<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="https://xs-mlvp.github.io/xs-bpu/docs/ports/">
<link rel="alternate" type="application/rss&#43;xml" href="https://xs-mlvp.github.io/xs-bpu/docs/ports/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/xs-bpu/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/xs-bpu/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-192x192.png" sizes="192x192">

<title>重要结构及接口文档 | 香山微架构开放验证第一期：昆明湖BPU模块UT验证实战</title>
<meta name="description" content="本文档将会对 BPU 中的重要结构以及对外接口进行描述，描述粒度将深入代码级别，通过阅读本文档，你可以理解香山分支预测单元中每一个信号是什么作用，理解各种请求的具体实现方式，也将使你能够结合代码进行功能的理解。">
<meta property="og:title" content="重要结构及接口文档" />
<meta property="og:description" content="本文档将会对 BPU 中的重要结构以及对外接口进行描述，描述粒度将深入代码级别，通过阅读本文档，你可以理解香山分支预测单元中每一个信号是什么作用，理解各种请求的具体实现方式，也将使你能够结合代码进行功能的理解。" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://xs-mlvp.github.io/xs-bpu/docs/ports/" />
<meta itemprop="name" content="重要结构及接口文档">
<meta itemprop="description" content="本文档将会对 BPU 中的重要结构以及对外接口进行描述，描述粒度将深入代码级别，通过阅读本文档，你可以理解香山分支预测单元中每一个信号是什么作用，理解各种请求的具体实现方式，也将使你能够结合代码进行功能的理解。"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="重要结构及接口文档"/>
<meta name="twitter:description" content="本文档将会对 BPU 中的重要结构以及对外接口进行描述，描述粒度将深入代码级别，通过阅读本文档，你可以理解香山分支预测单元中每一个信号是什么作用，理解各种请求的具体实现方式，也将使你能够结合代码进行功能的理解。"/>




<link rel="preload" href="/xs-bpu/scss/main.min.5081230fda7a265fa5fc10130b5bca4f0868fd0e77a3fa6ae4f2d28669ce5899.css" as="style">
<link href="/xs-bpu/scss/main.min.5081230fda7a265fa5fc10130b5bca4f0868fd0e77a3fa6ae4f2d28669ce5899.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?6aacb1c7ca0a3ef4e3aa84c1eaa237dd";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
    </script>


    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4Z2ZY6ZE84"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-4Z2ZY6ZE84');
    </script>


  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/xs-bpu/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">香山微架构开放验证第一期：昆明湖BPU模块UT验证实战</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="站内搜索…"
    aria-label="站内搜索…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/xs-bpu/offline-search-index.9307adac5e4355a47f5b60591ab52129.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/xs-bpu/docs/ports/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">重要结构及接口文档</h1>
<div class="lead">本文档将会对 BPU 中的重要结构以及对外接口进行描述，描述粒度将深入代码级别，通过阅读本文档，你可以理解香山分支预测单元中每一个信号是什么作用，理解各种请求的具体实现方式，也将使你能够结合代码进行功能的理解。</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-82ca2994e72c69cffbb84db4c9379254">FTB项与完整预测结果接口</a></li>


    
  
    
    
	
<li>2: <a href="#pg-31e8ba09abfd18f2000562cd1e9c5357">重定向与更新接口</a></li>


    
  
    
    
	
<li>3: <a href="#pg-356688b245f87b5c6a87c8d73ece8cd7">BPU 全局接口</a></li>


    
  
    
    
	
<li>4: <a href="#pg-9ec9b2e73fd778d6c722398e3805b765">子预测器基类与子预测器接口</a></li>


    
  

    </ul>


<div class="content">
      <p>本文档将会对 BPU 中的重要结构以及对外接口进行描述，描述粒度将深入代码级别，文档中描述的结构将与香山分支预测单元 Chisel 版本代码保持一致，信号结构及名称亦来自于 Chisel 版本代码。</p>
<p>文档适用于已经了解了香山分支预测单元基础设计，并想要深入了解信号细节的同学使用。可以根据验证需要的内容有选择的进行阅读，或随时进行查阅。</p>
<p>其中，FTB项与完整预测结果接口涉及 BPU 产生预测结果的方式，建议每位同学进行阅读。</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-82ca2994e72c69cffbb84db4c9379254">1 - FTB项与完整预测结果接口</h1>
    <div class="lead">BPU 的基本预测单位是分支预测块，然而分支预测块的结构是怎样的呢？为什么一个分支预测块可以指导接下来如此多条指令的执行呢？这一部分将讲述生成分支预测块的核心数据结构——FTB项，以及由 FTB 项生成的完整预测结果结构。</div>
	<h2 id="ftb-项">FTB 项</h2>
<p>FTB 项是香山中分支预测块的核心数据结构，它存储了生成一个分支预测块所需的信息。在BPU进行预测时，初始的分支预测块首先由一个读出的 FTB 项生成。然后，这个分支预测块会传递到后续的预测器中，后续的预测器会读取其中的信息并加以修改，生成最终的预测结果。</p>
<p>因此，要理解分支预测块的结构，首先需要理解FTB项的结构。一个FTB项对应着一个分支预测块，其大致结构如下：</p>

<figure>
    <img src="1.png" width="750px"/> 
</figure>

<p>首先，需要明确一个信息：无论是分支预测块还是FTB项，它们可以容纳的指令数量都被设定为一个特定的上限（在香山当前版本中为16条RVC指令），被称为<strong>最大预测长度</strong>。这意味着，如果我们需要记录分支预测块内某一条指令的位置，可以使用一个固定长度的位向量，来指定这条指令相对于预测块起始地址的偏移量。</p>
<p>分支预测块执行流程的决定因素是其中的分支指令信息。其余的指令都被视为普通指令，不影响程序的执行流。因此，在一个分支预测块中，我们只需记录下其中的分支指令位置即可，而普通指令的位置我们并不关心。</p>
<p>因此，FTB项中定义了两种类型的<strong>分支指令槽（slot）</strong>——<code>brSlots</code>和<code>tailSlot</code>，用于存储分支预测块中的分支指令。目前香山版本中，<code>brSlots</code>只含有一个 slot，而 <code>tailSlot</code> 则是一个单独的 slot，总计含有两个 slot。</p>
<p>在最大预测长度内的指令中，如果出现了分支指令，FTB项会将其记录在对应的slot内，并将该slot置为有效。如果分支指令出现过多，达到了FTB项的容纳上限，那么超出上限的分支指令则会交给下一个FTB项来存储。在每个 slot中，我们会记录一条分支指令相对于预测块起始地址的偏移量（offset），同时还会记录其跳转目标地址等信息。</p>
<h3 id="唯一的-tailslot">唯一的 tailSlot</h3>
<p>在RISC-V中，分支指令主要分为两种类型：条件分支和无条件跳转。因此，<strong>对于一个分支预测块来说，最多只会包含一条无条件跳转指令</strong>。因为一旦执行到这条指令，程序的执行流就会发生改变，后续的指令将不再执行。因此，我们定义了一种类型的 slot 叫做 <code>tailSlot</code>，专门用来存储这条无条件跳转指令。而对于条件分支指令，则将它们存储在<code>brSlots</code>中。</p>
<p><code>tailSlot</code>如其名，位于整个预测块中的最后一个 slot。这也是因为一旦填充了无条件跳转指令，程序必定跳转，之后的指令就由其他预测块进行处理，因此后续的指令情况我们无需关心。但在无条件跳转指令之前的指令中，我们需要关心是否存在条件分支指令，因为条件分支指令既有可能跳转，也有可能不跳转。因此，我们需要记录下条件分支指令的相关信息。</p>
<h3 id="tailslot-共享">tailSlot 共享</h3>
<p>考虑一种情况：如果从预测块起始PC开始直到最大预测长度，都没有出现无条件跳转指令，反而出现了两条条件分支指令，这样一来，<code>tailSlot</code> 就会空闲，而第二条条件分支指令又无法存储，造成空间的浪费。</p>
<p>为了解决这个问题，香山采用了一种方法：设置一个 <code>sharing</code> 标记。我们可以直接将第二条分支指令存储到<code>tailSlot</code> 中，并将sharing标记设置为真，表示第二条条件分支指令共享了无条件跳转指令的 <code>tailSlot</code>。这样，就有效利用了tailSlot的空间。</p>
<p>预测块中的 <code>isCall</code>、<code>isRet</code>和<code>isJalr</code>字段是为<code>tailSlot</code>服务的。如果tailSlot中记录的是无条件跳转指令，这几个字段会进一步指示该跳转指令的类型。在FTB项中还有一个字段 <code>always_taken</code>，用来记录每个Slot中存储的条件分支指令是否总是被预测为跳转。如果是的话，后续的预测器可以直接采用这一预测结果。</p>
<p>通过FTB项，我们可以得知一个分支预测块中的指令情况，包括分支指令的位置、类型等。这些信息会交给后续的预测器，由后续的预测器来预测更为精确的跳转目标、是否跳转等信息。</p>
<h2 id="ftb-项完整结构-ftbentry">FTB 项完整结构 （FTBEntry）</h2>
<p>接口定义: <code>src/main/scala/xiangshan/frontend/FTB.scala</code></p>
<p>本节中描述了 FTB 项的完整结构定义，其所含的信号如下：</p>
<ul>
<li><strong>valid</strong>: FTB表项是否有效。
<ul>
<li>接口类型: <code>Bool</code></li>
</ul>
</li>
<li><strong>brSlots</strong>: 条件分支指令槽。
<ul>
<li>接口类型: <code>Vec(numBrSlot, new FtbSlot(BR_OFFSET_LEN))</code> （接口列表详见FtbSlot）</li>
</ul>
</li>
<li><strong>tailSlot</strong>: 无条件跳转指令槽。
<ul>
<li>接口类型: <code>new FtbSlot(JMP_OFFSET_LEN, Some(BR_OFFSET_LEN))</code> （接口列表详见FtbSlot）</li>
</ul>
</li>
<li><strong>pftAddr</strong>: 预测块的结束地址。
<ul>
<li>接口类型: <code>UInt(log2Up(PredictWidth).W)</code></li>
</ul>
</li>
<li><strong>carry</strong>: 预测块的结束地址进位。
<ul>
<li>接口类型: <code>Bool()</code></li>
</ul>
</li>
<li><strong>isCall</strong>: 无条件跳转指令槽中的指令为 call 指令。
<ul>
<li>接口类型: <code>Bool()</code></li>
</ul>
</li>
<li><strong>isRet</strong>: 无条件跳转指令槽中的指令为 ret 指令。
<ul>
<li>接口类型: <code>Bool()</code></li>
</ul>
</li>
<li><strong>isJalr</strong>: 无条件跳转指令槽中的指令为 jalr 指令。
<ul>
<li>接口类型: <code>Bool()</code></li>
</ul>
</li>
<li><strong>last_may_be_rvi_call</strong>:  无条件跳转指令槽中的指令可能为一个 RVI 类型的 call 指令信号。
<ul>
<li>接口类型: <code>Bool()</code></li>
</ul>
</li>
<li><strong>always_taken</strong>: 该预测块中的每个分支指令是否总是被预测为 Taken。
<ul>
<li>接口类型: <code>Vec(numBr, Bool())</code></li>
</ul>
</li>
</ul>
<p><strong>说明：pftAddr 和 carry</strong></p>
<p>在这里，<code>pftAddr</code>是Partial Fallthrough Addr的缩写。Fallthrough Addr 表示，如果预测块中没有跳转，那么程序将会顺序执行到达的地址。换句话说，如果一条无条件跳转指令的偏移为5，那么 Fallthrough Addr 对应的偏移便是6。这一信号主要用于获取函数调用后程序的返回地址，可以将这一概念理解为预测块的结束地址。</p>
<p>Partial 表示部分地址，这是由地址的表示方法决定的。在这里，地址的表示方法如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Plain" data-lang="Plain"><span style="display:flex;"><span>  pc: | ... |&lt;-- log(predictWidth) --&gt;|&lt;-- log(instBytes) --&gt;|
</span></span><span style="display:flex;"><span>           ^                         ^
</span></span><span style="display:flex;"><span>           |                         |
</span></span><span style="display:flex;"><span>           carryPos                  instOffsetBits
</span></span></code></pre></div><p><code>pftAddr</code> 便是只记录了中间的偏移部分（即长度为 log(predictWidth) 的部分），之后结合当前 PC 才能生成完整 PC。但由于有可能产生进位，因此单独记录一个 <code>carry</code> 位，carryPos 是预测块中的指令地址中 会产生进位的位置</p>
<p>另外，<code>last_may_be_rvi_call</code> 也是对该地址的一个辅助信号，表示无条件跳转指令槽中的指令是一个RVI类型的 call 指令。由于pftAddr在计算时默认认为指令长度为压缩指令长度，因此计算结束地址只会加 2 字节。但如果实际的call指令并不是压缩指令，就会导致返回地址计算错误。RAS会根据这一信号修正这个错误。</p>
<h2 id="分支预测槽-ftbslot">分支预测槽 （FTBSlot）</h2>
<p>接口定义: <code>src/main/scala/xiangshan/frontend/FTB.scala</code></p>
<p>该接口定义了 FTB 表项中 slot：</p>
<ul>
<li><strong>offset</strong>: 该 slot 中指令相对于预测块起始地址的偏移
<ul>
<li>接口类型：<code>UInt(log2Ceil(PredictWidth).W)</code></li>
</ul>
</li>
<li><strong>lower</strong>: 跳转目标地址的低位。
<ul>
<li>接口类型：<code>UInt(offsetLen.W)</code></li>
<li>说明：这里设置 lower 为 12 位或 20 位，因为分支指令的寻址能力为 12 位，而跳转指令的寻址能力为 20 位</li>
</ul>
</li>
<li><strong>tarStat</strong>: 跳转后的 pc 高位是否进退位
<ul>
<li>接口类型：<code>UInt(TAR_STAT_SZ.W)</code>（TAR_STAT_SZ = 2）</li>
<li>说明：跳转目标地址由当前 PC 的高位、tarState 以及 lower 字段共同计算得出，其中，lower 字段直接存储了跳转目标地址的低位。当前的 PC 高位经过 tarStat 指导进行进退位之后，直接与 lower 拼接便可得到真正的跳转目标地址。tarStat 共有三个可能的取值：0 - 不进不退, 1 - 进位, 2 - 退位。</li>
</ul>
</li>
<li><strong>sharing</strong>: 无条件跳转指令槽中存储了一条条件分支指令。
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>valid</strong>: slot 有效位。
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
</ul>
<h2 id="完整分支预测结果-fullbranchprediction">完整分支预测结果 (FullBranchPrediction)</h2>
<ul>
<li>接口定义: <code>src/main/scala/xiangshan/frontend/FrontendBundle.scala</code></li>
</ul>
<p>该接口定义了完整的分支预测结果，每流水级预测结果中都会包含该接口。</p>
<p>完整分支预测结果接口与 FTB 项相差无几，并最初由 FTB 项生成。两个Slot被拆分成了单独的信号：<code>slot_valids</code>, <code>targets</code>, <code>offsets</code>, <code>is_br_sharing</code> 等，另外增加了若干字段例如 <code>br_taken_mask</code>, <code>jar_target</code> 便于后续预测器提供精确预测结果，另外 <code>hit</code> 表示 FTB 项是否命中，即本轮预测中的 PC 索引到了某个 FTB 项。</p>
<p><strong>完整接口列表如下：</strong></p>
<ul>
<li>
<p><strong>hit</strong> FTB表项是否命中</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>slot_valids</strong> slot有效位，表示 ftb 项中的每个 slot 是否有效</p>
<ul>
<li>接口类型：<code>Vec(totalSlot, Bool())</code></li>
</ul>
</li>
<li>
<p><strong>targets</strong> 每个 slot 对应的跳转目标地址</p>
<ul>
<li>接口类型：<code>Vec(totalSlot, UInt(VAddrBits.W))</code></li>
</ul>
</li>
<li>
<p><strong>offsets</strong> 每个 slot 中的指令相对于预测块起始地址的偏移</p>
<ul>
<li>接口类型：<code>Vec(totalSlot, UInt(log2Ceil(PredictWidth).W))</code></li>
</ul>
</li>
<li>
<p><strong>fallThroughAddr</strong> 预测块的结束地址</p>
<ul>
<li>接口类型：<code>UInt(VAddrBits.W)</code></li>
</ul>
</li>
<li>
<p><strong>fallThroughErr</strong> FTB项中记录的 <code>pftAddr</code> 有误</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>is_jal</strong> 预测块内包含jal指令</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>is_jalr</strong> 预测块内包含jalr指令</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>is_call</strong> 预测块内包含call指令</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>is_ret</strong> 预测块内包含ret指令</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>last_may_be_rvi_call</strong>  无条件跳转指令槽中的指令可能为一个 RVI 类型的 call 指令信号。</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>is_br_sharing</strong> 最后一个slot (tailSlot) 中存储的是条件分支指令信号</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>br_taken_mask</strong> 分支预测结果，每个分支(slot)对应一位，表示该分支是否被预测为 taken</p>
<ul>
<li>接口类型：<code>Vec(numBr, Bool())</code></li>
</ul>
</li>
<li>
<p><strong>jalr_target</strong> 本预测块中的 jalr 的跳转目标</p>
<ul>
<li>接口类型：<code>UInt(VAddrBits.W)</code></li>
</ul>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-31e8ba09abfd18f2000562cd1e9c5357">2 - 重定向与更新接口</h1>
    <div class="lead">重定向与更新请求是 FTQ 发往 BPU 的两大信息类型，本节中讲述了这两种请求接口的具体结构。</div>
	<h2 id="分支预测重定向branchpredictionredirect"><strong>分支预测重定向（BranchPredictionRedirect）</strong></h2>
<p><strong>接口定义：</strong><code>src/main/scala/xiangshan/frontend/FrontendBundle.scala</code></p>
<p><strong>接口类型：</strong><code>BranchPredictionRedirect</code></p>
<p>该接口定义了分支预测单元的重定向请求，主要用于重定向分支预测器的状态。</p>
<p><code>BranchPredictionRedirct</code> 接口继承自 <code>Redirct</code> 接口，所含信号较多，BPU 重定向只会用到其中一部分接口，文档描述的结构中只包含 BPU 用到的接口内容。</p>
<p>重定向请求有两种来源，与 IFU 预译码信息对比生成的重定向请求，后端执行过程中的重定向请求。</p>
<p><strong>在重定向请求中，关键信息是</strong><code>cfiUpdate</code>，<strong>即控制流指令信息。这一信息对应着一条指令，也就是BPU发生预测错误的指令</strong>。举例来说，如果 BPU 在预测块中指示第三条指令为普通指令不发生跳转，但预译码显示第三条指令是一条无条件跳转指令，必定会跳转。在这种情况下，BPU 发生了预测错误，FTQ 产生了重定向请求。在重定向请求中，<code>cfiUpdate</code> 将会对应这条无条件跳转指令。</p>
<p><code>cfiUpdate</code> 中的信息可大致分为三种类型的信息：</p>
<ol>
<li><strong>对应指令的信息及执行情况</strong>。其中会说明该指令在预测块中位于那个槽 (shift) 及 pc； 会指示这条指令的类型相关信息 (pd)；还有这条指令的执行情况，例如跳转目标、是否跳转等</li>
<li><strong>历史维护相关信息</strong>。重定向请求中包含了该条指令所处的预测块对应的分支历史信息，以帮助BPU恢复分支历史信息。<code>foleded_hist</code> 代表全局折叠历史，<code>histPtr</code> 代表全局历史指针，而其余信息则是维护分支历史的辅助信息。要详细了解这些信息的含义，请参阅 <code>BPU顶层模块</code>。</li>
<li><strong>RAS维护相关信息</strong>。详细含义请参阅 RAS 子预测器文档。</li>
</ol>
<p><code>level</code> 信息的含义是，重定向是否包含本条指令，如果不包含，重定向请求的接收方将认为这条指令已经被执行了，下次预测将从下一条指令开始。<code>BPU</code> 顶层会默认不包含本条指令，收到重定向请求后，会将本条指令的执行情况统计到分支历史当中。</p>
<p><strong>以下为重定向接口的详细信号列表：</strong></p>
<ul>
<li>
<p><strong>level</strong>: 重定向请求是否包括本位置，低表示在本位置后重定向，高表示在本位置重定向。</p>
<ul>
<li>接口类型: <code>UInt(1.W)</code></li>
</ul>
</li>
<li>
<p><strong>cfiUpdate</strong>: 控制流指令更新信息</p>
<ul>
<li>
<p>接口类型: <code>CfiUpdateInfo</code></p>
</li>
<li>
<p>接口列表</p>
<ul>
<li><strong>pc</strong>: 重定向请求对应的指令 PC
<ul>
<li>接口类型: <code>UInt(VaddrBits.W)</code></li>
</ul>
</li>
<li><strong>pd</strong>: 重定向指令的预译码信息
<ul>
<li><strong>isRVC</strong>: 是否是压缩指令
<ul>
<li>接口类型: <code>Bool</code></li>
</ul>
</li>
<li><strong>isCall</strong>: 是否是函数调用
<ul>
<li>接口类型: <code>Bool</code></li>
</ul>
</li>
<li><strong>isRet</strong>: 是否是函数返回
<ul>
<li>接口类型: <code>Bool</code></li>
</ul>
</li>
</ul>
</li>
<li><strong>target</strong>: 重定向请求指令的目标地址。
<ul>
<li>接口类型: <code>UInt(VaddrBits.W)</code></li>
</ul>
</li>
<li><strong>taken</strong>: 重定向请求指令是否发生跳转。
<ul>
<li>接口类型: <code>Bool</code></li>
</ul>
</li>
<li><strong>shift</strong>: 重定向请求指令位于哪个槽，如果是普通指令则为0.
<ul>
<li>接口类型: <code>UInt((log2Ceil(numBr)+1).W)</code></li>
</ul>
</li>
<li><strong>addIntoHist</strong>: 重定向请求指令执行信息是否要加入分支历史。
<ul>
<li>接口类型: <code>Bool</code></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>folded_hist</strong>: 重定向请求对应的折叠历史。
<ul>
<li>接口类型: <code>AllFoldedHistories(foldedGHistInfos)</code></li>
</ul>
</li>
<li><strong>afhob</strong>: 重定向请求指令对应的分支历史最老位。
<ul>
<li>接口类型: <code>AllAheadFoldedHistoryOldestBits(foldedGHistInfos)</code></li>
</ul>
</li>
<li><strong>lastBrNumOH</strong>: 重定向请求对应的上次跳转位置。
<ul>
<li>接口类型: <code>UInt((numBr+1).W)</code></li>
</ul>
</li>
<li><strong>histPtr</strong>: 重定向请求需要恢复的全局历史指针。
<ul>
<li>接口类型: <code>CGHPtr</code></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>ssp</strong>: 重定向请求指令对应的 RAS 推测栈栈顶在提交栈位置的指针。
<ul>
<li>接口类型: <code>UInt(log2Up(RasSize).W)</code></li>
</ul>
</li>
<li><strong>sctr</strong>: 重定向请求指令对应的 RAS 推测栈栈顶递归计数 Counter。
<ul>
<li>接口类型: <code>UInt(log2Up(RasCtrSize).W)</code></li>
</ul>
</li>
<li><strong>TOSW</strong>: 重定向请求指令对应的 RAS 推测栈（队列）写指针。
<ul>
<li>接口类型: <code>CGHPtr</code></li>
</ul>
</li>
<li><strong>TOSR</strong>: 重定向请求指令对应的 RAS 推测栈（队列）读指针。
<ul>
<li>接口类型: <code>CGHPtr</code></li>
</ul>
</li>
<li><strong>NOS</strong>: 重定向请求指令的 RAS 栈顶 Counter。
<ul>
<li>接口类型: <code>CGHPtr</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="分支预测更新branchpredictionupdate"><strong>分支预测更新（BranchPredictionUpdate）</strong></h2>
<p>接口定义: <code>src/main/scala/xiangshan/frontend/FrontendBundle.scala</code></p>
<p>该接口定义了分支预测器的更新请求，主要用于更新分支预测器的状态，文档只列出了在 BPU 中使用的接口。</p>
<p>更新请求与每一个分支预测块一一对应，当 FTQ 中的一个分支预测块被执行过以后，FTQ 将会为这个分支预测块产生一个更新请求，来指导预测器进行训练，因此更新请求中的一个重要职责就是向 BPU 反馈指令的真实执行情况。当然在香山分支预测单元中，更新请求还会负责 FTB 项的更新</p>
<p>更新请求中的信息可大致分为四类：</p>
<ul>
<li><strong>PC</strong>    表示预测块的起始地址，指示了该更新请求对应哪个分支预测块</li>
<li><strong>FTB 项更新信息</strong>    更新通道中会含有一个 FTB 项结构 (ftb_entry)，输出 FTQ 新生成的 FTB 项，并且还会指示是否与旧的 FTB 项相同 (old_entry)</li>
<li><strong>指令真实执行情况信息</strong>    更新通道中会指示该分支预测块中分支指令和无条件跳转指令的执行情况，还会给出控制流指令（即发生跳转的指令）的地址以及最终跳转目标。</li>
<li><strong>与该预测块对应的预测器相关数据</strong>   包含 spec_info 以及 meta 信息。（具体请参阅BPU全局接口文档）</li>
</ul>
<p><strong>更新请求的接口列表如下：</strong></p>
<ul>
<li><strong>pc</strong> 更新请求的pc (预测块起始地址)
<ul>
<li>接口类型：<code>UInt(VAddrBits.W)</code></li>
</ul>
<hr>
</li>
<li><strong>ftb_entry</strong> 更新后的ftb项
<ul>
<li>接口类型：<code>new FTBEntry()</code></li>
<li>接口列表：详见（<code>FTBEntry</code>）</li>
</ul>
</li>
<li><strong>old_entry</strong> 更新后的 FTB 项是否与旧的 FTB 项相同
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
<hr>
</li>
<li><strong>br_taken_mask</strong> 预测块内每个slot内指令是否跳转
<ul>
<li>接口类型：<code>Vec(numBr, Bool())</code></li>
</ul>
</li>
<li><strong>mispred_mask</strong> 预测块内预测错误的掩码。第一、二位分别代表两个条件分支指令是否预测错误，第三位指示无条件跳转指令是否预测错误。
<ul>
<li>接口类型：<code>Vec(numBr+1, Bool())</code></li>
</ul>
</li>
<li><strong>jmp_taken</strong> 预测块内无条件跳转指令被触发
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>cfi_idx</strong> 控制流指令在预测块中的索引
<ul>
<li>接口类型：<code>ValidUndirectioned(UInt(log2Ceil(PredictWidth).W))</code></li>
</ul>
</li>
<li><strong>full_target</strong> 预测块的跳转目标（下一个预测块的起始地址）
<ul>
<li>接口类型：<code>UInt(VAddrBits.W)</code></li>
</ul>
<hr>
</li>
<li><strong>spec_info</strong> 该预测块对应的 last_stage_spec_info
<ul>
<li>接口类型：<code>new SpeculativeInfo</code></li>
<li>接口列表：（只用到了 <code>foled_hist</code> 一项）
<ul>
<li><strong>folded_hist</strong> 全局折叠历史
<ul>
<li>接口类型：<code>AllFolededHistories(foldedGHistInfos)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>meta</strong> 该预测块对应的 last_stage_meta 信息
<ul>
<li>接口类型：<code>UInt(MaxMetaLength.W)</code></li>
</ul>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-356688b245f87b5c6a87c8d73ece8cd7">3 - BPU 全局接口</h1>
    <div class="lead">本节中介绍了香山分支预测单元整体对外交互的接口的定义，包括全局分支预测结果和单流水级预测结果的呈现形式。</div>
	<h2 id="bpu-模块整体对外接口-predirectio"><strong>BPU 模块整体对外接口 (PredirectIO)</strong></h2>
<p>接口定义: <code>src/main/scala/xiangshan/frontend/BPU.scala</code></p>
<p>PredirectIO 是分支预测器整体的对外接口，它主要处理了分支预测器（BPU）与取值目标缓冲（FTQ）之间的交互，主要包含以下几个部分：</p>
<ul>
<li><strong>bpu_to_ftq</strong>: BPU 向 FTQ 发送的信息，主要用于 BPU 向 FTQ 发送分支预测结果
<ul>
<li>接口类型： <code>BpuToFtqIO</code></li>
<li>信号列表：
<ul>
<li><strong>resp</strong>: BPU 向 FTQ 发送的全局分支预测信息
<ul>
<li>接口类型：<code>DecoupledIO(new BpuToFtqBundle())</code>
<ul>
<li><code>BpuToFtqBundle</code> 继承自 <code>BranchPredictionResp</code>，没有额外的信号</li>
</ul>
</li>
<li>信号列表：详见 (<code>BranchPredictionResp</code>)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>ftq_to_bpu</strong>: FTQ 向 BPU 发送的信息，主要用于处理重定向及更新请求
<ul>
<li>接口类型： <code>FtqToBpuIO</code></li>
<li>信号列表：
<ul>
<li><strong>redirect</strong>: FTQ 向 BPU 发送的重定向请求
<ul>
<li>接口类型： <code>Valid(new BranchPredictionRedirect)</code></li>
<li>接口列表：详见（<code>BranchPredictionRedirect</code>）</li>
</ul>
</li>
<li><strong>update</strong>: FTQ 向 BPU 发送的更新请求
<ul>
<li>接口类型：<code>Valid(new BranchPredictionUpdate)</code></li>
<li>接口列表：详见（<code>BranchPredictionUpdate</code>）</li>
</ul>
</li>
<li><strong>enq_ptr</strong>: FTQ发送给BPU的FTQ指针，告诉BPU下一次需要写到哪个FTQ表项
<ul>
<li>接口类型：<code>FtqPtr</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>ctrl</strong>: BPU 控制信号，主要用于控制各预测器的使能
<ul>
<li>接口类型：<code>BPUCtrl</code></li>
<li>接口列表：
<ul>
<li><strong>ubtb_enable</strong>: UBTB 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>btb_enable</strong>: BTB 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>bim_enable</strong>: BIM 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>tage_enable</strong>: TAGE 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>sc_enable</strong>: SC 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>ras_enable</strong>: RAS 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>loop_enable</strong>: LOOP 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>reset_vector</strong>: 重置向量，reset 时 BPU 的 pc 会被重置为该值
<ul>
<li>接口类型：<code>UInt(PAddrBits.W)</code></li>
</ul>
</li>
</ul>
<h2 id="全局分支预测信息-branchpredictionresp"><strong>全局分支预测信息 (BranchPredictionResp)</strong></h2>
<p>接口定义: <code>src/main/scala/xiangshan/frontend/FrontendBundle.scala</code></p>
<p>该接口定义了分支预测器预测的所有结果信息，包含了每一阶段的预测结果，以及最后一个流水级输出的相关信息。</p>
<ul>
<li><strong>s1</strong> s1流水级的分支预测结果</li>
<li><strong>s2</strong> s2流水级的分支预测结果</li>
<li><strong>s3</strong> s3流水级的分支预测结果
<ul>
<li>接口类型：<code>BranchPredictionBundle</code></li>
<li>信号列表：详见（<code>BranchPredictionBundle</code>）</li>
</ul>
</li>
<li><strong>last_stage_meta</strong> 最后一个流水级的输出的本轮预测的预测器元数据。是一个位向量，由每个预测器输出、并由 Composer 合并为一个。
<ul>
<li>接口类型：<code>UInt(MaxMetaLength.W)</code></li>
</ul>
</li>
<li><strong>last_stage_spec_info</strong> 最后一个流水级的输出的本轮预测的相关信息
<ul>
<li>接口类型：<code>Ftq_Redirect_SRAMEntry</code></li>
<li>接口列表：
<ul>
<li><strong>folded_hist</strong>  全局折叠历史
<ul>
<li>接口类型：<code>AllFoldedHistories(foldedGHistInfos)</code></li>
</ul>
</li>
<li><strong>afhob</strong> 全局分支历史最老位
<ul>
<li>接口类型：<code>AllAheadFoldedHistoryOldestBits(foldedGHistInfos)</code></li>
</ul>
</li>
<li><strong>lastBrNumOH</strong> 上次跳转位置。
<ul>
<li>接口类型：<code>UInt((numBr+1).W)</code></li>
</ul>
</li>
<li><strong>histPtr</strong> 全局分支历史指针
<ul>
<li>接口类型：<code>CGHPtr</code></li>
</ul>
</li>
<li><strong>ssp</strong> RAS推测栈栈顶在提交栈位置的指针
<ul>
<li>接口类型：<code>UInt(log2Up(RasSize).W)</code></li>
</ul>
</li>
<li><strong>sctr</strong> RAS推测栈栈顶递归计数 Counter
<ul>
<li>接口类型：<code>UInt(log2Up(RasCtrSize).W)</code></li>
</ul>
</li>
<li><strong>TOSW</strong> RAS推测栈（队列）写指针
<ul>
<li>接口类型：<code>CGHPtr</code></li>
</ul>
</li>
<li><strong>TOSR</strong> RAS推测栈（队列）读指针
<ul>
<li>接口类型：<code>CGHPtr</code></li>
</ul>
</li>
<li><strong>NOS</strong> RAS栈顶 Counter
<ul>
<li>接口类型：<code>CGHPtr</code></li>
</ul>
</li>
<li><strong>topAddr</strong> RAS栈顶返回地址
<ul>
<li>接口类型：<code>UInt(VAddrBits.W)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>last_stage_ftb_entry</strong> 最后一个流水级的输出的FTB表项
<ul>
<li>接口类型：<code>FtqEntry</code></li>
<li>接口列表：详见（<code>FtqEntry</code>）</li>
</ul>
</li>
</ul>
<h2 id="单流水级分支预测结果-branchpredictionbundle"><strong>单流水级分支预测结果 (BranchPredictionBundle)</strong></h2>
<p>接口定义: <code>src/main/scala/xiangshan/frontend/FrontendBundle.scala</code></p>
<p>该接口定义了每个流水级对外输出的分支预测结果信息，</p>
<ul>
<li><strong>pc</strong> 预测块的起始 pc
<ul>
<li>接口类型：<code>Vec(numDup, UInt(VAddrBits.W))</code> numDup仅为寄存器复制，其中信号完全相同</li>
</ul>
</li>
<li><strong>valid</strong> 预测结果是否有效
<ul>
<li>接口类型：<code>Vec(numDup, Bool())</code></li>
</ul>
</li>
<li><strong>hasRedirect</strong> 是否需要重定向
<ul>
<li>接口说明：只有s2, s3阶段会重定向，重定向发生时本阶段预测结果会覆盖之前流水级的结果</li>
<li>接口类型：<code>Vec(numDup, Bool())</code></li>
</ul>
</li>
<li><strong>ftq_idx</strong> FTQ指针，指向该阶段对应预测信息的FTQ表项
<ul>
<li>接口类型：<code>new FtqPtr</code></li>
</ul>
</li>
<li><strong>full_pred</strong> 完整的分支预测结果
<ul>
<li>接口类型：<code>Vec(numDup, new FullBranchPrediction)</code></li>
<li>接口列表：详见（<code>FullBranchPrediction</code>）</li>
</ul>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9ec9b2e73fd778d6c722398e3805b765">4 - 子预测器基类与子预测器接口</h1>
    <div class="lead">本文档介绍了香山BPU中的子预测器接口，以及子预测器基类的使用，阅读此文档可帮助你了解子预测器的对外交互，和子预测器基类中信号的使用。</div>
	<p>在香山分支预测单元中，其所有子预测器以及 Composer 的类实现都是继承自子预测器基类（BasePredictor），并且子预测器接口（BasePredictorIO）也是在子预测器基类中进行定义。因此我们可以认为，Compser 和所有子预测器都含有相同的接口。</p>
<p>在子预测的理解及验证当中，我们最直接的外界交互是发生在子预测器接口，以及子预测器基类中定义的一些变量，因此在子预测器的验证之前，强烈建议你阅读并理解本节文档。</p>
<p>子分支预测器接口的大致内容及使用方法，已在<code>香山分支预测单元（BPU）基础设计</code>中进行了介绍，本节文档将专注于接口的信号细节。</p>
<h2 id="子分支预测器接口-basepredictorio"><strong>子分支预测器接口 (BasePredictorIO)</strong></h2>
<p>接口定义: <code>src/main/scala/xiangshan/frontend/BPU.scala</code></p>
<p>每个子分支预测器都需要实现该接口，该接口定义了子分支预测器的输入输出接口。</p>
<p>注意：其中某些信号被定义为了 <code>numDup</code> 个数量，其中每个信号完全一样，多个相同信号是为其他因素考虑。</p>
<p>详细的信号列表如下：</p>
<ul>
<li>
<p><strong>reset_vector</strong> 重置向量，reset 时 BPU 的 pc 会被重置为该值</p>
<ul>
<li>接口类型：<code>UInt(PAddrBits.W)</code></li>
</ul>
</li>
<li>
<p><strong>in</strong> BPU 向子分支预测器发送的信息</p>
<ul>
<li>接口类型：<code>DecoupledIO(new BasePredictorInput)</code></li>
<li>信号列表：
<ul>
<li><strong>s0_pc</strong> s0流水级的pc
<ul>
<li>接口类型：<code>Vec(numDup, UInt(VAddrBits.W))</code></li>
</ul>
</li>
<li><strong>folded_hist</strong> 全局折叠历史信息
<ul>
<li>接口类型：<code>Vec(numDup, new AllFoldedHistories(foldedGHistInfos))</code></li>
<li>信号列表：详见（<code>AllFoldedHistories</code>）</li>
</ul>
</li>
<li><strong>ghist</strong> 全局分支历史信息
<ul>
<li>接口类型：<code>UInt(HistoryLength.W)</code></li>
</ul>
</li>
<li><strong>resp_in</strong> 全局分支预测信息（包含s1, s2, s3 预测结果信息）
<ul>
<li>接口类型：<code>BranchPredictionResp</code></li>
<li>信号列表：详见（<code>BranchPredictionResp</code>）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>out</strong> 子分支预测器向 BPU 发送的信息（包含s1, s2, s3 预测结果信息）</p>
<ul>
<li>接口类型：<code>new BasePredictorOutput</code> 继承自 <code>BranchPredictionResp</code></li>
<li>信号列表：详见（<code>BranchPredictionResp</code>）</li>
</ul>
</li>
<li>
<p><strong>ctrl</strong> BPU 子预测器使能控制信号，主要用于控制各预测器是否开启</p>
<ul>
<li>接口类型：<code>BPUCtrl</code></li>
<li>接口列表：
<ul>
<li><strong>ubtb_enable</strong>: UBTB 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>btb_enable</strong>: BTB 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>bim_enable</strong>: BIM 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>tage_enable</strong>: TAGE 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>sc_enable</strong>: SC 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>ras_enable</strong>: RAS 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li><strong>loop_enable</strong>: LOOP 预测器使能
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>s0_fire</strong> s0阶段握手成功信号</p>
<ul>
<li>接口类型：<code>Vec(numDup, Bool())</code></li>
</ul>
</li>
<li>
<p><strong>s1_fire</strong> s1阶段握手成功信号</p>
<ul>
<li>接口类型：<code>Vec(numDup, Bool())</code></li>
</ul>
</li>
<li>
<p><strong>s2_fire</strong> s2阶段握手成功信号</p>
<ul>
<li>接口类型：<code>Vec(numDup, Bool())</code></li>
</ul>
</li>
<li>
<p><strong>s3_fire</strong> s3阶段握手成功信号</p>
<ul>
<li>接口类型：<code>Vec(numDup, Bool())</code></li>
</ul>
</li>
<li>
<p><strong>s2_redirect</strong> s2阶段重定向信号</p>
<ul>
<li>接口类型：<code>Vec(numDup, Bool())</code></li>
</ul>
</li>
<li>
<p><strong>s3_redirect</strong> s3阶段重定向信号</p>
<ul>
<li>接口类型：<code>Vec(numDup, Bool())</code></li>
</ul>
</li>
<li>
<p><strong>s1_ready</strong> s1阶段是否准备好接收信息 （方向：由子预测器输出）</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>s2_ready</strong> s2阶段是否准备好接收信息 （方向：由子预测器输出）</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>s3_ready</strong> s3阶段是否准备好接收信息 （方向：由子预测器输出）</p>
<ul>
<li>接口类型：<code>Bool()</code></li>
</ul>
</li>
<li>
<p><strong>update</strong> BPU 向子分支预测器转发的更新请求</p>
<ul>
<li>接口类型：<code>Valid(new BranchPredictionUpdate)</code></li>
<li>信号列表：详见（<code>BranchPredictionUpdate</code>）</li>
</ul>
</li>
<li>
<p><strong>redirect</strong> BPU 向子分支预测器转发的重定向请求</p>
<ul>
<li>接口类型：<code>Valid(new BranchPredictionRedirect)</code></li>
<li>信号列表：详见（<code>BranchPredictionRedirect</code>）</li>
</ul>
</li>
</ul>
<p>其中，流水线控制信号将会在下面内容中进行进一步的说明。</p>
<h3 id="全局折叠历史-allfoldedhistories">全局折叠历史 (AllFoldedHistories)</h3>
<p><strong>接口定义：</strong><code>src/main/scala/xiangshan/frontend/FrontendBundle.scala</code></p>
<p><strong>接口类型：</strong><code>AllFoldedHistories(foldedGHistInfos))</code></p>
<p>全局折叠历史的接口信息仅为一个 <code>FoldedHistory</code> 的列表</p>
<ul>
<li><strong>hist</strong> 折叠历史列表
<ul>
<li>接口类型：<code>MixedVec(gen.map{case (l, cl) =&gt; new FoldedHistory(l, cl, numBr)})</code></li>
</ul>
</li>
</ul>
<p>而 <code>FoldedHistory</code> 的接口信息也仅有一项</p>
<ul>
<li><strong>folded_hist</strong> 单项折叠历史，其位宽为历史压缩后长度。
<ul>
<li>接口类型：<code>UInt(compLen.W)</code></li>
</ul>
</li>
</ul>
<p>也就是说，全局折叠历史接口实际上是一个存储了折叠后历史的列表，其中每一项都是一个特定长度的折叠历史。</p>
<h2 id="子预测器基类">子预测器基类</h2>
<p>在子预测器基类中定义了若干信号，并在每个子预测器中都可以访问到，并在其中还进行了若干连线。</p>
<p>其中多数信号都较容易理解 ，我们需要重点关注的是其中每个流水的 pc，这还会涉及到你对于流水线控制信号的掌握。因此接下来，我们将会介绍在子预测器中需要关注的流水线控制信号的含义，以及 s1_pc, s2_pc, s3_pc 信号的含义。</p>
<p>其中流水线控制信号共分为 3 组：</p>
<ul>
<li>fire 信号 (s0, s1, s2, s3)</li>
<li>redirect 信号 (s2, s3)</li>
<li>ready 信号 (s1, s2, s3)</li>
</ul>
<p>子预测器基类中的 pc 信号共有四组，<code>s0_pc_dup</code>, <code>s1_pc_dup</code>, <code>s2_pc_dup</code>, <code>s3_pc_dup</code>。每组信号中有多个 pc 信号，他们完全相同，为考虑一些其他因素所复制。因此我们可单纯把他们看做 <code>s0_pc</code>, <code>s1_pc</code>, <code>s2_pc</code>, <code>s3_pc</code>。</p>
<p>他们的用法可参照下图：</p>

<figure>
    <img src="1.png" width="700px"/> 
</figure>

<p>他们与流水线控制信号的关系是：</p>
<ul>
<li><code>s0_pc</code> 直接由输入接口中的 <code>in.s0_pc</code> 连接而来</li>
<li>当 <code>s0_fire</code> 生效时，下一周期 <code>s1_pc</code> 会输出 <code>s0_pc</code> 的值</li>
<li>当 <code>s1_fire</code> 生效时，下一周期 <code>s2_pc</code> 会输出 <code>s1_pc</code> 的值</li>
<li>当 <code>s2_fire</code> 生效时，下一周期 <code>s3_pc</code> 会输出 <code>s2_pc</code> 的值</li>
</ul>
<p>也就是说，<code>fire</code> 信号是会影响到下一个周期的数据是否有效，比如 <code>s0_fire</code> 信号会影响 s1 流水的数据是否有效，<code>s1_fire</code> 信号会影响到 s2 流水的数据是否有效。</p>
<p>而 <code>fire</code> 信号是否有效取决于本流水级数据是否有效 以及 下一流水级是否 ready。例如 <code>s1_fire</code> 信号有效的条件必须包含 s1 阶段数据有效，以及子预测器输出的 <code>s2_ready</code> 信号为有效，此时便可认为，s1 阶段数据处理完成，并且 s2 阶段就绪，下一周期数据将被直接送入 s2 阶段。</p>
<p>因此在子预测器中，以 s1 阶段为例，<code>s1_ready</code> 可以阻塞数据进入 s1 阶段，当 <code>s1_ready</code> 生效时，下一周期 s1 阶段的数据便会生效。而<strong>当</strong> <strong><code>s1_fire</code></strong> <strong>有效的同时，说明 s1 阶段数据已经生效，预测器也已经将 s1 阶段的结果生成</strong>，下一周期将直接被送入 s2 阶段。</p>
<p><code>redirect</code> 信号则相对明确。以 s2 为例，当 <code>s2_redirect</code> 有效时，说明 <code>s2_fire</code> 生效的同时 s2 预测结果与上周期 s1 预测结果不同。</p>

</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2024
    <span class="td-footer__authors">BOSC</span></span><span class="td-footer__all_rights_reserved">保留所有权利</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">隐私政策</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/xs-bpu/js/main.min.fc653db1f3d4f4a8b4eacd389f96d8afe966937ba9dded8b07d3a1b17d967d22.js" integrity="sha256-/GU9sfPU9Ki06s04n5bYr&#43;lmk3up3e2LB9OhsX2WfSI=" crossorigin="anonymous"></script>
<script defer src="/xs-bpu/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/xs-bpu/js/tabpane-persist.js'></script>

  </body>
</html>
