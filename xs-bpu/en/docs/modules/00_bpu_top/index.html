<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/xs-bpu/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/xs-bpu/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/xs-bpu/favicons/android-192x192.png" sizes="192x192">

<title>BPU Top Module | OpenVerify Courses</title>
<meta name="description" content="The overall function and structure of the BPU top level have been roughly described in previous documents. For those verifying the BPU top level, a more detailed description might be needed. Due to the many functions of the BPU top level, this section divides the BPU into several major functional points for further description. However, since there are too many details at the BPU top level, further details need to be understood by referring to the code.">
<meta property="og:title" content="BPU Top Module" />
<meta property="og:description" content="The overall function and structure of the BPU top level have been roughly described in previous documents. For those verifying the BPU top level, a more detailed description might be needed. Due to the many functions of the BPU top level, this section divides the BPU into several major functional points for further description. However, since there are too many details at the BPU top level, further details need to be understood by referring to the code." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xs-mlvp.github.io/xs-bpu/en/docs/modules/00_bpu_top/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2024-07-13T22:44:54+08:00" />
<meta itemprop="name" content="BPU Top Module">
<meta itemprop="description" content="The overall function and structure of the BPU top level have been roughly described in previous documents. For those verifying the BPU top level, a more detailed description might be needed. Due to the many functions of the BPU top level, this section divides the BPU into several major functional points for further description. However, since there are too many details at the BPU top level, further details need to be understood by referring to the code.">
<meta itemprop="dateModified" content="2024-07-13T22:44:54+08:00" />
<meta itemprop="wordCount" content="3257">
<meta itemprop="keywords" content="Xiangshan,BPU Top Level,Global Branch History,Branch Folding History,Pipeline Control," /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="BPU Top Module"/>
<meta name="twitter:description" content="The overall function and structure of the BPU top level have been roughly described in previous documents. For those verifying the BPU top level, a more detailed description might be needed. Due to the many functions of the BPU top level, this section divides the BPU into several major functional points for further description. However, since there are too many details at the BPU top level, further details need to be understood by referring to the code."/>




<link rel="preload" href="/xs-bpu/scss/main.min.5081230fda7a265fa5fc10130b5bca4f0868fd0e77a3fa6ae4f2d28669ce5899.css" as="style">
<link href="/xs-bpu/scss/main.min.5081230fda7a265fa5fc10130b5bca4f0868fd0e77a3fa6ae4f2d28669ce5899.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?6aacb1c7ca0a3ef4e3aa84c1eaa237dd";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
    </script>


    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4Z2ZY6ZE84"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-4Z2ZY6ZE84');
    </script>


  </head>
  <body class="td-page">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/xs-bpu/en/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">OpenVerify Courses</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">English</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/xs-bpu/docs/modules/00_bpu_top/">中文</a></li>
    </ul>
</div></li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/xs-bpu/offline-search-index.c3eb5574a6b260a9ed71a61d76389bc9.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            <div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/xs-bpu/offline-search-index.c3eb5574a6b260a9ed71a61d76389bc9.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type="button" data-bs-toggle="collapse" data-bs-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="td-sidebar-nav collapse" id="td-section-nav">
    <div class="td-sidebar-nav__section nav-item dropdown d-block d-lg-none">
      <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">English</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/xs-bpu/docs/modules/00_bpu_top/">中文</a></li>
    </ul>
</div>
    </div>
    <ul class="td-sidebar-nav__section pe-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-xs-bpuendocs-li">
  <a href="/xs-bpu/en/docs/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-xs-bpuendocs"><span class="">Branch Predictor and Kunming Lake Microarchitecture Implementation</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-xs-bpuendocsbasic-li">
  <a href="/xs-bpu/en/docs/basic/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-xs-bpuendocsbasic"><span class="">Basic Design of Shanshan Branch Prediction Unit (BPU)</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsbasic00_bp-li">
  <a href="/xs-bpu/en/docs/basic/00_bp/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsbasic00_bp"><span class="">What is Branch Prediction</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsbasic01_xsbpu_basic-li">
  <a href="/xs-bpu/en/docs/basic/01_xsbpu_basic/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsbasic01_xsbpu_basic"><span class="">Basic of the Xiangshan Branch Prediction Unit (BPU)</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsbasic02_xsbpu_structure-li">
  <a href="/xs-bpu/en/docs/basic/02_xsbpu_structure/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsbasic02_xsbpu_structure"><span class="">Introduction to the Xiangshan Branch Prediction Unit Structure</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsbasic03_xsbpu_timing-li">
  <a href="/xs-bpu/en/docs/basic/03_xsbpu_timing/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsbasic03_xsbpu_timing"><span class="">Introduction to the Timing of Xiangshan Branch Prediction Unit</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-xs-bpuendocsports-li">
  <a href="/xs-bpu/en/docs/ports/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-xs-bpuendocsports"><span class="">Important Structures and Interface Documentation</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsports00_ftb-li">
  <a href="/xs-bpu/en/docs/ports/00_ftb/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsports00_ftb"><span class="">FTB Item and Complete Prediction Result Interface</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsports01_redirect_and_update-li">
  <a href="/xs-bpu/en/docs/ports/01_redirect_and_update/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsports01_redirect_and_update"><span class="">Redirection and Update Interfaces</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsports02_global_ports-li">
  <a href="/xs-bpu/en/docs/ports/02_global_ports/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsports02_global_ports"><span class="">BPU Global Interface</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsports03_subpredictor-li">
  <a href="/xs-bpu/en/docs/ports/03_subpredictor/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsports03_subpredictor"><span class="">Base Predictor Class and Sub Predictor Interface</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-xs-bpuendocsmodules-li">
  <a href="/xs-bpu/en/docs/modules/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-xs-bpuendocsmodules"><span class="">Submodule Documentation</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-xs-bpuendocsmodules00_bpu_top-li">
  <a href="/xs-bpu/en/docs/modules/00_bpu_top/" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsmodules00_bpu_top"><span class="td-sidebar-nav-active-item">BPU Top Module</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsmodules01_uftb-li">
  <a href="/xs-bpu/en/docs/modules/01_uftb/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsmodules01_uftb"><span class="">uFTB Branch Predictor</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsmodules02_tage_sc-li">
  <a href="/xs-bpu/en/docs/modules/02_tage_sc/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsmodules02_tage_sc"><span class="">TAGE-SC Branch Predictor</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsmodules03_ftb-li">
  <a href="/xs-bpu/en/docs/modules/03_ftb/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsmodules03_ftb"><span class="">FTB Branch Predictor</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsmodules04_ittage-li">
  <a href="/xs-bpu/en/docs/modules/04_ittage/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsmodules04_ittage"><span class="">ITTAGE Branch Predictor</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsmodules05_ras-li">
  <a href="/xs-bpu/en/docs/modules/05_ras/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsmodules05_ras"><span class="">RAS Branch Predictor</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-xs-bpuendocsfeature-li">
  <a href="/xs-bpu/en/docs/feature/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-xs-bpuendocsfeature"><span class="">Feature List</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsfeature00_bpufeature-li">
  <a href="/xs-bpu/en/docs/feature/00_bpufeature/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsfeature00_bpufeature"><span class="">BPU Top Feature List</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsfeature01_uftbfeature-li">
  <a href="/xs-bpu/en/docs/feature/01_uftbfeature/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsfeature01_uftbfeature"><span class="">uFTB Feature List</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsfeature02_ftbfeature-li">
  <a href="/xs-bpu/en/docs/feature/02_ftbfeature/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsfeature02_ftbfeature"><span class="">FTB Feature List</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsfeature03_tagescfeature-li">
  <a href="/xs-bpu/en/docs/feature/03_tagescfeature/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsfeature03_tagescfeature"><span class="">TAGE-SC Feature List</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsfeature04_ittagefeature-li">
  <a href="/xs-bpu/en/docs/feature/04_ittagefeature/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsfeature04_ittagefeature"><span class="">ITTAGE Feature List</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-xs-bpuendocsfeature05_rasfeature-li">
  <a href="/xs-bpu/en/docs/feature/05_rasfeature/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-xs-bpuendocsfeature05_rasfeature"><span class="">RAS Feature List</span></a>
</li>
  </ul>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            <div class="td-page-meta ms-2 pb-1 pt-2 mb-0">
<a href="https://github.com/XS-MLVP/course/tree/main/content/en/docs/modules/00_bpu_top.md" class="td-page-meta--view td-page-meta__view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
  <a href="https://github.com/XS-MLVP/course/edit/main/content/en/docs/modules/00_bpu_top.md" class="td-page-meta--edit td-page-meta__edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  <a href="https://github.com/XS-MLVP/course/new/main/content/en/docs/modules?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child td-page-meta__child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
  <a href="https://github.com/XS-MLVP/course/issues/new?title=BPU%20Top%20Module" class="td-page-meta--issue td-page-meta__issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
  <a href="https://github.com/XS-MLVP/course/mlvp-portal/issues/new" class="td-page-meta--project td-page-meta__project-issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
  <a id="print" href="/xs-bpu/en/docs/modules/_print/"><i class="fa-solid fa-print fa-fw"></i> Print entire section</a>

</div>

            <div class="td-toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#generator-maintenance-method">Generator Maintenance Method</a></li>
    <li><a href="#global-branch-history">Global Branch History</a>
      <ul>
        <li><a href="#calculating-the-current-global-branch-history-with-ghist_ptr">Calculating the Current Global Branch History with ghist_ptr</a></li>
        <li><a href="#updating-global-branch-history">Updating Global Branch History</a></li>
      </ul>
    </li>
    <li><a href="#branch-folded-history">Branch Folded History</a>
      <ul>
        <li><a href="#branch-folded-history-1">Branch Folded History</a></li>
        <li><a href="#method-for-updating-branch-folded-history">Method for Updating Branch Folded History</a></li>
        <li><a href="#implementation-of-update-method">Implementation of Update Method</a></li>
      </ul>
    </li>
    <li><a href="#pipeline-control-method">Pipeline Control Method</a>
      <ul>
        <li><a href="#valid-ready-与-fire">valid, ready 与 fire</a></li>
        <li><a href="#incorporating-flush-and-redirect">Incorporating Flush and Redirect</a></li>
      </ul>
    </li>
    <li><a href="#redirect-recovery-logic">Redirect Recovery Logic</a></li>
  </ul>
</nav>
      </div>
    
            <div class="taxonomy taxonomy-terms-cloud taxo-tags">
      <h5 class="taxonomy-title">Tag Cloud</h5>
      <ul class="taxonomy-terms">
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/bpu/" data-taxonomy-term="bpu"><span class="taxonomy-label">BPU</span><span class="taxonomy-count">6</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/bpu-top-level/" data-taxonomy-term="bpu-top-level"><span class="taxonomy-label">BPU Top Level</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/branch-folding-history/" data-taxonomy-term="branch-folding-history"><span class="taxonomy-label">Branch Folding History</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/branch-prediction/" data-taxonomy-term="branch-prediction"><span class="taxonomy-label">Branch Prediction</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/branch-prediction-block/" data-taxonomy-term="branch-prediction-block"><span class="taxonomy-label">Branch Prediction Block</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/docs/" data-taxonomy-term="docs"><span class="taxonomy-label">Docs</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/examples/" data-taxonomy-term="examples"><span class="taxonomy-label">Examples</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/feature-list/" data-taxonomy-term="feature-list"><span class="taxonomy-label">Feature List</span><span class="taxonomy-count">6</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/fetch-target-queue-ftq/" data-taxonomy-term="fetch-target-queue-ftq"><span class="taxonomy-label">Fetch Target Queue (FTQ)</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/ftb/" data-taxonomy-term="ftb"><span class="taxonomy-label">FTB</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/global-branch-history/" data-taxonomy-term="global-branch-history"><span class="taxonomy-label">Global Branch History</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/ittage/" data-taxonomy-term="ittage"><span class="taxonomy-label">ITTAGE</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/pipeline-control/" data-taxonomy-term="pipeline-control"><span class="taxonomy-label">Pipeline Control</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/prediction-result-redirection/" data-taxonomy-term="prediction-result-redirection"><span class="taxonomy-label">Prediction Result Redirection</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/ras/" data-taxonomy-term="ras"><span class="taxonomy-label">RAS</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/redirect-request/" data-taxonomy-term="redirect-request"><span class="taxonomy-label">Redirect Request</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/redirection-request/" data-taxonomy-term="redirection-request"><span class="taxonomy-label">Redirection Request</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/shanshan/" data-taxonomy-term="shanshan"><span class="taxonomy-label">Shanshan</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/sub-predictor/" data-taxonomy-term="sub-predictor"><span class="taxonomy-label">Sub-Predictor</span><span class="taxonomy-count">4</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/sub-predictors/" data-taxonomy-term="sub-predictors"><span class="taxonomy-label">Sub-Predictors</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/subpredictor/" data-taxonomy-term="subpredictor"><span class="taxonomy-label">Subpredictor</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/tage-sc/" data-taxonomy-term="tage-sc"><span class="taxonomy-label">TAGE-SC</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/uftb/" data-taxonomy-term="uftb"><span class="taxonomy-label">UFTB</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/update-request/" data-taxonomy-term="update-request"><span class="taxonomy-label">Update Request</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/xiangshan/" data-taxonomy-term="xiangshan"><span class="taxonomy-label">Xiangshan</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/xiangshan-bpu-structure/" data-taxonomy-term="xiangshan-bpu-structure"><span class="taxonomy-label">Xiangshan BPU Structure</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/xiangshan-bpu-timing/" data-taxonomy-term="xiangshan-bpu-timing"><span class="taxonomy-label">Xiangshan BPU Timing</span><span class="taxonomy-count">1</span></a></li>
        </ul>
    </div>
  <div class="taxonomy taxonomy-terms-cloud taxo-categories">
      <h5 class="taxonomy-title">Categories</h5>
      <ul class="taxonomy-terms">
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/branch-prediction-unit-bpu/" data-taxonomy-term="branch-prediction-unit-bpu"><span class="taxonomy-label">Branch Prediction Unit (BPU)</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/example/" data-taxonomy-term="example"><span class="taxonomy-label">Example</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/feature-list/" data-taxonomy-term="feature-list"><span class="taxonomy-label">Feature List</span><span class="taxonomy-count">6</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/shanshan-bpu-basic-design/" data-taxonomy-term="shanshan-bpu-basic-design"><span class="taxonomy-label">Shanshan BPU Basic Design</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/tutorial/" data-taxonomy-term="tutorial"><span class="taxonomy-label">Tutorial</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/xiangshan-bpu-basic-design/" data-taxonomy-term="xiangshan-bpu-basic-design"><span class="taxonomy-label">Xiangshan BPU Basic Design</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/xiangshan-bpu-interface/" data-taxonomy-term="xiangshan-bpu-interface"><span class="taxonomy-label">Xiangshan BPU Interface</span><span class="taxonomy-count">4</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/xiangshan-bpu-interfaces/" data-taxonomy-term="xiangshan-bpu-interfaces"><span class="taxonomy-label">Xiangshan BPU Interfaces</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/xiangshan-bpu-submodule/" data-taxonomy-term="xiangshan-bpu-submodule"><span class="taxonomy-label">Xiangshan BPU Submodule</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/xiangshan-bpu-submodules/" data-taxonomy-term="xiangshan-bpu-submodules"><span class="taxonomy-label">Xiangshan BPU Submodules</span><span class="taxonomy-count">2</span></a></li>
        </ul>
    </div>
  
	
          </aside>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/xs-bpu/en/docs/">Branch Predictor and Kunming Lake Microarchitecture Implementation</a></li>
  <li class="breadcrumb-item">
    <a href="/xs-bpu/en/docs/modules/">Submodule Documentation</a></li>
  <li class="breadcrumb-item active" aria-current="page">
    BPU Top Module</li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>BPU Top Module</h1>
	
	<header class="article-meta">
		<div class="taxonomy taxonomy-terms-article taxo-tags">
  <h5 class="taxonomy-title">Tags:</h5>
  <ul class="taxonomy-terms">
    <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/xiangshan/" data-taxonomy-term="xiangshan"><span class="taxonomy-label">Xiangshan</span></a></li>
    <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/bpu-top-level/" data-taxonomy-term="bpu-top-level"><span class="taxonomy-label">BPU Top Level</span></a></li>
    <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/global-branch-history/" data-taxonomy-term="global-branch-history"><span class="taxonomy-label">Global Branch History</span></a></li>
    <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/branch-folding-history/" data-taxonomy-term="branch-folding-history"><span class="taxonomy-label">Branch Folding History</span></a></li>
    <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/tags/pipeline-control/" data-taxonomy-term="pipeline-control"><span class="taxonomy-label">Pipeline Control</span></a></li>
    </ul>
</div>
<div class="taxonomy taxonomy-terms-article taxo-categories">
  <h5 class="taxonomy-title">Categories:</h5>
  <ul class="taxonomy-terms">
    <li><a class="taxonomy-term" href="https://xs-mlvp.github.io/xs-bpu/en/categories/xiangshan-bpu-submodule/" data-taxonomy-term="xiangshan-bpu-submodule"><span class="taxonomy-label">Xiangshan BPU Submodule</span></a></li>
    </ul>
</div>

  </header>
	<p>The overall function and structure of the BPU top level have been roughly described in previous documents. For those verifying the BPU top level, a more detailed description might be needed. Due to the many functions of the BPU top level, this section divides the BPU into several major functional points for further description. However, since there are too many details at the BPU top level, further details need to be understood by referring to the code.</p>
<h2 id="generator-maintenance-method">Generator Maintenance Method</h2>
<p>From the basic design documents of Xiangshan, we know that the BPU top level maintains various variables in the s0 cycle through generators, such as PC, branch history, etc. The core concept is to decide which pipeline level&rsquo;s result to adopt through the redirection signal of the prediction result.</p>
<p>There are a total of 6 generators in the BPU top level:</p>
<ul>
<li><strong>npcGen</strong> maintains the PC</li>
<li><strong>ghistPtrGen</strong> maintains the global history pointer</li>
<li><strong>ghvBitWriteGens</strong> maintains global history write data</li>
<li><strong>foledGhGen</strong> maintains the folded history</li>
<li><strong>lastBrNumOHGen</strong> maintains the position of the last effective branch instruction in the previous cycle</li>
<li><strong>aheadFhObGen</strong> maintains the oldest position of the branch history</li>
</ul>
<p>Except for <code>npcGen</code>, the rest of the generators will be introduced in this document. In this section, we will focus on the method of generating the next prediction for the generators.</p>
<p>In the code, you can see generators defined in a similar way:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Scala" data-lang="Scala"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">npcGen</span> <span style="color:#204a87;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">PhyPriorityMuxGenerator</span><span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#204a87;font-weight:bold">UInt</span><span style="color:#ce5c00;font-weight:bold">]</span>
</span></span></code></pre></div><p>Next, the code registers the data sources for the generators through multiple statements:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Scala" data-lang="Scala"><span style="display:flex;"><span><span style="color:#000">npcGen</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">register</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">B</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">reg</span><span style="color:#a40000">，</span> <span style="color:#ce5c00;font-weight:bold">...)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">npcGen</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">register</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">s1_valid</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">s1_target</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">...)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">npcGen</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">register</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">s2_redirect</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">s2_target</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">...)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">npcGen</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">register</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">s3_redirect</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">s3_target</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">...)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">npcGen</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">register</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">do_redirect</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">valid</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">do_redirect</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cfiUpdate</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">target</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">...)</span>
</span></span></code></pre></div><p>Each line is called a registration. In a registration, the first signal parameter is the data valid signal, and the second signal parameter contains the specific data. The priority of the generator is also determined in the order of registration; the later the registration, the higher the priority. Therefore, the priority at the same time, from low to high, is as follows:</p>
<ul>
<li>s0 blocked data</li>
<li>Data updated based on s1 prediction results</li>
<li>Data updated based on s2 prediction results</li>
<li>Data updated based on s3 prediction results</li>
<li>Data in external redirection of BPU</li>
</ul>
<p>In this way, when the redirection of the prediction result is valid, we can avoid using the earlier pipeline level&rsquo;s prediction result and adopt the corrected prediction result. This allows us to handle external redirection requests with the highest priority.</p>
<p>We can conclude the method by which all generators generate s0 signals: <strong>Among all data valid signals, if only one is valid, the corresponding data is selected; if multiple data valid signals are valid, the data with the highest priority is selected</strong>.</p>
<h2 id="global-branch-history">Global Branch History</h2>
<p>We know that the global branch history is maintained at the BPU top level, and the maintenance strategy is consistent with the PC maintenance strategy. That is, after the prediction result is generated at each stage of the pipeline, the global branch history is updated based on the corresponding signals.</p>
<p>The top level defines two sets of signals to maintain the global branch history:</p>
<ul>
<li><strong>ghv</strong> stores the global branch history (maximum length 256)</li>
<li><strong>ghist_ptr</strong> global branch history pointer, pointing to the current position of the global branch history</li>
</ul>
<p>Similar to <code>s0_pc</code>, <code>s1_pc</code>, <code>s2_pc</code>, the BPU top level also maintains signals for each stage of the global history pointer: <code>s0_ghist_ptr</code>, <code>s1_ghist_ptr</code>, <code>s2_ghist_ptr</code>. However, the content in <code>ghv</code> is fixed in position, and we only use <code>ghist_ptr</code> to locate where the current global branch history starts.</p>
<h3 id="calculating-the-current-global-branch-history-with-ghist_ptr">Calculating the Current Global Branch History with ghist_ptr</h3>
<p>The use of <code>ghist_ptr</code> is only visible at the BPU top level. What we pass to the sub-predictors is the global branch history after the data in the global history register is shifted based on <code>ghist_ptr</code>. In the global branch history obtained by the sub-predictor, the least significant bit corresponds to the newest bit of the global branch history, and the most significant bit corresponds to the oldest bit.</p>
<p>So how is the shifting done? First, let&rsquo;s see how the global history is stored in <code>ghv</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Plain" data-lang="Plain"><span style="display:flex;"><span>|===== ghist =====&gt;| =======&gt;|
</span></span><span style="display:flex;"><span>n                  ^         0
</span></span><span style="display:flex;"><span>                   ghist_ptr
</span></span></code></pre></div><p>As shown in the figure above, the sequence represents the entire <code>ghv</code> register, and <code>ghist_ptr</code> points to a position in <code>ghv</code>. This position represents the newest bit of the global branch history. When a new global history record needs to be added, <code>ghist_ptr</code> is first decremented by 1, and then this bit is written to the position it points to. When <code>ghist_ptr</code> is decremented to 0, it will loop back to point to the highest position, thereby overwriting the previously written global branch history.</p>
<p>No matter what, starting from the position pointed to by <code>ghist_ptr</code>, the pointer increases and the history gets older. Therefore, when we need to calculate the current global branch history, we only need to circularly right-shift the <code>ghv</code> register by <code>ghist_ptr positions</code>.</p>
<h3 id="updating-global-branch-history">Updating Global Branch History</h3>
<p>The strategy for updating the global branch history is consistent with the strategy for updating the <code>pc</code>. At each pipeline stage, a <strong>pointer for the current stage and an update description of <code>ghv</code></strong> are generated based on the prediction result of the current stage, and all are sent to the relevant generator for processing.</p>
<p>The update strategy for the global branch history is consistent with the <code>pc</code> update strategy, requiring the generation of a <strong>current stage pointer and <code>ghv</code> update instructions</strong> based on the current stage&rsquo;s prediction results at each pipeline stage. These instructions are ultimately sent to the relevant generators for processing.</p>
<p>The update description of <code>ghv</code> is some information used to guide the update of the <code>ghv</code> register. Xiangshan BPU maintains two pieces of information to fulfill this duty:</p>
<ul>
<li><code>ghv_wdata</code> the data that needs to be written into ghv</li>
<li><code>ghv_wens</code> the write bit mask</li>
</ul>
<p>For the final update, only the bits identified by <code>ghv_wens</code> need to be written with the corresponding bits of <code>ghv_wdata</code>.</p>
<p><strong>Therefore, each pipeline stage needs to generate three sets of information: <code>ghist_ptr</code>, <code>ghv_wdata</code>, <code>ghv_wens</code></strong>.</p>
<p>Specifically, the prediction result can contain up to two branch instructions. We only need to set these pieces of information according to the actual situation. Here are some examples:</p>
<ul>
<li>Only the first slot is valid, and the conditional branch instruction in it is predicted as not taken. Then the next position of <code>ghv_wens</code> is set to 0, the corresponding position of <code>ghv_wens</code> is set to 1, and <code>ghist_ptr</code> is decremented by one.</li>
<li>Both slots contain conditional branch instructions, the first is predicted as not taken, and the second is predicted as taken. At this time, <code>ghist_ptr</code> should be decremented by two, and the other two pieces of information should indicate writing 01 to <code>ghv</code>.</li>
</ul>
<p>Here, only one piece of <code>ghv_wdata</code> information is maintained in the generator (maintained by the <code>ghvBitWriteGens</code> generator), and <code>ghv_wens</code> is not maintained by the generator. This is because a small trick is used here, where the final output of the generator&rsquo;s <code>ghv_wdata</code> is the result of the selected stage, and <code>ghv_wens</code> is used by performing a bitwise OR operation on <code>ghv_wens</code> of all stages.</p>
<p>This consideration is based on:</p>
<ul>
<li>If the later pipeline stage is valid, the global history pointer is restored to an older position, even if the history of newer positions is modified by the earlier pipeline&rsquo;s <code>ghv_wens</code>.</li>
<li>If the earlier pipeline stage is valid, the global history pointer continues to update to newer positions, and the later pipeline will not set <code>ghv_wens</code> due to the ineffective redirect.</li>
</ul>
<h2 id="branch-folded-history">Branch Folded History</h2>
<p>The branch folded history passed to the predictor is also maintained by the BPU top level. To shorten the update delay of the folded history, the BPU maintains many variables to support the fast update of the branch folded history. We will focus on this strategy and introduce the function of each variable.</p>
<p>Before we start, let&rsquo;s first look at how the branch folded history is defined and its structure.</p>
<h3 id="branch-folded-history-1">Branch Folded History</h3>
<p>If you have checked the BPU global interface documentation, you will know that the sub-predictor receives an array of bit vectors of different lengths, representing various lengths of folded history, and these folded histories are compressed from the global branch history.</p>
<p>For the global branch history, we have a register that stores the global branch history with a length of 256. For example, suppose the length of the global branch history is 15 bits, and after shifting, we get a branch history like this: the least significant bit is the newest history record, and the most significant bit is the oldest history record.</p>
<p>At this time, if we need to generate a 6-bit folded history from these 15 bits, we will use an XOR strategy for compression. The specific process is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Plain" data-lang="Plain"><span style="display:flex;"><span>    h[5]         h[4]       h[3]    h[2]   h[1]   h[0]
</span></span><span style="display:flex;"><span>    h[11]        h[10]      h[9]    h[8]   h[7]   h[6]
</span></span><span style="display:flex;"><span>^                                   h[14]  h[13]  h[12]
</span></span><span style="display:flex;"><span>---------------------------------------------------------------
</span></span><span style="display:flex;"><span>    h[5]^h[11]   h[4]^h[10]         ...           h[0]^h[6]^h[12]
</span></span></code></pre></div><p>That is, after arranging it as shown above, perform an XOR operation on the values at each position, and the result is the folded history of length 6.</p>
<h3 id="method-for-updating-branch-folded-history">Method for Updating Branch Folded History</h3>
<p>Now we want to update this branch folded history. When we insert a new history into the global branch history, it is inserted from the least significant bit, meaning the original h[0] becomes h[1]. If we want to obtain the folded history at this time, we only need to perform the XOR operation again. But such efficiency is too low, because the XOR operation may become particularly long. We can explore the impact of one update on the branch folded history.</p>
<p>In the example above, before inserting a new history, the 6-bit folded history is generated in the following arrangement:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Plain" data-lang="Plain"><span style="display:flex;"><span>h[5]   h[4]   h[3]  h[2]  h[1]  h[0]
</span></span><span style="display:flex;"><span>h[11]  h[10]  h[9]  h[8]  h[7]  h[6]
</span></span><span style="display:flex;"><span>                    h[14] h[13] h[12]
</span></span></code></pre></div><p>After inserting a new history, it becomes like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Plain" data-lang="Plain"><span style="display:flex;"><span>h[4]   h[3]   h[2]  h[1]  h[0]  h[new]
</span></span><span style="display:flex;"><span>h[10]  h[9]   h[8]  h[7]  h[6]  h[5]
</span></span><span style="display:flex;"><span>           (h[14])  h[13] h[12] h[11]
</span></span></code></pre></div><p>We can notice some patterns:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Plain" data-lang="Plain"><span style="display:flex;"><span>Before insertion:
</span></span><span style="display:flex;"><span>h[5]   {h[4]   h[3]  h[2]  h[1]  h[0] }
</span></span><span style="display:flex;"><span>h[11]  {h[10]  h[9]  h[8]  h[7]  h[6] }
</span></span><span style="display:flex;"><span>       {             h[14] h[13] h[12]}
</span></span><span style="display:flex;"><span>After insertion:
</span></span><span style="display:flex;"><span>{h[4]   h[3]   h[2]  h[1]  h[0] } h[new]
</span></span><span style="display:flex;"><span>{h[10]  h[9]   h[8]  h[7]  h[6] } h[5]
</span></span><span style="display:flex;"><span>{           (h[14])  h[13] h[12]} h[11]
</span></span></code></pre></div><p>The content in the curly braces has undergone a complete left shift, with h[5] and h[11] moving from the most significant bit to the least significant bit. So, in the compressed history, isn&rsquo;t this just a typical cyclic left shift that we often encounter!</p>
<p>However, only two bits have changed: one is the newly inserted h[new], and the other is the discarded h[14]. h[new] must be in the first position, and the discarded position is fixed. <strong>Therefore, to complete an update, we only need to know the value of the newly inserted history and the oldest bit of the previous history</strong>. After the cyclic shift, modifying these two positions according to the actual situation will give us the updated folded history.</p>
<h3 id="implementation-of-update-method">Implementation of Update Method</h3>
<p>To achieve this update in the top-level BPU, two additional variables are maintained:</p>
<ul>
<li><strong>ahead_fh_oldest_bits</strong>: the oldest bit of the global branch history, with additional bits stored before it</li>
<li><strong>last_br_num_oh</strong>: the slot number of the last effective branch instruction in the previous prediction</li>
</ul>
<p>An optimization in the timing of operations occurs here because the global history pointer can only be updated based on the branch outcome when the pipeline-level prediction result is available. Updating the oldest bit after updating the global history pointer would increase the latency. Therefore, we maintain the branch outcome and update the oldest bit when it is needed in the next cycle.</p>
<p>The oldest bit also needs to be maintained further back because after updating using the branch outcome, the relatively newer bits will become the oldest bits.</p>
<p>Thus, there are three generators related to the folded history: <code>foldedGhGen</code>, <code>lastBrNumOhGen</code>, and <code>aheadFhObGen</code>.</p>
<p><strong>Information required for each update of the folded history</strong>：</p>
<ul>
<li>Folded history information before the update</li>
<li>Oldest bit of the global branch history (ahead_fh_oldest_bits)</li>
<li>Last prediction&rsquo;s branch outcome (last_br_num_oh)</li>
<li>Whether there is a branch instruction in this update</li>
<li>The branch outcome of this update: the slot number of the last effective branch instruction</li>
</ul>
<p>For each update of the folded history, the true oldest bit needs to be determined based on <code>last_br_num_oh</code> and <code>ahead_fh_oldest_bits</code>. Then, based on the oldest bit and the branch outcome of this update, several bits are modified, and finally, a cyclic left shift completes the update operation.</p>
<h2 id="pipeline-control-method">Pipeline Control Method</h2>
<p>Pipeline control is the core function of the BPU, with complex logic. All pipeline control signals in the top-level BPU are as follows:</p>
<ul>
<li><strong>s1_valid, s2_valid, s3_valid</strong>: indicate the corresponding pipeline data is valid</li>
<li><strong>s1_ready, s2_ready, s3_ready</strong>: indicate the corresponding pipeline is ready to continue the prediction of the previous pipeline stage</li>
<li><strong>s1_component_ready, s2_component_ready, s3_component_ready</strong>: indicate the readiness of the corresponding pipeline sub-predictor</li>
<li><strong>s0_fire, s1_fire, s2_fire, s3_fire</strong>: successful handshake signals, indicating that the pipeline data is valid and has been successfully passed to the next pipeline</li>
<li><strong>s1_flush, s2_flush, s3_flush</strong>: indicate whether the current pipeline needs flushing</li>
<li><strong>s2_redirect, s3_redirect</strong>: indicate whether the current pipeline needs to redirect due to a different prediction result</li>
</ul>
<h3 id="valid-ready-与-fire">valid, ready 与 fire</h3>
<p>We will introduce the purpose of each signal step by step. First, let&rsquo;s look at the <code>fire</code> signal, which indicates a successful handshake in the pipeline, meaning that the data has been successfully passed to the next pipeline. This signifies the end of the current cycle and the end of the prediction for this pipeline stage, with the prediction for the next pipeline stage about to begin in the next cycle.</p>
<p>This requires two conditions:</p>
<ol>
<li><code>valid</code>: The data in the current pipeline stage is valid.</li>
<li><code>ready</code>: Indicates whether the next pipeline stage in the BPU top level and the predictor are ready.</li>
</ol>
<p>When these two signals are high simultaneously, the <code>fire</code> signal is valid, indicating a successful handshake. If we isolate a single prediction, the timing should look like this (in reality, most of the time, each pipeline is valid continuously):</p>

<figure>
    <img src="1.png" width="400px"/> 
</figure>

<p>Of the four sets of signals mentioned earlier, <code>component_ready</code> is generated by the predictor, while the rest are maintained by the BPU top level, with only the fire set of signals exposed to the sub-predictor.</p>
<p>Next, let&rsquo;s take s2 as an example to see how each signal is maintained.</p>
<p><strong>ready</strong> <strong>Signal</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Scala" data-lang="Scala"><span style="display:flex;"><span><span style="color:#000">s2_ready</span> <span style="color:#204a87;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">s2_fire</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">s2_valid</span>
</span></span></code></pre></div><p>This assignment statement is a combinational circuit assignment, meaning that <code>s2_ready</code> is directly related to <code>s2_fire</code> and <code>s2_valid</code> for this cycle, with two possible situations:</p>
<ul>
<li>If <code>s2_valid</code> is invalid for this cycle, indicating that the s2 pipeline stage is empty and can accept new data, then <code>s2_ready</code> is valid.</li>
<li>If <code>s2_valid</code> is valid for this cycle, indicating that the s2 pipeline stage has data that has not been passed to the next stage yet, but if <code>s2_fire</code>, then the data will be passed in the next cycle. In this case, <code>s2_ready</code> is valid, indicating that the data can flow into the next stage.</li>
</ul>
<p><strong>valid Signal</strong></p>
<p>Maintaining ·s2_valid· is relatively simple, as it is only related to <code>s1_fire</code> and <code>s2_ready</code> signals. The relationship is as follows:</p>
<ul>
<li>When <code>s1_fire</code> is valid, indicating that data is coming in and <code>s2_valid</code> will be valid in the next cycle.</li>
<li>When <code>s2_fire</code> is valid, indicating that data is flowing out and <code>s2_valid</code> will be invalid in the next cycle.</li>
</ul>
<p><strong>fire Signal</strong></p>
<p>The fire signal is somewhat special, but for intermediate pipeline stages, its maintenance is straightforward. For example,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Scala" data-lang="Scala"><span style="display:flex;"><span><span style="color:#000">s2_fire</span> <span style="color:#204a87;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">s2_valid</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">s3_components_ready</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">s3_ready</span>
</span></span></code></pre></div><p>This simply requires considering the <code>valid</code> of the current pipeline stage and the <code>ready</code> of the next pipeline stage.</p>
<p>However, for s0_fire, since there is no valid signal, it is directly set to <code>s1_components_ready &amp;&amp; s1_ready</code>.</p>
<p>For s3_fire, as there is no ready signal for the next stage, it is directly set to <code>s3_valid</code>.</p>
<h3 id="incorporating-flush-and-redirect">Incorporating Flush and Redirect</h3>
<p>When there is a different prediction result in the pipeline, a redirection signal is generated, and the pipeline needs to be flushed. <code>flush</code> and <code>redirect</code> handle these two tasks. <code>redirect</code> indicates whether the current pipeline stage needs redirection, while <code>flush</code> indicates whether the current pipeline stage needs flushing.</p>
<p><strong>redirect Signal</strong></p>
<p>The generation of <code>s2_redirect</code> is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Scala" data-lang="Scala"><span style="display:flex;"><span><span style="color:#000">s2_redirect</span> <span style="color:#204a87;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">s2_fire</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">s2_redirect_s1_last_pred</span>
</span></span></code></pre></div><p>This means that when <code>s2_fire</code> is valid and the prediction result of s2 is different from the prediction result saved from s1, this signal is valid. Later, this signal will be connected to the input of the sub-predictor and the output of the BPU prediction result, guiding the sub-predictor and FTQ to restore their states.</p>
<p><strong>flush Signal</strong></p>
<p>The flush signal is used to guide the flushing of the pipeline. For example, when s3_redirect is valid, it means that the incorrect prediction result has entered the pipeline, and both s1 and s2 are now predicting based on the wrong result. Therefore, the pipeline needs to be flushed to stop the previous stages and wait for new prediction results to enter.</p>
<p>Specifically, the relationship between them is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Scala" data-lang="Scala"><span style="display:flex;"><span> <span style="color:#000">s2_flush</span> <span style="color:#204a87;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">s3_flush</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">s3_redirect</span>
</span></span><span style="display:flex;"><span> <span style="color:#000">s1_flush</span> <span style="color:#204a87;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">s2_flush</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">s2_redirect</span>
</span></span></code></pre></div><p>This means that if a pipeline stage needs redirection, all previous stages will be flushed. The purpose of flush is to guide the valid signal. If the valid signal is valid in this cycle but the fire signal is not, it means that the incorrect data has not been taken by the next pipeline stage. In this case, when flush is valid, valid will immediately become invalid in the next cycle, avoiding storing incorrect data in the pipeline for a long time.</p>
<p>However, the effect of flush on the valid signal varies depending on each pipeline stage. For example:</p>
<ul>
<li>For the s1 pipeline stage, although flush is valid, if <code>s0_fire</code> is valid, indicating that new data is flowing in, valid will remain valid in the next cycle.</li>
<li>For the s2 pipeline stage, if flush is valid, valid will definitely be invalid in the next cycle (because s1 is also flushed), indicating that valid can be directly set to invalid. However, there is a special case where <code>s2_redirect</code> occurs but <code>s2_flush</code> is not set to valid. In this case, if <code>s1_fire</code> occurs, the incorrect prediction result of s1 may also flow in. In this case, <code>s2_valid</code> needs to be determined based on the <code>s1_flush</code> signal.</li>
</ul>
<p>The use of flush is complex, and more detailed details need to be understood by referring to the code.</p>
<h2 id="redirect-recovery-logic">Redirect Recovery Logic</h2>
<p>When the redirect request from FTQ to BPU takes effect, it indicates that all stages of the pipeline have incorrect predictions, and all stages should be flushed. This can be achieved by setting <code>s3_flush</code> to be valid. Therefore, we have:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Scala" data-lang="Scala"><span style="display:flex;"><span> <span style="color:#000">s3_flush</span> <span style="color:#204a87;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">redirect_req</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">valid</span>
</span></span></code></pre></div><p>In the BPU, the redirect request is delayed by one cycle before being officially used. Therefore, the response of <code>s1_valid</code> to the <code>flush</code> signal needs to be changed. When the redirect request (before delay) is valid, <code>s1_valid</code> in the next cycle is immediately set to invalid, without the need to refer to the <code>s0_fire</code> signal.</p>
<p>At this point, generators such as <code>npcGen</code> also need to directly use the data from the redirect request to generate, which is equivalent to redirecting the BPU&rsquo;s state to the state before the error occurred. However, it is important to note that the default redirect level in BPU is <code>flushAfter</code>, which means that the redirect request corresponds to a predicted erroneous instruction, and the BPU assumes that although this instruction was predicted incorrectly, it has been corrected and executed by the backend. Therefore, the next prediction can start directly from the next instruction.</p>
<p>Therefore, when recovering from a redirect, it is necessary not only to restore the information from the redirect interface, but also to update the execution status of this predicted erroneous instruction in the history.</p>

	<div class="td-page-meta__lastmod">
  Last modified July 13, 2024: <a href="https://github.com/XS-MLVP/course/commit/505f9d9a4af942b9df0aababb74b94d0713912fe">edit the RAS document. (505f9d9)</a>
</div>

</div>


          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2024
    <span class="td-footer__authors">BOSC</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/xs-bpu/js/main.min.fc653db1f3d4f4a8b4eacd389f96d8afe966937ba9dded8b07d3a1b17d967d22.js" integrity="sha256-/GU9sfPU9Ki06s04n5bYr&#43;lmk3up3e2LB9OhsX2WfSI=" crossorigin="anonymous"></script>
<script defer src="/xs-bpu/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/xs-bpu/js/tabpane-persist.js'></script>

  </body>
</html>