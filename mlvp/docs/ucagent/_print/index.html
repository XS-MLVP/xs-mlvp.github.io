<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="https://open-verify.cc/mlvp/docs/ucagent/">
<link rel="alternate" type="application/rss&#43;xml" href="https://open-verify.cc/mlvp/docs/ucagent/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/mlvp/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/mlvp/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/mlvp/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/mlvp/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-192x192.png" sizes="192x192">

<title>(AI)验证智能体 | 开放验证平台学习资源</title>
<meta name="description" content="基于大模型进行自动化UT验证智能体">
<meta property="og:url" content="https://open-verify.cc/mlvp/docs/ucagent/">
  <meta property="og:site_name" content="开放验证平台学习资源">
  <meta property="og:title" content="(AI)验证智能体">
  <meta property="og:description" content="基于大模型进行自动化UT验证智能体">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="(AI)验证智能体">
  <meta itemprop="description" content="基于大模型进行自动化UT验证智能体">
  <meta itemprop="dateModified" content="2025-10-28T20:13:02+08:00">
  <meta itemprop="wordCount" content="5">
  <meta itemprop="keywords" content="Examples,Docs">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="(AI)验证智能体">
  <meta name="twitter:description" content="基于大模型进行自动化UT验证智能体">
<link rel="preload" href="/mlvp/scss/main.min.3bb6570761fbbb25e6691001febc67f331f0953db4e4e1cfb79172c2e6a5819e.css" as="style" integrity="sha256-O7ZXB2H7uyXmaRAB/rxn8zHwlT205OHPt5FywualgZ4=" crossorigin="anonymous">
<link href="/mlvp/scss/main.min.3bb6570761fbbb25e6691001febc67f331f0953db4e4e1cfb79172c2e6a5819e.css" rel="stylesheet" integrity="sha256-O7ZXB2H7uyXmaRAB/rxn8zHwlT205OHPt5FywualgZ4=" crossorigin="anonymous">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/mlvp/css/prism.css"/>

    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?6aacb1c7ca0a3ef4e3aa84c1eaa237dd";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
    </script>


    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4Z2ZY6ZE84"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-4Z2ZY6ZE84');
    </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />

<script>
    $(document).ready(function() {
        $('a[name="multi-lang-toggle"]').on('click', function(event) {
            var language = $(this).attr('lang');
            var codeDiv = $(this).closest('.highlight');
            var preNodes = codeDiv.find('pre');
            preNodes.each(function(index, preNode) {
                if ($(preNode).attr("name").toLowerCase().indexOf(language.toLowerCase()) !== -1) {
                    preNode.style.display = 'block';
                } else {
                    preNode.style.display = 'none';
                }
            });
            var alist = codeDiv.find('a[name="multi-lang-toggle"]');
            alist.each(function(index, aNode) {
                if ($(aNode).attr('lang').toLowerCase() === language.toLowerCase()) {
                    aNode.style.fontWeight = 'bold';
                } else {
                    aNode.style.fontWeight = 'normal';
                }
            });
        })
        $(this).find('pre[name^="group-lang-code-"]').each(function(index, preNode) {
            if (preNode.style.display !== 'none') {
                var language = $(preNode).attr("name").replace('group-lang-code-', '');
                var alist = $(this).closest('.highlight').find('a[name="multi-lang-toggle"]');
                alist.each(function(index, aNode) {
                    if ($(aNode).attr('lang').toLowerCase() === language.toLowerCase()) {
                        aNode.style.fontWeight = 'bold';
                    } else {
                        aNode.style.fontWeight = 'normal';
                    }
                });
            }
        });
    });
</script>
    
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/mlvp/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">开放验证平台学习资源</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/mlvp/en/">English</a></li>
    </ul>
</div></li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="站内搜索…"
    aria-label="站内搜索…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/mlvp/offline-search-index.6de4b99d520f594cab5024ab22c3e2c8.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/mlvp/docs/ucagent/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">(AI)验证智能体</h1>
<div class="lead">基于大模型进行自动化UT验证智能体</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-74e4e4ada00d6610843bbbd117f4cd16">工具介绍</a></li>


    
  
    
    
	
<li>2: <a href="#pg-6d7ccde5388a9664f923cf6de9f5e2d0">使用</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-4c2f0764b1448b4485db5bdc8abbc971">MCP集成模式（推荐）</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-7735a0965a81b3fff45d8f9c0238a813">直接使用模式</a></li>


    
  
    
    
	
<li>2.3: <a href="#pg-fbd7beae096d8cd3a81879ce0d6d9759">人机协同验证</a></li>


    
  
    
    
	
<li>2.4: <a href="#pg-56fd437efd30e85d1af55e127ea86585">参数说明</a></li>


    
  
    
    
	
<li>2.5: <a href="#pg-5fdb5ae128eebcc1e92c02708d6ec432">TUI</a></li>


    
  
    
    
	
<li>2.6: <a href="#pg-496947e48f69f9f9e929fe92771d84e0">FAQ</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-123be64371eca729c53f6175259c146a">工作流</a></li>


    
  
    
    
	
<li>4: <a href="#pg-f2c9a60e5e9f300f565a6d475173df02">定制功能</a></li>


    
  
    
    
	
<li>5: <a href="#pg-41ee5298b8c6094ee5f1fde353978dbe">工具列表</a></li>


    
  

    </ul>


<div class="content">
      <p><strong>UCAgent</strong> 是一个基于大语言模型的自动化硬件验证智能体，专注于芯片设计的单元测试(Unit Test)验证工作。该项目通过 AI 技术自动分析硬件设计，生成测试用例，并执行验证任务生成测试报告，从而提高验证效率。</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-74e4e4ada00d6610843bbbd117f4cd16">1 - 工具介绍</h1>
    <div class="lead">工具介绍与安装。</div>
	

<div class="pageinfo pageinfo-primary">
<p>随着芯片设计的愈发复杂，其验证难度和耗时也成倍增长，而近年来大语言模型的能力突飞猛进。于是我们推出了 UCAgent——一个基于大语言模型的自动化硬件验证 AI 代理，专注于芯片设计的单元测试(Unit Test)验证工作。
接下来我将从介绍、安装、使用、工作流、高级这五个方面来说明 UCAgent。</p>

</div>

<h2 id="介绍">介绍</h2>
<h3 id="背景">背景</h3>
<ul>
<li>芯片验证时间已经占据了芯片开发时间的 50-60%，并且设计工程师也将 49%的时间投入了硬件验证工作，但是 2024 年首次流片成功率仅有 14%。</li>
<li>随着 LLM 与编程类 Agent 兴起，将“硬件验证”抽象为“软件测试问题”可实现高比例自动化。</li>
</ul>
<h3 id="ucagent-是什么">UCAgent 是什么</h3>
<ul>
<li>面向芯片设计单元测试(Unit Test)的 AI Agent，基于 LLM 驱动，围绕“阶段化工作流 + 工具编排”自动/半自动完成需求理解、测试生成、执行与报告产出。</li>
<li>以用户为主导，LLM 为助理的协作式交互 Agent</li>
<li>以 Picker &amp; Toffee 为基础，DUT 以 Python 包形式被测试；可与 OpenHands/Copilot/Claude Code/Gemini-CLI/Qwen Code/ 等通过 MCP 协议深度协作。</li>
</ul>
<h3 id="能力与目标">能力与目标</h3>
<ul>
<li>自动/半自动：生成/完善测试代码与文档、运行用例、汇总报告</li>
<li>完整：功能覆盖率、代码行覆盖率与文档一致性</li>
<li>可集成：支持标准 CLI、TUI；提供 MCP server 接口便于外部 Code Agent 接入</li>
<li>目标：有效减少用户在验证过程中的重复工作</li>
</ul>
<h2 id="安装">安装</h2>
<h3 id="系统要求">系统要求</h3>
<ul>
<li>Python 版本： 3.11+</li>
<li>操作系统：Linux / macOS</li>
<li>API 需求：可访问 OpenAI 兼容 API</li>
<li>内存：建议 4GB+</li>
<li>依赖：<a href="https://github.com/XS-MLVP/picker">picker</a>（将 Verilog DUT 导出为 Python 包）</li>
</ul>
<h3 id="安装方式">安装方式</h3>
<ul>
<li>
<p>方式一：克隆仓库并安装依赖</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/XS-MLVP/UCAgent.git
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> UCAgent
</span></span><span style="display:flex;"><span>pip install -r requirements.txt
</span></span></code></pre></div></li>
<li>
<p>方式二（pip 安装）</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install git+https://git@github.com/XS-MLVP/UCAgent@main
</span></span><span style="display:flex;"><span>ucagent --help <span style="color:#8f5902;font-style:italic"># 确认安装成功</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="使用">使用</h2>
<h3 id="快速开始">快速开始</h3>
<ol>
<li>
<p>pip 安装 UCAgent</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install git+https://git@github.com/XS-MLVP/UCAgent@main
</span></span></code></pre></div></li>
<li>
<p>准备 DUT（待测模块）</p>
</li>
</ol>
<ul>
<li>
<p>创建目录：在<code>{工作区}</code>目录下创建<code>Adder</code>目录。(<code>{工作区}</code>是指当前运行<code>ucagent</code>命令的地方，其他的的目录都以<code>{工作区}</code>为根目录)</p>
<ul>
<li><code>mkdir -p Adder</code></li>
</ul>
</li>
<li>
<p>RTL：使用<a href="https://open-verify.cc/mlvp/docs/quick-start/eg-adder/">快速开始-简单加法器</a>的加法器,将其代码放入<code>Adder/Adder.v</code></p>
</li>
<li>
<p>注入 bug：将输出和位宽修改为 63 位（用于演示位宽错误导致的缺陷）。</p>
<ul>
<li>
<p>将<code>Adder.v</code>第九行由<code>output [WIDTH-1:0] sum,</code>改为<code>output [WIDTH-2:0] sum,</code>，<code>vim Adder/Adder.v</code>。目前的 verilog 代码为：</p>
<div class="highlight line-numbers"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// A verilog 64-bit full adder with carry in and carry out
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">module</span> <span style="color:#000">Adder</span> <span style="color:#000;font-weight:bold">#(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">parameter</span> <span style="color:#000">WIDTH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">WIDTH</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">WIDTH</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">WIDTH</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000">cout</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#000">cout</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">}</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">endmodule</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
<ol start="3">
<li>将 RTL 导出为 Python Module
<blockquote>
<p>picker 可以将 RTL 设计验证模块打包成动态库，并提供 Python 的编程接口来驱动电路。参照<a href="https://open-verify.cc/mlvp/docs/env_usage/picker_usage/">基础工具-工具介绍</a>和<a href="https://github.com/XS-MLVP/picker/blob/master/README.zh.md">picker 文档</a></p></blockquote>
</li>
</ol>
<ul>
<li>直接在<code>{工作区}</code>目录下执行命令<code>picker export Adder/Adder.v --rw 1 --sname Adder --tdir output/ -c -w output/Adder/Adder.fst</code></li>
</ul>
<ol start="4">
<li>编写 README</li>
</ol>
<ul>
<li>
<p>将加法器的说明、验证目标、bug 分析和其他都写在<code>Adder</code>文件夹的<code>README.md</code>文件中，同时将这个文件向<code>output/Adder</code>文件夹复制一份。</p>
<ul>
<li>
<p>将内容写入 readme 中，<code>vim Adder/README.md</code>，将下面内容复制到<code>README.md</code>中。</p>
</li>
<li>
<p>复制文件，<code>cp Adder/README.md output/Adder/README.md</code>。</p>
</li>
<li>
<p><code>Adder/README.md</code>内容可以是如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#800080;font-weight:bold">### Adder 64 位加法器
</span></span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>输入 a, b, cin 输出 sum，cout
</span></span><span style="display:flex;"><span>实现 sum = a + b + cin
</span></span><span style="display:flex;"><span>cin 是进位输入
</span></span><span style="display:flex;"><span>cout 是进位输出
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold">### 验证目标
</span></span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>只要验证加法相关的功能，其他验证，例如波形、接口等，不需要出现
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold">### bug 分析
</span></span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>在 bug 分析时，请参考源码：examples/MyAdder/Adder.v
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold">### 其他
</span></span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>所有的文档和注释都用中文编写
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
<ol start="5">
<li>安装 Qwen Code CLI</li>
</ol>
<ul>
<li>直接使用<code>npm</code>全局安装<code>sudo npm install -g @qwen-code/qwen-code</code>。（需要本地有<a href="https://nodejs.org/zh-cn/download/">nodejs 环境</a>）</li>
<li>其他安装方式请参考：<a href="https://qwenlm.github.io/qwen-code-docs/zh/deployment/">Qwen Code 执行与部署</a></li>
</ul>
<ol start="6">
<li>配置 Qwen Code CLI</li>
</ol>
<ul>
<li>修改<code>~/.qwen/settings.json</code> 配置文件，<code>vim ~/.qwen/settings.json</code>，示例 Qwen 配置文件如下：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">&#34;mcpServers&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#204a87;font-weight:bold">&#34;unitytest&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">&#34;httpUrl&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://localhost:5000/mcp&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">&#34;timeout&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">10000</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><ol start="7">
<li>启动 MCP Server<a id="命令"></a></li>
</ol>
<ul>
<li>在<code>{工作区}</code>目录下：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ucagent output/ Adder -s -hm --tui --mcp-server-no-file-tools --no-embed-tools
</span></span></code></pre></div>见到如下图则表示启动成功：
<img src="tui.png" alt="tui.png"></li>
</ul>
<ol start="8">
<li>启动 Qwen Code</li>
</ol>
<ul>
<li>在<code>UCAgent/output</code>目录输入<code>qwen</code>启动 Qwen Code，看见 &gt;QWEN 图就表示启动成功。</li>
</ul>
<p><img src="qwen.png" alt="qwen.png"></p>
<ol start="9">
<li>开始验证</li>
</ol>
<ul>
<li>在框内输入提示词并且<strong>同意 Qwen Code 的使用工具、命令和读写文件请求</strong>。（通过<code>j/k</code>控制上/下）提示词如下：
<blockquote>
<p>请通过工具 RoleInfo 获取你的角色信息和基本指导，然后完成任务。请使用工具 ReadTextFile 读取文件。你需要在当前工作目录进行文件操作，不要超出该目录。</p></blockquote>
</li>
</ul>
<p><img src="qwen-allow.png" alt="qwen-allow.png"></p>
<p>有时候 Qwen Code 停止了，但是我们不确定是否完成了任务，此时可以通过查看 server 的 tui 界面来确认。</p>
<p><img src="tui-pause.png" alt="tui-pause.png">
此时 Mission 部分显示阶段还在 13，所以我们还要让 Qwen Code 继续执行任务。</p>
<p><img src="qwen-pause.png" alt="qwen-pause.png">
中途停止了，但是任务没有完成，可以通过在输入框里输入“继续”来继续。</p>
<ol start="10">
<li>结果分析<a id="详细输出"></a></li>
</ol>
<p>最终的结果都在<code>output</code>文件夹中，其中的内容如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── Adder  <span style="color:#8f5902;font-style:italic"># 打包好的python DUT</span>
</span></span><span style="display:flex;"><span>├── Guide_Doc <span style="color:#8f5902;font-style:italic"># 各种模板文件</span>
</span></span><span style="display:flex;"><span>├── uc_test_report <span style="color:#8f5902;font-style:italic"># 跑完的测试报告，包含可以直接网页运行的index.html</span>
</span></span><span style="display:flex;"><span>└── unity_test <span style="color:#8f5902;font-style:italic"># 各种生成的文档和测试用例文件</span>
</span></span><span style="display:flex;"><span>    └── tests <span style="color:#8f5902;font-style:italic"># 测试用例及其依赖</span>
</span></span></code></pre></div><ul>
<li>
<p>Guide_Doc：这些文件是“规范/示例/模板型”的参考文档，启动时会从<code>vagent/lang/zh/doc/Guide_Doc</code>复制到工作区的 <code>Guide_Doc/</code>（当前以 output 作为 workspace 时即 <code>output/Guide_Doc/</code>）。它们不会被直接执行，供人和 AI 作为编写 unity_test 文档与测试的范式与规范，并被语义检索工具读取，在 UCAgent 初始化时复制过来。</p>
<ul>
<li>
<p>dut_functions_and_checks.md<br>
用途：定义功能分组 FG-、功能点 FC-、检测点 CK-* 的组织方式与写法规范，要求覆盖所有功能点，每个功能点至少一个检测点。<br>
最终要产出的对应物：unity_test/{DUT}_functions_and_checks.md（如 <code>Adder_functions_and_checks.md</code>）。</p>
</li>
<li>
<p>dut_fixture.md<br>
用途：说明如何编写 DUT Fixture/Env（包含接口、时序、复位、激励、监视、检查、钩子等），给出标准写法和必备项。<br>
对应物：unity_test/DutFixture 与 EnvFixture 相关实现/文档。</p>
</li>
<li>
<p>dut_api_instruction.md<br>
用途：DUT API 设计与文档规范（接口命名、参数、返回、约束、边界条件、错误处理、示例）。<br>
对应物：unity_test/{DUT}_api.md 或 API 实现+测试（如 <code>Adder_api.py</code>）。</p>
</li>
<li>
<p>dut_function_coverage_def.md<br>
用途：功能覆盖（Functional Coverage）定义方法，如何从 FG/FC/CK 推导覆盖项、covergroup/coverpoint/bin 的组织与命名。<br>
对应物：coverage 定义文件与生成的覆盖数据、以及相关说明文档，如<code>Adder_function_coverage_def.py</code>。</p>
</li>
<li>
<p>dut_line_coverage.md<br>
用途：行覆盖采集与分析方法，如何启用、统计、解读未命中行、定位冗余或缺失测试。<br>
对应物：行覆盖数据文件与分析笔记（unity_test/{DUT}_line_coverage_analysis.md，如 <code>Adder_line_coverage_analysis.md</code>）。</p>
</li>
<li>
<p>dut_test_template.md<br>
用途：测试用例的骨架/模板，给出最小可行的结构与编写范式（Arrange-Act-Assert、前后置、标记/选择器等）。<br>
对应物：tests/ 下各具体测试文件的基本结构参考。</p>
</li>
<li>
<p>dut_test_case.md<br>
用途：单个测试用例的撰写规范（命名、输入空间、边界/异常、可重复性、断言质量、日志、标记）。<br>
对应物：tests/ 中具体 test_xxx.py::test_yyy 的质量基准与填写要求。</p>
</li>
<li>
<p>dut_test_program.md<br>
用途：测试计划/测试编排（回归集合、分层/分阶段执行、标记与选择、超时控制、先后顺序、依赖关系）。<br>
对应物：回归集配置、命令/脚本、阶段化执行策略文档。</p>
</li>
<li>
<p>dut_test_summary.md<br>
用途：测试阶段性/最终总结的结构（通过率、覆盖率、主要问题、修复状态、风险/残留问题、下一步计划）。<br>
对应物：unity_test/{DUT}_test_summary.md（如<code>Adder_test_summary.md</code>） 或报告页面（<code>output/uc_test_report</code>）。</p>
</li>
<li>
<p>dut_bug_analysis.md<br>
用途：Bug 记录与分析规范（复现步骤、根因分析、影响范围、修复建议、验证状态、标签与追踪）。<br>
对应物：unity_test/{DUT}_bug_analysis.md（如<code>Adder_bug_analysis.md</code>）。</p>
</li>
</ul>
</li>
<li>
<p>uc_test_report：由 toffee-test 生成的 index.html 报告，可直接使用浏览器打开。</p>
<ul>
<li>这个报告包含了 Line Coverage 行覆盖率，Functional Coverage 功能覆盖率，测试用例的通过情况，功能点标记具体情况等内容。</li>
</ul>
</li>
<li>
<p>unity_test/tests：验证代码文件夹</p>
<ul>
<li>
<p><code>Adder.ignore</code><br>
作用：行覆盖率忽略清单。支持忽略整个文件，或以“起止行段”形式忽略代码段。<br>
被谁使用：<code>Adder_api.py</code> 的 <code>set_line_coverage(request, get_coverage_data_path(request, new_path=False), ignore=current_path_file(&quot;Adder.ignore&quot;))</code>。</p>
<p>与 Guide_Doc 的关系：
对应参考：<code>dut_line_coverage.md</code>（说明如何启用/统计/分析行覆盖，以及忽略规则的意义和使用场景）。</p>
</li>
<li>
<p><code>Adder_api.py</code><br>
作用：测试公共基座，集中放 DUT 构造、覆盖率接线与采样、pytest 基础夹具（fixtures）和示例 API。</p>
<ul>
<li>create_dut(request): 实例化 DUT、设置覆盖率文件、可选波形、绑定 StepRis 采样。</li>
<li>AdderEnv: 封装引脚与常用操作（Step）。</li>
<li>api_Adder_add: 对外暴露的测试 API，完成参数校验、信号赋值、推进、读取结果。</li>
<li>pytest fixtures：dut（模块级，负责覆盖率采样/收集交给 toffee_test）、env（函数级，给每个 test 一个全新环境）。</li>
</ul>
<p>与 Guide_Doc 的关系：</p>
<ul>
<li>dut_fixture.md：夹具/环境（Fixture/Env）的组织、Step/StepRis 的用法与职责边界。</li>
<li>dut_api_instruction.md：API 设计（命名、参数约束、返回、示例、异常）和文档规范。</li>
<li>dut_function_coverage_def.md：如何将功能覆盖组接线到 DUT 并在 StepRis 内采样。</li>
<li>dut_line_coverage.md：如何设置行覆盖文件、忽略清单，并将数据上报给 toffee_test。</li>
</ul>
</li>
<li>
<p><code>Adder_function_coverage_def.py</code><br>
作用：功能覆盖定义（Functional Coverage），声明 FG/FC/CK 并给出 watch_point 条件。</p>
<ul>
<li>定义覆盖组：FG-API、FG-ARITHMETIC、FG-BIT-WIDTH。</li>
</ul>
</li>
<li>
<p>每组下定义 FC-_ 和 CK-_ 条件（如 CK-BASIC/CK-CARRY-IN/CK-OVERFLOW 等）。</p>
<ul>
<li>get_coverage_groups(dut): 初始化并返回覆盖组列表，供 Adder_api.py 绑定与采样。</li>
</ul>
<p>与 Guide_Doc 的关系：</p>
<ul>
<li>dut_function_coverage_def.md：覆盖组/覆盖点的组织方式与命名规范、watch_point 的表达方式。</li>
<li>dut_functions_and_checks.md：FG/FC/CK 的命名体系与映射关系来源，测试中用 mark_function 标记覆盖时需与此保持一致。</li>
</ul>
</li>
<li>
<p><code>test_Adder_api_basic.py</code><br>
作用：API 层面的基础功能测试，覆盖典型输入、进位、零值、溢出、边界等。</p>
<ul>
<li>使用 from Adder_api import * 来获取 fixtures（dut/env）与 API。</li>
<li>在每个测试中通过 env.dut.fc_cover[&ldquo;FG-&hellip;&rdquo;].mark_function(&ldquo;FC-&hellip;&rdquo;, &lt;test_fn&gt;, [&ldquo;CK-&hellip;&rdquo;]) 标注功能覆盖命中关系。
与 Guide_Doc 的关系：</li>
<li>dut_test_case.md：单测结构（目标/流程/预期）、命名与断言规范、可重复性、标记与日志。</li>
<li>dut_functions_and_checks.md：FG/FC/CK 的正确引用与标注。</li>
<li>dut_test_template.md：docstring 和结构写法的范式来源。</li>
</ul>
</li>
<li>
<p><code>test_Adder_functional.py</code><br>
作用：功能行为测试（接近“场景/功能项”的角度），比 API 基测覆盖更全面的功能点验证。</p>
<ul>
<li>同样通过 mark_function 与 FG/FC/CK 标签体系对齐。
与 Guide_Doc 的关系：
<ul>
<li>dut_test_case.md：功能类测试的编写规范与断言要求。</li>
<li>dut_functions_and_checks.md：功能覆盖标注的规范与完整性。</li>
<li>dut_test_template.md：测试函数组织的范式。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>test_example.py</code><br>
作用：空白样例（脚手架），用于新增测试文件的最小模板参考。
与 Guide_Doc 的关系：</p>
<ul>
<li>dut_test_template.md：新建测试文件/函数时的结构、引入方式与标注方法的模板。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>unity_test/*.md：验证相关文档</p>
<ul>
<li>
<p>Adder_basic_info.md</p>
<ul>
<li>用途：DUT 概览与接口说明（功能、端口、类型、粗粒度功能分类）。</li>
<li>参考：<code>Guide_Doc/dut_functions_and_checks.md</code>（接口/功能分类用语）、<code>Guide_Doc/dut_fixture.md</code>（从验证视角描述 I/O 与 Step 时可参考）。</li>
</ul>
</li>
<li>
<p>Adder_verification_needs_and_plan.md</p>
<ul>
<li>用途：验证需求与计划（目标、风险点、测试项规划、方法论）。</li>
<li>参考：<code>Guide_Doc/dut_test_program.md</code>（编排与选择策略）、<code>Guide_Doc/dut_test_case.md</code>（单测质量要求）、<code>Guide_Doc/dut_functions_and_checks.md</code>（从需求到 FG/FC/CK 的映射）。</li>
</ul>
</li>
<li>
<p>Adder_functions_and_checks.md</p>
<ul>
<li>用途：FG/FC/CK 真源清单，测试标注与功能覆盖定义需与此保持一致。</li>
<li>参考：<code>Guide_Doc/dut_functions_and_checks.md</code>（结构/命名）、<code>Guide_Doc/dut_function_coverage_def.md</code>（如何落地为覆盖实现）。</li>
</ul>
</li>
<li>
<p>Adder_line_coverage_analysis.md</p>
<ul>
<li>用途：行覆盖率结论与分析，解释忽略清单、未命中行、补测建议。</li>
<li>参考：<code>Guide_Doc/dut_line_coverage.md</code>；配合同目录 tests 下的 <code>Adder.ignore</code>。</li>
</ul>
</li>
<li>
<p>Adder_bug_analysis.md</p>
<ul>
<li>用途：缺陷分析报告，按 CK/TC 对应、置信度、根因、修复建议与回归方法撰写。</li>
<li>参考：<code>Guide_Doc/dut_bug_analysis.md</code>（结构/要素）、<code>Guide_Doc/dut_functions_and_checks.md</code>（命名一致）。</li>
</ul>
</li>
<li>
<p>Adder_test_summary.md</p>
<ul>
<li>用途：阶段性/最终测试总结（执行统计、覆盖情况、缺陷分布、建议、结论）。</li>
<li>参考：<code>Guide_Doc/dut_test_summary.md</code>，与 <code>Guide_Doc/dut_test_program.md</code> 呼应。</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="11">
<li>流程总结</li>
</ol>
<p>要做什么：</p>
<ul>
<li>将 DUT（如 Adder）打包为可测的 Python 模块</li>
<li>启动 UCAgent（可带 MCP Server），让 Code Agent 协作按阶段推进验证</li>
<li>依据 Guide_Doc 规范生成/完善 unity_test 文档与 tests，并以功能覆盖+行覆盖驱动测试</li>
<li>发现并分析缺陷，产出报告与结论</li>
</ul>
<p>做了什么：</p>
<ul>
<li>用 picker 将 RTL 导出为 Python 包（<code>output/Adder/</code>），准备最小 README 与文件清单</li>
<li>启动 <code>ucagent</code>（含 <code>--mcp-server</code>/<code>--mcp-server-no-file-tools</code>），在 TUI/MCP 下协作</li>
<li>在 Guide_Doc 规范约束下，生成/补全：
<ul>
<li>功能清单与检测点：<code>unity_test/Adder_functions_and_checks.md</code>（FG/FC/CK）</li>
<li>夹具/环境与 API：<code>tests/Adder_api.py</code>（<code>create_dut</code>、<code>AdderEnv</code>、<code>api_Adder_*</code>）</li>
<li>功能覆盖定义：<code>tests/Adder_function_coverage_def.py</code>（绑定 <code>StepRis</code> 采样）</li>
<li>行覆盖配置与忽略：<code>tests/Adder.ignore</code>，分析文档 <code>unity_test/Adder_line_coverage_analysis.md</code></li>
<li>用例实现：<code>tests/test_*.py</code>（标注 <code>mark_function</code> 与 FG/FC/CK）</li>
<li>缺陷分析与总结：<code>unity_test/Adder_bug_analysis.md</code>、<code>unity_test/Adder_test_summary.md</code></li>
</ul>
</li>
<li>通过工具编排推进：<code>RunTestCases</code>/<code>Check</code>/<code>StdCheck</code>/<code>KillCheck</code>/<code>Complete</code>/<code>GoToStage</code></li>
<li>权限控制仅允许写 <code>unity_test/</code> 与 <code>tests</code>（<code>add_un_write_path</code>/<code>del_un_write_path</code>）</li>
</ul>
<p>实现的效果：</p>
<ul>
<li>自动/半自动地产出合规的文档与可回归的测试集，支持全量与定向回归</li>
<li>功能覆盖与行覆盖数据齐备，未命中点可定位与补测</li>
<li>缺陷根因、修复建议与验证方法有据可依，形成结构化报告（<code>uc_test_report/index.html</code>）</li>
<li>支持 MCP 集成与 TUI 协作，过程可暂停/检查/回补，易于迭代与复用</li>
</ul>
<p>典型操作轨迹（卡住时）：</p>
<ul>
<li><code>Check</code> → <code>StdCheck(lines=-1)</code> → <code>KillCheck</code> → 修复 → <code>Check</code> → <code>Complete</code></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6d7ccde5388a9664f923cf6de9f5e2d0">2 - 使用</h1>
    <div class="lead">两种使用方式、各个选项参数、TUI界面和FAQ说明。</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-4c2f0764b1448b4485db5bdc8abbc971">2.1 - MCP集成模式（推荐）</h1>
    <div class="lead">如何使用MCP集成模式来使用UCAgent。</div>
	<h2 id="mcp-集成推荐集成code-agent">MCP 集成（推荐）集成Code Agent</h2>
<p>基于 MCP 的外部编程 CLI 协作方式。该模式能与所有支持 MCP-Server 调用的 LLM 客户端进行协同验证，例如：Cherry Studio、Claude Code、 Gemini-CLI、VS Code Copilot、Qwen-Code等。
平常使用是直接使用<code>make</code>命令的，要看详细命令可参考<a href="../ucagent/introduce.md/#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B">快速开始</a>，也可以直接查看项目根目录的<code>Makefile</code>文件。</p>
<ul>
<li>
<p>准备RTL和对应的SPEC文档放入<code>examples/{dut}</code>文件夹。<code>{dut}</code>是模块的名称，比如<code>Adder</code>，如果是<code>Adder</code>，目录则为<code>examples/Adder</code>。</p>
</li>
<li>
<p>打包RTL，将文档放入工作目录并且启动 MCP server：<code>make mcp_{dut}</code>，<code>{dut}</code>为对应的模块。此处如果使用的<code>Adder</code>，则命令为<code>make mcp_Adder</code></p>
</li>
<li>
<p>在支持 MCP client 的应用中配置 JSON：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">&#34;mcpServers&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#204a87;font-weight:bold">&#34;unitytest&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">&#34;httpUrl&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://localhost:5000/mcp&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">&#34;timeout&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">10000</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></li>
<li>
<p>启动应用：此处使用的Qwen Code，在<code>UCAgent/output</code>启动qwen,然后输入提示词。</p>
</li>
<li>
<p>输入提示词：</p>
</li>
</ul>
<blockquote>
<p>请通过工具<code>RoleInfo</code>获取你的角色信息和基本指导，然后完成任务。工具<code>ReadTextFile</code>读取文件。你需要在当前工作目录进行文件操作，不要超出该目录。</p></blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7735a0965a81b3fff45d8f9c0238a813">2.2 - 直接使用模式</h1>
    <div class="lead">直接使用方式、各个选项参数、TUI界面和FAQ说明。</div>
	<h2 id="直接使用">直接使用</h2>
<p>基于本地 CLI 和大模型的使用方式。需要准备好 OpenAI 兼容的 API 和嵌入模型 API。</p>
<h3 id="使用环境变量配置推荐">使用环境变量配置（推荐）</h3>
<p>配置文件内容：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># OpenAI兼容的API配置</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">openai</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">model_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;$(OPENAI_MODEL: Qwen/Qwen3-Coder-30B-A3B-Instruct)&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 模型名称</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">openai_api_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;$(OPENAI_API_KEY: YOUR_API_KEY)&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># API密钥</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">openai_api_base</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;$(OPENAI_API_BASE: http://10.156.154.242:8000/v1)&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># API基础URL</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># 向量嵌入模型配置</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># 用于文档搜索和记忆功能，不需要可通过 --no-embed-tools 关闭</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">embed</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">model_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;$(EMBED_MODEL: Qwen/Qwen3-Embedding-0.6B)&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 嵌入模型名称</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">openai_api_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;$(EMBED_OPENAI_API_KEY: YOUR_API_KEY)&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 嵌入模型API密钥</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">openai_api_base</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;$(EMBED_OPENAI_API_BASE: http://10.156.154.242:8001/v1)&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 嵌入模型API URL</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">dims</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">4096</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 嵌入维度</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>UCAgent 的配置文件支持 Bash 风格的环境变量占位：<code>$(VAR: default)</code>。加载时会用当前环境变量 <code>VAR</code> 的值替换；若未设置，则使用 <code>default</code>。</p>
<ul>
<li>例如在内置配置 <code>vagent/setting.yaml</code> 中：
<ul>
<li><code>openai.model_name: &quot;$(OPENAI_MODEL: &lt;your_chat_model_name&gt;)&quot;</code></li>
<li><code>openai.openai_api_key: &quot;$(OPENAI_API_KEY: [your_api_key])&quot;</code></li>
<li><code>openai.openai_api_base: &quot;$(OPENAI_API_BASE: http://&lt;your_chat_model_url&gt;/v1)&quot;</code></li>
<li><code>embed.model_name: &quot;$(EMBED_MODEL: &lt;your_embedding_model_name&gt;)&quot;</code></li>
<li>也支持其他提供商：<code>model_type</code> 可选 <code>openai</code>、<code>anthropic</code>、<code>google_genai</code>（详见 <code>vagent/setting.yaml</code>）。</li>
</ul>
</li>
</ul>
<p>你可以仅通过导出环境变量完成模型与端点切换，而无需改动配置文件。</p>
<p>示例：设置聊天模型与端点</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 指定聊天模型（OpenAI 兼容）</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">OPENAI_MODEL</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;Qwen/Qwen3-Coder-30B-A3B-Instruct&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 指定 API Key 与 Base（按你的服务商填写）</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">OPENAI_API_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;你的API密钥&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">OPENAI_API_BASE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;https://你的-openai-兼容端点/v1&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 可选：嵌入模型（若使用检索/记忆等功能）</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">EMBED_MODEL</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;text-embedding-3-large&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">EMBED_OPENAI_API_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$OPENAI_API_KEY</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">EMBED_OPENAI_API_BASE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$OPENAI_API_BASE</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>然后按前述命令启动 UCAgent 即可。若要长期生效，可将上述 export 追加到你的默认 shell 启动文件（例如 bash: <code>~/.bashrc</code>，zsh: <code>~/.zshrc</code>，fish: <code>~/.config/fish/config.fish</code>），保存后重新打开终端或手动加载。</p>
<h3 id="使用-configyaml-来配置">使用 config.yaml 来配置</h3>
<ul>
<li>在项目根目录创建并编辑 <code>config.yaml</code> 文件，配置 AI 模型和嵌入模型：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># OpenAI兼容的API配置</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">openai</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">openai_api_base</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;your_openai_api_base_url&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># API基础URL</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">model_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;your_model_name&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 模型名称，如 gpt-4o-mini</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">openai_api_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;your_openai_api_key&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># API密钥</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># 向量嵌入模型配置</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># 用于文档搜索和记忆功能，不需要可通过 --no-embed-tools 关闭</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">embed</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">model_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;your_embed_model_name&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 嵌入模型名称</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">openai_api_base</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;your_openai_api_base_url&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 嵌入模型API URL</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">openai_api_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;your_api_key&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 嵌入模型API密钥</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">dims</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;your_embed_model_dims&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 嵌入维度，如 1536</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="开始使用">开始使用</h3>
<ul>
<li>第一步和 MCP 模式相同，准备 RTL 和对应的 SPEC 文档放入<code>examples/{dut}</code>文件夹。<code>{dut}</code>是模块的名称，如果是<code>Adder</code>，目录则为<code>examples/Adder</code>。</li>
<li>第二步开始就不同了，打包 RTL，将文档放入工作目录并启动 UCAgent TUI：<code>make test_{dut}</code>，<code>{dut}</code>为对应的模块。若使用 <code>Adder</code>，命令为 <code>make test_Adder</code>（可在 <code>Makefile</code> 查看全部目标）。该命令会：
<ul>
<li>将 <code>examples/{dut}</code> 下文件拷贝到 <code>output/{dut}</code>（含 .v/.sv/.md/.py 等）</li>
<li>执行 <code>python3 ucagent.py output/ {dut} --config config.yaml -s -hm --tui -l</code></li>
<li>启动带 TUI 的 UCAgent，并自动进入任务循环（loop）</li>
</ul>
</li>
</ul>
<p>提示：验证产物默认写入 <code>output/unity_test/</code>，若需更改可通过 CLI 的 <code>--output</code> 参数指定目录名。</p>
<h3 id="直接用-cli-启动不经-makefile">直接用 CLI 启动（不经 Makefile）</h3>
<ul>
<li>未安装命令时（项目内运行）：
<ul>
<li><code>python3 ucagent.py output/ Adder --config config.yaml -s -hm --tui -l</code></li>
</ul>
</li>
<li>安装为命令后：
<ul>
<li><code>ucagent output/ Adder --config config.yaml -s -hm --tui -l</code></li>
</ul>
</li>
</ul>
<p>参数对齐 <code>vagent/cli.py</code>：</p>
<ul>
<li><code>workspace</code>：工作区目录（此处为 <code>output/</code>）</li>
<li><code>dut</code>：DUT 名称（工作区子目录名，如 <code>Adder</code>）</li>
<li>常用可选项：
<ul>
<li><code>--tui</code> 启动终端界面</li>
<li><code>-l/--loop --loop-msg &quot;...&quot;</code> 启动后立即进入循环并注入提示</li>
<li><code>-s/--stream-output</code> 实时输出</li>
<li><code>-hm/--human</code> 进入人工可干预模式（在阶段间可暂停）</li>
<li><code>--no-embed-tools</code> 如不需要检索/记忆工具</li>
<li><code>--skip/--unskip</code> 跳过/取消跳过阶段（可多次传入）</li>
</ul>
</li>
</ul>
<h3 id="常用-tui-命令速查直接使用模式">常用 TUI 命令速查（直接使用模式）</h3>
<ul>
<li>列出工具：<code>tool_list</code></li>
<li>阶段检查：<code>tool_invoke Check timeout=0</code></li>
<li>查看日志：<code>tool_invoke StdCheck lines=-1</code>（-1 表示所有行）</li>
<li>终止检查：<code>tool_invoke KillCheck</code></li>
<li>阶段完成：<code>tool_invoke Complete timeout=0</code></li>
<li>运行用例：
<ul>
<li>全量：<code>tool_invoke RunTestCases target='' timeout=0</code></li>
<li>单测函数：<code>tool_invoke RunTestCases target='tests/test_checker.py::test_run' timeout=120 return_line_coverage=True</code></li>
<li>过滤：<code>tool_invoke RunTestCases target='-k add or mul'</code></li>
</ul>
</li>
<li>阶段跳转：<code>tool_invoke GoToStage index=2</code>（索引从 0 开始）</li>
<li>继续执行：<code>loop 继续修复 ALU754 的未命中分支并重试用例</code></li>
</ul>
<p>建议的最小可写权限（只允许生成验证产物处可写）：</p>
<ul>
<li>仅允许 <code>unity_test/</code> 与 <code>unity_test/tests/</code> 可写：
<ul>
<li><code>add_un_write_path *</code></li>
<li><code>del_un_write_path unity_test</code></li>
<li><code>del_un_write_path unity_test/tests</code></li>
</ul>
</li>
</ul>
<h3 id="常见问题与提示">常见问题与提示</h3>
<ul>
<li>检查卡住/无输出：
<ul>
<li>先 <code>tool_invoke StdCheck lines=-1</code> 查看全部日志；必要时 <code>tool_invoke KillCheck</code>；修复后重试 <code>tool_invoke Check</code>。</li>
</ul>
</li>
<li>没找到工具名：
<ul>
<li>先执行 <code>tool_list</code> 确认可用工具；若缺失，检查是否在 TUI 模式、是否禁用了嵌入工具（通常无关）。</li>
</ul>
</li>
<li>产物位置：
<ul>
<li>默认在 <code>workspace/output_dir</code>，即本页示例为 <code>output/unity_test/</code>。</li>
</ul>
</li>
</ul>
<h3 id="相关文档">相关文档</h3>
<ul>
<li>人机协同的完整流程与示例，见<a href="/mlvp/docs/ucagent/usage/assit/">人机协同验证</a></li>
<li>MCP 集成（如 gemini-cli / qwen code），见<a href="/mlvp/docs/ucagent/usage/mcp/">MCP集成模式</a></li>
<li>TUI 界面与操作详解，见<a href="/mlvp/docs/ucagent/usage/tui/">TUI</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fbd7beae096d8cd3a81879ce0d6d9759">2.3 - 人机协同验证</h1>
    <div class="lead">如何与AI配合来验证模块。</div>
	<p>UCAgent 支持在验证过程中进行人机协同，允许用户暂停 AI 执行，人工干预验证过程，然后继续 AI 执行。这种模式适用于需要精细控制或复杂决策的场景。</p>
<p><strong>协同流程：</strong></p>
<ol>
<li>
<p>暂停 AI 执行：</p>
<ul>
<li>在直接接入 LLM 模式下：按 <code>Ctrl+C</code> 暂停。</li>
<li>在 Code Agent 协同模式下：根据 Agent 的暂停方式（如 Gemini-cli 使用 <code>Esc</code>）暂停。</li>
</ul>
</li>
<li>
<p>人工干预：</p>
<ul>
<li>手动编辑文件、测试用例或配置。</li>
<li>使用交互命令进行调试或调整。</li>
</ul>
</li>
<li>
<p>阶段控制：</p>
<ul>
<li>使用 <code>tool_invoke Check</code> 检查当前阶段状态。</li>
<li>使用 <code>tool_invoke Complete</code> 标记阶段完成并进入下一阶段。</li>
</ul>
</li>
<li>
<p>继续执行：</p>
<ul>
<li>使用 <code>loop [prompt]</code> 命令继续 AI 执行，并可提供额外的提示信息。</li>
<li>在 Code Agent 模式下，通过 Agent 的控制台输入提示。</li>
</ul>
</li>
<li>
<p>权限管理：</p>
<ul>
<li>可使用 <code>add_un_write_path</code>，<code>del_un_write_path</code> 等命令设置文件写权限，控制 AI 是否可以编辑特定文件。</li>
<li>适用于直接接入 LLM 或强制使用 UCAgent 文件工具。</li>
</ul>
</li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-56fd437efd30e85d1af55e127ea86585">2.4 - 参数说明</h1>
    <div class="lead">各个选项参数说明。</div>
	<h2 id="参数与选项">参数与选项</h2>
<p>UCAgent 的使用方式为：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ucagent &lt;workspace&gt; &lt;dut_name&gt; <span style="color:#ce5c00;font-weight:bold">{</span>参数与选项<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="输入">输入</h3>
<ul>
<li>workspace：工作目录：
<ul>
<li>workspace/&lt;DUT_DIR&gt;: 待测设计（DUT），即由 picker 导出的 DUT 对应的 Python 包 &lt;DUT_DIR&gt;，例如：Adder</li>
<li>workspace/&lt;DUT_DIR&gt;/README.md: 以自然语言描述的该 DUT 验证需求与目标</li>
<li>workspace/&lt;DUT_DIR&gt;/*.md: 其他参考文件</li>
<li>workspace/&lt;DUT_DIR&gt;/*.v/sv/scala: 源文件，用于进行 bug 分析</li>
<li>其他与验证相关的文件（例如：提供的测试实例、需求说明等）</li>
</ul>
</li>
<li>dut_name: 待测设计的名称，即 &lt;DUT_DIR&gt;，例如：Adder</li>
</ul>
<h3 id="输出">输出</h3>
<ul>
<li>workspace：工作目录：
<ul>
<li>workspace/Guide_Doc：验证过程中所遵循的各项要求与指导文档</li>
<li>workspace/uc_test_report： 生成的 Toffee-test 测试报告</li>
<li>workspace/unity_test/tests： 自动生成的测试用例</li>
<li>workspace/*.md： 生成的各类文档，包括 Bug 分析、检查点记录、验证计划、验证结论等</li>
</ul>
</li>
</ul>
<blockquote>
<p>对输出的详细解释可以参考<a href="/mlvp/docs/ucagent/introduce/#%e8%af%a6%e7%bb%86%e8%be%93%e5%87%ba">快速开始的9</a></p></blockquote>
<h3 id="位置参数">位置参数</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">参数</th>
          <th style="text-align: center">必填</th>
          <th style="text-align: left">说明</th>
          <th style="text-align: left">示例</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">workspace</td>
          <td style="text-align: center">是</td>
          <td style="text-align: left">运行代理的工作目录</td>
          <td style="text-align: left">./output</td>
      </tr>
      <tr>
          <td style="text-align: left">dut</td>
          <td style="text-align: center">是</td>
          <td style="text-align: left">DUT 名称（工作目录下的子目录名）</td>
          <td style="text-align: left">Adder</td>
      </tr>
  </tbody>
</table>
<h3 id="执行与交互">执行与交互</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">选项</th>
          <th style="text-align: left">简写</th>
          <th style="text-align: left">取值/类型</th>
          <th style="text-align: left">默认值</th>
          <th style="text-align: left">说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">--stream-output</td>
          <td style="text-align: left">-s</td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">关闭</td>
          <td style="text-align: left">流式输出到控制台</td>
      </tr>
      <tr>
          <td style="text-align: left">--human</td>
          <td style="text-align: left">-hm</td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">关闭</td>
          <td style="text-align: left">启动时进入人工输入/断点模式</td>
      </tr>
      <tr>
          <td style="text-align: left">--interaction-mode</td>
          <td style="text-align: left">-im</td>
          <td style="text-align: left">standard/enhanced/advanced</td>
          <td style="text-align: left">standard</td>
          <td style="text-align: left">交互模式；enhanced 含规划与记忆管理，advanced 含自适应策略</td>
      </tr>
      <tr>
          <td style="text-align: left">--tui</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">关闭</td>
          <td style="text-align: left">启用终端 TUI 界面</td>
      </tr>
      <tr>
          <td style="text-align: left">--loop</td>
          <td style="text-align: left">-l</td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">关闭</td>
          <td style="text-align: left">启动后立即进入主循环（可配合 --loop-msg），适用于直接使用模式</td>
      </tr>
      <tr>
          <td style="text-align: left">--loop-msg</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">str</td>
          <td style="text-align: left">空</td>
          <td style="text-align: left">进入循环时注入的首条消息</td>
      </tr>
      <tr>
          <td style="text-align: left">--seed</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">int</td>
          <td style="text-align: left">随机</td>
          <td style="text-align: left">随机种子（未指定则自动随机）</td>
      </tr>
      <tr>
          <td style="text-align: left">--sys-tips</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">str</td>
          <td style="text-align: left">空</td>
          <td style="text-align: left">覆盖系统提示词</td>
      </tr>
  </tbody>
</table>
<h3 id="配置与模板">配置与模板</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">选项</th>
          <th style="text-align: left">简写</th>
          <th style="text-align: left">取值/类型</th>
          <th style="text-align: left">默认值</th>
          <th style="text-align: left">说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">--config</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">path</td>
          <td style="text-align: left">无</td>
          <td style="text-align: left">配置文件路，如&ndash;config config.yaml径</td>
      </tr>
      <tr>
          <td style="text-align: left">--template-dir</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">path</td>
          <td style="text-align: left">无</td>
          <td style="text-align: left">自定义模板目录</td>
      </tr>
      <tr>
          <td style="text-align: left">--template-overwrite</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">否</td>
          <td style="text-align: left">渲染模板到 workspace 时允许覆盖已存在内容</td>
      </tr>
      <tr>
          <td style="text-align: left">--output</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">dir</td>
          <td style="text-align: left">unity_test</td>
          <td style="text-align: left">输出目录名</td>
      </tr>
      <tr>
          <td style="text-align: left">--override</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">A.B.C=VALUE[,X.Y=VAL2,&hellip;]</td>
          <td style="text-align: left">无</td>
          <td style="text-align: left">以“点号路径=值”覆盖配置；字符串需引号，其它按 Python 字面量解析</td>
      </tr>
      <tr>
          <td style="text-align: left">--gen-instruct-file</td>
          <td style="text-align: left">-gif</td>
          <td style="text-align: left">file</td>
          <td style="text-align: left">无</td>
          <td style="text-align: left">在 workspace 下生成外部 Agent 的引导文件（存在则覆盖）</td>
      </tr>
      <tr>
          <td style="text-align: left">--guid-doc-path</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">path</td>
          <td style="text-align: left">无</td>
          <td style="text-align: left">使用自定义 Guide_Doc 目录（默认使用内置拷贝）</td>
      </tr>
  </tbody>
</table>
<h3 id="计划与-todo">计划与 ToDo</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">选项</th>
          <th style="text-align: left">简写</th>
          <th style="text-align: left">取值/类型</th>
          <th style="text-align: left">默认值</th>
          <th style="text-align: left">说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">--force-todo</td>
          <td style="text-align: left">-fp</td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">否</td>
          <td style="text-align: left">在 standard 模式下也启用 ToDo 工具，并在每轮提示中附带 ToDo 信息</td>
      </tr>
      <tr>
          <td style="text-align: left">--use-todo-tools</td>
          <td style="text-align: left">-utt</td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">否</td>
          <td style="text-align: left">启用 ToDo 相关工具（不限于 standard 模式）</td>
      </tr>
  </tbody>
</table>
<h3 id="todo-工具概览与示例--给模型规划的小模型关闭大模型自行打开">ToDo 工具概览与示例  给模型规划的，小模型关闭，大模型自行打开</h3>
<p>说明：ToDo 工具是用于提升模型规划能力的工具，用户可以利用它来自定义模型的ToDo列表。目前该功能对模型能力要求较高，默认处于关闭状态。</p>
<p>启用条件：任意模式下使用 <code>--use-todo-tools</code>；或在 standard 模式用 <code>--force-todo</code> 强制启用并在每轮提示中附带 ToDo 信息。</p>
<p>约定与限制：步骤索引为 1-based；steps 数量需在 2~20；notes 与每个 step 文本长度 ≤ 100；超限会拒绝并返回错误字符串。</p>
<p>工具总览</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">工具类</th>
          <th style="text-align: left">调用名</th>
          <th style="text-align: left">主要功能</th>
          <th style="text-align: left">参数</th>
          <th style="text-align: left">返回</th>
          <th style="text-align: left">关键约束/行为</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">CreateToDo</td>
          <td style="text-align: left">CreateToDo</td>
          <td style="text-align: left">新建当前 ToDo（覆盖旧 ToDo）</td>
          <td style="text-align: left">task_description: str; steps: List[str]</td>
          <td style="text-align: left">成功提示 + 摘要字符串</td>
          <td style="text-align: left">校验步数与长度；成功后写入并返回摘要</td>
      </tr>
      <tr>
          <td style="text-align: left">CompleteToDoSteps</td>
          <td style="text-align: left">CompleteToDoSteps</td>
          <td style="text-align: left">将指定步骤标记为完成，可附加备注</td>
          <td style="text-align: left">completed_steps: List[int]=[]; notes: str=&quot;&quot;</td>
          <td style="text-align: left">成功提示（完成数）+ 摘要</td>
          <td style="text-align: left">仅未完成步骤生效；无 ToDo 时提示先创建；索引越界忽略</td>
      </tr>
      <tr>
          <td style="text-align: left">UndoToDoSteps</td>
          <td style="text-align: left">UndoToDoSteps</td>
          <td style="text-align: left">撤销步骤完成状态，可附加备注</td>
          <td style="text-align: left">steps: List[int]=[]; notes: str=&quot;&quot;</td>
          <td style="text-align: left">成功提示（撤销数）+ 摘要</td>
          <td style="text-align: left">仅已完成步骤生效；无 ToDo 时提示先创建；索引越界忽略</td>
      </tr>
      <tr>
          <td style="text-align: left">ResetToDo</td>
          <td style="text-align: left">ResetToDo</td>
          <td style="text-align: left">重置/清空当前 ToDo</td>
          <td style="text-align: left">无</td>
          <td style="text-align: left">重置成功提示</td>
          <td style="text-align: left">清空步骤与备注，随后可重新创建</td>
      </tr>
      <tr>
          <td style="text-align: left">GetToDoSummary</td>
          <td style="text-align: left">GetToDoSummary</td>
          <td style="text-align: left">获取当前 ToDo 摘要</td>
          <td style="text-align: left">无</td>
          <td style="text-align: left">摘要字符串 / 无 ToDo 提示</td>
          <td style="text-align: left">只读，不修改状态</td>
      </tr>
      <tr>
          <td style="text-align: left">ToDoState</td>
          <td style="text-align: left">ToDoState</td>
          <td style="text-align: left">获取状态短语（看板/状态栏）</td>
          <td style="text-align: left">无</td>
          <td style="text-align: left">状态描述字符串</td>
          <td style="text-align: left">动态显示：无 ToDo/已完成/进度统计等</td>
      </tr>
  </tbody>
</table>
<p>调用示例（以 MCP/内部工具调用为例，参数为 JSON 格式）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">&#34;tool&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;CreateToDo&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#204a87;font-weight:bold">&#34;task_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;为 Adder 核心功能完成验证闭环&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>		<span style="color:#204a87;font-weight:bold">&#34;steps&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;阅读 README 与规格，整理功能点&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;定义检查点与通过标准&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;生成首批单元测试&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;运行并修复失败用例&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;补齐覆盖率并输出报告&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">&#34;tool&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;CompleteToDoSteps&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">&#34;completed_steps&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;初始问题排查完成，准备补充用例&#34;</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">&#34;tool&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;UndoToDoSteps&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">&#34;steps&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;第二步需要微调检查点&#34;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">&#34;tool&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ResetToDo&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{}</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">&#34;tool&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;GetToDoSummary&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{}</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">&#34;tool&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ToDoState&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{}</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="外部与嵌入工具">外部与嵌入工具</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">选项</th>
          <th style="text-align: left">简写</th>
          <th style="text-align: left">取值/类型</th>
          <th style="text-align: left">默认值</th>
          <th style="text-align: left">说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">--ex-tools</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">name1[,name2&hellip;]</td>
          <td style="text-align: left">无</td>
          <td style="text-align: left">逗号分隔的外部工具类名列表（如：SqThink）</td>
      </tr>
      <tr>
          <td style="text-align: left">--no-embed-tools</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">否</td>
          <td style="text-align: left">禁用内置的检索/记忆类嵌入工具</td>
      </tr>
  </tbody>
</table>
<h3 id="日志">日志</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">选项</th>
          <th style="text-align: left">简写</th>
          <th style="text-align: left">取值/类型</th>
          <th style="text-align: left">默认值</th>
          <th style="text-align: left">说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">--log</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">否</td>
          <td style="text-align: left">启用日志</td>
      </tr>
      <tr>
          <td style="text-align: left">--log-file</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">path</td>
          <td style="text-align: left">自动</td>
          <td style="text-align: left">日志输出文件（未指定则使用默认）</td>
      </tr>
      <tr>
          <td style="text-align: left">--msg-file</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">path</td>
          <td style="text-align: left">自动</td>
          <td style="text-align: left">消息日志文件（未指定则使用默认）</td>
      </tr>
  </tbody>
</table>
<h3 id="mcp-server">MCP Server</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">选项</th>
          <th style="text-align: left">简写</th>
          <th style="text-align: left">取值/类型</th>
          <th style="text-align: left">默认值</th>
          <th style="text-align: left">说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">--mcp-server</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">否</td>
          <td style="text-align: left">启动 MCP Server（含文件工具）</td>
      </tr>
      <tr>
          <td style="text-align: left">--mcp-server-no-file-tools</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">否</td>
          <td style="text-align: left">启动 MCP Server（无文件操作工具）</td>
      </tr>
      <tr>
          <td style="text-align: left">--mcp-server-host</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">host</td>
          <td style="text-align: left">127.0.0.1</td>
          <td style="text-align: left">Server 监听地址</td>
      </tr>
      <tr>
          <td style="text-align: left">--mcp-server-port</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">int</td>
          <td style="text-align: left">5000</td>
          <td style="text-align: left">Server 端口</td>
      </tr>
  </tbody>
</table>
<h3 id="阶段控制与安全">阶段控制与安全</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">选项</th>
          <th style="text-align: left">简写</th>
          <th style="text-align: left">取值/类型</th>
          <th style="text-align: left">默认值</th>
          <th style="text-align: left">说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">--force-stage-index</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">int</td>
          <td style="text-align: left">0</td>
          <td style="text-align: left">强制从指定阶段索引开始</td>
      </tr>
      <tr>
          <td style="text-align: left">--skip</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">int（可多次）</td>
          <td style="text-align: left">[]</td>
          <td style="text-align: left">跳过指定阶段索引，可重复提供</td>
      </tr>
      <tr>
          <td style="text-align: left">--unskip</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">int（可多次）</td>
          <td style="text-align: left">[]</td>
          <td style="text-align: left">取消跳过指定阶段索引，可重复提供</td>
      </tr>
      <tr>
          <td style="text-align: left">--no-write / &ndash;nw</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">path1 path2 &hellip;</td>
          <td style="text-align: left">无</td>
          <td style="text-align: left">限制写入目标列表；必须位于 workspace 内且存在</td>
      </tr>
  </tbody>
</table>
<h3 id="版本与检查">版本与检查</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">选项</th>
          <th style="text-align: left">简写</th>
          <th style="text-align: left">取值/类型</th>
          <th style="text-align: left">默认值</th>
          <th style="text-align: left">说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">--check</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left">否</td>
          <td style="text-align: left">检查默认配置、语言目录、模板与 Guide_Doc 是否存在后退出</td>
      </tr>
      <tr>
          <td style="text-align: left">--version</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">flag</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">输出版本并退出</td>
      </tr>
  </tbody>
</table>
<h3 id="示例">示例</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 ucagent.py ./output Adder <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -s <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -hm <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -im enhanced <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --tui <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -l <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --loop-msg <span style="color:#4e9a06">&#39;start verification&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --seed <span style="color:#0000cf;font-weight:bold">12345</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --sys-tips <span style="color:#4e9a06">&#39;按规范完成Adder的验证&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --config config.yaml <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --template-dir ./templates <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --template-overwrite <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --output unity_test <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --override <span style="color:#4e9a06">&#39;conversation_summary.max_tokens=16384,...&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --use-todo-tools <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --ex-tools <span style="color:#4e9a06">&#39;SqThink,AnotherTool&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --no-embed-tools <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --log <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --log-file ./output/ucagent.log <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --msg-file ./output/ucagent.msg <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --mcp-server-no-file-tools <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --mcp-server-host 127.0.0.1 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --mcp-server-port <span style="color:#0000cf;font-weight:bold">5000</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --force-stage-index <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --skip <span style="color:#0000cf;font-weight:bold">5</span> --skip <span style="color:#0000cf;font-weight:bold">7</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --unskip <span style="color:#0000cf;font-weight:bold">6</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --nw ./output/Adder ./output/unity_test
</span></span></code></pre></div><ul>
<li>位置参数
<ul>
<li>./output：workspace 工作目录</li>
<li>Adder：dut 子目录名</li>
</ul>
</li>
<li>执行与交互
<ul>
<li>-s：流式输出</li>
<li>-hm：启动即人工可介入</li>
<li>-im enhanced：交互模式为增强（含规划与记忆）</li>
<li>--tui：启用 TUI</li>
<li>--loop/&ndash;loop-msg：启动后立即进入循环并注入首条消息</li>
<li>--seed 12345：固定随机种子</li>
<li>--sys-tips：自定义系统提示</li>
</ul>
</li>
<li>配置与模板
<ul>
<li>--config config.yaml：从<code>config.yaml</code>加载项目配置</li>
<li>--template-dir ./templates：指定模板目录为<code>./templates</code></li>
<li>--template-overwrite：渲染模板时允许覆盖</li>
<li>--output unity_test：输出目录名<code>unity_test</code></li>
<li>--override &lsquo;&hellip;&rsquo;: 覆盖配置键值（点号路径=值，多项用逗号分隔；字符串需内层引号，整体用单引号包裹以保留引号），示例里设置了会话摘要上限、启用裁剪、文档语言为“中文”、模型名为 gpt-4o-mini</li>
<li>-gif/--gen-instruct-file GEMINI.md：在 <code>&lt;workspace&gt;/GEMINI.md</code> 下生成外部协作引导文件</li>
<li>--guid-doc-path ./output/Guide_Doc：自定义 Guide_Doc 目录为<code>./output/Guide_Doc</code></li>
</ul>
</li>
<li>计划与 ToDo
<ul>
<li>--use-todo-tools：启用 ToDo 工具及强制附带 ToDo 信息</li>
</ul>
</li>
<li>外部与嵌入工具
<ul>
<li>--ex-tools &lsquo;SqThink,AnotherTool&rsquo;：启用外部工具<code>SqThink,AnotherTool</code></li>
<li>--no-embed-tools：禁用内置嵌入检索/记忆工具</li>
</ul>
</li>
<li>日志
<ul>
<li>--log：开启日志文件</li>
<li>--log-file ./output/ucagent.log：指定日志输出文件为<code>./output/ucagent.log</code></li>
<li>--msg-file ./output/ucagent.msg：指定消息日志文件为<code>./output/ucagent.msg</code></li>
</ul>
</li>
<li>MCP Server
<ul>
<li>--mcp-server-no-file-tools：启动 MCP（无文件操作工具）</li>
<li>--mcp-server-host：Server 监听地址为<code>127.0.0.1</code></li>
<li>--mcp-server-port：Server 监听端口为<code>5000</code></li>
</ul>
</li>
<li>阶段控制与安全
<ul>
<li>--force-stage-index 2：从阶段索引 2 开始</li>
<li>--skip 5 --skip 7：跳过阶段5和阶段7</li>
<li>--unskip 7：取消跳过阶段7</li>
<li>--nw ./output/Adder ./output/unity_test：限制仅<code>./output/Adder</code>和<code>./output/unity_test</code>路径可写</li>
</ul>
</li>
<li>说明
<ul>
<li>--check 与 --version 会直接退出，未与运行组合使用</li>
<li>--mcp-server 与 --mcp-server-no-file-tools 二选一；此处选了后者带路径参数（如 --template-dir/--guid-doc-path/&ndash;nw 的路径）需实际存在，否则会报错</li>
<li>--override 字符串值务必带引号，并整体用单引号包住以避免 shell 吃掉引号（示例写法已处理）</li>
</ul>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5fdb5ae128eebcc1e92c02708d6ec432">2.5 - TUI</h1>
    <div class="lead">tui界面的组成与操作说明。</div>
	<h2 id="tui界面与操作">TUI（界面与操作）</h2>
<p>UCAgent 自带基于 urwid 的终端界面（TUI），用于在本地交互式观察任务进度、消息流与控制台输出，并直接输入命令（如进入/退出循环、切换模式、执行调试命令等）。</p>
<h3 id="界面组成">界面组成</h3>
<p><img src="tui-part.png" alt="tui界面组成"></p>
<ul>
<li>
<p>Mission 面板（左侧）</p>
<ul>
<li>阶段列表：显示当前任务的阶段（索引、标题、失败数、耗时）。颜色含义：
<ul>
<li>绿色：已完成阶段</li>
<li>红色：当前进行阶段</li>
<li>黄色：被跳过的阶段（显示“skipped”）</li>
</ul>
</li>
<li>Changed Files：近期修改文件（含修改时间与相对时间，如“3m ago”）。较新的文件以绿色显示。</li>
<li>Tools Call：工具调用状态与计数。忙碌中的工具会以黄色高亮（如 SqThink(2)）。</li>
<li>Deamon Commands：后台运行的 demo 命令列表（带开始时间与已运行时长）。</li>
</ul>
</li>
<li>
<p>Status 面板（右上）</p>
<ul>
<li>显示 API 与代理状态摘要，以及当前面板尺寸参数（便于调节布局时参考）。</li>
</ul>
</li>
<li>
<p>Messages 面板（右上中）</p>
<ul>
<li>实时消息流（模型回复、工具输出、系统提示）。</li>
<li>支持焦点与滚动控制，标题会显示“当前/总计”的消息定位。例如：Messages (123/456)。</li>
</ul>
</li>
<li>
<p>Console（底部）</p>
<ul>
<li>Output：命令与系统输出区域，支持分页浏览。</li>
<li>Input：命令输入行（默认提示符 “(UnityChip) ”）。提供历史、补全、忙碌提示等。</li>
</ul>
</li>
</ul>
<p>提示：界面每秒自动刷新一次（不影响输入）。当消息或输出过长时，会进入分页或手动滚动模式。</p>
<h3 id="操作与快捷键">操作与快捷键</h3>
<ul>
<li>Enter：执行当前输入命令；若输入为空会重复上一次命令；输入 q/Q/exit/quit 退出 TUI。</li>
<li>Esc：
<ul>
<li>若正在浏览 Messages 的历史，退出滚动并返回末尾；</li>
<li>若 Output 正在分页查看，退出分页；</li>
<li>否则聚焦到底部输入框。</li>
</ul>
</li>
<li>Tab：命令补全；再次按 Tab 可分批显示更多可选项。</li>
<li>Shift+Right：清空 Console Output。</li>
<li>Shift+Up / Shift+Down：在 Messages 中向上/向下移动焦点（浏览历史）。</li>
<li>Ctrl+Up / Ctrl+Down：增/减 Console 输出区域高度。</li>
<li>Ctrl+Left / Ctrl+Right：减/增 Mission 面板宽度。</li>
<li>Shift+Up / Shift+Down（另一路径）：调整 Status 面板高度（最小 3，最大 100）。</li>
<li>Up / Down：
<ul>
<li>若 Output 在分页模式，Up/Down 用于翻页；</li>
<li>否则用于命令历史导航（将历史命令放入输入行，可编辑后回车执行）。</li>
</ul>
</li>
</ul>
<p>分页模式提示：当 Output 进入分页浏览时，底部标题会提示 “Up/Down: scroll, Esc: exit”，Esc 退出分页并返回输入状态。</p>
<h3 id="命令与用法">命令与用法</h3>
<ul>
<li>普通命令：直接输入并回车，例如 loop、tui、help 等（由内部调试器处理）。</li>
<li>历史命令：在输入行为空时按 Enter，将重复执行上一条命令。</li>
<li>清屏：输入 clear 并回车，仅清空 Output（不影响消息记录）。</li>
<li>演示/后台命令：命令末尾添加 &amp; 将在后台运行，完成后会在 Output 区域提示结束；当前后台命令可通过 list_demo_cmds 查看。</li>
<li>直接执行系统/危险命令：以 ! 前缀执行（例如 !loop），该模式执行后优先滚动到最新输出。</li>
<li>列出后台命令：list_demo_cmds 显示正在运行的 demo 命令列表与开始时间。</li>
</ul>
<h4 id="消息配置message_config">消息配置（message_config）</h4>
<ul>
<li>作用：在运行中查看/调整消息裁剪策略，控制历史保留与 LLM 输入 token 上限。</li>
<li>命令：
<ul>
<li>message_config 查看当前配置</li>
<li>message_config <key> <value> 设置配置项</li>
</ul>
</li>
<li>可配置项：
<ul>
<li>max_keep_msgs：保留的历史消息条数（影响会话记忆窗口）</li>
<li>max_token：进入模型前的消息裁剪 token 上限（影响开销/截断）</li>
</ul>
</li>
<li>示例：
<ul>
<li>message_config</li>
<li>message_config max_keep_msgs 8</li>
<li>message_config max_token 4096</li>
</ul>
</li>
</ul>
<p>其他说明</p>
<ul>
<li>自动补全：支持命令名与部分参数的补全；候选项过多时分批显示，可多次按 Tab 查看剩余项。</li>
<li>忙碌提示：命令执行期间，输入框标题会轮转显示 (wait.), (wait..), (wait&hellip;)，表示正在处理。</li>
<li>消息焦点：当未手动滚动时，消息焦点自动跟随最新消息；进入手动滚动后，会保持当前位置，直至按 Esc 或滚动至末尾。</li>
<li>错误容错：若某些 UI 操作异常（如终端不支持某些控制序列），TUI 会尽量回退到安全状态继续运行。</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-496947e48f69f9f9e929fe92771d84e0">2.6 - FAQ</h1>
    <div class="lead">常见问题与解答。</div>
	<h2 id="faq">FAQ</h2>
<ul>
<li>模型切换：在 <code>config.yaml</code> 改 <code>openai.model_name</code></li>
<li>验证过程中出现错误怎么办：使用 <code>Ctrl+C</code> 进入交互模式，通过 <code>status</code> 查看当前状态，使用 <code>help</code> 获取调试命令。</li>
<li>Check 失败：先 <code>ReadTextFile</code> 阅读 reference_files；再按返回信息修复，循环 RunTestCases → Check</li>
<li>自定义阶段：修改 <code>vagent/lang/zh/config/default.yaml</code> 的 <code>stage</code>；或用 <code>--override</code> 临时覆盖</li>
<li>添加工具：<code>vagent/tools/</code> 下新建类，继承 <code>UCTool</code>，运行时 <code>--ex-tools YourTool</code></li>
<li>MCP 连接失败：检查端口/防火墙，改 <code>--mcp-server-port</code>；无嵌入可加 <code>--no-embed-tools</code></li>
<li>只读保护：通过 <code>--no-write/--nw</code> 指定路径限制写入（必须位于 workspace 内）</li>
</ul>
<h3 id="为什么快速启动找不到configyaml定制流程时找不到configyaml">为什么快速启动找不到config.yaml/定制流程时找不到config.yaml?</h3>
<ul>
<li>使用pip 安装后并没有<code>config.yaml</code>那个文件，所以在快速启动的<a href="/mlvp/docs/ucagent/introduce/#%e5%91%bd%e4%bb%a4">启动 MCP Server</a>没有加<code>--config config.yaml</code>这个选项。</li>
<li>可以通过在工作目录添加<code>config.yaml</code>文件并且加上<code>--config config.yaml</code>参数来启动；也可以使用克隆仓库来使用UCAgent的方式来解决。</li>
</ul>
<h3 id="运行中如何调整消息窗口与-token-上限">运行中如何调整消息窗口与 token 上限？</h3>
<ul>
<li>在 TUI 输入：<code>message_config</code> 查看当前配置；</li>
<li>设置：<code>message_config max_keep_msgs 8</code> 或 <code>message_config max_token 4096</code>；</li>
<li>作用范围：影响会话历史裁剪与送入 LLM 的最大 token 上限（通过 Summarization/Trim 节点生效）。</li>
</ul>
<h3 id="文档中的-ck-bug-要改吗">文档中的 “CK bug” 要改吗？</h3>
<ul>
<li>是。术语统一为 “TC bug”。同时确保 bug 文档里的 <code>&lt;TC-*&gt;</code> 能匹配失败用例（文件/类/用例名）。</li>
</ul>
<h3 id="为什么找不到-writetextfile-工具">为什么找不到 WriteTextFile 工具？</h3>
<ul>
<li>该工具已移除。请改用 <code>EditTextFile</code>（支持 overwrite/append/replace 三种模式）或其他文件工具（Copy/Move/Delete 等）。</li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-123be64371eca729c53f6175259c146a">3 - 工作流</h1>
    <div class="lead">整体的工作流说明。</div>
	<p>整体采用“按阶段渐进推进”的方式，每个阶段都有明确目标、产出与通过标准；完成后用工具 Check 验证并用 Complete 进入下一阶段。若阶段包含子阶段，需按顺序 逐一完成子阶段并各自通过 Check。</p>
<ul>
<li>顶层阶段总数：11（见 <code>vagent/lang/zh/config/default.yaml</code>）</li>
<li>推进原则：未通过的阶段不可跳转；可用工具 CurrentTips 获取当前阶段详细指导；需要回补时可用 GotoStage 回到指定阶段；命令行也可用 &ndash;skip/--unskip 控制阶段索引。</li>
</ul>
<h2 id="整体流程概览11-个阶段">整体流程概览（11 个阶段）</h2>
<p>目前的流程包含：</p>
<ol>
<li>需求分析与验证规划 → 2) {DUT} 功能理解 → 3) 功能规格分析与测试点定义 → 4) 测试平台基础架构设计 → 5) 功能覆盖率模型实现 → 6) 基础 API 实现 → 7) 基础 API 功能测试 → 8) 测试框架脚手架 → 9) 全面验证执行与缺陷分析 → 10) 代码行覆盖率分析与提升（默认跳过，可启用）→ 11) 验证审查与总结</li>
</ol>
<p>以实际的工作流为准，下图仅供参考。
<img src="workflow.png" alt="工作流图"></p>
<p>说明：以下路径中的 <OUT> 默认为工作目录下的输出目录名（默认 unity_test）。例如文档输出到 <code>&lt;workspace&gt;/unity_test/</code>。</p>
<hr>
<p>阶段 1：需求分析与验证规划</p>
<ul>
<li>目标：理解任务、明确验证范围与策略。</li>
<li>怎么做：
<ul>
<li>阅读 <code>{DUT}/README.md</code>，梳理“需要测哪些功能/输入输出/边界与风险”。</li>
<li>形成可执行的验证计划与目标清单。</li>
</ul>
</li>
<li>产出：<code>&lt;OUT&gt;/{DUT}_verification_needs_and_plan.md</code>（中文撰写）。</li>
<li>通过标准：文档存在、结构规范（自动检查 markdown_file_check）。</li>
<li>检查器：
<ul>
<li>UnityChipCheckerMarkdownFileFormat
<ul>
<li>作用：校验 Markdown 文件存在与格式，禁止把换行写成字面量“\n”。</li>
<li>参数：
<ul>
<li>markdown_file_list (str | List[str]): 待检查的 MD 文件路径或路径列表。示例：<code>{OUT}/{DUT}_verification_needs_and_plan.md</code></li>
<li>no_line_break (bool): 是否禁止把换行写成字面量 &ldquo;\n&rdquo;；true 表示禁止。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>阶段 2：{DUT} 功能理解</p>
<ul>
<li>目标：掌握 DUT 的接口与基本信息，明确是组合/时序电路。</li>
<li>怎么做：
<ul>
<li>阅读 <code>{DUT}/README.md</code> 与 <code>{DUT}/__init__.py</code>。</li>
<li>分析 IO 端口、时钟/复位需求与功能范围。</li>
</ul>
</li>
<li>产出：<code>&lt;OUT&gt;/{DUT}_basic_info.md</code>。</li>
<li>通过标准：文档存在、格式规范（markdown_file_check）。</li>
<li>检查器：
<ul>
<li>UnityChipCheckerMarkdownFileFormat
<ul>
<li>作用：校验 Markdown 文件存在与格式，禁止把换行写成字面量“\n”。</li>
<li>参数：
<ul>
<li>markdown_file_list (str | List[str]): 待检查的 MD 文件路径或路径列表。示例：<code>{OUT}/{DUT}_basic_info.md</code></li>
<li>no_line_break (bool): 是否禁止把换行写成字面量 &ldquo;\n&rdquo;；true 表示禁止。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>阶段 3：功能规格分析与测试点定义（含子阶段 FG/FC/CK）</p>
<ul>
<li>目标：把功能分组（FG）、功能点（FC）和检测点（CK）结构化，作为后续自动化的依据。</li>
<li>怎么做：
<ul>
<li>阅读 <code>{DUT}/*.md</code> 与已产出文档，建立 <code>{DUT}_functions_and_checks.md</code> 的 FG/FC/CK 结构。</li>
<li>规范标签：&lt;FG-组名&gt;、&lt;FC-功能名&gt;、&lt;CK-检测名&gt;，每个功能点至少 1 个检测点。</li>
</ul>
</li>
<li>子阶段：
<ul>
<li>3.1 功能分组与层次（FG）：检查器 UnityChipCheckerLabelStructure(FG)</li>
<li>3.2 功能点定义（FC）：检查器 UnityChipCheckerLabelStructure(FC)</li>
<li>3.3 检测点设计（CK）：检查器 UnityChipCheckerLabelStructure(CK)</li>
</ul>
</li>
<li>产出：<code>&lt;OUT&gt;/{DUT}_functions_and_checks.md</code>。</li>
<li>通过标准：三类标签结构均通过对应检查。</li>
<li>对应检查器（默认配置）：
<ul>
<li>3.1 UnityChipCheckerLabelStructure
<ul>
<li>作用：解析 <code>{DUT}_functions_and_checks.md</code> 中的标签结构并校验层级与数量（FG）。</li>
<li>参数：
<ul>
<li>doc_file (str): 功能/检查点文档路径。示例：<code>{OUT}/{DUT}_functions_and_checks.md</code></li>
<li>leaf_node (&ldquo;FG&rdquo; | &ldquo;FC&rdquo; | &ldquo;CK&rdquo;): 需要校验的叶子类型。示例：<code>&quot;FG&quot;</code></li>
<li>min_count (int, 默认 1): 该叶子类型的最小数量阈值。</li>
<li>must_have_prefix (str, 默认 &ldquo;FG-API&rdquo;): FG 名称要求的前缀，用于规范化分组命名。</li>
</ul>
</li>
</ul>
</li>
<li>3.2 UnityChipCheckerLabelStructure
<ul>
<li>作用：解析文档并校验功能点定义（FC）。</li>
<li>参数：
<ul>
<li>doc_file (str): 功能/检查点文档路径。示例：<code>{OUT}/{DUT}_functions_and_checks.md</code></li>
<li>leaf_node (&ldquo;FG&rdquo; | &ldquo;FC&rdquo; | &ldquo;CK&rdquo;): 需要校验的叶子类型。示例：<code>&quot;FC&quot;</code></li>
<li>min_count (int, 默认 1): 该叶子类型的最小数量阈值。</li>
<li>must_have_prefix (str, 默认 &ldquo;FG-API&rdquo;): 所属 FG 的前缀规范，用于一致性检查。</li>
</ul>
</li>
</ul>
</li>
<li>3.3 UnityChipCheckerLabelStructure
<ul>
<li>作用：解析文档并校验检测点设计（CK），并缓存 CK 列表用于后续分批实现。</li>
<li>参数：
<ul>
<li>doc_file (str): 功能/检查点文档路径。示例：<code>{OUT}/{DUT}_functions_and_checks.md</code></li>
<li>leaf_node (&ldquo;FG&rdquo; | &ldquo;FC&rdquo; | &ldquo;CK&rdquo;): 需要校验的叶子类型。示例：<code>&quot;CK&quot;</code></li>
<li>data_key (str): 共享数据键名，用于缓存 CK 列表（供后续分批实现使用）。示例：<code>&quot;COVER_GROUP_DOC_CK_LIST&quot;</code></li>
<li>min_count (int, 默认 1): 该叶子类型的最小数量阈值。</li>
<li>must_have_prefix (str, 默认 &ldquo;FG-API&rdquo;): 所属 FG 的前缀规范，用于一致性检查。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>阶段 4：测试平台基础架构设计（fixture/API 框架）</p>
<ul>
<li>目标：提供统一的 DUT 创建与测试生命周期管理能力。</li>
<li>怎么做：
<ul>
<li>在 <code>&lt;OUT&gt;/tests/{DUT}_api.py</code> 实现 create_dut()；时序电路配置时钟（InitClock），组合电路无需时钟。</li>
<li>实现 pytest fixture <code>dut</code>，负责初始化/清理与可选的波形/行覆盖率开关。</li>
</ul>
</li>
<li>产出：<code>&lt;OUT&gt;/tests/{DUT}_api.py</code>（含注释与文档字符串）。</li>
<li>通过标准：DUT 创建与 fixture 检查通过（UnityChipCheckerDutCreation / UnityChipCheckerDutFixture）。</li>
<li>子阶段检查器：
<ul>
<li>DUT 创建：UnityChipCheckerDutCreation
<ul>
<li>作用：校验 <code>{DUT}_api.py</code> 中的 create_dut(request) 是否实现规范（签名、时钟/复位、覆盖率路径等约定）。</li>
<li>参数：
<ul>
<li>target_file (str): DUT API 与 fixture 所在文件路径。示例：<code>{OUT}/tests/{DUT}_api.py</code></li>
</ul>
</li>
</ul>
</li>
<li>dut fixture：UnityChipCheckerDutFixture
<ul>
<li>作用：校验 pytest fixture <code>dut</code> 的生命周期管理、yield/清理，以及覆盖率收集调用是否到位。</li>
<li>参数：
<ul>
<li>target_file (str): 包含 <code>dut</code> fixture 的文件路径。示例：<code>{OUT}/tests/{DUT}_api.py</code></li>
</ul>
</li>
</ul>
</li>
<li>env fixture：UnityChipCheckerEnvFixture
<ul>
<li>作用：校验 <code>env*</code> 系列 fixture 的存在、数量与 Bundle 封装是否符合要求。</li>
<li>参数：
<ul>
<li>target_file (str): 包含 <code>env*</code> 系列 fixture 的文件路径。示例：<code>{OUT}/tests/{DUT}_api.py</code></li>
<li>min_env (int, 默认 1): 至少需要存在的 <code>env*</code> fixture 数量。示例：<code>1</code></li>
<li>force_bundle (bool, 当前未使用): 是否强制要求 Bundle 封装。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>覆盖率路径规范（重要）：</p>
<ul>
<li>在 create_dut(request) 中，必须通过 <code>get_coverage_data_path(request, new_path=True)</code> 获取新的行覆盖率文件路径，并传入 <code>dut.SetCoverage(...)</code>。</li>
<li>在 <code>dut</code> fixture 的清理阶段，必须通过 <code>get_coverage_data_path(request, new_path=False)</code> 获取已有路径，并调用 <code>set_line_coverage(request, &lt;path&gt;, ignore=...)</code> 写入统计。</li>
<li>若缺失上述调用，检查器会直接报错，并给出修复提示（含 <code>tips_of_get_coverage_data_path</code> 示例）。</li>
</ul>
<p>阶段 5：功能覆盖率模型实现</p>
<ul>
<li>目标：将 FG/FC/CK 转为可统计的覆盖结构，支撑进度度量与回归。</li>
<li>怎么做：
<ul>
<li>在 <code>&lt;OUT&gt;/tests/{DUT}_function_coverage_def.py</code> 实现 <code>get_coverage_groups(dut)</code>。</li>
<li>为每个 FG 建立 CovGroup；为 FC/CK 建 watch_point 与检查函数（优先用 lambda，必要时普通函数）。</li>
</ul>
</li>
<li>子阶段：
<ul>
<li>5.1 覆盖组创建（FG）</li>
<li>5.2 覆盖点与检查实现（FC/CK），支持“分批实现”提示（COMPLETED_POINTS/TOTAL_POINTS）。</li>
</ul>
</li>
<li>产出：<code>&lt;OUT&gt;/tests/{DUT}_function_coverage_def.py</code>。</li>
<li>通过标准：CoverageGroup 检查（FG/FC/CK）与批量实现检查通过。</li>
<li>子阶段检查器：
<ul>
<li>5.1 UnityChipCheckerCoverageGroup
<ul>
<li>作用：比对覆盖组定义与文档 FG 一致性。</li>
<li>参数：
<ul>
<li>test_dir (str): 测试目录根路径。示例：<code>{OUT}/tests</code></li>
<li>cov_file (str): 覆盖率模型定义文件路径。示例：<code>{OUT}/tests/{DUT}_function_coverage_def.py</code></li>
<li>doc_file (str): 功能/检查点文档路径。示例：<code>{OUT}/{DUT}_functions_and_checks.md</code></li>
<li>check_types (str | List[str]): 检查的类型集合。示例：<code>&quot;FG&quot;</code></li>
</ul>
</li>
</ul>
</li>
<li>5.2 UnityChipCheckerCoverageGroup
<ul>
<li>作用：比对覆盖点/检查点实现与文档 FC/CK 一致性。</li>
<li>参数：
<ul>
<li>test_dir (str): 测试目录根路径。示例同上</li>
<li>cov_file (str): 覆盖率模型定义文件路径。示例同上</li>
<li>doc_file (str): 功能/检查点文档路径。示例同上</li>
<li>check_types (List[str]): 检查类型集合。示例：<code>[&quot;FC&quot;, &quot;CK&quot;]</code></li>
</ul>
</li>
</ul>
</li>
<li>5.2（分批）UnityChipCheckerCoverageGroupBatchImplementation
<ul>
<li>作用：按 CK 分批推进实现与对齐检查，维护进度（TOTAL/COMPLETED）。</li>
<li>参数：
<ul>
<li>test_dir (str): 测试目录根路径。</li>
<li>cov_file (str): 覆盖率模型定义文件路径。</li>
<li>doc_file (str): 功能/检查点文档路径。</li>
<li>batch_size (int, 默认 20): 每批实现与校验的 CK 数量上限。示例：<code>20</code></li>
<li>data_key (str): 共享数据键名，用于读取 CK 列表。示例：<code>&quot;COVER_GROUP_DOC_CK_LIST&quot;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>阶段 6：基础 API 实现</p>
<ul>
<li>目标：用 <code>api_{DUT}_*</code> 前缀提供可复用的操作封装，隐藏底层信号细节。</li>
<li>怎么做：
<ul>
<li>在 <code>&lt;OUT&gt;/tests/{DUT}_api.py</code> 实现至少 1 个基础 API；建议区分“底层功能 API”与“任务功能 API”。</li>
<li>补充详细 docstring：功能、参数、返回值、异常。</li>
</ul>
</li>
<li>产出：<code>&lt;OUT&gt;/tests/{DUT}_api.py</code>。</li>
<li>通过标准：UnityChipCheckerDutApi 通过（前缀必须为 <code>api_{DUT}_</code>）。</li>
<li>检查器：
<ul>
<li>UnityChipCheckerDutApi
<ul>
<li>作用：扫描/校验 <code>api_{DUT}_*</code> 函数的数量、命名、签名与 docstring 完整度。</li>
<li>参数：
<ul>
<li>api*prefix (str): API 前缀匹配表达式。建议：<code>&quot;api*{DUT}\_&quot;</code></li>
<li>target_file (str): API 定义所在文件。示例：<code>{OUT}/tests/{DUT}_api.py</code></li>
<li>min_apis (int, 默认 1): 至少需要的 API 数量。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>阶段 7：基础 API 功能正确性测试</p>
<ul>
<li>目标：为每个已实现 API 编写至少 1 个基础功能用例，并标注覆盖率。</li>
<li>怎么做：
<ul>
<li>在 <code>&lt;OUT&gt;/tests/test_{DUT}_api_*.py</code> 新建测试；导入 <code>from {DUT}_api import *</code>。</li>
<li>每个测试函数的第一行：<code>dut.fc_cover['FG-API'].mark_function('FC-API-NAME', test_func, ['CK-XXX'])</code>。</li>
<li>设计典型/边界/异常数据，断言预期输出。</li>
<li>用工具 RunTestCases 执行与回归。</li>
</ul>
</li>
<li>产出：<code>&lt;OUT&gt;/tests/test_{DUT}_api_*.py</code> 与缺陷记录（若发现 bug）。</li>
<li>通过标准：UnityChipCheckerDutApiTest 通过（覆盖、用例质量、文档记录齐备）。</li>
<li>检查器：
<ul>
<li>UnityChipCheckerDutApiTest
<ul>
<li>作用：运行 pytest 并检查每个 API 至少 1 个基础功能用例且正确覆盖标记；核对缺陷记录与文档一致。</li>
<li>参数：
<ul>
<li>api*prefix (str): API 前缀匹配表达式。建议：<code>&quot;api*{DUT}\_&quot;</code></li>
<li>target_file_api (str): API 文件路径。示例：<code>{OUT}/tests/{DUT}_api.py</code></li>
<li>target*file_tests (str): 测试文件 Glob。示例：<code>{OUT}/tests/test*{DUT}\_api\*.py</code></li>
<li>doc_func_check (str): 功能/检查点文档。示例：<code>{OUT}/{DUT}_functions_and_checks.md</code></li>
<li>doc_bug_analysis (str): 缺陷分析文档。示例：<code>{OUT}/{DUT}_bug_analysis.md</code></li>
<li>min_tests (int, 默认 1): 单 API 最少测试用例数。</li>
<li>timeout (int, 默认 15): 单次测试运行超时（秒）。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>阶段 8：测试框架脚手架构建</p>
<ul>
<li>目标：为尚未实现的功能点批量生成“占位”测试模板，确保覆盖版图完整。</li>
<li>怎么做：
<ul>
<li>依据 <code>{DUT}_functions_and_checks.md</code>，在 <code>&lt;OUT&gt;/tests/</code> 创建 <code>test_*.py</code>，文件与用例命名语义化。</li>
<li>每个函数首行标注覆盖率 mark；补充 TODO 注释说明要测什么；末尾添加 <code>assert False, 'Not implemented'</code> 防误通过。</li>
</ul>
</li>
<li>产出：批量测试模板；覆盖率进度指标（COVERED_CKS/TOTAL_CKS）。</li>
<li>通过标准：UnityChipCheckerTestTemplate 通过（结构/标记/说明完整）。</li>
<li>检查器：
<ul>
<li>UnityChipCheckerTestTemplate
<ul>
<li>作用：检查模板文件/用例结构、覆盖标记、TODO 注释与防误通过断言；统计覆盖进度。</li>
<li>参数：
<ul>
<li>doc_func_check (str): 功能/检查点文档路径。示例：<code>{OUT}/{DUT}_functions_and_checks.md</code></li>
<li>test_dir (str): 测试目录根路径。示例：<code>{OUT}/tests</code></li>
<li>ignore*ck_prefix (str): 统计覆盖时忽略的 CK 前缀（通常为基础 API 的用例）。示例：<code>&quot;test_api*{DUT}\_&quot;</code></li>
<li>data_key (str): 共享数据键名，用于生成/读取模板实现进度。示例：<code>&quot;TEST_TEMPLATE_IMP_REPORT&quot;</code></li>
<li>batch_size (int, 默认 20): 每批模板检查数量。</li>
<li>min_tests (int, 默认 1): 最少要求的模板测试数。</li>
<li>timeout (int, 默认 15): 测试运行超时（秒）。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>阶段 9：全面验证执行与缺陷分析</p>
<ul>
<li>目标：将模板填充为真实测试，系统发现并分析 DUT bug。</li>
<li>怎么做：
<ul>
<li>在 <code>test_*.py</code> 填充逻辑，优先通过 API 调用，不直接操纵底层信号。</li>
<li>设计充分数据并断言；用 RunTestCases 运行；对 Fail 进行基于源码的缺陷定位与记录。</li>
</ul>
</li>
<li>子阶段：
<ul>
<li>9.1 分批测试用例实现与对应缺陷分析（COMPLETED_CASES/TOTAL_CASES）。</li>
</ul>
</li>
<li>产出：成体系的测试集与 <code>/{DUT}_bug_analysis.md</code>。</li>
<li>通过标准：UnityChipCheckerTestCase（质量/覆盖/缺陷分析）通过。</li>
<li>检查器：
<ul>
<li>父阶段：UnityChipCheckerTestCase
<ul>
<li>作用：运行整体测试并对照功能/缺陷文档检查质量、覆盖与记录一致性。</li>
<li>参数：
<ul>
<li>doc_func_check (str): 功能/检查点文档路径。示例：<code>{OUT}/{DUT}_functions_and_checks.md</code></li>
<li>doc_bug_analysis (str): 缺陷分析文档路径。示例：<code>{OUT}/{DUT}_bug_analysis.md</code></li>
<li>test_dir (str): 测试目录根路径。示例：<code>{OUT}/tests</code></li>
<li>min_tests (int, 默认 1): 最少要求的测试用例数量。</li>
<li>timeout (int, 默认 15): 测试运行超时（秒）。</li>
</ul>
</li>
</ul>
</li>
<li>子阶段（分批实现）：UnityChipCheckerBatchTestsImplementation
<ul>
<li>作用：分批将模板落地为真实用例并回归，维护实现进度与报告。</li>
<li>参数：
<ul>
<li>doc_func_check (str): 功能/检查点文档路径。</li>
<li>doc_bug_analysis (str): 缺陷分析文档路径。</li>
<li>test_dir (str): 测试目录根路径。</li>
<li>ignore*ck_prefix (str): 统计覆盖时忽略的 CK 前缀。示例：<code>&quot;test_api*{DUT}\_&quot;</code></li>
<li>batch_size (int, 默认 10): 每批转化并执行的用例数量。</li>
<li>data_key (str): 共享数据键名（必填），用于保存分批实现进度。示例：<code>&quot;TEST_TEMPLATE_IMP_REPORT&quot;</code></li>
<li>pre_report_file (str): 历史进度报告路径。示例：<code>{OUT}/{DUT}/.TEST_TEMPLATE_IMP_REPORT.json</code></li>
<li>timeout (int, 默认 15): 测试运行超时（秒）。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>TC bug 标注规范与一致性（与文档/报告强关联）：</p>
<ul>
<li>术语：统一使用 “TC bug”（不再使用 “CK bug”）。</li>
<li>标注结构：<code>&lt;FG-*&gt;/&lt;FC-*&gt;/&lt;CK-*&gt;/&lt;BG-NAME-XX&gt;/&lt;TC-test_file.py::[ClassName]::test_case&gt;</code>；其中 BG 的置信度 XX 为 0–100 的整数。</li>
<li>失败用例与文档关系：
<ul>
<li>文档中出现的 &lt;TC-*&gt; 必须能与测试报告中的失败用例一一对应（文件名/类名/用例名匹配）。</li>
<li>失败的测试用例必须标注其关联检查点（CK），否则会被判定为“未标记”。</li>
<li>若存在失败用例未在 bug 文档中记录，将被提示为“未文档化的失败用例”。</li>
</ul>
</li>
</ul>
<p>阶段 10：代码行覆盖率分析与提升（默认跳过，可启用）</p>
<ul>
<li>目标：回顾未覆盖代码行，定向补齐。</li>
<li>怎么做：
<ul>
<li>运行 Check 获取行覆盖率；若未达标，围绕未覆盖行增补测试并回归；循环直至满足阈值。</li>
</ul>
</li>
<li>产出：行覆盖率报告与补充测试。</li>
<li>通过标准：UnityChipCheckerTestCaseWithLineCoverage 达标（默认阈值 0.9，可在配置中调整）。</li>
<li>说明：该阶段在配置中标记 skip=true，可用 <code>--unskip</code> 指定索引启用。</li>
<li>检查器：
<ul>
<li>UnityChipCheckerTestCaseWithLineCoverage
<ul>
<li>作用：在 TestCase 基础上统计行覆盖率并对比阈值。</li>
<li>参数：
<ul>
<li>doc_func_check (str): 功能/检查点文档路径。示例：<code>{OUT}/{DUT}_functions_and_checks.md</code></li>
<li>doc_bug_analysis (str): 缺陷分析文档路径。示例：<code>{OUT}/{DUT}_bug_analysis.md</code></li>
<li>test_dir (str): 测试目录根路径。示例：<code>{OUT}/tests</code></li>
<li>cfg (dict | Config): 必填，用于推导默认路径以及环境配置。</li>
<li>min_line_coverage (float, 默认按配置，未配置则 0.8): 最低行覆盖率阈值。</li>
<li>coverage_json (str, 可选): 行覆盖率 JSON 路径。默认：<code>uc_test_report/line_dat/code_coverage.json</code></li>
<li>coverage_analysis (str, 可选): 行覆盖率分析 MD 输出。默认：<code>unity_test/{DUT}_line_coverage_analysis.md</code></li>
<li>coverage_ignore (str, 可选): 忽略文件清单。默认：<code>unity_test/tests/{DUT}.ignore</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>阶段 11：验证审查与总结</p>
<ul>
<li>目标：沉淀成果、复盘流程、给出改进建议。</li>
<li>怎么做：
<ul>
<li>完善 <code>/{DUT}_bug_analysis.md</code> 的缺陷条目（基于源码分析）。</li>
<li>汇总并撰写 <code>/{DUT}_test_summary.md</code>，回看规划是否达成；必要时用 GotoStage 回补。</li>
</ul>
</li>
<li>产出：<code>&lt;OUT&gt;/{DUT}_test_summary.md</code> 与最终结论。</li>
<li>通过标准：UnityChipCheckerTestCase 复核通过。</li>
<li>检查器：
<ul>
<li>UnityChipCheckerTestCase
<ul>
<li>作用：复核整体测试结果与文档一致性，形成最终结论。</li>
<li>参数：doc_func_check: &ldquo;{OUT}/{DUT}_functions_and_checks.md&rdquo;；doc_bug_analysis: &ldquo;{OUT}/{DUT}_bug_analysis.md&rdquo;；test_dir: &ldquo;{OUT}/tests&rdquo;。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>提示与最佳实践</p>
<ul>
<li>随时用工具：Detail/Status 查看 Mission 进度与当前阶段；CurrentTips 获取步骤级指导；Check/Complete 推进阶段。</li>
<li>TUI 左侧 Mission 会显示阶段序号、跳过状态与失败计数；可结合命令行 <code>--skip/--unskip/--force-stage-index</code> 控制推进。</li>
</ul>
<h2 id="定制工作流增删阶段子阶段">定制工作流（增删阶段/子阶段）</h2>
<h3 id="原理说明">原理说明</h3>
<ul>
<li>工作流定义在语言配置 <code>vagent/lang/zh/config/default.yaml</code> 的顶层 <code>stage:</code> 列表。</li>
<li>配置加载顺序：setting.yaml → ~/.ucagent/setting.yaml → 语言默认（含 stage）→ 项目根 <code>config.yaml</code> → CLI <code>--override</code>。</li>
<li>注意：列表类型（如 stage 列表）在合并时是“整体覆盖”，不是元素级合并；因此要“增删改”阶段，建议把默认的 stage 列表复制到你的项目 <code>config.yaml</code>，在此基础上编辑。</li>
<li>临时不执行某阶段：优先使用 CLI <code>--skip &lt;index&gt;</code> 或在运行中用工具 Skip/Goto；持久跳过可在你的 <code>config.yaml</code> 中把该阶段条目的 <code>skip: true</code> 写上（同样需要提供完整的 stage 列表）。</li>
</ul>
<h3 id="增加阶段">增加阶段</h3>
<ul>
<li>需求：在“全面验证执行”之后新增一个“静态检查与 Lint 报告”阶段，要求生成 <code>&lt;OUT&gt;/{DUT}_lint_report.md</code> 并做格式检查。</li>
<li>做法：在项目根 <code>config.yaml</code> 中提供完整的 <code>stage:</code> 列表，并在合适位置插入如下条目（片段示例，仅展示新增项，实际需要放入你的完整 stage 列表里）。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">stage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># ...前面的既有阶段...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">static_lint_and_style_check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">desc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;静态分析与代码风格检查报告&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">task</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">&#34;目标：完成 DUT 的静态检查/Lint，并输出报告&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">&#34;第1步：运行 lint 工具（按项目需要）&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">&#34;第2步：将结论整理为 &lt;OUT&gt;/{DUT}_lint_report.md（中文）&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">&#34;第3步：用 Check 校验报告是否存在且格式规范&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">checker</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">markdown_file_check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clss</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;UnityChipCheckerMarkdownFileFormat&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">markdown_file_list</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_lint_report.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># MD 文件路径或列表</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">no_line_break</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 禁止字面量 &#34;\n&#34; 作为换行</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reference_files</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">output_files</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">&#34;{OUT}/{DUT}_lint_report.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">skip</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># ...后续既有阶段...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="减少子阶段">减少子阶段</h3>
<ul>
<li>场景：在“功能规格分析与测试点定义”中，临时不执行“功能点定义（FC）”子阶段。</li>
<li>推荐做法：运行时使用 CLI <code>--skip</code> 跳过该索引；若需长期配置，复制默认 <code>stage:</code> 列表到你的 <code>config.yaml</code>，在父阶段 <code>functional_specification_analysis</code> 的 <code>stage:</code> 子列表里移除对应子阶段条目，或为该子阶段加 <code>skip: true</code>。</li>
</ul>
<p>子阶段移除（片段示例，仅展示父阶段结构与其子阶段列表）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">stage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">functional_specification_analysis</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">desc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;功能规格分析与测试点定义&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">task</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">&#34;目标：将芯片功能拆解成可测试的小块，为后续测试做准备&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># ...省略父阶段任务...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">stage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">functional_grouping</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 保留 FG 子阶段</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># ...原有配置...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># - name: function_point_definition  # 原来的 FC 子阶段（此行及其内容整体删除，或在其中加 skip: true）</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">check_point_design</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 保留 CK 子阶段</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># ...原有配置...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># ...其他字段...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>小贴士</p>
<ul>
<li>仅需临时跳过：用 <code>--skip</code>/<code>--unskip</code> 最快，无需改配置文件。</li>
<li>需要永久增删：复制默认 <code>stage:</code> 列表到项目 <code>config.yaml</code>，编辑后提交到仓库；注意列表是整体覆盖，别只贴新增/删减的片段。</li>
<li>新增阶段的检查器可复用现有类（如 Markdown/Fixture/API/Coverage/TestCase 等），也可以扩展自定义检查器（放在 <code>vagent/checkers/</code> 并以可导入路径填写到 <code>clss</code>）。</li>
</ul>
<h2 id="定制校验器checker">定制校验器（checker）</h2>
<p>原理说明</p>
<ul>
<li>每个（子）阶段下的 <code>checker:</code> 是一个列表；执行 <code>Check</code> 时会依次运行该列表里的所有检查器。</li>
<li>配置字段：
<ul>
<li><code>name</code>: 该检查器在阶段内的标识（便于阅读/日志）</li>
<li><code>clss</code>: 检查器类名；短名默认从 <code>vagent.checkers</code> 命名空间导入，也可写完整模块路径（如 <code>mypkg.mychk.MyChecker</code>）</li>
<li><code>args</code>: 传给检查器构造函数的参数，支持模板变量（如 <code>{OUT}</code>、<code>{DUT}</code>）</li>
<li><code>extra_args</code>: 可选，部分检查器支持自定义提示/策略（如 <code>fail_msg</code>、<code>batch_size</code>、<code>pre_report_file</code> 等）</li>
</ul>
</li>
<li>解析与实例化：<code>vagent/stage/vstage.py</code> 会读取 <code>checker:</code>，按 <code>clss/args</code> 生成实例；运行期由 <code>ToolStdCheck/Check</code> 调用其 <code>do_check()</code>。</li>
<li>合并语义：配置合并时列表是“整体替换”，要在项目 <code>config.yaml</code> 修改某个阶段的 <code>checker:</code>，建议复制该阶段条目并完整替换其 <code>checker:</code> 列表。</li>
</ul>
<h3 id="增加-checker">增加 checker</h3>
<p>在“功能规格分析与测试点定义”父阶段，新增“文档格式检查”，确保 <code>{OUT}/{DUT}_functions_and_checks.md</code> 没有把换行写成字面量 <code>\n</code>。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 片段示例：需要放入你的完整 stage 列表对应阶段中</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">functional_specification_analysis</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">desc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;功能规格分析与测试点定义&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># ...existing fields...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">output_files</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">checker</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">functions_and_checks_doc_format</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clss</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;UnityChipCheckerMarkdownFileFormat&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">markdown_file_list</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 功能/检查点文档</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">no_line_break</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 禁止字面量 &#34;\n&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">stage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># ...子阶段 FG/FC/CK 原有配置...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>（可扩展）自定义检查器（最小实现，放在 <code>vagent/checkers/unity_test.py</code>）</p>
<p>很多场景下“增加的 checker”并非复用已有检查器，而是需要自己实现一个新的检查器。最小实现步骤：</p>
<ol>
<li>新建类并继承基类 <code>vagent.checkers.base.Checker</code></li>
<li>在 <code>__init__</code> 里声明你需要的参数（与 YAML args 对应）</li>
<li>实现 <code>do_check(self, timeout=0, **kw) -&gt; tuple[bool, object]</code>，返回 (是否通过, 结构化消息)</li>
<li>如需读/写工作区文件，使用 <code>self.get_path(rel)</code> 获取绝对路径；如需跨阶段共享数据，使用 <code>self.smanager_set_value/get_value</code></li>
<li>若想用短名 <code>clss</code> 引用，请在 <code>vagent/checkers/__init__.py</code> 导出该类（或在 <code>clss</code> 写完整模块路径）</li>
</ol>
<p>最小代码骨架（示例）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 文件：vagent/checkers/unity_test.py</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">typing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Tuple</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">os</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">vagent.checkers.base</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Checker</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">UnityChipCheckerMyCustomCheck</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Checker</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">target_file</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">threshold</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#000">kw</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">target_file</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">target_file</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">threshold</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">threshold</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">do_check</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">timeout</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#000">kw</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">Tuple</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87">bool</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">]:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;&#34;&#34;检查 target_file 是否存在并做简单规则校验。&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">real</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">target_file</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exists</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">real</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">False</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;file &#39;</span><span style="color:#4e9a06">{</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">target_file</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39; not found&#34;</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># TODO: 这里写你的具体校验逻辑，例如统计/解析/比对等</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;message&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;MyCustomCheck passed&#34;</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>在阶段 YAML 中引用（与“增加一个 checker”一致）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">checker</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my_custom_check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">clss</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;UnityChipCheckerMyCustomCheck&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 若未在 __init__.py 导出，写完整路径 mypkg.mychk.UnityChipCheckerMyCustomCheck</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">target_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_something.py&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">threshold</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">extra_args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">fail_msg</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;未满足自定义阈值，请完善实现或调低阈值。&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 可选：通过 extra_args 自定义默认失败提示</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>进阶提示（按需）：</p>
<ul>
<li>长时任务/外部进程：在运行子进程时调用 <code>self.set_check_process(p, timeout)</code>，即可用工具 <code>KillCheck/StdCheck</code> 管理与查看进程输出。</li>
<li>模板渲染：实现 <code>get_template_data()</code> 可将进度/统计渲染到阶段标题与任务文案中。</li>
<li>初始化钩子：实现 <code>on_init()</code> 以在阶段开始时加载缓存/准备批任务（与 Batch 系列 checker 一致）。</li>
</ul>
<h3 id="删除-checker">删除 checker</h3>
<p>如临时不要“第 2 阶段 基本信息文档格式检查”，将该阶段的 <code>checker:</code> 置空或移除该项：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dut_function_understanding</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">desc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{DUT}功能理解&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># ...existing fields...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">checker</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[]</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 删除原本的 markdown_file_check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="修改-checker">修改 checker</h3>
<p>把“行覆盖率检查”的阈值从 0.9 调整到 0.8，并自定义失败提示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">line_coverage_analysis_and_improvement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">desc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;代码行覆盖率分析与提升{COVERAGE_COMPLETE}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># ...existing fields...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">checker</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">line_coverage_check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clss</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;UnityChipCheckerTestCaseWithLineCoverage&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">doc_func_check</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">doc_bug_analysis</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_bug_analysis.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">test_dir</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">min_line_coverage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0.8</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 调低阈值</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">extra_args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">fail_msg</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;未达到 80% 的行覆盖率，请补充针对未覆盖行的测试。&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>可选：自定义检查器类</p>
<ul>
<li>在 <code>vagent/checkers/</code> 新增类，继承 <code>vagent.checkers.base.Checker</code> 并实现 <code>do_check()</code>；</li>
<li>在 <code>vagent/checkers/__init__.py</code> 导出类后，可在 <code>clss</code> 用短名；或直接写完整模块路径；</li>
<li><code>args</code> 中的字符串支持模板变量渲染；<code>extra_args</code> 可用于自定义提示文案（具体视检查器实现而定）。</li>
</ul>
<h3 id="常用-checker-参数结构化">常用 checker 参数（结构化）</h3>
<p>以下参数均来自实际代码实现（<code>vagent/checkers/unity_test.py</code>），名称、默认值与类型与代码保持一致；示例片段可直接放入阶段 YAML 的 <code>checker[].args</code>。</p>
<h4 id="unitychipcheckermarkdownfileformat">UnityChipCheckerMarkdownFileFormat</h4>
<ul>
<li>参数：
<ul>
<li>markdown_file_list (str | List[str]): 要检查的 Markdown 文件路径或路径列表。</li>
<li>no_line_break (bool, 默认 false): 是否禁止把换行写成字面量 &ldquo;\n&rdquo;；true 表示禁止。</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">markdown_file_list</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_basic_info.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">no_line_break</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckerlabelstructure">UnityChipCheckerLabelStructure</h4>
<ul>
<li>参数：
<ul>
<li><code>doc_file</code> (str)</li>
<li><code>leaf_node</code> (&ldquo;FG&rdquo;|&ldquo;FC&rdquo;|&ldquo;CK&rdquo;)</li>
<li><code>min_count</code> (int, 默认 1)</li>
<li><code>must_have_prefix</code> (str, 默认 &ldquo;FG-API&rdquo;)</li>
<li><code>data_key</code> (str, 可选)</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">leaf_node</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;CK&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">data_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;COVER_GROUP_DOC_CK_LIST&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckerdutcreation">UnityChipCheckerDutCreation</h4>
<ul>
<li>参数：
<ul>
<li><code>target_file</code> (str)</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">target_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests/{DUT}_api.py&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckerdutfixture">UnityChipCheckerDutFixture</h4>
<ul>
<li>参数：
<ul>
<li><code>target_file</code> (str)</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">target_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests/{DUT}_api.py&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckerenvfixture">UnityChipCheckerEnvFixture</h4>
<ul>
<li>参数：
<ul>
<li><code>target_file</code> (str)</li>
<li><code>min_env</code> (int, 默认 1)</li>
<li><code>force_bundle</code> (bool, 当前未使用)</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">target_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests/{DUT}_api.py&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">min_env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckerdutapi">UnityChipCheckerDutApi</h4>
<ul>
<li>参数：
<ul>
<li><code>api_prefix</code> (str)</li>
<li><code>target_file</code> (str)</li>
<li><code>min_apis</code> (int, 默认 1)</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">api_prefix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;api_{DUT}_&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">target_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests/{DUT}_api.py&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">min_apis</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckercoveragegroup">UnityChipCheckerCoverageGroup</h4>
<ul>
<li>参数：
<ul>
<li><code>test_dir</code> (str)</li>
<li><code>cov_file</code> (str)</li>
<li><code>doc_file</code> (str)</li>
<li><code>check_types</code> (str|List[str])</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">test_dir</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cov_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests/{DUT}_function_coverage_def.py&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">check_types</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;FG&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;FC&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;CK&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckercoveragegroupbatchimplementation">UnityChipCheckerCoverageGroupBatchImplementation</h4>
<ul>
<li>参数：
<ul>
<li><code>test_dir</code> (str)</li>
<li><code>cov_file</code> (str)</li>
<li><code>doc_file</code> (str)</li>
<li><code>batch_size</code> (int)</li>
<li><code>data_key</code> (str)</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">test_dir</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cov_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests/{DUT}_function_coverage_def.py&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">batch_size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">data_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;COVER_GROUP_DOC_CK_LIST&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckertesttemplate">UnityChipCheckerTestTemplate</h4>
<ul>
<li>基类参数：<code>doc_func_check</code> (str), <code>test_dir</code> (str), <code>min_tests</code> (int, 默认 1), <code>timeout</code> (int, 默认 15)</li>
<li>扩展参数（extra_args）：<code>batch_size</code> (默认 20), <code>ignore_ck_prefix</code> (str), <code>data_key</code> (str)</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_func_check</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">test_dir</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ignore_ck_prefix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;test_api_{DUT}_&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">data_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;TEST_TEMPLATE_IMP_REPORT&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">batch_size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckerdutapitest">UnityChipCheckerDutApiTest</h4>
<ul>
<li>参数：
<ul>
<li><code>api_prefix</code> (str)</li>
<li><code>target_file_api</code> (str)</li>
<li><code>target_file_tests</code> (str)</li>
<li><code>doc_func_check</code> (str)</li>
<li><code>doc_bug_analysis</code> (str)</li>
<li><code>min_tests</code> (int, 默认 1)</li>
<li><code>timeout</code> (int, 默认 15)</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">api_prefix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;api_{DUT}_&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">target_file_api</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests/{DUT}_api.py&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">target_file_tests</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests/test_{DUT}_api*.py&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_func_check</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_bug_analysis</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_bug_analysis.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckerbatchtestsimplementation">UnityChipCheckerBatchTestsImplementation</h4>
<ul>
<li>基类参数：<code>doc_func_check</code> (str), <code>test_dir</code> (str), <code>doc_bug_analysis</code> (str), <code>ignore_ck_prefix</code> (str), <code>timeout</code> (int, 默认 15)</li>
<li>进度参数：<code>data_key</code> (str, 必填)</li>
<li>扩展参数（extra_args）：<code>batch_size</code> (默认 5), <code>pre_report_file</code> (str)</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_func_check</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_bug_analysis</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_bug_analysis.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">test_dir</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ignore_ck_prefix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;test_api_{DUT}_&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">batch_size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">data_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;TEST_TEMPLATE_IMP_REPORT&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">pre_report_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}/.TEST_TEMPLATE_IMP_REPORT.json&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckertestcase">UnityChipCheckerTestCase</h4>
<ul>
<li>参数：
<ul>
<li><code>doc_func_check</code> (str)</li>
<li><code>doc_bug_analysis</code> (str)</li>
<li><code>test_dir</code> (str)</li>
<li><code>min_tests</code> (int, 默认 1)</li>
<li><code>timeout</code> (int, 默认 15)</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_func_check</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_bug_analysis</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_bug_analysis.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">test_dir</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h4 id="unitychipcheckertestcasewithlinecoverage">UnityChipCheckerTestCaseWithLineCoverage</h4>
<ul>
<li>基础参数同 <code>UnityChipCheckerTestCase</code></li>
<li>额外必需：<code>cfg</code> (dict|Config)</li>
<li>额外可选（extra_args）：
<ul>
<li><code>min_line_coverage</code> (float, 默认按配置，未配置则 0.8)</li>
<li><code>coverage_json</code> (str, 默认 <code>uc_test_report/line_dat/code_coverage.json</code>)</li>
<li><code>coverage_analysis</code> (str, 默认 <code>unity_test/{DUT}_line_coverage_analysis.md</code>)</li>
<li><code>coverage_ignore</code> (str, 默认 <code>unity_test/tests/{DUT}.ignore</code>)</li>
</ul>
</li>
<li>示例：
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">args</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_func_check</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_functions_and_checks.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">doc_bug_analysis</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/{DUT}_bug_analysis.md&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">test_dir</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{OUT}/tests&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cfg</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;CONFIG_OBJECT_OR_DICT&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">min_line_coverage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0.9</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<p>提示：上面的 <code>示例</code> 仅展示 <code>args</code> 片段；实际需置于阶段条目下的 <code>checker[].args</code>。</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f2c9a60e5e9f300f565a6d475173df02">4 - 定制功能</h1>
    <div class="lead">如何自行定义参数、流程和工具。</div>
	<h2 id="添加工具与-mcp-server-工具">添加工具与 MCP Server 工具</h2>
<p>面向可修改本仓库代码的高级用户，以下说明如何：</p>
<ul>
<li>添加一个新工具（供本地/Agent 内调用）</li>
<li>将工具暴露为 MCP Server 工具（供外部 IDE/客户端调用）</li>
<li>控制选择哪些工具被暴露与如何调用</li>
</ul>
<p>涉及关键位置：</p>
<ul>
<li><code>vagent/tools/uctool.py</code>：工具基类 UCTool、to_fastmcp（LangChain Tool → FastMCP Tool）</li>
<li><code>vagent/util/functions.py</code>：<code>import_and_instance_tools</code>（按名称导入实例）、<code>create_verify_mcps</code>（启动 FastMCP）</li>
<li><code>vagent/verify_agent.py</code>：装配工具清单，<code>start_mcps</code> 组合并启动 Server</li>
<li><code>vagent/cli.py</code> / <code>vagent/verify_pdb.py</code>：命令行与 TUI 内的 MCP 启动命令</li>
</ul>
<h3 id="1-工具体系与装配">1) 工具体系与装配</h3>
<ul>
<li>工具基类 UCTool：
<ul>
<li>继承 LangChain BaseTool，内置：call_count 计数、call_time_out 超时、流式/阻塞提示、MCP Context 注入（ctx.info）、防重入等。</li>
<li>推荐自定义工具继承 UCTool，获得更好的 MCP 行为与调试体验。</li>
</ul>
</li>
<li>运行期装配（VerifyAgent 初始化）：
<ul>
<li>基础工具：RoleInfo、ReadTextFile</li>
<li>嵌入工具：参考检索与记忆（除非 <code>--no-embed-tools</code>）</li>
<li>文件工具：读/写/查找/路径等（可在 MCP 无文件工具模式下剔除）</li>
<li>阶段工具：由 StageManager 按工作流动态提供</li>
<li>外部工具：来自配置项 <code>ex_tools</code> 与 CLI <code>--ex-tools</code>（通过 <code>import_and_instance_tools</code> 零参实例化）</li>
</ul>
</li>
<li>名称解析：
<ul>
<li>短名：类/工厂函数需在 <code>vagent/tools/__init__.py</code> 导出（例如 <code>from .mytool import HelloTool</code>），即可在 <code>ex_tools</code> 写 <code>HelloTool</code></li>
<li>全路径：<code>mypkg.mytools.HelloTool</code> / <code>mypkg.mytools.Factory</code></li>
</ul>
</li>
</ul>
<h3 id="2-添加一个新工具本地agent-内">2) 添加一个新工具（本地/Agent 内）</h3>
<p>规范要求：</p>
<ul>
<li>唯一 name、清晰 description</li>
<li>使用 pydantic BaseModel 定义 args_schema（MCP 转换依赖）</li>
<li>实现 _run（同步）或 _arun（异步）；继承 UCTool 可直接获得超时、流式与 ctx 注入</li>
</ul>
<p>示例 1：同步工具（计数问候）</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">pydantic</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">BaseModel</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Field</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">vagent.tools.uctool</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">UCTool</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">HelloArgs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">BaseModel</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">who</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;要问候的人&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">HelloTool</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">UCTool</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">name</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Hello&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">description</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;向指定对象问候，并统计调用次数&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">args_schema</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">HelloArgs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">who</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">run_manager</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>				<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;Hello, </span><span style="color:#4e9a06">{</span><span style="color:#000">who</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">! (called </span><span style="color:#4e9a06">{</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">call_count</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> times)&#34;</span>
</span></span></code></pre></div><p>注册与使用：</p>
<ul>
<li>临时：<code>--ex-tools mypkg.mytools.HelloTool</code></li>
<li>持久：项目 <code>config.yaml</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">ex_tools</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">	</span>- <span style="color:#000">mypkg.mytools.HelloTool</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>（可选）短名注册：在 <code>vagent/tools/__init__.py</code> 导出 <code>HelloTool</code> 后，可写 <code>--ex-tools HelloTool</code>。</p>
<p>示例 2：异步流式工具（ctx.info + 超时）</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">pydantic</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">BaseModel</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Field</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">vagent.tools.uctool</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">UCTool</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">asyncio</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">ProgressArgs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">BaseModel</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">steps</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ge</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">le</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;进度步数&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">ProgressTool</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">UCTool</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">name</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Progress&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">description</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;演示流式输出与超时处理&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">args_schema</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ProgressArgs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_arun</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">steps</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">run_manager</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>				<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">steps</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>						<span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">put_alive_data</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;step </span><span style="color:#4e9a06">{</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">/</span><span style="color:#4e9a06">{</span><span style="color:#000">steps</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># 供阻塞提示/日志缓冲</span>
</span></span><span style="display:flex;"><span>						<span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>				<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#4e9a06">&#34;done&#34;</span>
</span></span></code></pre></div><p>说明：UCTool.ainvoke 会在 MCP 模式下注入 ctx，并启动阻塞提示线程；当 <code>sync_block_log_to_client=True</code> 时会周期性 <code>ctx.info</code> 推送日志，超时后返回错误与缓冲日志。</p>
<h3 id="3-暴露为-mcp-server-工具">3) 暴露为 MCP Server 工具</h3>
<p>工具 → MCP 转换（<code>vagent/tools/uctool.py::to_fastmcp</code>）：</p>
<ul>
<li>必须：args_schema 继承 BaseModel；不支持“注入参数”签名。</li>
<li>UCTool 子类会得到 context_kwarg=&ldquo;ctx&rdquo; 的 FastMCP 工具，具备流式交互能力。</li>
</ul>
<p>Server 端启动：</p>
<ul>
<li>VerifyAgent.start_mcps 组合工具：<code>tool_list_base + tool_list_task + tool_list_ext + [tool_list_file]</code></li>
<li><code>vagent/util/functions.py::create_verify_mcps</code> 将工具序列转换为 FastMCP 工具并启动 uvicorn（<code>mcp.streamable_http_app()</code>）。</li>
</ul>
<p>如何选择暴露范围：</p>
<ul>
<li>CLI：
<ul>
<li>启动（含文件工具）：<code>--mcp-server</code></li>
<li>启动（无文件工具）：<code>--mcp-server-no-file-tools</code></li>
<li>地址：<code>--mcp-server-host</code>，端口：<code>--mcp-server-port</code></li>
</ul>
</li>
<li>TUI 命令：<code>start_mcp_server [host] [port]</code> / <code>start_mcp_server_no_file_ops [host] [port]</code></li>
</ul>
<h3 id="4-客户端调用流程">4) 客户端调用流程</h3>
<p>FastMCP Python 客户端（参考 <code>tests/test_mcps.py</code>）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">fastmcp</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Client</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Client</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://127.0.0.1:5000/mcp&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">timeout</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">list_tools</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">call_tool</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;who&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;UCAgent&#34;</span><span style="color:#000;font-weight:bold">}))</span>
</span></span></code></pre></div><p>IDE/Agent（Claude Code、Copilot、Qwen Code 等）：将 <code>httpUrl</code> 指向 <code>http://&lt;host&gt;:&lt;port&gt;/mcp</code>，即可发现并调用工具。</p>
<h3 id="5-生命周期并发与超时">5) 生命周期、并发与超时</h3>
<ul>
<li>计数：UCTool 内置 call_count；非 UCTool 工具由 <code>import_and_instance_tools</code> 包装计数。</li>
<li>并发保护：is_in_streaming/is_alive_loop 防止重入；同一实例不允许并发执行。</li>
<li>超时：<code>call_time_out</code>（默认 20s）+ 客户端 timeout；阻塞时可用 <code>put_alive_data</code> + <code>sync_block_log_to_client=True</code> 推送心跳。</li>
</ul>
<h3 id="6-配置策略与最佳实践">6) 配置策略与最佳实践</h3>
<ul>
<li>ex_tools 列表为“整体覆盖”，项目 <code>config.yaml</code> 需写出完整清单。</li>
<li>短名 vs 全路径：短名更便捷，全路径适用于私有包不修改本仓库时。</li>
<li>无参构造/工厂：装配器直接调用 <code>(...)()</code>，复杂配置建议在工厂内部处理（读取环境/配置文件）。</li>
<li>文件写权限：MCP 无文件工具模式下不要暴露写类工具；如需写入，请在本地 Agent 内使用或显式允许写目录。</li>
</ul>
<h4 id="通过环境变量注入外部工具ex_tools">通过环境变量注入外部工具（EX_TOOLS）</h4>
<p>配置文件支持 Bash 风格环境变量占位：<code>$(VAR: default)</code>。你可以让 <code>ex_tools</code> 从环境变量注入工具类列表（支持模块全名或 <code>vagent.tools</code> 下的短名）。</p>
<ol>
<li>在项目的 <code>config.yaml</code> 或用户级 <code>~/.ucagent/setting.yaml</code> 中写入：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">ex_tools: $(EX_TOOLS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[]</span><span style="color:#000">)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ol start="2">
<li>用环境变量提供列表（必须是可被 YAML 解析的数组字面量）：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">EX_TOOLS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;[&#34;SqThink&#34;,&#34;HumanHelp&#34;]&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 或使用完整类路径：</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># export EX_TOOLS=&#39;[&#34;vagent.tools.extool.SqThink&#34;,&#34;vagent.tools.human.HumanHelp&#34;]&#39;</span>
</span></span></code></pre></div><ol start="3">
<li>
<p>启动后本地对话与 MCP Server 中都会出现这些工具。短名需要在 <code>vagent/tools/__init__.py</code> 导出；否则请使用完整模块路径。</p>
</li>
<li>
<p>与 CLI 的 <code>--ex-tools</code> 选项是合并关系（两边都会被装配）。</p>
</li>
</ol>
<h3 id="7-常见问题排查">7) 常见问题排查</h3>
<ul>
<li>工具未出现在 MCP 列表：未被装配（ex_tools 未配置/未导出）、args_schema 非 BaseModel、Server 未按预期启动。</li>
<li>调用报“注入参数不支持”：工具定义包含 LangChain 的 injected args；请改成显式 args_schema 参数。</li>
<li>超时：调大 <code>call_time_out</code> 或客户端 timeout；在长任务中输出进度维持心跳。</li>
<li>短名无效：未在 <code>vagent/tools/__init__.py</code> 导出；改用全路径或补导出。</li>
</ul>
<p>完成以上步骤后：你的工具既能在本地对话中被 ReAct 自动调用，也能通过 MCP Server 暴露给外部 IDE/客户端统一调用。</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-41ee5298b8c6094ee5f1fde353978dbe">5 - 工具列表</h1>
    <div class="lead">UCAgent 可用工具清单（按类别归纳）。</div>
	<p>以下为当前仓库内内置工具（UCTool 家族）的概览，按功能类别归纳：名称（调用名）、用途与参数说明（字段: 类型 — 含义）。</p>
<p>提示：</p>
<ul>
<li>带有“文件写”能力的工具仅在本地/允许写模式下可用；MCP 无文件工具模式不会暴露写类工具。</li>
<li>各工具均基于 args_schema 校验参数，MCP 客户端将根据 schema 生成参数表单。</li>
</ul>
<h2 id="基础信息类">基础/信息类</h2>
<ul>
<li>
<p>RoleInfo（RoleInfo）</p>
<ul>
<li>用途：返回当前代理的角色信息（可在启动时自定义 role_info）。</li>
<li>参数：无</li>
</ul>
</li>
<li>
<p>HumanHelp（HumanHelp）</p>
<ul>
<li>用途：向人类请求帮助（仅在确实卡住时使用）。</li>
<li>参数：
<ul>
<li>message: str — 求助信息</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="规划todo-类">规划/ToDo 类</h2>
<ul>
<li>CreateToDo
<ul>
<li>用途：创建 ToDo（覆盖旧 ToDo）。</li>
<li>参数：
<ul>
<li>task_description: str — 任务描述</li>
<li>steps: List[str] — 步骤（1–20 步）</li>
</ul>
</li>
</ul>
</li>
<li>CompleteToDoSteps
<ul>
<li>用途：将指定步骤标记为完成，可附加备注。</li>
<li>参数：
<ul>
<li>completed_steps: List[int] — 完成的步骤序号（1-based）</li>
<li>notes: str — 备注</li>
</ul>
</li>
</ul>
</li>
<li>UndoToDoSteps
<ul>
<li>用途：撤销步骤完成状态，可附加备注。</li>
<li>参数：
<ul>
<li>steps: List[int] — 撤销的步骤序号（1-based）</li>
<li>notes: str — 备注</li>
</ul>
</li>
</ul>
</li>
<li>ResetToDo
<ul>
<li>用途：重置/清空当前 ToDo。</li>
<li>参数：无</li>
</ul>
</li>
<li>GetToDoSummary / ToDoState
<ul>
<li>用途：获取 ToDo 摘要 / 看板状态短语。</li>
<li>参数：无</li>
</ul>
</li>
</ul>
<h2 id="记忆检索类">记忆/检索类</h2>
<ul>
<li>
<p>SemanticSearchInGuidDoc（SemanticSearchInGuidDoc）</p>
<ul>
<li>用途：在 Guide_Doc/项目文档中做语义检索，返回最相关片段。</li>
<li>参数：
<ul>
<li>query: str — 查询语句</li>
<li>limit: int — 返回条数（1–100，默认 3）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>MemoryPut</p>
<ul>
<li>用途：按 scope 写入长时记忆。</li>
<li>参数：
<ul>
<li>scope: str — 命名空间/范围（如 general/task-specific）</li>
<li>data: str — 内容（可为 JSON 文本）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>MemoryGet</p>
<ul>
<li>用途：按 scope 检索记忆。</li>
<li>参数：
<ul>
<li>scope: str — 命名空间/范围</li>
<li>query: str — 查询语句</li>
<li>limit: int — 返回条数（1–100，默认 3）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="测试执行类">测试/执行类</h2>
<ul>
<li>
<p>RunPyTest（RunPyTest）</p>
<ul>
<li>用途：在指定目录/文件下运行 pytest，支持返回 stdout/stderr。</li>
<li>参数：
<ul>
<li>test_dir_or_file: str — 测试目录或文件</li>
<li>pytest_ex_args: str — 额外 pytest 参数（如 &ldquo;-v --capture=no&rdquo;）</li>
<li>return_stdout: bool — 是否返回标准输出</li>
<li>return_stderr: bool — 是否返回标准错误</li>
<li>timeout: int — 超时秒数（默认 15）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>RunUnityChipTest（RunUnityChipTest）</p>
<ul>
<li>用途：面向 UnityChip 项目封装的测试执行，产生 toffee_report.json 等结果。</li>
<li>参数：同 RunPyTest；另含内部字段（workspace/result_dir/result_json_path）。</li>
</ul>
</li>
</ul>
<h2 id="文件路径文本类">文件/路径/文本类</h2>
<ul>
<li>
<p>SearchText（SearchText）</p>
<ul>
<li>用途：在工作区内按文本搜索，支持通配与正则。</li>
<li>参数：
<ul>
<li>pattern: str — 搜索模式（明文/通配/正则）</li>
<li>directory: str — 相对目录（为空则全仓；填文件则仅搜该文件）</li>
<li>max_match_lines: int — 每个文件返回的最大匹配行数（默认 20）</li>
<li>max_match_files: int — 返回的最大文件数（默认 10）</li>
<li>use_regex: bool — 是否使用正则</li>
<li>case_sensitive: bool — 区分大小写</li>
<li>include_line_numbers: bool — 返回是否带行号</li>
</ul>
</li>
</ul>
</li>
<li>
<p>FindFiles（FindFiles）</p>
<ul>
<li>用途：按通配符查找文件。</li>
<li>参数：
<ul>
<li>pattern: str — 文件名模式（fnmatch 通配）</li>
<li>directory: str — 相对目录（为空则全仓）</li>
<li>max_match_files: int — 返回最大文件数（默认 10）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>PathList（PathList）</p>
<ul>
<li>用途：列出目录结构（可限制深度）。</li>
<li>参数：
<ul>
<li>path: str — 目录（相对 workspace）</li>
<li>depth: int — 深度（-1 全部，0 当前）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ReadBinFile（ReadBinFile）</p>
<ul>
<li>用途：读取二进制文件（返回 [BIN_DATA]）。</li>
<li>参数：
<ul>
<li>path: str — 文件路径（相对 workspace）</li>
<li>start: int — 起始字节（默认 0）</li>
<li>end: int — 结束字节（默认 -1 表示 EOF）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ReadTextFile（ReadTextFile）</p>
<ul>
<li>用途：读取文本文件（带行号，返回 [TXT_DATA]）。</li>
<li>参数：
<ul>
<li>path: str — 文件路径（相对 workspace）</li>
<li>start: int — 起始行（1-based，默认 1）</li>
<li>count: int — 行数（-1 到文件末尾）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>EditTextFile（EditTextFile）</p>
<ul>
<li>用途：编辑/创建文本文件，模式：replace/overwrite/append。</li>
<li>参数：
<ul>
<li>path: str — 文件路径（相对 workspace，不存在则创建）</li>
<li>data: str — 写入的文本（None 表示清空）</li>
<li>mode: str — 编辑模式（replace/overwrite/append，默认 replace）</li>
<li>start: int — replace 模式的起始行（1-based）</li>
<li>count: int — replace 模式替换行数（-1 到末尾，0 插入）</li>
<li>preserve_indent: bool — replace 时是否保留缩进</li>
</ul>
</li>
</ul>
</li>
<li>
<p>CopyFile（CopyFile）</p>
<ul>
<li>用途：复制文件；可选覆盖。</li>
<li>参数：
<ul>
<li>source_path: str — 源文件</li>
<li>dest_path: str — 目标文件</li>
<li>overwrite: bool — 目标存在时是否覆盖</li>
</ul>
</li>
</ul>
</li>
<li>
<p>MoveFile（MoveFile）</p>
<ul>
<li>用途：移动/重命名文件；可选覆盖。</li>
<li>参数：
<ul>
<li>source_path: str — 源文件</li>
<li>dest_path: str — 目标文件</li>
<li>overwrite: bool — 目标存在时是否覆盖</li>
</ul>
</li>
</ul>
</li>
<li>
<p>DeleteFile（DeleteFile）</p>
<ul>
<li>用途：删除文件。</li>
<li>参数：
<ul>
<li>path: str — 文件路径</li>
</ul>
</li>
</ul>
</li>
<li>
<p>CreateDirectory（CreateDirectory）</p>
<ul>
<li>用途：创建目录（递归）。</li>
<li>参数：
<ul>
<li>path: str — 目录路径</li>
<li>parents: bool — 递归创建父目录</li>
<li>exist_ok: bool — 已存在是否忽略</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ReplaceStringInFile（ReplaceStringInFile）</p>
<ul>
<li>用途：精确字符串替换（强约束匹配；可新建文件）。</li>
<li>参数：
<ul>
<li>path: str — 目标文件</li>
<li>old_string: str — 需要被替换的完整原文（含上下文，精确匹配）</li>
<li>new_string: str — 新内容</li>
</ul>
</li>
</ul>
</li>
<li>
<p>GetFileInfo（GetFileInfo）</p>
<ul>
<li>用途：获取文件信息（大小、修改时间、人类可读尺寸等）。</li>
<li>参数：
<ul>
<li>path: str — 文件路径</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="扩展示例">扩展示例</h2>
<ul>
<li>SimpleReflectionTool（SimpleReflectionTool）
<ul>
<li>用途：示例型“自我反思”工具（来自 extool.py），可作为扩展参考。</li>
<li>参数：
<ul>
<li>message: str — 自我反思文本</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>备注：</p>
<ul>
<li>工具调用超时默认 20s（具体工具可重写）；长任务请周期性输出进度避免超时。</li>
<li>MCP 无文件工具模式下默认不暴露写类工具；如需写入，建议在本地 Agent 模式或按需限制可写目录。</li>
</ul>

</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025
    <span class="td-footer__authors">BOSC</span></span><span class="td-footer__all_rights_reserved">保留所有权利</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">隐私政策</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/mlvp/js/main.min.8bdc707530d61dee3a6fd659f8a422c05d2e2319377a8710175451ca21fa83b0.js" integrity="sha256-i9xwdTDWHe46b9ZZ&#43;KQiwF0uIxk3eocQF1RRyiH6g7A=" crossorigin="anonymous"></script>
<script src='/mlvp/js/prism.js'></script>
<script src='/mlvp/js/tabpane-persist.js'></script>

  </body>
</html>
