<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="https://xs-mlvp.github.io/mlvp/en/docs/">
<link rel="alternate" type="application/rss&#43;xml" href="https://xs-mlvp.github.io/mlvp/en/docs/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/mlvp/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/mlvp/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/mlvp/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/mlvp/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/mlvp/favicons/android-192x192.png" sizes="192x192">

<title>Learning Resources | UnityChip Verification</title>
<meta name="description" content="This learning resource introduces the basic concepts and techniques related to verification, as well as how to use the open-source tools provided by this project for chip verification.
Before studying this material, it is assumed that you already have basic knowledge of Linux, Python, etc.
Relevant learning materials:
《Linux 101》Online Lecture Notes Python Official Python Tutorial Official Python Tutorial If you plan to participate in the “Open Source Verification Projects” published on this platform, it is recommended to complete the study of this material in advance.">
<meta property="og:title" content="Learning Resources" />
<meta property="og:description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://xs-mlvp.github.io/mlvp/en/docs/" />
<meta itemprop="name" content="Learning Resources">
<meta itemprop="description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins."><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Learning Resources"/>
<meta name="twitter:description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins."/>
<link rel="preload" href="/mlvp/scss/main.min.5e43f8574351718e9b44966c9f3a571202ed048c082f457fb574c10b1a1bc56c.css" as="style" integrity="sha256-XkP4V0NRcY6bRJZsnzpXEgLtBIwIL0V/tXTBCxobxWw=" crossorigin="anonymous">
<link href="/mlvp/scss/main.min.5e43f8574351718e9b44966c9f3a571202ed048c082f457fb574c10b1a1bc56c.css" rel="stylesheet" integrity="sha256-XkP4V0NRcY6bRJZsnzpXEgLtBIwIL0V/tXTBCxobxWw=" crossorigin="anonymous">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/mlvp/css/prism.css"/>

    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?6aacb1c7ca0a3ef4e3aa84c1eaa237dd";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
    </script>


    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4Z2ZY6ZE84"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-4Z2ZY6ZE84');
    </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />

<script>
    $(document).ready(function() {
        $('a[name="multi-lang-toggle"]').on('click', function(event) {
            var language = $(this).attr('lang');
            var codeDiv = $(this).closest('.highlight');
            var preNodes = codeDiv.find('pre');
            preNodes.each(function(index, preNode) {
                if ($(preNode).attr("name").toLowerCase().indexOf(language.toLowerCase()) !== -1) {
                    preNode.style.display = 'block';
                } else {
                    preNode.style.display = 'none';
                }
            });
            var alist = codeDiv.find('a[name="multi-lang-toggle"]');
            alist.each(function(index, aNode) {
                if ($(aNode).attr('lang').toLowerCase() === language.toLowerCase()) {
                    aNode.style.fontWeight = 'bold';
                } else {
                    aNode.style.fontWeight = 'normal';
                }
            });
        })
        $(this).find('pre[name^="group-lang-code-"]').each(function(index, preNode) {
            if (preNode.style.display !== 'none') {
                var language = $(preNode).attr("name").replace('group-lang-code-', '');
                var alist = $(this).closest('.highlight').find('a[name="multi-lang-toggle"]');
                alist.each(function(index, aNode) {
                    if ($(aNode).attr('lang').toLowerCase() === language.toLowerCase()) {
                        aNode.style.fontWeight = 'bold';
                    } else {
                        aNode.style.fontWeight = 'normal';
                    }
                });
            }
        });
    });
</script>
    
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/mlvp/en/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">UnityChip Verification</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">English</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/mlvp/docs/">中文</a></li>
    </ul>
</div></li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/mlvp/offline-search-index.42b5a68010ee76649de83ae01cd6c103.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/mlvp/en/docs/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Learning Resources</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-6546478d87b4368b79e83eb0e32c466c">Quick Start</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-4d867707798ab2157e2ebf55f2ff5ecf">Setting Up the Verification Environment</a></li>


    
  
    
    
	
<li>1.2: <a href="#pg-ed0dac32f7bc588e473d2d5d54f6678e">Case 1: Adder</a></li>


    
  
    
    
	
<li>1.3: <a href="#pg-c05bb6c77ec711a62c2f3e22fed11380">Case 2: Random Number Generator</a></li>


    
  
    
    
	
<li>1.4: <a href="#pg-8754821d205ce3dd872f355001bd1199">Case 3: Dual-Port Stack (Callback)</a></li>


    
  
    
    
	
<li>1.5: <a href="#pg-8b6f24fda4c11d593a6c671bbe7427ce">Case 4: Dual-Port Stack (Coroutines)</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-7351c618ae63b98e5898f0913a6c55f5">Environment Usage</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-ea0963a557e19f6f121695eff48e4632">Tool Introduction</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-f3644e5a33edc980188913395528ef79">Waveform Generation</a></li>


    
  
    
    
	
<li>2.3: <a href="#pg-5e24b3d167d3b33da0ef1cb2f151ba27">Multi-File Input</a></li>


    
  
    
    
	
<li>2.4: <a href="#pg-625b33435a15ffee912f47c5443ffc13">Coverage Statistics</a></li>


    
  
    
    
	
<li>2.5: <a href="#pg-a2e75c30d9ecce2bb906ec293eb6678e">Integrated Testing Framework</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.5.1: <a href="#pg-59e8c01d61d7cbb458b1aedd8931a8d4">PyTest</a></li>


    
  
    
    
	
<li>2.5.2: <a href="#pg-e228270a25eab6e1035925a8e92bf6f0">Hypothesis</a></li>


    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-60a985e164b2bc20af6e01e35f5b2af0">Verification Basics</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-13bda523e6e63f16e87df4b0401a9d7f">Chip Verification</a></li>


    
  
    
    
	
<li>3.2: <a href="#pg-d3cde34a1f60a51b0990066a7b5fc0c9">Digital Circuits</a></li>


    
  
    
    
	
<li>3.3: <a href="#pg-f9d4c1f404f62253b519fd8af17d8389">Creating DUT</a></li>


    
  
    
    
	
<li>3.4: <a href="#pg-82b31af9e0ee05c3d251234b764020ed">DUT Verification</a></li>


    
  
    
    
	
<li>3.5: <a href="#pg-9677ff4fee20856211cd5ff4272fe758">Verification Report</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-3116bc87ca15222db8a1ea63529f340c">Verification Framework</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1: <a href="#pg-6b230018a9532ed03844c346cb1ab6b1">Quick Start</a></li>


    
  
    
    
	
<li>4.2: <a href="#pg-b07ce7c9627fc1d6d7c8d73fb5b195f4">Writing a Standardized Verification Environment</a></li>


    
  
    
    
	
<li>4.3: <a href="#pg-e77a7d893b67be7260a40bdc5eb52674">Setting Up a Verification Environment</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.3.1: <a href="#pg-f0ad1b6fbd03350b4038655714fa526a">How to Use an Asynchronous Environment</a></li>


    
  
    
    
	
<li>4.3.2: <a href="#pg-24fbc3c0d43eefa92eb8f640766a6876">How to Use Bundle</a></li>


    
  
    
    
	
<li>4.3.3: <a href="#pg-d8294406c872c50fb824daf8117b16c4">How to Write an Agent</a></li>


    
  
    
    
	
<li>4.3.4: <a href="#pg-ef7ff8d9b1e4680f7bfedab19681abb5">How to Build an Env</a></li>


    
  
    
    
	
<li>4.3.5: <a href="#pg-561e9af58bbb529ed50067d0df763d91">How to Write a Reference Model</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4.4: <a href="#pg-3c86338d72241e31623b577659ea691b">Writing Test Cases</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.4.1: <a href="#pg-59f61aa8e02aaee75f4d59274ed9c583">How to Drive Using Test Environment Interfaces</a></li>


    
  
    
    
	
<li>4.4.2: <a href="#pg-20d016e97daff972eb4b248aee8c24c1">How to Use Pytest to Manage Test Cases</a></li>


    
  
    
    
	
<li>4.4.3: <a href="#pg-a072beec952896e88e69f09e9e661bc0">How to Write Test Points</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4.5: <a href="#pg-218ae6a2d4629a583763e808ab9baf63">Starting a New Verification Task</a></li>


    
  
    
    
	
<li>4.6: <a href="#pg-c7e9635323f5bcd8850571649a8a42b8">API Documentation</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.6.1: <a href="#pg-bd013f36b484950df4c10662b7c51cde">Bundle API</a></li>


    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-9bbc770803b9bc1e63b3586d9d27b4a2">Advanced Case Studies</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-def016dedd85ad313b8a6618f0995331">Complete Verification of Nutshell Cache</a></li>


    
  
    
    
	
<li>5.2: <a href="#pg-ddd72ebc8a861fa48194266f6ffaaf60">TileLink Protocol</a></li>


    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-636f24d07e5c63a708ce945a0d50c36c">Multi-language Support</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>6.1: <a href="#pg-cd5f02d8062ce0e1861c417988fc8c9e">Using C&#43;&#43;</a></li>


    
  
    
    
	
<li>6.2: <a href="#pg-28fd3cc543c8fa74cf9e1aa32666d139">Using Java ...</a></li>


    
  

    </ul>
    
  

    </ul>


<div class="content">
      

<div class="pageinfo pageinfo-primary">
<p>This learning resource introduces the basic concepts and techniques related to verification, as well as how to use the open-source tools provided by this project for chip verification.</p>

</div>

<p><strong><span style="color:red;">Before studying this material, it is assumed that you already have basic knowledge of Linux, Python, etc.</span></strong></p>
<p>Relevant learning materials:</p>
<ol>
<li><a href="https://101.ustclug.org/" target="_blank">《Linux 101》Online Lecture Notes</a></li>
<li><a href="https://docs.python.org/3/tutorial/index.html" target="_blank">Python Official Python Tutorial</a></li>
<li><a href="https://www.javatpoint.com/git" target="_blank">Official Python Tutorial</a></li>
</ol>
<p>If you plan to participate in the &ldquo;Open Source Verification Projects&rdquo; published on this platform, it is recommended to complete the study of this material in advance.</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6546478d87b4368b79e83eb0e32c466c">1 - Quick Start</h1>
    <div class="lead">How to use the open verification platform to participate in hardware verification.</div>
	

<div class="pageinfo pageinfo-primary">
<p>This page will briefly introduce what verification is, as well as concepts used in the examples, such as DUT (Design Under Test) and RM (Reference Model).</p>

</div>

<h3 id="chip-verification">Chip Verification</h3>
<p>Chip verification is a crucial step to ensure the correctness and reliability of chip designs, including functional verification, formal verification, and physical verification. This material only covers functional verification, focusing on simulation-based chip functional verification. The processes and methods of chip functional verification have many similarities with software testing, such as unit testing, system testing, black-box testing, and white-box testing. They also share similar metrics, such as functional coverage and code coverage. In essence, apart from the different tools and programming languages used, their goals and processes are almost identical. <strong>Thus, software test engineers should be able to perform chip verification without considering the tools and programming languages.</strong> However, in practice, software testing and chip verification are two completely separate fields, primarily due to the different verification tools and languages, making it difficult for software test engineers to crossover. In chip verification, hardware description languages (e.g., Verilog or SystemVerilog) and specialized commercial tools for circuit simulation are commonly used. Hardware description languages differ from high-level software programming languages like C++/Python, featuring a unique &ldquo;clock&rdquo; characteristic, which poses a high learning curve for software engineers.</p>
<p><strong>To bridge the gap between chip verification and traditional software testing, allowing more people to participate in chip verification, this project provides the following content:</strong></p>
<blockquote><p>
Multi-language verification tools (Picker), allowing users to use their preferred programming language for chip verification.
<p>Verification framework (MLVP), enabling functional verification without worrying about the clock.</p>
<p>Introduction to basic circuits and verification knowledge, helping software enthusiasts understand circuit characteristics more easily.</p>
<p>Basic learning materials for fundamental verification knowledge.</p>
<p>Real high-performance chip verification cases, allowing enthusiasts to participate in verification work remotely.</p>
</blockquote></p>
<h3 id="basic-terms">Basic Terms</h3>
<p><strong>DUT:</strong> Design Under Test, usually referring to the designed RTL code.</p>
<p><strong>RM:</strong> Reference Model, a standard error-free model corresponding to the unit under test.</p>
<p><strong>RTL:</strong> Register Transfer Level, typically referring to the Verilog or VHDL code corresponding to the chip design.</p>
<p><strong>Coverage:</strong> The percentage of the test range relative to the entire requirement range. In chip verification, this typically includes line coverage, function coverage, and functional coverage.</p>
<p><strong>DV:</strong> Design Verification, referring to the collaboration of design and verification.</p>
<p><strong>Differential Testing (difftest):</strong> Selecting two (or more) functionally identical units under test, submitting the same test cases that meet the unit&rsquo;s requirements to observe whether there are differences in the execution results.</p>
<h3 id="tool-introduction">Tool Introduction</h3>
<p>The core tool used in this material is Picker（<a href="https://github.com/XS-MLVP/picker">https://github.com/XS-MLVP/picker</a>）. Its purpose is to automatically provide high-level programming language interfaces (Python/C++) for RTL-written design modules. Based on this tool, verification personnel with a software development (testing) background can perform chip verification without learning hardware description languages like Verilog/VHDL.</p>
<h3 id="system-requirements">System Requirements</h3>
<p>Recommended operating system: Ubuntu 22.04 LTS</p>
<blockquote><p>
In the development and research of system architecture, Linux is the most commonly used platform, mainly because Linux has a rich set of software and tool resources. Due to its open-source nature, important tools and software (such as Verilator) can be easily developed for Linux. In this course, multi-language verification tools like Picker and Swig can run stably on Linux.
</blockquote></p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4d867707798ab2157e2ebf55f2ff5ecf">1.1 - Setting Up the Verification Environment</h1>
    <div class="lead">Install the necessary dependencies, <strong>download, build, and install</strong>  the required tools.</div>
	<h2 id="installing-the-picker-tool-from-source">Installing the Picker Tool from Source</h2>
<h3 id="installing-dependencies">Installing Dependencies</h3>
<ol>
<li>
<p><a href="https://cmake.org/download/">cmake</a>  ( &gt;=3.11 )</p>
</li>
<li>
<p><a href="https://gcc.gnu.org/">gcc</a>  ( Supports C++20, at least GCC version 10, <strong>recommended 11 or higher</strong>  )</p>
</li>
<li>
<p><a href="https://www.python.org/downloads/">python3</a>  ( &gt;=3.8 )</p>
</li>
<li>
<p><a href="https://verilator.org/guide/latest/install.html#git-quick-install">verilator</a>  ( <strong>==4.218</strong>  )</p>
</li>
<li>
<p><a href="https://github.com/chipsalliance/verible">verible-verilog-format</a>  ( &gt;=0.0-3428-gcfcbb82b )</p>
</li>
<li>
<p><a href="http://www.swig.org/">swig</a>  ( &gt;=<strong>4.2.0</strong> , for multi-language support )</p>
</li>
</ol>
<blockquote>
<p>Please ensure that the tools like <code>verible-verilog-format</code> have been added to the environment variable <code>$PATH</code>, so they can be called directly from the command line.</p>
</blockquote>
<h3 id="source-code-download">Source Code Download</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/XS-MLVP/picker.git --depth<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> picker
</span></span><span style="display:flex;"><span>make init
</span></span></code></pre></div><h3 id="build-and-install">Build and Install</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> picker
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># You can enable support for other languages by </span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#   using `make BUILD_XSPCOMM_SWIG=python,java,scala,golang`.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Each language requires its own development environment, </span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#   which needs to be configured separately, such as `javac` for Java.</span>
</span></span><span style="display:flex;"><span>sudo -E make install
</span></span></code></pre></div><blockquote>
<p>The default installation path is <code>/usr/local</code>, with binary files placed in <code>/usr/local/bin</code> and template files in <code>/usr/local/share/picker</code>.
If you need to change the installation directory, you can pass arguments to cmake by specifying ARGS, for example: <code>make ARGS=&quot;-DCMAKE_INSTALL_PREFIX=your_install_dir&quot;</code>
The installation will automatically install the <code>xspcomm</code> base library (<a href="https://github.com/XS-MLVP/xcomm)">https://github.com/XS-MLVP/xcomm)</a>, which is used to encapsulate the basic types of <code>RTL</code> modules, located at <code>/usr/local/lib/libxspcomm.so</code>. <strong>You may need to manually set the link directory parameters (-L) during compilation.</strong><br>
If support for languages such as Java is enabled, the corresponding <code>xspcomm</code> multi-language packages will also be installed.</p>
</blockquote>
<p><strong>picker can also be compiled into a wheel file and installed via pip</strong></p>
<p>To package picker into a wheel installation package, use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make wheel <span style="color:#8f5902;font-style:italic"># or BUILD_XSPCOMM_SWIG=python,java,scala,golang make wheel</span>
</span></span></code></pre></div><p>After compilation, the wheel file will be located in the dist directory. You can then install it via pip, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install dist/xspcomm-0.0.1-cp311-cp311-linux_x86_64.whl
</span></span><span style="display:flex;"><span>pip install dist/picker-0.0.1-cp311-cp311-linux_x86_64.whl
</span></span></code></pre></div><p>After installation, execute the <code>picker</code> command to except the flow output:</p>
<pre tabindex="0"><code>XDut Generate. 
Convert DUT(*.v/*.sv) to C++ DUT libs.

Usage: ./build/bin/picker [OPTIONS] [SUBCOMMAND]

Options:
  -h,--help                   Print this help message and exit
  -v,--version                Print version
  --show_default_template_path
                              Print default template path
  --show_xcom_lib_location_cpp
                              Print xspcomm lib and include location
  --show_xcom_lib_location_java
                              Print xspcomm-java.jar location
  --show_xcom_lib_location_scala
                              Print xspcomm-scala.jar location
  --show_xcom_lib_location_python
                              Print python module xspcomm location
  --show_xcom_lib_location_golang
                              Print golang module xspcomm location
  --check                     check install location and supproted languages

Subcommands:
  export                      Export RTL Projects Sources as Software libraries such as C++/Python
  pack                        Pack UVM transaction as a UVM agent and Python class
</code></pre><h3 id="installation-test">Installation Test</h3>
<p>picker currently has two subcommands: <code>export</code> and <code>pack</code>.</p>
<p>The <code>export</code> subcommand is used to convert RTL designs into &ldquo;libraries&rdquo; corresponding to other high-level programming languages, which can be driven through software.</p>
<blockquote>
<p>$picker export &ndash;help</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Export RTL Projects Sources as Software libraries such as C++/Python
</span></span><span style="display:flex;"><span>Usage: picker <span style="color:#204a87">export</span> <span style="color:#ce5c00;font-weight:bold">[</span>OPTIONS<span style="color:#ce5c00;font-weight:bold">]</span> file...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Positionals:
</span></span><span style="display:flex;"><span>  file TEXT ... REQUIRED      DUT .v/.sv <span style="color:#204a87">source</span> file, contain the top module
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>  -h,--help                   Print this <span style="color:#204a87">help</span> message and <span style="color:#204a87">exit</span>
</span></span><span style="display:flex;"><span>  --fs,--filelist TEXT ...    DUT .v/.sv <span style="color:#204a87">source</span> files, contain the top module, split by comma.
</span></span><span style="display:flex;"><span>                              Or use <span style="color:#4e9a06">&#39;*.txt&#39;</span> file  with one RTL file path per line to specify the file list
</span></span><span style="display:flex;"><span>  --sim TEXT <span style="color:#ce5c00;font-weight:bold">[</span>verilator<span style="color:#ce5c00;font-weight:bold">]</span>      vcs or verilator as simulator, default is verilator
</span></span><span style="display:flex;"><span>  --lang,--language TEXT:<span style="color:#ce5c00;font-weight:bold">{</span>python,cpp,java,scala,golang<span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">[</span>python<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                              Build example project, default is python, choose cpp, java or python
</span></span><span style="display:flex;"><span>  --sdir,--source_dir TEXT <span style="color:#ce5c00;font-weight:bold">[</span>/home/yaozhicheng/workspace/picker/template<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                              Template Files Dir, default is <span style="color:#4e9a06">${</span><span style="color:#000">picker_install_path</span><span style="color:#4e9a06">}</span>/../picker/template
</span></span><span style="display:flex;"><span>  --tdir,--target_dir TEXT <span style="color:#ce5c00;font-weight:bold">[</span>./picker_out<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                              Codegen render files to target dir, default is ./picker_out
</span></span><span style="display:flex;"><span>  --sname,--source_module_name TEXT ...
</span></span><span style="display:flex;"><span>                              Pick the module in DUT .v file, default is the last module in the -f marked file
</span></span><span style="display:flex;"><span>  --tname,--target_module_name TEXT
</span></span><span style="display:flex;"><span>                              Set the module name and file name of target DUT, default is the same as source.
</span></span><span style="display:flex;"><span>                              For example, -T top, will generate UTtop.cpp and UTtop.hpp with UTtop class
</span></span><span style="display:flex;"><span>  --internal TEXT             Exported internal signal config file, default is empty, means no internal pin
</span></span><span style="display:flex;"><span>  -F,--frequency TEXT <span style="color:#ce5c00;font-weight:bold">[</span>100MHz<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                              Set the frequency of the **only VCS** DUT, default is 100MHz, use Hz, KHz, MHz, GHz as unit
</span></span><span style="display:flex;"><span>  -w,--wave_file_name TEXT    Wave file name, emtpy mean don<span style="color:#4e9a06">&#39;t dump wave
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -c,--coverage               Enable coverage, default is not selected as OFF
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --cp_lib,--copy_xspcomm_lib BOOLEAN [1]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                              Copy xspcomm lib to generated DUT dir, default is true
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -V,--vflag TEXT             User defined simulator compile args, passthrough.
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                              Eg: &#39;</span>-v -x-assign<span style="color:#ce5c00;font-weight:bold">=</span>fast -Wall --trace<span style="color:#4e9a06">&#39; || &#39;</span>-C vcs -cc -f filelist.f<span style="color:#4e9a06">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -C,--cflag TEXT             User defined gcc/clang compile command, passthrough. Eg:&#39;</span>-O3 -std<span style="color:#ce5c00;font-weight:bold">=</span>c++17 -I./include<span style="color:#a40000">&#39;</span>
</span></span><span style="display:flex;"><span>  --verbose                   Verbose mode
</span></span><span style="display:flex;"><span>  -e,--example                Build example project, default is OFF
</span></span><span style="display:flex;"><span>  --autobuild BOOLEAN <span style="color:#ce5c00;font-weight:bold">[</span>1<span style="color:#ce5c00;font-weight:bold">]</span>     Auto build the generated project, default is <span style="color:#204a87">true</span>
</span></span></code></pre></div><p>Static Multi-Module Support:</p>
<p>When generating the wrapper for <code>dut_top.sv/v</code>, picker allows specifying multiple module names and their corresponding quantities using the <code>--sname</code> parameter. For example, if there are modules A and B in the design files <code>a.v</code> and <code>b.v</code> respectively, and you need 2 instances of A and 3 instances of B in the generated DUT, and the combined module name is C (if not specified, the default name will be A_B). This can be achieved using the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>picker path/a.v,path/b.v --sname A,2,B,3 --tname C
</span></span></code></pre></div><p>Environment Variables:</p>
<ul>
<li><code>DUMPVARS_OPTION</code>: Sets the option parameter for <code>$dumpvars</code>. For example, <code>DUMPVARS_OPTION=&quot;+mda&quot; picker ....</code> enables array waveform support in VCS.</li>
<li><code>SIMULATOR_FLAGS</code>: Parameters passed to the backend simulator. Refer to the documentation of the specific backend simulator for details.</li>
<li><code>CFLAGS</code>: Sets the <code>-cflags</code> parameter for the backend simulator.</li>
</ul>
<p>The <code>pack</code> subcommand is used to convert UVM <code>sequence_item</code> into other languages and then communicate through TLM (currently supports Python, other languages are under development).</p>
<blockquote>
<p>$picker pack &ndash;help</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Pack uvm transaction as a uvm agent and python class
</span></span><span style="display:flex;"><span>Usage: picker pack <span style="color:#ce5c00;font-weight:bold">[</span>OPTIONS<span style="color:#ce5c00;font-weight:bold">]</span> file...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Positionals:
</span></span><span style="display:flex;"><span>  file TEXT ... REQUIRED      Sv <span style="color:#204a87">source</span> file, contain the transaction define
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>  -h,--help                   Print this <span style="color:#204a87">help</span> message and <span style="color:#204a87">exit</span>
</span></span><span style="display:flex;"><span>  -e,--example                Generate example project based on transaction, default is OFF
</span></span><span style="display:flex;"><span>  -c,--force                  Force delete folder when the code has already generated by picker
</span></span><span style="display:flex;"><span>  -r,--rename TEXT ...        Rename transaction name in picker generate code
</span></span></code></pre></div><h3 id="test-examples">Test Examples</h3>
<p>After picker compilation, execute the following commands in the picker directory to test the examples:</p>
<pre tabindex="0"><code>bash example/Adder/release-verilator.sh --lang cpp
bash example/Adder/release-verilator.sh --lang python

# Default enable cpp and python
#  for other languages support：make BUILD_XSPCOMM_SWIG=python,java,scala,golang
bash example/Adder/release-verilator.sh --lang java
bash example/Adder/release-verilator.sh --lang scala
bash example/Adder/release-verilator.sh --lang golang

bash example/RandomGenerator/release-verilator.sh --lang cpp
bash example/RandomGenerator/release-verilator.sh --lang python
bash example/RandomGenerator/release-verilator.sh --lang java
</code></pre><h3 id="more-documents">More Documents</h3>
<p>For guidance on chip verification with picker, please refer to: <a href="https://open-verify.cc/mlvp/en/docs/">https://open-verify.cc/mlvp/en/docs/</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ed0dac32f7bc588e473d2d5d54f6678e">1.2 - Case 1: Adder</h1>
    <div class="lead">Demonstrates the principles and usage of the tool based on a simple adder verification. This adder is implemented using simple combinational logic.</div>
	<h2 id="rtl-source-code">RTL Source Code</h2>
<p>In this case, we drive a 64-bit adder (combinational circuit) with the following source code:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// A verilog 64-bit full adder with carry in and carry out
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">module</span> <span style="color:#000">Adder</span> <span style="color:#000;font-weight:bold">#(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">parameter</span> <span style="color:#000">WIDTH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">WIDTH</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">WIDTH</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">WIDTH</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000">cout</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#000">cout</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">}</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">endmodule</span>
</span></span></code></pre></div><p>This adder contains a 64-bit adder with inputs of two 64-bit numbers and a carry-in signal, outputting a 64-bit sum and a carry-out signal.</p>
<h2 id="testing-process">Testing Process</h2>
<p>During the testing process, we will create a folder named <code>Adder</code>, containing a file called <code>Adder.v</code>. This file contains the above RTL source code.</p>
<h3 id="exporting-rtl-to-python-module">Exporting RTL to Python Module</h3>
<h4 id="generating-intermediate-files">Generating Intermediate Files</h4>
<p>Navigate to the <code>Adder</code> folder and execute the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>picker <span style="color:#204a87">export</span> --autobuild<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> Adder.v -w Adder.fst --sname Adder --tdir picker_out_adder --lang python -e --sim verilator
</span></span></code></pre></div><p>This command performs the following actions:</p>
<ol>
<li>
<p>Uses <code>Adder.v</code> as the top file, with <code>Adder</code> as the top module, and generates a dynamic library using the Verilator simulator with Python as the target language.</p>
</li>
<li>
<p>Enables waveform output, with the target waveform file as <code>Adder.fst</code>.</p>
</li>
<li>
<p>Includes files for driving the example project (-e), and does not automatically compile after code generation (-autobuild=false).</p>
</li>
<li>
<p>The final file output path is <code>picker_out_adder</code>.</p>
</li>
</ol>
<p>Some command-line parameters were not used in this command, and they will be introduced in later sections.
The output directory structure is as follows. <strong>Note that these are all intermediate files</strong>  and cannot be used directly:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>picker_out_adder
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- Adder.v <span style="color:#8f5902;font-style:italic"># Original RTL source code</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- Adder_top.sv <span style="color:#8f5902;font-style:italic"># Generated Adder_top top-level wrapper, using DPI to drive Adder module inputs and outputs</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- Adder_top.v <span style="color:#8f5902;font-style:italic"># Generated Adder_top top-level wrapper in Verilog, needed because Verdi does not support importing SV source code</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- CMakeLists.txt <span style="color:#8f5902;font-style:italic"># For invoking the simulator to compile the basic C++ class and package it into a bare DPI function binary dynamic library (libDPIAdder.so)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- Makefile <span style="color:#8f5902;font-style:italic"># Generated Makefile for invoking CMakeLists.txt, allowing users to compile libAdder.so through the make command, with manual adjustment of Makefile configuration parameters, or to compile the example project</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- cmake <span style="color:#8f5902;font-style:italic"># Generated cmake folder for invoking different simulators to compile RTL code</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- vcs.cmake
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#4e9a06">`</span>-- verilator.cmake
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- cpp <span style="color:#8f5902;font-style:italic"># CPP example directory containing sample code</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- CMakeLists.txt <span style="color:#8f5902;font-style:italic"># For wrapping libDPIAdder.so using basic data types into a directly operable class (libUTAdder.so), not just bare DPI functions</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- Makefile
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- cmake
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- vcs.cmake
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>   <span style="color:#4e9a06">`</span>-- verilator.cmake
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- dut.cpp <span style="color:#8f5902;font-style:italic"># Generated CPP UT wrapper, including calls to libDPIAdder.so, and UTAdder class declaration and implementation</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- dut.hpp <span style="color:#8f5902;font-style:italic"># Header file</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#4e9a06">`</span>-- example.cpp <span style="color:#8f5902;font-style:italic"># Sample code calling UTAdder class</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- dut_base.cpp <span style="color:#8f5902;font-style:italic"># Base class for invoking and driving simulation results from different simulators, encapsulated into a unified class to hide all simulator-related code details</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- dut_base.hpp
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- filelist.f <span style="color:#8f5902;font-style:italic"># Additional file list for multi-file projects, check the -f parameter introduction. Empty in this case</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- mk
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- cpp.mk <span style="color:#8f5902;font-style:italic"># Controls Makefile when targeting C++ language, including logic for compiling example projects (-e, example)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#4e9a06">`</span>-- python.mk <span style="color:#8f5902;font-style:italic"># Same as above, but with Python as the target language</span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">`</span>-- python
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>-- CMakeLists.txt
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>-- Makefile
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>-- cmake
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- vcs.cmake
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>   <span style="color:#4e9a06">`</span>-- verilator.cmake
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>-- dut.i <span style="color:#8f5902;font-style:italic"># SWIG configuration file for exporting libDPIAdder.so’s base class and function declarations to Python, enabling Python calls</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">`</span>-- dut.py <span style="color:#8f5902;font-style:italic"># Generated Python UT wrapper, including calls to libDPIAdder.so, and UTAdder class declaration and implementation, equivalent to libUTAdder.so</span>
</span></span></code></pre></div><h4 id="building-intermediate-files">Building Intermediate Files</h4>
<p>Navigate to the <code>picker_out_adder</code> directory and execute the <code>make</code> command to generate the final files.</p>
<blockquote>
<p>Use the simulator invocation script defined by <code>cmake/*.cmake</code> to compile <code>Adder_top.sv</code> and related files into the <code>libDPIAdder.so</code> dynamic library.Use the compilation script defined by <code>CMakeLists.txt</code> to wrap <code>libDPIAdder.so</code> into the <code>libUTAdder.so</code> dynamic library through <code>dut_base.cpp</code>. Both outputs from steps 1 and 2 are copied to the <code>UT_Adder</code> directory.Generate the wrapper layer using the <code>SWIG</code> tool with <code>dut_base.hpp</code> and <code>dut.hpp</code> header files, and finally build a Python module in the <code>UT_Adder</code> directory.If the <code>-e</code> parameter is included, the pre-defined <code>example.py</code> is placed in the parent directory of the <code>UT_Adder</code> directory as a sample code for calling this Python module.
The final directory structure is:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- Adder.fst <span style="color:#8f5902;font-style:italic"># Waveform file for testing</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- UT_Adder
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- Adder.fst.hier
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- _UT_Adder.so <span style="color:#8f5902;font-style:italic"># Wrapper dynamic library generated by SWIG</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- __init__.py <span style="color:#8f5902;font-style:italic"># Python module initialization file, also the library definition file</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- libDPIAdder.a <span style="color:#8f5902;font-style:italic"># Library file generated by the simulator</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- libUTAdder.so <span style="color:#8f5902;font-style:italic"># DPI dynamic library wrapper generated based on dut_base</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#4e9a06">`</span>-- libUT_Adder.py <span style="color:#8f5902;font-style:italic"># Python module generated by SWIG</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#4e9a06">`</span>-- xspcomm <span style="color:#8f5902;font-style:italic"># Base library folder, no need to pay attention to this</span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">`</span>-- example.py <span style="color:#8f5902;font-style:italic"># Sample code</span>
</span></span></code></pre></div><h3 id="setting-up-test-code">Setting Up Test Code</h3>
<blockquote>
<p>Replace the content in <code>example.py</code> with the following Python test code.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_Adder</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">random</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Generate unsigned random numbers</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">random_int</span><span style="color:#000;font-weight:bold">():</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">randint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">63</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">63</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#0000cf;font-weight:bold">63</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Reference model for the adder implemented in Python</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">reference_adder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">sum</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#0000cf;font-weight:bold">64</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">carry</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">sum</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">a</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">sum</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">carry</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">carry</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#204a87">sum</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">carry</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">random_test</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Create DUT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># By default, pin assignments do not write immediately but write on the next clock rising edge, which is suitable for sequential circuits. However, since the Adder is a combinational circuit, we need to write immediately</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Therefore, the AsImmWrite() method is called to change pin assignment behavior</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">AsImmWrite</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">AsImmWrite</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">AsImmWrite</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Loop test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span> <span style="color:#0000cf;font-weight:bold">114514</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random_int</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">random_int</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">random_int</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># DUT: Assign values to Adder circuit pins, then drive the combinational circuit (for sequential circuits or waveform viewing, use dut.Step() to drive)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">RefreshComb</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Reference model: Calculate results</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ref_sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ref_cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">reference_adder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Check results</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">ref_sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;sum mismatch: 0x</span><span style="color:#4e9a06">{dut.sum.value:x}</span><span style="color:#4e9a06"> != 0x</span><span style="color:#4e9a06">{ref_sum:x}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">ref_cout</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;cout mismatch: 0x</span><span style="color:#4e9a06">{dut.cout.value:x}</span><span style="color:#4e9a06"> != 0x</span><span style="color:#4e9a06">{ref_cout:x}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;[test </span><span style="color:#4e9a06">{</span><span style="color:#000">i</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">] a=0x</span><span style="color:#4e9a06">{</span><span style="color:#000">a</span><span style="color:#4e9a06">:</span><span style="color:#4e9a06">x</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">, b=0x</span><span style="color:#4e9a06">{</span><span style="color:#000">b</span><span style="color:#4e9a06">:</span><span style="color:#4e9a06">x</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">, cin=0x</span><span style="color:#4e9a06">{</span><span style="color:#000">cin</span><span style="color:#4e9a06">:</span><span style="color:#4e9a06">x</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> =&gt; sum: 0x</span><span style="color:#4e9a06">{</span><span style="color:#000">ref_sum</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">, cout: 0x</span><span style="color:#4e9a06">{</span><span style="color:#000">ref_cout</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Test complete</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Finish</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Test Passed&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;__main__&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">random_test</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><h3 id="running-the-test">Running the Test</h3>
<p>In the <code>picker_out_adder</code> directory, execute the <code>python3 example.py</code> command to run the test. After the test is complete, we can see the output of the example project.</p>
<pre tabindex="0"><code>[...]
[test 114507] a=0x7adc43f36682cffe, b=0x30a718d8cf3cc3b1, cin=0x0 =&gt; sum: 0x12358823834579604399, cout: 0x0
[test 114508] a=0x3eb778d6097e3a72, b=0x1ce6af17b4e9128, cin=0x0 =&gt; sum: 0x4649372636395916186, cout: 0x0
[test 114509] a=0x42d6f3290b18d4e9, b=0x23e4926ef419b4aa, cin=0x1 =&gt; sum: 0x7402657300381600148, cout: 0x0
[test 114510] a=0x505046adecabcc, b=0x6d1d4998ed457b06, cin=0x0 =&gt; sum: 0x7885127708256118482, cout: 0x0
[test 114511] a=0x16bb10f22bd0af50, b=0x5813373e1759387, cin=0x1 =&gt; sum: 0x2034576336764682968, cout: 0x0
[test 114512] a=0xc46c9f4aa798106, b=0x4d8f52637f0417c4, cin=0x0 =&gt; sum: 0x6473392679370463434, cout: 0x0
[test 114513] a=0x3b5387ba95a7ac39, b=0x1a378f2d11b38412, cin=0x0 =&gt; sum: 0x6164045699187683403, cout: 0x0
Test Passed
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c05bb6c77ec711a62c2f3e22fed11380">1.3 - Case 2: Random Number Generator</h1>
    <div class="lead">Demonstrating the tool usage with a 16-bit LFSR random number generator, which includes a clock signal, sequential logic, and registers.</div>
	<h2 id="rtl-source-code">RTL Source Code</h2>
<p>In this example, we drive a random number generator, with the source code as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">module</span> <span style="color:#000">RandomGenerator</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#204a87;font-weight:bold">wire</span> <span style="color:#000">clk</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#204a87;font-weight:bold">wire</span> <span style="color:#000">reset</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">seed</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">random_number</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">reg</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">lfsr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">always</span> <span style="color:#000;font-weight:bold">@(</span><span style="color:#204a87;font-weight:bold">posedge</span> <span style="color:#000">clk</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#204a87;font-weight:bold">posedge</span> <span style="color:#000">reset</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">reset</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">lfsr</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">seed</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">end</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">lfsr</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#000">lfsr</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">14</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">lfsr</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">^</span> <span style="color:#000">lfsr</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">14</span><span style="color:#000;font-weight:bold">]};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000">random_number</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">lfsr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">endmodule</span>
</span></span></code></pre></div><p>This random number generator contains a 16-bit LFSR, with a 16-bit seed as input and a 16-bit random number as output. The LFSR is updated according to the following rules:</p>
<ol>
<li>
<p>XOR the highest bit and the second-highest bit of the current LFSR to generate a <code>new_bit</code>.</p>
</li>
<li>
<p>Shift the original LFSR left by one bit, and place <code>new_bit</code> in the lowest bit.</p>
</li>
<li>
<p>Discard the highest bit.</p>
</li>
</ol>
<h2 id="testing-process">Testing Process</h2>
<p>During testing, we will create a folder named <code>RandomGenerator</code>, which contains a <code>RandomGenerator.v</code> file. The content of this file is the RTL source code mentioned above.</p>
<h3 id="building-the-rtl-into-a-python-module">Building the RTL into a Python Module</h3>
<h4 id="generating-intermediate-files">Generating Intermediate Files</h4>
<p>Navigate to the <code>RandomGenerator</code> folder and execute the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>picker <span style="color:#204a87">export</span> --autobuild<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> RandomGenerator.v -w RandomGenerator.fst --sname RandomGenerator --tdir picker_out_rmg --lang python -e --sim verilator
</span></span></code></pre></div><p>This command does the following:</p>
<ol>
<li>
<p>Uses <code>RandomGenerator.v</code> as the top file and <code>RandomGenerator</code> as the top module, generating a dynamic library with the Verilator simulator, targeting Python as the output language.</p>
</li>
<li>
<p>Enables waveform output, with the target waveform file being <code>RandomGenerator.fst</code>.</p>
</li>
<li>
<p>Includes files for driving the example project (<code>-e</code>), and does not automatically compile after code generation (<code>-autobuild=false</code>).</p>
</li>
<li>
<p>Outputs the final files to the <code>picker_out_rmg</code> directory.
The output directory structure is similar to <a href="https://chatgpt.com/docs/quick-start/eg-adder/#generating-intermediate-files">Adder Verification - Generating Intermediate Files</a> , so it will not be elaborated here.</p>
</li>
</ol>
<h4 id="building-intermediate-files">Building Intermediate Files</h4>
<p>Navigate to the <code>picker_out_rmg</code> directory and execute the <code>make</code> command to generate the final files.</p>
<blockquote>
<p>Note: The compilation process is similar to <a href="https://chatgpt.com/docs/quick-start/eg-adder/#building-intermediate-files">Adder Verification - Compilation Process</a> , so it will not be elaborated here.
The final directory structure will be:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>picker_out_rmg
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- RandomGenerator.fst <span style="color:#8f5902;font-style:italic"># Waveform file from the test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>-- UT_RandomGenerator
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- RandomGenerator.fst.hier
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- _UT_RandomGenerator.so <span style="color:#8f5902;font-style:italic"># Swig-generated wrapper dynamic library</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- __init__.py  <span style="color:#8f5902;font-style:italic"># Initialization file for the Python module, also the library definition file</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- libDPIRandomGenerator.a <span style="color:#8f5902;font-style:italic"># Library file generated by the simulator</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- libUTRandomGenerator.so <span style="color:#8f5902;font-style:italic"># libDPI dynamic library wrapper generated based on dut_base</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#4e9a06">`</span>-- libUT_RandomGenerator.py <span style="color:#8f5902;font-style:italic"># Python module generated by Swig</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>   <span style="color:#4e9a06">`</span>-- xspcomm  <span style="color:#8f5902;font-style:italic"># xspcomm base library, fixed folder, no need to pay attention to it</span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">`</span>-- example.py <span style="color:#8f5902;font-style:italic"># Example code</span>
</span></span></code></pre></div><h3 id="configuring-the-test-code">Configuring the Test Code</h3>
<blockquote>
<p>Replace the content of <code>example.py</code> with the following code.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_RandomGenerator</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">random</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Define the reference model</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">LFSR_16</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">seed</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">state</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">seed</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#0000cf;font-weight:bold">16</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">new_bit</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">state</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">^</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">state</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#0000cf;font-weight:bold">14</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">state</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">state</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">new_bit</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#0000cf;font-weight:bold">16</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;__main__&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTRandomGenerator</span><span style="color:#000;font-weight:bold">()</span>            <span style="color:#8f5902;font-style:italic"># Create the DUT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">InitClock</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;clk&#34;</span><span style="color:#000;font-weight:bold">)</span>                  <span style="color:#8f5902;font-style:italic"># Specify the clock pin and initialize the clock</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">seed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">randint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">16</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>   <span style="color:#8f5902;font-style:italic"># Generate a random seed</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">seed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">seed</span>                 <span style="color:#8f5902;font-style:italic"># Set the DUT seed</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ref</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LFSR_16</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">seed</span><span style="color:#000;font-weight:bold">)</span>                   <span style="color:#8f5902;font-style:italic"># Create a reference model for comparison</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Reset the DUT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">reset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>                   <span style="color:#8f5902;font-style:italic"># Set reset signal to 1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">()</span>                            <span style="color:#8f5902;font-style:italic"># Advance one clock cycle (DUTRandomGenerator is a sequential circuit, it requires advancing via Step)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">reset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>                   <span style="color:#8f5902;font-style:italic"># Set reset signal to 0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">()</span>                            <span style="color:#8f5902;font-style:italic"># Advance one clock cycle</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">65536</span><span style="color:#000;font-weight:bold">):</span>                <span style="color:#8f5902;font-style:italic"># Loop 65536 times</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">()</span>                        <span style="color:#8f5902;font-style:italic"># Advance one clock cycle for the DUT, generating a random number</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ref</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">()</span>                        <span style="color:#8f5902;font-style:italic"># Advance one clock cycle for the reference model, generating a random number</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">random_number</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">ref</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">state</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Mismatch&#34;</span>  <span style="color:#8f5902;font-style:italic"># Compare the random numbers generated by the DUT and the reference model</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;Cycle </span><span style="color:#4e9a06">{</span><span style="color:#000">i</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">, DUT: </span><span style="color:#4e9a06">{</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">random_number</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#4e9a06">:</span><span style="color:#4e9a06">x</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">, REF: </span><span style="color:#4e9a06">{</span><span style="color:#000">ref</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">state</span><span style="color:#4e9a06">:</span><span style="color:#4e9a06">x</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># Print the results</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Complete the test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Test Passed&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Finish</span><span style="color:#000;font-weight:bold">()</span>    <span style="color:#8f5902;font-style:italic"># Finish function will complete the writing of waveform, coverage, and other files</span>
</span></span></code></pre></div><h3 id="running-the-test-program">Running the Test Program</h3>
<p>Execute <code>python example.py</code> in the <code>picker_out_rmg</code> directory to run the test program. After the execution, if <code>Test Passed</code> is output, the test is considered passed. After the run is complete, a waveform file <code>RandomGenerator.fst</code> will be generated, which can be viewed in the terminal using the following command:</p>
<blockquote>
<p>gtkwave RandomGenerator.fst
Example output:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>···
</span></span><span style="display:flex;"><span>Cycle 65529, DUT: d9ea, REF: d9ea
</span></span><span style="display:flex;"><span>Cycle 65530, DUT: b3d4, REF: b3d4
</span></span><span style="display:flex;"><span>Cycle 65531, DUT: 67a9, REF: 67a9
</span></span><span style="display:flex;"><span>Cycle 65532, DUT: cf53, REF: cf53
</span></span><span style="display:flex;"><span>Cycle 65533, DUT: 9ea6, REF: 9ea6
</span></span><span style="display:flex;"><span>Cycle 65534, DUT: 3d4d, REF: 3d4d
</span></span><span style="display:flex;"><span>Cycle 65535, DUT: 7a9a, REF: 7a9a
</span></span><span style="display:flex;"><span>Test Passed, destroy UT_RandomGenerator
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8754821d205ce3dd872f355001bd1199">1.4 - Case 3: Dual-Port Stack (Callback)</h1>
    <div class="lead">A dual-port stack is a stack with two ports, each supporting push and pop operations. This case study uses a dual-port stack as an example to demonstrate how to use callback functions to drive the DUT.</div>
	<h2 id="introduction-to-the-dual-port-stack">Introduction to the Dual-Port Stack</h2>
<p>A dual-port stack is a data structure that supports simultaneous operations on two ports. Compared to a traditional single-port stack, a dual-port stack allows simultaneous read and write operations. In scenarios such as multithreaded concurrent read and write operations, the dual-port stack can provide better performance. In this example, we provide a simple dual-port stack implementation, with the source code as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">module</span> <span style="color:#000">dual_port_stack</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000">clk</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000">rst</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Interface 0
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000">in0_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000">in0_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">in0_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">in0_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000">out0_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000">out0_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">out0_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">out0_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Interface 1
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000">in1_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000">in1_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">in1_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">in1_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000">out1_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#000">out1_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">out1_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">out1_cmd</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Command definitions
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">localparam</span> <span style="color:#000">CMD_PUSH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#0000cf;font-weight:bold">&#39;b00</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">localparam</span> <span style="color:#000">CMD_POP</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#0000cf;font-weight:bold">&#39;b01</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">localparam</span> <span style="color:#000">CMD_PUSH_OKAY</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#0000cf;font-weight:bold">&#39;b10</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">localparam</span> <span style="color:#000">CMD_POP_OKAY</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#0000cf;font-weight:bold">&#39;b11</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Stack memory and pointer
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">reg</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">stack_mem</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">255</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">reg</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">sp</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">reg</span> <span style="color:#000">busy</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">reg</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">out0_data_reg</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">out1_data_reg</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">reg</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">out0_cmd_reg</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">out1_cmd_reg</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">reg</span> <span style="color:#000">out0_valid_reg</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">out1_valid_reg</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000">out0_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">out0_data_reg</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000">out0_cmd</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">out0_cmd_reg</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000">out0_valid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">out0_valid_reg</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000">out1_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">out1_data_reg</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000">out1_cmd</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">out1_cmd_reg</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000">out1_valid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">out1_valid_reg</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">always</span> <span style="color:#000;font-weight:bold">@(</span><span style="color:#204a87;font-weight:bold">posedge</span> <span style="color:#000">clk</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#204a87;font-weight:bold">posedge</span> <span style="color:#000">rst</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">rst</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">end</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">// Interface 0 Request Handling
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">in0_valid</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">in0_ready</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">case</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">in0_cmd</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f57900">CMD_PUSH:</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out0_valid_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">stack_mem</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">sp</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">in0_data</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out0_cmd_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">CMD_PUSH_OKAY</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f57900">CMD_POP:</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out0_valid_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out0_data_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">stack_mem</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out0_cmd_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">CMD_POP_OKAY</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">default</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out0_valid_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">endcase</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">// Interface 1 Request Handling
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">in1_valid</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">in1_ready</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">case</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">in1_cmd</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f57900">CMD_PUSH:</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out1_valid_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">stack_mem</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">sp</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">in1_data</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out1_cmd_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">CMD_PUSH_OKAY</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f57900">CMD_POP:</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out1_valid_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out1_data_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">stack_mem</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out1_cmd_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">CMD_POP_OKAY</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">default</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">out1_valid_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">endcase</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">// Interface 0 Response Handling
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">out0_ready</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">out0_valid_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">// Interface 1 Response Handling
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">out1_ready</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">out1_valid_reg</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000">in0_ready</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">in0_cmd</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">CMD_PUSH</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">255</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">in0_cmd</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">CMD_POP</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">busy</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000">in1_ready</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">in1_cmd</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">CMD_PUSH</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">255</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">in1_cmd</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">CMD_POP</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">sp</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">busy</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">in0_ready</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">in0_valid</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">endmodule</span>
</span></span></code></pre></div><p>In this implementation, aside from the clock signal (<code>clk</code>) and reset signal (<code>rst</code>), there are also input and output signals for the two ports, which have the same interface definition. The meaning of each signal for the ports is as follows:</p>
<ul>
<li>
<p>Request Port (in)</p>
<ul>
<li>
<p><code>in_valid</code>: Input data valid signal</p>
</li>
<li>
<p><code>in_ready</code>: Input data ready signal</p>
</li>
<li>
<p><code>in_data</code>: Input data</p>
</li>
<li>
<p><code>in_cmd</code>: Input command (0: PUSH, 1: POP)</p>
</li>
</ul>
</li>
<li>
<p>Response Port (out)</p>
<ul>
<li>
<p><code>out_valid</code>: Output data valid signal</p>
</li>
<li>
<p><code>out_ready</code>: Output data ready signal</p>
</li>
<li>
<p><code>out_data</code>: Output data</p>
</li>
<li>
<p><code>out_cmd</code>: Output command (2: PUSH_OKAY, 3: POP_OKAY)</p>
</li>
</ul>
</li>
</ul>
<p>When we want to perform an operation on the stack through a port, we first need to write the required data and command to the input port, and then wait for the output port to return the result.
Specifically, if we want to perform a PUSH operation on the stack, we should first write the data to be pushed into <code>in_data</code>, then set <code>in_cmd</code> to 0, indicating a PUSH operation, and set <code>in_valid</code> to 1, indicating that the input data is valid. Next, we need to wait for <code>in_ready</code> to be 1, ensuring that the data has been correctly received, at which point the PUSH request has been correctly sent.After the command is successfully sent, we need to wait for the stack&rsquo;s response information on the response port. When <code>out_valid</code> is 1, it indicates that the stack has completed the corresponding operation. At this point, we can read the stack&rsquo;s returned data from <code>out_data</code> (the returned data of the POP operation will be placed here) and read the stack&rsquo;s returned command from <code>out_cmd</code>. After reading the data, we need to set <code>out_ready</code> to 1 to notify the stack that the returned information has been correctly received.
If requests from both ports are valid simultaneously, the stack will prioritize processing requests from port 0.</p>
<h2 id="setting-up-the-driver-environment">Setting Up the Driver Environment</h2>
<p>Similar to Case Study 1 and Case Study 2, before testing the dual-port stack, we first need to use the Picker tool to build the RTL code into a Python Module. After the build is complete, we will use a Python script to drive the RTL code for testing.
First, create a file named <code>dual_port_stack.v</code> and copy the above RTL code into this file. Then, execute the following command in the same folder:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>picker <span style="color:#204a87">export</span> --autobuild<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> dual_port_stack.v -w dual_port_stack.fst --sname dual_port_stack --tdir picker_out_dual_port_stack --lang python -e --sim verilator
</span></span></code></pre></div><p>The generated driver environment is located in the <code>picker_out_dual_port_stack</code> folder. Inside, <code>UT_dual_port_stack</code> is the generated Python Module, and <code>example.py</code> is the test script.
You can run the test script with the following commands:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> picker_out_dual_port_stack
</span></span><span style="display:flex;"><span>python3 example.py
</span></span></code></pre></div><p>If no errors occur during the run, it means the environment has been set up correctly.</p>
<h2 id="driving-the-dut-with-coroutines">Driving the DUT with Coroutines</h2>
<h2 id="driving-the-dut-with-callback-functions">Driving the DUT with Callback Functions</h2>
<p>In this case, we need to drive a dual-port stack to test its functionality. However, you may quickly realize that the methods used in Cases 1 and 2 are insufficient for driving a dual-port stack. In the previous tests, the DUT had a single execution logic where you input data into the DUT and wait for the output.</p>
<p>However, a dual-port stack is different because its two ports operate with independent execution logic. During the drive process, these two ports might be in entirely different states. For example, while port 0 is waiting for data from the DUT, port 1 might be sending a new request. In such situations, simple sequential execution logic will struggle to drive the DUT effectively.</p>
<p>Therefore, in this case, we will use the dual-port stack as an example to introduce a callback function-based driving method to handle such DUTs.</p>
<h3 id="introduction-to-callback-functions">Introduction to Callback Functions</h3>
<p>A callback function is a common programming technique that allows us to pass a function as an argument, which is then called when a certain condition is met. In the generated Python Module, we provide an interface <code>StepRis</code> for registering callback functions with the internal execution environment. Here&rsquo;s how it works:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_dual_port_stack</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">DUTdual_port_stack</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">callback</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cycles</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;The current clock cycle is </span><span style="color:#4e9a06">{</span><span style="color:#000">cycles</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTdual_port_stack</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">StepRis</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">callback</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>You can run this code directly to see the effect of the callback function.
In the above code, we define a callback function <code>callback</code> that takes a <code>cycles</code> parameter and prints the current clock cycle each time it is called. We then register this callback function to the DUT via <code>StepRis</code>.Once the callback function is registered, each time the <code>Step</code> function is run, which corresponds to each clock cycle, the callback function is invoked on the rising edge of the clock signal, with the current clock cycle passed as an argument.
Using this approach, we can write different execution logics as callback functions and register multiple callback functions to the DUT, thereby achieving parallel driving of the DUT.</p>
<h3 id="dual-port-stack-driven-by-callback-functions">Dual-Port Stack Driven by Callback Functions</h3>
<p>To complete a full execution logic using callback functions, we typically write it in the form of a state machine. Each callback function invocation triggers a state change within the state machine, and multiple invocations complete a full execution logic.</p>
<p>Below is an example code for driving a dual-port stack using callback functions:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">random</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_dual_port_stack</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">enum</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Enum</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">StackModel</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stack</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">commit_push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;push&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">commit_pop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut_data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Pop&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut_data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">model_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">model_data</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">dut_data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;The model data </span><span style="color:#4e9a06">{</span><span style="color:#000">model_data</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> is not equal to the dut data </span><span style="color:#4e9a06">{</span><span style="color:#000">dut_data</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;Pass: </span><span style="color:#4e9a06">{</span><span style="color:#000">model_data</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> == </span><span style="color:#4e9a06">{</span><span style="color:#000">dut_data</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">SinglePortDriver</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Status</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Enum</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">IDLE</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">WAIT_REQ_READY</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">WAIT_RESP_VALID</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">BusCMD</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Enum</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">PUSH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">POP</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">PUSH_OKAY</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">POP_OKAY</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">model</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">StackModel</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dut</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">model</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">port_dict</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Status</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">IDLE</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">operation_num</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">remaining_delay</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_valid&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_cmd&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">BusCMD</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">PUSH</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_data&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">randint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">32</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">pop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_valid&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_cmd&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">BusCMD</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">POP</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">step_callback</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cycle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Status</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">WAIT_REQ_READY</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_ready&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_valid&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>                <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;out_ready&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Status</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">WAIT_RESP_VALID</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_cmd&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">BusCMD</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">PUSH</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">commit_push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_data&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">elif</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Status</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">WAIT_RESP_VALID</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;out_valid&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;out_ready&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>                <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Status</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">IDLE</span>
</span></span><span style="display:flex;"><span>                <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">remaining_delay</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">randint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;out_cmd&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">BusCMD</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">POP_OKAY</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">commit_pop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;out_data&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Status</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">IDLE</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">remaining_delay</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">operation_num</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">elif</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">operation_num</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">operation_num</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Status</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">WAIT_REQ_READY</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">remaining_delay</span> <span style="color:#ce5c00;font-weight:bold">-=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_stack</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stack</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StackModel</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">port0</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SinglePortDriver</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stack</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">model</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_valid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in0_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_ready&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in0_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in0_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_cmd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in0_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_valid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out0_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_ready&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out0_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out0_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_cmd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out0_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">port1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SinglePortDriver</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stack</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">model</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_valid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in1_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_ready&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in1_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in1_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_cmd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in1_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_valid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out1_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_ready&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out1_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out1_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_cmd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out1_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">StepRis</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">port0</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">step_callback</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">StepRis</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">port1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">step_callback</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">200</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;__main__&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTdual_port_stack</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">InitClock</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;clk&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">test_stack</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Finish</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>In the code above, the driving process is implemented such that each port independently drives the DUT, with a random delay added after each request is completed. Each port performs 10 <code>PUSH</code> operations and 10 <code>POP</code> operations.When a <code>PUSH</code> or <code>POP</code> request takes effect, the corresponding <code>commit_push</code> or <code>commit_pop</code> function in the <code>StackModel</code> is called to simulate stack behavior. After each <code>POP</code> operation, the data returned by the DUT is compared with the model&rsquo;s data to ensure consistency.To implement the driving behavior for a single port, we created the <code>SinglePortDriver</code> class, which includes a method for sending and receiving data. The <code>step_callback</code> function handles the internal update logic.In the <code>test_stack</code> function, we create a <code>SinglePortDriver</code> instance for each port of the dual-port stack, pass the corresponding interfaces, and register the callback function to the DUT using the <code>StepRis</code> function. When <code>dut.Step(200)</code> is called, the callback function is automatically invoked each clock cycle to complete the entire driving logic.<strong>SinglePortDriver Driving Logic</strong> As mentioned earlier, callback functions typically require the execution logic to be implemented as a state machine. Therefore, in the <code>SinglePortDriver</code> class, the status of each port is recorded, including:</p>
<ul>
<li>
<p><code>IDLE</code>: Idle state, waiting for the next operation.</p>
<ul>
<li>
<p>In the idle state, check the <code>remaining_delay</code> status to determine whether the current delay has ended. If the delay has ended, proceed with the next operation; otherwise, continue waiting.</p>
</li>
<li>
<p>When the next operation is ready, check the <code>operation_num</code> status (the number of operations already performed) to determine whether the next operation should be <code>PUSH</code> or <code>POP</code>. Then, call the corresponding function to assign values to the port and switch the status to <code>WAIT_REQ_READY</code>.</p>
</li>
</ul>
</li>
<li>
<p><code>WAIT_REQ_READY</code>: Waiting for the request port to be ready.</p>
<ul>
<li>
<p>After the request is sent (<code>in_valid</code> is valid), wait for the <code>in_ready</code> signal to be valid to ensure the request has been correctly received.</p>
</li>
<li>
<p>Once the request is correctly received, set <code>in_valid</code> to 0 and <code>out_ready</code> to 1, indicating the request is complete and ready to receive a response.</p>
</li>
</ul>
</li>
<li>
<p><code>WAIT_RESP_VALID</code>: Waiting for the response port to return data.</p>
<ul>
<li>After the request is correctly received, wait for the DUT&rsquo;s response, i.e., wait for the <code>out_valid</code> signal to be valid. When the <code>out_valid</code> signal is valid, it indicates that the response has been generated and the request is complete. Set <code>out_ready</code> to 0 and switch the status to <code>IDLE</code>.</li>
</ul>
</li>
</ul>
<h3 id="running-the-test">Running the Test</h3>
<p>Copy the above code into <code>example.py</code>, and then run the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> picker_out_dual_port_stack
</span></span><span style="display:flex;"><span>python3 example.py
</span></span></code></pre></div><p>You can run the test code for this case directly, and you will see output similar to the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>push <span style="color:#0000cf;font-weight:bold">77</span>
</span></span><span style="display:flex;"><span>push <span style="color:#0000cf;font-weight:bold">140</span>
</span></span><span style="display:flex;"><span>push <span style="color:#0000cf;font-weight:bold">249</span>
</span></span><span style="display:flex;"><span>push <span style="color:#0000cf;font-weight:bold">68</span>
</span></span><span style="display:flex;"><span>push <span style="color:#0000cf;font-weight:bold">104</span>
</span></span><span style="display:flex;"><span>push <span style="color:#0000cf;font-weight:bold">222</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">43</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">43</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">43</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">211</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">211</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">211</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">16</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">16</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">16</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">255</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">255</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">255</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">222</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">222</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">222</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">104</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>In the output, you can see the data for each <code>PUSH</code> and <code>POP</code> operation, as well as the result of each <code>POP</code> operation. If there is no error message in the output, it indicates that the test has passed.</p>
<h2 id="pros-and-cons-of-callback-driven-design">Pros and Cons of Callback-Driven Design</h2>
<p>By using callbacks, we can achieve parallel driving of the DUT, as demonstrated in this example. We utilized two callbacks to drive two ports with independent execution logic. In simple scenarios, callbacks offer a straightforward method for parallel driving.</p>
<p>However, as shown in this example, even implementing a simple &ldquo;request-response&rdquo; flow requires maintaining a significant amount of internal state. Callbacks break down what should be a cohesive execution logic into multiple function calls, adding considerable complexity to both the code writing and debugging processes.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8b6f24fda4c11d593a6c671bbe7427ce">1.5 - Case 4: Dual-Port Stack (Coroutines)</h1>
    <div class="lead">The dual-port stack is a stack with two ports, each supporting push and pop operations. This case study uses the dual-port stack as an example to demonstrate how to drive a DUT using coroutines.</div>
	<h2 id="introduction-to-the-dual-port-stack-and-environment-setup">Introduction to the Dual-Port Stack and Environment Setup</h2>
<p>The dual-port stack used in this case is identical to the one implemented in Case 3. Please refer to the <a href="https://chatgpt.com/eg-stack-callback#%E5%8F%8C%E7%AB%AF%E5%8F%A3%E6%A0%88%E7%AE%80%E4%BB%8B">Introduction to the Dual-Port Stack</a>  and <a href="https://chatgpt.com/eg-stack-callback#%E6%9E%84%E5%BB%BA%E9%A9%B1%E5%8A%A8%E7%8E%AF%E5%A2%83">Driver Environment Setup</a>  in Case 3 for more details.</p>
<h2 id="driving-the-dut-using-coroutines">Driving the DUT Using Coroutines</h2>
<p>In Case 3, we used callbacks to drive the DUT. While callbacks offer a way to perform parallel operations, they break the execution flow into multiple function calls and require maintaining a large amount of intermediate state, making the code more complex to write and debug.</p>
<p>In this case, we will introduce a method of driving the DUT using coroutines. This method not only allows for parallel operations but also avoids the issues associated with callbacks.</p>
<h3 id="introduction-to-coroutines">Introduction to Coroutines</h3>
<p>Coroutines are a form of &ldquo;lightweight&rdquo; threading that enables behavior similar to concurrent execution without the overhead of traditional threads. Coroutines operate on a single-threaded event loop, where multiple coroutines can be defined and added to the event loop, with the event loop managing their scheduling.</p>
<p>Typically, a defined coroutine will continue to execute until it encounters an event that requires waiting. At this point, the event loop pauses the coroutine and schedules other coroutines to run. Once the event occurs, the event loop resumes the paused coroutine to continue execution.</p>
<p>For parallel execution in hardware verification, this behavior is precisely what we need. We can create multiple coroutines to handle various verification tasks. We can treat the clock execution as an event, and within each coroutine, wait for this event. When the clock signal arrives, the event loop wakes up all the waiting coroutines, allowing them to continue executing until they wait for the next clock signal.
We use Python&rsquo;s <code>asyncio</code> to implement coroutine support:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">asyncio</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_dual_port_stack</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">my_coro</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">name</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">{</span><span style="color:#000">name</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">: </span><span style="color:#4e9a06">{</span><span style="color:#000">i</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">AStep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_dut</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_task</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">my_coro</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;coroutine 1&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_task</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">my_coro</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;coroutine 2&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_task</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">RunStep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTdual_port_stack</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">InitClock</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;clk&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">test_dut</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Finish</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>You can run the above code directly to observe the execution of coroutines. In the code, we use <code>create_task</code> to create two coroutine tasks and add them to the event loop. Each coroutine task continuously prints a number and waits for the next clock signal.We use <code>dut.RunStep(10)</code> to create a background clock, which continuously generates clock synchronization signals, allowing other coroutines to continue execution when the clock signal arrives.</p>
<h3 id="driving-the-dual-port-stack-with-coroutines">Driving the Dual-Port Stack with Coroutines</h3>
<p>Using coroutines, we can write the logic for driving each port of the dual-port stack as an independent execution flow without needing to maintain a large amount of intermediate state.</p>
<p>Below is a simple verification code using coroutines:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">asyncio</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">random</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_dual_port_stack</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">enum</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Enum</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">StackModel</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stack</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">commit_push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Push&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">commit_pop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut_data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Pop&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut_data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">model_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">model_data</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">dut_data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;The model data </span><span style="color:#4e9a06">{</span><span style="color:#000">model_data</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> is not equal to the dut data </span><span style="color:#4e9a06">{</span><span style="color:#000">dut_data</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;Pass: </span><span style="color:#4e9a06">{</span><span style="color:#000">model_data</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> == </span><span style="color:#4e9a06">{</span><span style="color:#000">dut_data</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">SinglePortDriver</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">BusCMD</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Enum</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">PUSH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">POP</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">PUSH_OKAY</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">POP_OKAY</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">model</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">StackModel</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dut</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">model</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">port_dict</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">send_req</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">is_push</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_valid&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_cmd&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">BusCMD</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">PUSH</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">is_push</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">BusCMD</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">POP</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_data&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">randint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">AStep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Acondition</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_ready&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_valid&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">is_push</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">commit_push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;in_data&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">receive_resp</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;out_ready&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">AStep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Acondition</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;out_valid&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;out_ready&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;out_cmd&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">BusCMD</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">POP_OKAY</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">commit_pop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_dict</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;out_data&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">exec_once</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">is_push</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">send_req</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">is_push</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">receive_resp</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">randint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">AStep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exec_once</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">is_push</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exec_once</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">is_push</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_stack</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stack</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StackModel</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">port0</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SinglePortDriver</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stack</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">model</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_valid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in0_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_ready&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in0_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in0_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_cmd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in0_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_valid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out0_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_ready&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out0_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out0_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_cmd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out0_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">port1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SinglePortDriver</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stack</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">model</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_valid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in1_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_ready&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in1_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in1_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;in_cmd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">in1_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_valid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out1_valid</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_ready&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out1_ready</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out1_data</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;out_cmd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">out1_cmd</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_task</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">port0</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">main</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_task</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">port1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">main</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_task</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">RunStep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">200</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;__main__&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTdual_port_stack</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">InitClock</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;clk&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">test_stack</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Finish</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>Similar to Case 3, we define a <code>SinglePortDriver</code> class to handle the logic for driving a single port. In the <code>main</code> function, we create two instances of <code>SinglePortDriver</code>, each responsible for driving one of the two ports. We place the driving processes for both ports in the main function and add them to the event loop using <code>asyncio.create_task</code>. Finally, we use <code>dut.RunStep(200)</code> to create a background clock to drive the test.
This code implements the same test logic as in Case 3, where each port performs 10 PUSH and 10 POP operations, followed by a random delay after each operation. As you can see, using coroutines eliminates the need to maintain any intermediate state.
<strong>SinglePortDriver Logic</strong> In the <code>SinglePortDriver</code> class, we encapsulate a single operation into the <code>exec_once</code> function. In the <code>main</code> function, we first call <code>exec_once(is_push=True)</code> 10 times to complete the PUSH operations, and then call <code>exec_once(is_push=False)</code> 10 times to complete the POP operations.In the <code>exec_once</code> function, we first call <code>send_req</code> to send a request, then call <code>receive_resp</code> to receive the response, and finally wait for a random number of clock signals to simulate a delay.The <code>send_req</code> and <code>receive_resp</code> functions have similar logic; they set the corresponding input/output signals to the appropriate values and wait for the corresponding signals to become valid. The implementation can be written according to the execution sequence of the ports.Similarly, we use the <code>StackModel</code> class to simulate stack behavior. The <code>commit_push</code> and <code>commit_pop</code> functions simulate the PUSH and POP operations, respectively, with the POP operation comparing the data.</p>
<h3 id="running-the-test">Running the Test</h3>
<p>Copy the above code into <code>example.py</code> and then execute the following commands:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> picker_out_dual_port_stack
</span></span><span style="display:flex;"><span>python3 example.py
</span></span></code></pre></div><p>You can run the test code for this case directly, and you will see output similar to the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Push <span style="color:#0000cf;font-weight:bold">141</span>
</span></span><span style="display:flex;"><span>Push <span style="color:#0000cf;font-weight:bold">102</span>
</span></span><span style="display:flex;"><span>Push <span style="color:#0000cf;font-weight:bold">63</span>
</span></span><span style="display:flex;"><span>Push <span style="color:#0000cf;font-weight:bold">172</span>
</span></span><span style="display:flex;"><span>Push <span style="color:#0000cf;font-weight:bold">208</span>
</span></span><span style="display:flex;"><span>Push <span style="color:#0000cf;font-weight:bold">130</span>
</span></span><span style="display:flex;"><span>Push <span style="color:#0000cf;font-weight:bold">151</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">102</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">102</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">102</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">138</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">138</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">138</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">56</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">56</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">56</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">153</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">153</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">153</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">129</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">129</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">129</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">235</span>
</span></span><span style="display:flex;"><span>Pass: <span style="color:#000">235</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">235</span>
</span></span><span style="display:flex;"><span>Pop <span style="color:#0000cf;font-weight:bold">151</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>In the output, you can see the data for each <code>PUSH</code> and <code>POP</code> operation, as well as the result of each <code>POP</code> operation. If there are no error messages in the output, it indicates that the test passed.</p>
<h2 id="pros-and-cons-of-coroutine-driven-design">Pros and Cons of Coroutine-Driven Design</h2>
<p>Using coroutine functions, we can effectively achieve parallel operations while avoiding the issues that come with callback functions. Each independent execution flow can be fully retained as a coroutine, which greatly simplifies code writing.</p>
<p>However, in more complex scenarios, you may find that having many coroutines can make synchronization and timing management between them more complicated. This is especially true when you need to synchronize between two coroutines that do not directly interact with the DUT.
At this point, you&rsquo;ll need a set of coroutine writing standards and design patterns for verification code to help you write coroutine-based verification code more effectively. Therefore, we provide the <code>mlvp</code> library, which offers a set of design patterns for coroutine-based verification code. You can learn more about <code>mlvp</code> and how it can help you write better verification code by visiting <a href="https://github.com/XS-MLVP/mlvp">here</a> .</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7351c618ae63b98e5898f0913a6c55f5">2 - Environment Usage</h1>
    <div class="lead">Detailed usage instructions for the Open Verification Platform environment.</div>
	

<div class="pageinfo pageinfo-primary">
<p>This page will briefly introduce what verification is and concepts used in the examples, such as DUT (Design Under Test) and RM (Reference Model).</p>

</div>


</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-ea0963a557e19f6f121695eff48e4632">2.1 - Tool Introduction</h1>
    <div class="lead">Basic usage of the verification tool.</div>
	<p>To meet the requirements of an open verification environment, we have developed the Picker tool, which is used to convert RTL designs into multi-language interfaces for verification. We will use the environment generated by the Picker tool as the basic verification environment. Next, we will introduce the Picker tool and its basic usage.</p>
<h2 id="introduction-to-picker">Introduction to Picker</h2>
<p>Picker is an auxiliary tool for chip verification with two main functions:</p>
<ol>
<li>
<p><strong>Packaging RTL Design Verification Modules:</strong>  Picker can package RTL design verification modules (.v/.scala/.sv) into dynamic libraries and provide programming interfaces in various high-level languages (currently supporting C++, Python, Java, Scala, Golang) to drive the circuit.</p>
</li>
<li>
<p><strong>Automatic UVM-TLM Code Generation:</strong>  Picker can automate TLM code encapsulation based on the UVM sequence_item provided by the user, providing a communication interface between UVM and other high-level languages such as Python.</p>
</li>
</ol>
<p>This tool allows users to perform chip unit testing based on existing software testing frameworks such as pytest, junit, TestNG, go test, etc.
<strong>Advantages of Verification Using Picker:</strong></p>
<ol>
<li>
<p><strong>No RTL Design Leakage:</strong>  After conversion by Picker, the original design files (.v) are transformed into binary files (.so). Verification can still be performed without the original design files, and the verifier cannot access the RTL source code.</p>
</li>
<li>
<p><strong>Reduced Compilation Time:</strong>  When the DUT (Design Under Test) is stable, it only needs to be compiled once (packaged into a .so file).</p>
</li>
<li>
<p><strong>Wide User Base:</strong>  With support for multiple programming interfaces, it caters to developers of various languages.</p>
</li>
<li>
<p><strong>Utilization of a Rich Software Ecosystem:</strong>  Supports ecosystems such as Python3, Java, Golang, etc.</p>
</li>
<li>
<p><strong>Automated UVM Transaction Encapsulation:</strong>  Enables communication between UVM and Python through automated UVM transaction encapsulation.</p>
</li>
</ol>
<p>RTL Simulators Currently Supported by Picker:</p>
<ol>
<li>
<p>Verilator</p>
</li>
<li>
<p>Synopsys VCS
<strong>Working Principle of Picker</strong> The main function of <code>Picker</code> is to convert <code>Verilog</code> code into C++ or Python code. For example, using a processor developed with Chisel: first, it is converted into Verilog code through Chisel&rsquo;s built-in tools, and then Picker provides high-level programming language interfaces.<img alt="Working Principle of Picker" src="Picker_working_principle.svg"></p>
</li>
</ol>
<h2 id="python-module-generation">Python Module Generation</h2>
<h3 id="process-of-module-generation">Process of Module Generation</h3>
<p>Picker exports Python modules based on C++.</p>
<ul>
<li>
<p><strong>Picker is a code generation tool. It first generates project files and then uses make to compile them into binary files.</strong></p>
</li>
<li>
<p>Picker first uses a simulator to compile the RTL code into a C++ class and then compiles it into a dynamic library (see the C++ steps for details).</p>
</li>
<li>
<p>Using the Swig tool, Picker then exports the dynamic library as a Python module based on the C++ header file definitions generated in the previous step.</p>
</li>
<li>
<p>Finally, the generated module is exported to a directory, with other intermediate files being either cleaned up or retained as needed.</p>
</li>
</ul>
<blockquote>
<p>Swig is a tool used to export C/C++ code to other high-level languages. It parses C++ header files and generates corresponding intermediate code.
For detailed information on the generation process, please refer to the <a href="http://www.swig.org/Doc4.2/SWIGDocumentation.html">Swig official documentation</a> .
For information on how Picker generates C++ classes, please refer to <a href="https://chatgpt.com/c/docs/quick-start/multi-lang/cpp">C++</a> .</p>
</blockquote>
<ul>
<li>The generated module can be imported and used by other Python programs, with a file structure similar to that of standard Python modules.</li>
</ul>
<h2 id="using-the-python-module">Using the Python Module</h2>
<ul>
<li>
<p>The <code>--language python</code> or <code>--lang python</code> parameter specifies the generation of the Python base library.</p>
</li>
<li>
<p>The <code>--example, -e</code> parameter generates an executable file containing an example project.</p>
</li>
<li>
<p>The <code>--verbose, -v</code> parameter preserves intermediate files generated during project creation.</p>
</li>
</ul>
<h3 id="using-the-tool-to-generate-pythons-dut-class">Using the Tool to Generate Python&rsquo;s DUT Class</h3>
<p>Using the <a href="https://chatgpt.com/quick-start/eg-adder/">simple adder</a>  example from Case One:</p>
<ul>
<li>Picker automatically generates a base class in Python, referred to as the DUT class. For the adder example, the user needs to write test cases, importing the Python module generated in the previous section and calling its methods to operate on the hardware module. The directory structure is as follows:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>picker_out_adder
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>-- UT_Adder                <span style="color:#8f5902;font-style:italic"># Project generated by Picker tool</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- Adder.fst.hier
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- _UT_Adder.so
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- __init__.py
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- libDPIAdder.a
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>   <span style="color:#000;font-weight:bold">|</span>-- libUTAdder.so
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">|</span>   <span style="color:#4e9a06">`</span>-- libUT_Adder.py
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">`</span>-- example.py              <span style="color:#8f5902;font-style:italic"># User-written code</span>
</span></span></code></pre></div><ul>
<li>The DUTAdder class has a total of eight methods, as shown below:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">InitClock</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">)</span>    <span style="color:#8f5902;font-style:italic"># Initialize clock, with the clock pin name as a parameter, e.g., clk</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>        <span style="color:#8f5902;font-style:italic"># Advance the circuit by i cycles</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">StepRis</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">callback</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Callable</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">kwargs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{})</span>  <span style="color:#8f5902;font-style:italic"># Set rising edge callback function</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">StepFal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">callback</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Callable</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">kwargs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{})</span>  <span style="color:#8f5902;font-style:italic"># Set falling edge callback function</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">SetWaveform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">filename</span><span style="color:#000;font-weight:bold">)</span>   <span style="color:#8f5902;font-style:italic"># Set waveform file</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">SetCoverage</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">filename</span><span style="color:#000;font-weight:bold">)</span>   <span style="color:#8f5902;font-style:italic"># Set code coverage file</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">RefreshComb</span><span style="color:#000;font-weight:bold">()</span>           <span style="color:#8f5902;font-style:italic"># Advance combinational circuit</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Finish</span><span style="color:#000;font-weight:bold">()</span>                <span style="color:#8f5902;font-style:italic"># Destroy the circuit</span>
</span></span></code></pre></div><ul>
<li>Pins corresponding to the DUT, such as reset and clock, are represented as member variables in the DUTAdder class. As shown below, pin values can be read and written via the <code>value</code> attribute.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_Adder</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span> 
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>  <span style="color:#8f5902;font-style:italic"># Assign value to the pin by setting the .value attribute</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>    <span style="color:#8f5902;font-style:italic"># Assign value to the 12th bit of the input pin a</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>  <span style="color:#8f5902;font-style:italic"># Read the value of pin a</span>
</span></span><span style="display:flex;"><span><span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">]</span>    <span style="color:#8f5902;font-style:italic"># Read the 12th bit of pin a</span>
</span></span></code></pre></div><h4 id="general-flow-for-driving-dut">General Flow for Driving DUT</h4>
<ol>
<li>
<p><strong>Create DUT and Set Pin Modes:</strong>  By default, pins are assigned values on the rising edge of the next cycle. For combinational logic, you need to set the assignment mode to immediate assignment.</p>
</li>
<li>
<p><strong>Initialize the Clock:</strong>  This binds the clock pin to the internal <code>xclock</code> of the DUT. Combinational logic does not require a clock and can be ignored.</p>
</li>
<li>
<p><strong>Reset the Circuit:</strong>  Most sequential circuits need to be reset.</p>
</li>
<li>
<p><strong>Write Data to DUT Input Pins:</strong>  Use the <code>pin.Set(x)</code> interface or <code>pin.value = x</code> for assignment.</p>
</li>
<li>
<p><strong>Drive the Circuit:</strong>  Use <code>Step</code> for sequential circuits and <code>RefreshComb</code> for combinational circuits.</p>
</li>
<li>
<p><strong>Obtain and Check Outputs of DUT Pins:</strong>  For example, compare the results with a reference model using assertions.</p>
</li>
<li>
<p><strong>Complete Verification and Destroy DUT:</strong>  Calling <code>Finish()</code> will write waveform, coverage, and other information to files.</p>
</li>
</ol>
<p>The corresponding pseudocode is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_DUT</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 1 Create</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUT</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 2 Initialize</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">SetWaveform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test.fst&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">InitClock</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;clock&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 3 Reset</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">reset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">reset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 4 Input Data</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">input_pin1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0x123123</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">input_pin3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;0b1011&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 5 Drive the Circuit</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 6 Get Results</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">output_pin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;result:&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 7 Destroy</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Finish</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><h3 id="other-data-types">Other Data Types</h3>
<p>In general, most DUT verification tasks can be accomplished using the interfaces provided by the DUT class. However, for special cases, additional interfaces are needed, such as custom clocks, asynchronous operations, advancing combinational circuits and writing waveforms, and modifying pin properties.
In the DUT class generated by Picker, in addition to <strong>XData type pin member variables</strong> , there are also <strong>XClock type xclock</strong>  and <strong>XPort type xport</strong> .</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">xport</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">XPort</span>         <span style="color:#8f5902;font-style:italic"># Member variable xport for managing all pins in the DUT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">xclock</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">XClock</span>       <span style="color:#8f5902;font-style:italic"># Member variable xclock for managing the clock</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># DUT Pins</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">a</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">XData</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">b</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">XData</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">XData</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">cout</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">XData</span>
</span></span></code></pre></div><h4 id="xdata-class">XData Class</h4>
<ul>
<li>Data in DUT pins usually have an uncertain bit width and can be in one of four states: 0, 1, Z, and X. Picker provides <code>XData</code> to represent pin data in the circuit.
<strong>Main Methods</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">XData</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Split XData, for example, create a separate XData for bits 7-10 of a 32-bit XData</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">#  name: Name, start: Start bit, width: Bit width, e.g., auto sub = a.SubDataRef(&#34;sub_pin&#34;, 0, 4)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">SubDataRef</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">start</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">width</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#000">XData</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">GetWriteMode</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#000">WriteMode</span>     <span style="color:#8f5902;font-style:italic"># Get the write mode of XData: Imme (immediate), Rise (rising edge), Fall (falling edge)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">SetWriteMode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mode</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">WriteMode</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># Set the write mode of XData, e.g., a.SetWriteMode(WriteMode::Imme)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">DataValid</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">bool</span>             <span style="color:#8f5902;font-style:italic"># Check if the data is valid (returns false if value contains X or Z states, otherwise true)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">W</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">int</span>                      <span style="color:#8f5902;font-style:italic"># Get the bit width of XData (0 indicates XData is of Verilog&#39;s logic type, otherwise it&#39;s the width of Vec type)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">U</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">int</span>                      <span style="color:#8f5902;font-style:italic"># Get the unsigned value of XData (e.g., x = a.value)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">S</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">int</span>                      <span style="color:#8f5902;font-style:italic"># Get the signed value of XData</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">String</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">str</span>                 <span style="color:#8f5902;font-style:italic"># Convert XData to a hexadecimal string, e.g., &#34;0x123ff&#34;, if ? appears, it means X or Z state in the corresponding 4 bits</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Equal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xdata</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#204a87">bool</span>            <span style="color:#8f5902;font-style:italic"># Compare two XData instances for equality</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>                    <span style="color:#8f5902;font-style:italic"># Assign value to XData, value can be XData, string, int, bytes, etc.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">GetBytes</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">bytes</span>             <span style="color:#8f5902;font-style:italic"># Get the value of XData in bytes format</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Connect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xdata</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#204a87">bool</span>          <span style="color:#8f5902;font-style:italic"># Connect two XData instances; only In and Out types can be connected. When Out data changes, In type XData will be automatically updated.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">IsInIO</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">bool</span>                <span style="color:#8f5902;font-style:italic"># Check if XData is of In type, which can be read and written</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">IsOutIO</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">bool</span>               <span style="color:#8f5902;font-style:italic"># Check if XData is of Out type, which is read-only</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">IsBiIO</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">bool</span>                <span style="color:#8f5902;font-style:italic"># Check if XData is of Bi type, which can be read and written</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">IsImmWrite</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">bool</span>            <span style="color:#8f5902;font-style:italic"># Check if XData is in Imm write mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">IsRiseWrite</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">bool</span>           <span style="color:#8f5902;font-style:italic"># Check if XData is in Rise write mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">IsFallWrite</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">bool</span>           <span style="color:#8f5902;font-style:italic"># Check if XData is in Fall write mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">AsImmWrite</span><span style="color:#000;font-weight:bold">()</span>                  <span style="color:#8f5902;font-style:italic"># Change XData&#39;s write mode to Imm</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">AsRiseWrite</span><span style="color:#000;font-weight:bold">()</span>                 <span style="color:#8f5902;font-style:italic"># Change XData&#39;s write mode to Rise</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">AsFallWrite</span><span style="color:#000;font-weight:bold">()</span>                 <span style="color:#8f5902;font-style:italic"># Change XData&#39;s write mode to Fall</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">AsBiIO</span><span style="color:#000;font-weight:bold">()</span>                      <span style="color:#8f5902;font-style:italic"># Change XData to Bi type</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">AsInIO</span><span style="color:#000;font-weight:bold">()</span>                      <span style="color:#8f5902;font-style:italic"># Change XData to In type</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">AsOutIO</span><span style="color:#000;font-weight:bold">()</span>                     <span style="color:#8f5902;font-style:italic"># Change XData to Out type</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">FlipIOType</span><span style="color:#000;font-weight:bold">()</span>                  <span style="color:#8f5902;font-style:italic"># Invert the IO type of XData, e.g., In to Out or Out to In</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Invert</span><span style="color:#000;font-weight:bold">()</span>                      <span style="color:#8f5902;font-style:italic"># Invert the data in XData</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">At</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">index</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#000">PinBind</span>            <span style="color:#8f5902;font-style:italic"># Get the pin at index, e.g., x = a.At(12).Get() or a.At(12).Set(1)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">AsBinaryString</span><span style="color:#000;font-weight:bold">()</span>              <span style="color:#8f5902;font-style:italic"># Convert XData&#39;s data to a binary string, e.g., &#34;1001011&#34;</span>
</span></span></code></pre></div><p>To simplify assignment operations, <code>XData</code> has overloaded property assignment for <code>Set(value)</code> and <code>U()</code> methods, allowing assignments and retrievals with <code>pin.value = x</code> and <code>x = pin.value</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Access with .value</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># a is of XData type</span>
</span></span><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">12345</span>        <span style="color:#8f5902;font-style:italic"># Decimal assignment</span>
</span></span><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0b11011</span>      <span style="color:#8f5902;font-style:italic"># Binary assignment</span>
</span></span><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0o12345</span>      <span style="color:#8f5902;font-style:italic"># Octal assignment</span>
</span></span><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0x12345</span>      <span style="color:#8f5902;font-style:italic"># Hexadecimal assignment</span>
</span></span><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span>           <span style="color:#8f5902;font-style:italic"># Assign all bits to 1, a.value = x is equivalent to a.Set(x)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">31</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>              <span style="color:#8f5902;font-style:italic"># Assign value to bit 31</span>
</span></span><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;x&#34;</span>          <span style="color:#8f5902;font-style:italic"># Assign high impedance state</span>
</span></span><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;z&#34;</span>          <span style="color:#8f5902;font-style:italic"># Assign unknown state</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>            <span style="color:#8f5902;font-style:italic"># Retrieve value, equivalent to x = a.U()</span>
</span></span></code></pre></div><h3 id="xport-class">XPort Class</h3>
<ul>
<li>Directly operating on <code>XData</code> is clear and intuitive when dealing with a few pins. However, managing multiple <code>XData</code> instances can be cumbersome. <code>XPort</code> is a wrapper around <code>XData</code> that allows centralized management of multiple <code>XData</code> instances. It also provides methods for convenient batch management.
<strong>Initialization and Adding Pins</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">port</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">XPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;p&#34;</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># Create an XPort instance with prefix p</span>
</span></span></code></pre></div><p><strong>Main Methods</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">XPort</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">XPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">)</span>      <span style="color:#8f5902;font-style:italic"># Create a port with prefix prefix, e.g., p = XPort(&#34;tile_link_&#34;)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">PortCount</span><span style="color:#000;font-weight:bold">():</span> <span style="color:#204a87">int</span>        <span style="color:#8f5902;font-style:italic"># Get the number of pins in the port (i.e., number of bound XData instances)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pin_name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">XData</span><span style="color:#000;font-weight:bold">)</span>    <span style="color:#8f5902;font-style:italic"># Add a pin, e.g., p.Add(&#34;reset&#34;, dut.reset)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Del</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pin_name</span><span style="color:#000;font-weight:bold">)</span>           <span style="color:#8f5902;font-style:italic"># Delete a pin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Connect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xport2</span><span style="color:#000;font-weight:bold">)</span>         <span style="color:#8f5902;font-style:italic"># Connect two ports</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">NewSubPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">std</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">string</span> <span style="color:#000">subprefix</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#000">XPort</span> <span style="color:#8f5902;font-style:italic"># Create a sub-port with all pins starting with subprefix</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">key</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">raw_key</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">False</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#000">XData</span>         <span style="color:#8f5902;font-style:italic"># Get XData</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">SetZero</span><span style="color:#000;font-weight:bold">()</span>                                <span style="color:#8f5902;font-style:italic"># Set all XData in the port to 0</span>
</span></span></code></pre></div><h3 id="xclock-class">XClock Class</h3>
<ul>
<li><code>XClock</code> is a wrapper for the circuit clock used to drive the circuit. In traditional simulation tools (e.g., Verilator), you need to manually assign values to <code>clk</code> and update the state using functions like <code>step_eval</code>. Our tool provides methods to bind the clock directly to <code>XClock</code>, allowing the <code>Step()</code> method to simultaneously update the <code>clk</code> and circuit state.
<strong>Initialization and Adding Pins</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Initialization</span>
</span></span><span style="display:flex;"><span><span style="color:#000">clk</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">XClock</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stepfunc</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># Parameter stepfunc is the circuit advancement method provided by DUT backend, e.g., Verilator&#39;s step_eval</span>
</span></span></code></pre></div><p><strong>Main Methods</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">XClock</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xdata</span><span style="color:#000;font-weight:bold">)</span>       <span style="color:#8f5902;font-style:italic"># Bind Clock with xdata, e.g., clock.Add(dut.clk)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xport</span><span style="color:#000;font-weight:bold">)</span>       <span style="color:#8f5902;font-style:italic"># Bind Clock with XData</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">RefreshComb</span><span style="color:#000;font-weight:bold">()</span>    <span style="color:#8f5902;font-style:italic"># Advance circuit state without advancing time or dumping waveform</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">RefreshCombT</span><span style="color:#000;font-weight:bold">()</span>   <span style="color:#8f5902;font-style:italic"># Advance circuit state (advance time and dump waveform)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span> <span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># Advance the circuit by s clock cycles, DUT.Step = DUT.xclock.Step</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">StepRis</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">func</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">kwargs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{})</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f3644e5a33edc980188913395528ef79">2.2 - Waveform Generation</h1>
    <div class="lead">Generate circuit waveforms.</div>
	<h2 id="usage">Usage</h2>
<p>When using the Picker tool to encapsulate the DUT, use the <code>-w [wave_file]</code> option to specify the waveform file to be saved. Different waveform file types are supported for different backend simulators, as follows:</p>
<ol>
<li><a href="https://www.veripool.org/wiki/verilator">Verilator</a>
<ul>
<li><code>.vcd</code> format waveform file.</li>
<li><code>.fst</code> format waveform file, a more efficient compressed file.</li>
</ul>
</li>
<li><a href="https://www.synopsys.com/verification/simulation/vcs.html">VCS</a>
<ul>
<li><code>.fsdb</code> format waveform file, a more efficient compressed file.</li>
</ul>
</li>
</ol>
<p>Note that if you choose to generate the <code>libDPI_____.so</code> file yourself, the waveform file format is not restricted by the above constraints. The waveform file format is determined when the simulator constructs <code>libDPI.so</code>, so if you generate it yourself, you need to specify the waveform file format using the corresponding simulator&rsquo;s configuration.</p>
<h3 id="python-example">Python Example</h3>
<p>Normally, the DUT needs to be <strong>explicitly declared complete</strong> to notify the simulator to perform post-processing tasks (writing waveform, coverage files, etc.). In Python, after completing all tests, <strong>call the <code>.finalize()</code> method of the DUT</strong> to notify the simulator that the task is complete, and then flush the files to disk.</p>
<p>Using the <a href="/mlvp/en/docs/quick-start/eg-adder/">Adder Example</a>, the test program is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_Adder</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;__main__&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">finalize</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#8f5902;font-style:italic"># flush the wave file to disk</span>
</span></span></code></pre></div><p>After the run is completed, the waveform file with the specified name will be generated.</p>
<h2 id="viewing-results">Viewing Results</h2>
<h3 id="gtkwave">GTKWave</h3>
<p>Use GTKWave to open <code>fst</code> or <code>vcd</code> waveform files to view the waveform.</p>
<p><img alt="GTKWave" src="GTKwave.png"></p>
<h3 id="verdi">Verdi</h3>
<p>Use Verdi to open <code>fsdb</code> or <code>vcd</code> waveform files to view the waveform.</p>
<p><img alt="Verdi" src="verdiwave.png"></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5e24b3d167d3b33da0ef1cb2f151ba27">2.3 - Multi-File Input</h1>
    <div class="lead">Handling multiple Verilog source files</div>
	<h2 id="multi-file-input-and-output">Multi-File Input and Output</h2>
<p>In many cases, a module in one file may instantiate modules in other files. In such cases, you can use the picker tool&rsquo;s <code>-f</code> option to process multiple Verilog source files. For example, suppose you have three source files: <code>Cache.sv</code>, <code>CacheStage.sv</code>, and <code>CacheMeta.sv</code>:</p>
<h3 id="file-list">File List</h3>
<h4 id="cachesv">Cache.sv</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sv" data-lang="sv"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// In 
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">module</span> <span style="color:#000">Cache</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">CacheStage</span> <span style="color:#000">s1</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">CacheStage</span> <span style="color:#000">s2</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">CacheStage</span> <span style="color:#000">s3</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">CacheMeta</span> <span style="color:#000">cachemeta</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">endmodule</span>
</span></span></code></pre></div><h4 id="cachestagesv">CacheStage.sv</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sv" data-lang="sv"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// In CacheStage.sv
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">module</span> <span style="color:#000">CacheStage</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">endmodule</span>
</span></span></code></pre></div><h4 id="cachemetasv">CacheMeta.sv</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sv" data-lang="sv"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// In CacheMeta.sv
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">module</span> <span style="color:#000">CacheMeta</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">endmodule</span>
</span></span></code></pre></div><h3 id="usage">Usage</h3>
<p>In this case, the module under test is Cache, which is in <code>Cache.sv</code>. You can generate the DUT using the following command:</p>
<h4 id="command-line-specification">Command Line Specification</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>picker <span style="color:#204a87">export</span> Cache.sv --fs CacheStage.sv,CacheMeta.sv --sname Cache
</span></span></code></pre></div><h4 id="specification-through-a-file-list-file">Specification through a File List File</h4>
<p>You can also use a .txt file to specify multiple input files:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>picker <span style="color:#204a87">export</span> Cache.sv --fs src.txt --sname Cache
</span></span></code></pre></div><p>Where the contents of <code>src.txt</code> are:</p>
<pre tabindex="0"><code>CacheStage.sv
CacheMeta.sv
</code></pre><h3 id="notes">Notes</h3>
<ol>
<li>It is important to note that even when using multiple file inputs, you still need to specify the file containing the top-level module under test, as shown in the example above with <code>Cache.sv</code>.</li>
<li>When using multiple file inputs, Picker will pass all files to the simulator, which will compile them simultaneously. Therefore, it is necessary to ensure that the module names in all files are unique.</li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-625b33435a15ffee912f47c5443ffc13">2.4 - Coverage Statistics</h1>
    <div class="lead">Coverage tools</div>
	<blockquote>
<p>The Picker tool supports generating code line coverage reports, and the MLVP（<a href="https://github.com/XS-MLVP/mlvp">https://github.com/XS-MLVP/mlvp</a>）project supports generating functional coverage reports.</p>
</blockquote>
<h2 id="code-line-coverage">Code Line Coverage</h2>
<p>Currently, the Picker tool supports generating code line coverage reports based on the Verilator simulator.</p>
<h3 id="verilator">Verilator</h3>
<p>The Verilator simulator provides <a href="https://verilator.org/guide/latest/exe_verilator_coverage.html">coverage support</a>.<br>
The implementation is as follows:</p>
<ol>
<li>Use the <code>verilator_coverage</code> tool to process or merge coverage databases, ultimately generating a <code>coverage.info</code> file for multiple DUTs.</li>
<li>Use the <code>genhtml</code> command of the lcov tool based on <code>coverage.info</code> and RTL code source files to generate a complete code coverage report.</li>
</ol>
<p>The process is as follows:</p>
<ol>
<li>Enable the COVERAGE feature when generating the DUT with Picker (add the <code>-c</code> option).</li>
<li>After the simulator runs, a coverage database file <code>V{DUT_NAME}.dat</code> will be generated after <code>dut.finalize()</code> is called.</li>
<li>Use the write-info function of <code>verilator_coverage</code> to convert it to a <code>.info</code> file.</li>
<li>Use the <code>genhtml</code> function of <code>lcov</code> to generate an HTML report using the <code>.info</code> file and the <strong>RTL source files</strong> specified in the file.</li>
</ol>
<blockquote>
<p>Note: The <strong>RTL source files</strong> specified in the file refer to the source file paths used when generating the <code>DUT</code>, and these paths need to be valid in the current environment. In simple terms, all <code>.sv/.v</code> files used for compilation need to exist in the current environment, and the directory remains unchanged.</p>
</blockquote>
<h4 id="verilator_coverage">verilator_coverage</h4>
<p>The <code>verilator_coverage</code> tool is used to process coverage data generated by the <code>DUT</code> after running <code>.dat</code> files. The tool can process and merge multiple <code>.dat</code> files and has two main functions:</p>
<ol>
<li>
<p>Generate a <code>.info</code> file based on the <code>.dat</code> file for subsequent generation of a web page report.</p>
<ul>
<li>
<p><code>-annotate &lt;output_dir&gt;</code>：Present the coverage situation in the source file in annotated form, and save the result to <code>output_dir</code>. The format is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sv" data-lang="sv"><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">100000</span>  <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#204a87;font-weight:bold">logic</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic">// Begins with whitespace, because
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                        <span style="color:#8f5902;font-style:italic">// number of hits (100000) is above the limit.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#0000cf;font-weight:bold">000000</span>  <span style="color:#204a87;font-weight:bold">input</span> <span style="color:#204a87;font-weight:bold">logic</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic">// Begins with %, because
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                        <span style="color:#8f5902;font-style:italic">// number of hits (0) is below the limit.
</span></span></span></code></pre></div></li>
<li>
<p><code>-annotate-min &lt;count&gt;</code>：Specify the limit as count for the above.</p>
</li>
</ul>
</li>
<li>
<p>Combine the <code>.dat</code> file with the source code file, and write the coverage data in annotated form into the specified directory.</p>
<ul>
<li><code>-write &lt;merged-datafile&gt; -read &lt;datafiles&gt;</code>：Merge several .dat (<code>datafiles</code>) files into one .dat file.</li>
<li><code>-write-info &lt;merged-info&gt; -read &lt;datafiles&gt;</code>：Merge several .dat (<code>datafiles</code>) files into one .info file.</li>
</ul>
</li>
</ol>
<h4 id="genhtml">genhtml</h4>
<p>The <code>genhtml</code> provided by the <code>lcov</code> package can export a more readable HTML report from the .info file. The command format is: <code>genhtml [OPTIONS] &lt;infofiles&gt;</code>.
It is recommended to use the <code>-o &lt;outputdir&gt;</code> option to output the results to a specified directory.</p>
<p>For example, in the<a href="/mlvp/en/docs/quick-start/eg-adder/">Addr</a> project.
<img alt="adder.jpg" src="adder.jpg"></p>
<h2 id="usage-example">Usage Example</h2>
<p>If you enable the <code>-c</code> option when using Picker, after the simulation ends, a <code>V{DUT_NAME}.dat</code> file will be generated. And there will be a Makefile in the top-level directory, which contains the command to generate the coverage report.</p>
<p>The command is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-make" data-lang="make"><span style="display:flex;"><span><span style="color:#000">coverage</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    verilator_coverage -write-info coverage.info ./<span style="color:#4e9a06">${</span><span style="color:#000">TARGET</span><span style="color:#4e9a06">}</span>/V<span style="color:#4e9a06">${</span><span style="color:#000">PROJECT</span><span style="color:#4e9a06">}</span>_coverage.dat
</span></span><span style="display:flex;"><span>    genhtml coverage.info --output-directory coverage
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div><p>Enter <code>make coverage</code> in the shell, which will generate coverage.info based on the generated .dat file and then use <code>genhtml</code> to generate an html report in the coverage directory.</p>
<h2 id="vcs">VCS</h2>
<p>Documentation for VCS is currently being finalized.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a2e75c30d9ecce2bb906ec293eb6678e">2.5 - Integrated Testing Framework</h1>
    <div class="lead">Available Software Testing Frameworks</div>
	

<div class="pageinfo pageinfo-primary">
<p>In traditional chip verification practices, frameworks like UVM are widely adopted. Although they provide a comprehensive set of verification methodologies, they are typically confined to specific hardware description languages and simulation environments. Our tool breaks these limitations by converting simulation code into C++ or Python, allowing us to leverage software verification tools for more comprehensive testing.
Given Python&rsquo;s robust ecosystem, this project primarily uses Python as an example, briefly introducing two classic software testing frameworks: Pytest and Hypothesis. <strong>Pytest handles various testing needs with its simple syntax and rich features</strong>. Meanwhile, <strong>Hypothesis enhances the thoroughness and depth of testing by generating test cases that uncover unexpected edge cases</strong>.
Our project is designed from the outset to be compatible with various modern software testing frameworks. We encourage you to explore the potential of these tools and apply them to your testing processes. Through hands-on practice, you will gain a deeper understanding of how these tools can enhance code quality and reliability. Let&rsquo;s work together to improve the quality of chip development.</p>

</div>


</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-59e8c01d61d7cbb458b1aedd8931a8d4">2.5.1 - PyTest</h1>
    <div class="lead">Used for managing tests and generating test reports.</div>
	<h2 id="software-testing">Software Testing</h2>
<blockquote>
<p>Before we start with pytest, let&rsquo;s understand software testing. Software testing generally involves the following four aspects:</p>
<ul>
<li>Unit Testing: Also known as module testing, it involves checking the correctness of program modules, which are the smallest units in software design.</li>
<li>Integration Testing: Also known as assembly testing, it usually builds on unit testing by sequentially and incrementally testing all program modules, focusing on the interface parts of different modules.</li>
<li>System Testing: It treats the entire software system as a whole for testing, including testing the functionality, performance, and the software&rsquo;s running environment.</li>
<li>Acceptance Testing: Refers to testing the entire system according to the project task book, contract, and acceptance criteria agreed upon by both the supply and demand sides, to determine whether to accept or reject the system.</li>
</ul>
</blockquote>
<p>pytest was initially designed as a unit testing framework, but it also provides many features that allow it to be used for a wider range of testing, including integration testing and system testing. It is a very mature full-featured Python testing framework.
It simplifies test writing and execution by collecting test functions and modules and providing a rich assertion library. It is a very mature and powerful Python testing framework with the following key features:</p>
<ul>
<li><strong>Simple and Flexible</strong>: Pytest is easy to get started with and is flexible.</li>
<li><strong>Supports Parameterization</strong>: You can easily provide different parameters for test cases.</li>
<li><strong>Full-featured</strong>: Pytest not only supports simple unit testing but can also handle complex functional testing. You can even use it for automation testing, such as Selenium or Appium testing, as well as interface automation testing (combining Pytest with the Requests library).</li>
<li><strong>Rich Plugin Ecosystem</strong>: Pytest has many third-party plugins, and you can also customize extensions. Some commonly used plugins include:
<ul>
<li><code>pytest-selenium</code>: Integrates Selenium.</li>
<li><code>pytest-html</code>: Generates HTML test reports.</li>
<li><code>pytest-rerunfailures</code>: Repeats test cases in case of failure.</li>
<li><code>pytest-xdist</code>: Supports multi-CPU distribution.</li>
</ul>
</li>
<li><strong>Well Integrated with Jenkins</strong>.</li>
<li><strong>Supports Allure Report Framework</strong>.</li>
</ul>
<p>This article will briefly introduce the usage of pytest based on testing requirements. The <a href="https://learning-pytest.readthedocs.io/zh/latest/">complete manual</a> is available here for students to study in depth.</p>
<h2 id="installing-pytest">Installing Pytest</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Install pytest:</span>
</span></span><span style="display:flex;"><span>pip install pytest
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Upgrade pytest</span>
</span></span><span style="display:flex;"><span>pip install -U pytest
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Check pytest version</span>
</span></span><span style="display:flex;"><span>pytest --version
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Check installed package list</span>
</span></span><span style="display:flex;"><span>pip list
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Check pytest help documentation</span>
</span></span><span style="display:flex;"><span>pytest -h
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Install third-party plugins</span>
</span></span><span style="display:flex;"><span>pip install pytest-sugar
</span></span><span style="display:flex;"><span>pip install pytest-rerunfailures
</span></span><span style="display:flex;"><span>pip install pytest-xdist
</span></span><span style="display:flex;"><span>pip install pytest-assume
</span></span><span style="display:flex;"><span>pip install pytest-html
</span></span></code></pre></div><h2 id="using-pytest">Using Pytest</h2>
<h3 id="naming-convention">Naming Convention</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># When using pytest, our module names are usually prefixed with test or end with test. You can also modify the configuration file to customize the naming convention.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># test_*.py or *_test.py</span>
</span></span><span style="display:flex;"><span><span style="color:#000">test_demo1</span>
</span></span><span style="display:flex;"><span><span style="color:#000">demo2_test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The class name in the module must start with Test and cannot have an init method.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">TestDemo1</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">TestLogin</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The test methods defined in the class must start with test_</span>
</span></span><span style="display:flex;"><span><span style="color:#000">test_demo1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">test_demo2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Test Case</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">test_one</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_demo1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Test Case 1&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_demo2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Test Case 2&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="pytest-parameters">Pytest Parameters</h3>
<p>pytest supports many parameters, which can be viewed using the help command.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pytest -help
</span></span></code></pre></div><p>Here are some commonly used ones:</p>
<p>-m: Specify multiple tag names with an expression. pytest provides a decorator @pytest.mark.xxx for marking tests and grouping them (xxx is the group name you defined), so you can quickly select and run them, with different groups separated by and or or.</p>
<p>-v: Outputs more detailed information during runtime. Without -v, the runtime does not display the specific test case names being run; with -v, it prints out the specific test cases in the console.</p>
<p>-q: Similar to the verbosity in unittest, used to simplify the runtime output. When running tests with -q, only simple runtime information is displayed, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>.s..  <span style="color:#ce5c00;font-weight:bold">[</span>100%<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">3</span> passed, <span style="color:#0000cf;font-weight:bold">1</span> skipped in 9.60s
</span></span></code></pre></div><p>-k: You can run specified test cases using an expression. It is a fuzzy match, with and or or separating keywords, and the matching range includes file names, class names, and function names.</p>
<p>-x: Exit the test if one test case fails. This is very useful for debugging. When a test fails, stop running the subsequent tests.</p>
<p>-s: Display print content. When running test scripts, we often add some print content for debugging or printing some content. However, when running pytest, this content is not displayed. If you add -s, it will be displayed.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pytest test_se.py -s
</span></span></code></pre></div><h3 id="selecting-test-cases-to-execute-with-pytest">Selecting Test Cases to Execute with Pytest</h3>
<p><strong>In Pytest, you can select and execute test cases based on different dimensions such as test folders, test files, test classes, and test methods.</strong></p>
<ul>
<li>Execute by test folder</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Execute all test cases in the current folder and subfolders</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pytest</span> <span style="color:#ce5c00;font-weight:bold">.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Execute all test cases in the tests folder and its subfolders, which are at the same level as the current folder</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pytest</span> <span style="color:#ce5c00;font-weight:bold">../</span><span style="color:#000">tests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Execute by test file</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Run all test cases in test_se.py</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pytest</span> <span style="color:#000">test_se</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Execute by test class, must be in the following format:</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pytest</span> <span style="color:#000">file_name</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">py</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">TestClass</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">where</span> <span style="color:#4e9a06">&#34;::&#34;</span> <span style="color:#204a87;font-weight:bold">is</span> <span style="color:#000">the</span> <span style="color:#000">separator</span> <span style="color:#000">used</span> <span style="color:#000">to</span> <span style="color:#000">separate</span> <span style="color:#000">the</span> <span style="color:#000">test</span> <span style="color:#000">module</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">test</span> <span style="color:#000">class</span><span style="color:#ce5c00;font-weight:bold">.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Run all test cases under the class named TestSE in the test_se.py file</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pytest</span> <span style="color:#000">test_se</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">py</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">TestSE</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Execute by test method, must be in the following format:</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pytest</span> <span style="color:#000">file_name</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">py</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">TestClass</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">TestMethod</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">where</span> <span style="color:#4e9a06">&#34;::&#34;</span> <span style="color:#204a87;font-weight:bold">is</span> <span style="color:#000">the</span> <span style="color:#000">separator</span> <span style="color:#000">used</span> <span style="color:#000">to</span> <span style="color:#000">separate</span> <span style="color:#000">the</span> <span style="color:#000">test</span> <span style="color:#000">module</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">test</span> <span style="color:#000">class</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">test</span> <span style="color:#000">method</span><span style="color:#ce5c00;font-weight:bold">.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Run the test case named test_get_new_message under the class named TestSE in the test_se.py file </span>
</span></span><span style="display:flex;"><span><span style="color:#000">pytest</span> <span style="color:#000">test_se</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">py</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">TestSE</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">test_get_new_message</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The above methods of selecting test cases are all on the **command line**. If you want to execute directly in the test program, you can directly call pytest.main(), the format is:</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pytest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">main</span><span style="color:#000;font-weight:bold">([</span><span style="color:#000">module</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">py</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">class</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">method</span><span style="color:#000;font-weight:bold">])</span>
</span></span></code></pre></div><blockquote>
<p>In addition, Pytest also supports multiple ways to control the execution of test cases, such as filtering execution, running in multiple processes, retrying execution, etc.</p>
</blockquote>
<h2 id="writing-validation-with-pytest">Writing Validation with Pytest</h2>
<ul>
<li>During testing, we use the previously validated adder. Go to the Adder folder, create a new test_adder.py file in the picker_out_adder directory, with the following content:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Import test modules and required libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_Adder</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pytest</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">ctypes</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">random</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Use pytest fixture to initialize and clean up resources</span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@pytest.fixture</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">adder</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Create an instance of DUTAdder, load the dynamic link library</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Execute one clock step to prepare the DUT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># The code after the yield statement will be executed after the test ends, used to clean up resources</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">yield</span> <span style="color:#000">dut</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Clean up DUT resources and generate test coverage reports and waveforms</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Finish</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">TestFullAdder</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Define full_adder as a static method, as it does not depend on class instances</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">full_adder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#0000cf;font-weight:bold">0b1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Sum</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ctypes</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">c_uint64</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Sum</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">ctypes</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">c_uint64</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">b</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">Sum</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#0000cf;font-weight:bold">64</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#0000cf;font-weight:bold">0b1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Sum</span> <span style="color:#ce5c00;font-weight:bold">&amp;=</span> <span style="color:#0000cf;font-weight:bold">0xffffffffffffffff</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">Sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Cout</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Use the pytest.mark.usefixtures decorator to specify the fixture to use</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@pytest.mark.usefixtures</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;adder&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Define the test method, where adder is injected by pytest through the fixture</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_adder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">adder</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Perform multiple random tests</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">114514</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Generate random 64-bit a, b, and 1-bit cin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getrandbits</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">64</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getrandbits</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">64</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getrandbits</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Set the input of the DUT</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">b</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Execute one clock step</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Calculate the expected result using a static method</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">full_adder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Assert that the output of the DUT is the same as the expected result</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#204a87">sum</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;__main__&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">pytest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">main</span><span style="color:#000;font-weight:bold">([</span><span style="color:#4e9a06">&#39;-v&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;test_adder.py::TestFullAdder&#39;</span><span style="color:#000;font-weight:bold">])</span>
</span></span></code></pre></div><ul>
<li>After running the test, the output is as follows:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>collected <span style="color:#0000cf;font-weight:bold">1</span> item                                                               
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> test_adder.py ✓                                                 100% ██████████
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Results <span style="color:#ce5c00;font-weight:bold">(</span>4.33s<span style="color:#ce5c00;font-weight:bold">)</span>:
</span></span></code></pre></div><blockquote>
<p>The successful test indicates that after 114514 loops, our device has not found any bugs for now. However, using randomly generated test cases with multiple loops consumes a considerable amount of resources, and these randomly generated test cases may not effectively cover all boundary conditions. In the next section, we will introduce a more efficient method for generating test cases.</p>
</blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e228270a25eab6e1035925a8e92bf6f0">2.5.2 - Hypothesis</h1>
    <div class="lead">Can Be Used to Generate Stimuli</div>
	<h1 id="hypothesis">Hypothesis</h1>
<p>In the previous section, we manually wrote test cases and specified inputs and expected outputs for each case. This method has some issues, such as incomplete test case coverage and the tendency to overlook <strong>boundary conditions</strong>. Hypothesis is a Python library for property-based testing. Its main goal is to make testing <strong>simpler, faster, and more reliable</strong>. It uses a method called <strong>property-based testing</strong>, where you can write some hypotheses for your code, and Hypothesis will automatically generate test cases to verify these hypotheses. This makes it easier to write comprehensive and efficient tests. Hypothesis can automatically generate various types of input data, including basic types (e.g., integers, floats, strings), container types (e.g., lists, sets, dictionaries), and custom types. It tests based on the properties (assertions) you provide. If a test fails, it will try to narrow down the input data to find the smallest failing case. With Hypothesis, you can better cover the boundary conditions of your code and uncover errors you might not have considered. This helps improve the quality and reliability of your code.</p>
<h2 id="basic-concepts">Basic Concepts</h2>
<ul>
<li>Test Function: The function or method to be tested.</li>
<li>Properties: Conditions that the test function should satisfy. Properties are applied to the test function as decorators.</li>
<li>Strategy: A generator for test data. Hypothesis provides a range of built-in strategies, such as integers, strings, lists, etc. You can also <strong>define custom strategies</strong>.</li>
<li>Test Generator: A function that generates test data based on strategies. Hypothesis automatically generates test data and passes it as parameters to the test function.</li>
</ul>
<p>This article will briefly introduce Hypothesis based on testing requirements. The <a href="https://hypothesis.readthedocs.io/en/latest/">complete manual</a> is available for in-depth study.</p>
<h2 id="installation">Installation</h2>
<p>Install with pip and import in Python to use:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pip install hypothesis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>import hypothesis
</span></span></code></pre></div><h2 id="basic-usage">Basic Usage</h2>
<h3 id="properties-and-strategies">Properties and Strategies</h3>
<p>Hypothesis uses property decorators to define the properties of test functions. The most common decorator is @given, which specifies the properties the test function should satisfy.
We can define a test function test_addition using the @given decorator and add properties to x. The test generator will automatically generate test data for the function and pass it as parameters, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">addition</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">number</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">number</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@given</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">integers</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">y</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">integers</span><span style="color:#000;font-weight:bold">())</span>　　
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_addition</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">):</span>　　   
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">addition</span><span style="color:#a40000">（</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#a40000">）</span>
</span></span></code></pre></div><p>In this example, integers() is a built-in strategy for generating integer test data. Hypothesis offers a variety of built-in strategies for generating different types of test data. Besides integers(), there are strategies for strings, booleans, lists, dictionaries, etc. For instance, using the text() strategy to generate string test data and using lists(text()) to generate lists of strings:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@given</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">text</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">l</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">lists</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">text</span><span style="color:#000;font-weight:bold">()))</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_string_concatenation</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">l</span><span style="color:#000;font-weight:bold">):</span>　　   
</span></span><span style="display:flex;"><span>	<span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">)</span>　　   
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">x</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">l</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>You can also define custom strategies to generate specific types of test data, for example, a strategy for non-negative integers:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">non_negative_integers</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>　　<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">integers</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">min_value</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@given</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">non_negative_integers</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>　　<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_positive_addition</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>　　<span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">x</span>
</span></span></code></pre></div><h3 id="expectations">Expectations</h3>
<p>We can use expect to specify the expected result of a function:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@given</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">integers</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_addition</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">expected</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">actual</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">addition</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="hypotheses-and-assertions">Hypotheses and Assertions</h3>
<p>When using Hypothesis for testing, we can use standard Python assertions to verify the properties of the test function. Hypothesis will automatically generate test data and run the test function based on the properties defined in the decorator. If an assertion fails, Hypothesis will try to narrow down the test data to find the smallest failing case.</p>
<p>Suppose we have a string reversal function. We can use an assert statement to check if reversing a string twice equals itself:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_reverse_string</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">expected</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">actual</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">addition</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">actual</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">expected</span>
</span></span></code></pre></div><h2 id="writing-tests">Writing Tests</h2>
<ul>
<li>
<p>Tests in Hypothesis consist of two parts: a function that looks like a regular test in your chosen framework but with some extra parameters, and a @given decorator specifying how to provide those parameters. Here&rsquo;s an example of how to use it to verify a full adder, which we tested previously:</p>
</li>
<li>
<p>Based on the previous section&rsquo;s code, we modify the method of generating test cases from random numbers to the integers() method. The modified code is as follows:</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_Adder</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pytest</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">ctypes</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">random</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">hypothesis</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">given</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">strategies</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">st</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Initializing and Cleaning Up Resources Using pytest Fixture</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">UT_Adder</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pytest</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">ctypes</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">hypothesis</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">given</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">strategies</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">st</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Using pytest fixture to initialize and clean up resources</span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@pytest.fixture</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">scope</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;class&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">adder</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Create DUTAdder instance and load dynamic library</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Perform a clock step to prepare the DUT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Code after yield executes after tests finish, for cleanup</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">yield</span> <span style="color:#000">dut</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Clean up DUT resources and generate coverage report and waveform</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">finalize</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">TestFullAdder</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Define full_adder as a static method, as it doesn&#39;t depend on class instance</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">full_adder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#0000cf;font-weight:bold">0b1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Sum</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ctypes</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">c_uint64</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Sum</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">ctypes</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">c_uint64</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">b</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">Sum</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#0000cf;font-weight:bold">64</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#0000cf;font-weight:bold">0b1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Sum</span> <span style="color:#ce5c00;font-weight:bold">&amp;=</span> <span style="color:#0000cf;font-weight:bold">0xffffffffffffffff</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">Sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Cout</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Use Hypothesis to automatically generate test cases</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@given</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">st</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">integers</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">min_value</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">max_value</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0xffffffffffffffff</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">st</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">integers</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">min_value</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">max_value</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0xffffffffffffffff</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">st</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">integers</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">min_value</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">max_value</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Define test method, adder parameter injected by pytest via fixture</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_full_adder_with_hypothesis</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">adder</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Calculate expected sum and carry</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">sum_expected</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cout_expected</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">full_adder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Set DUT inputs</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">b</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Perform a clock step</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Assert DUT outputs match expected results</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">sum_expected</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">cout_expected</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;__main__&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Run specified tests in verbose mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">pytest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">main</span><span style="color:#000;font-weight:bold">([</span><span style="color:#4e9a06">&#39;-v&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;test_adder.py::TestFullAdder&#39;</span><span style="color:#000;font-weight:bold">])</span>
</span></span></code></pre></div><blockquote>
<p>In this example, the @given decorator and strategies are used to generate random data that meets specified conditions. st.integers() is a strategy for generating integers within a specified range, used to generate numbers between 0 and 0xffffffffffffffff for a and b, and between 0 and 1 for cin. Hypothesis will automatically rerun this test multiple times, each time using different random inputs, helping reveal potential boundary conditions or edge cases.</p>
</blockquote>
<ul>
<li>Run the tests, and the output will be as follows:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>collected <span style="color:#0000cf;font-weight:bold">1</span> item                                                               
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> test_adder.py ✓                                                 100% ██████████
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Results <span style="color:#ce5c00;font-weight:bold">(</span>0.42s<span style="color:#ce5c00;font-weight:bold">)</span>:
</span></span><span style="display:flex;"><span>       <span style="color:#0000cf;font-weight:bold">1</span> passed
</span></span></code></pre></div><blockquote>
<p>As we can see, the tests were completed in a short amount of time.</p>
</blockquote>

</div>



    
	
  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-60a985e164b2bc20af6e01e35f5b2af0">3 - Verification Basics</h1>
    <div class="lead">Introduction to the basic knowledge required for working with the open verification platform.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Introduction to chip verification using the Guoke Cache as an example, covering the basic verification process and report writing.</p>

</div>


</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-13bda523e6e63f16e87df4b0401a9d7f">3.1 - Chip Verification</h1>
    <div class="lead">Basic concepts of chip verification</div>
	

<div class="pageinfo pageinfo-primary">
<p>This page provides a brief introduction to chip verification, including concepts used in examples such as DUT (Design Under Test) and RM (Reference Model).</p>
<p>The chip verification process needs to align with the actual situation of the company or team. There is no absolute standard that meets all requirements and must be referenced.</p>

</div>

<h2 id="what-is-chip-verification">What is Chip Verification?</h2>
<hr>
<p>The chip design-to-production process involves three main stages: chip design, chip manufacturing, and chip packaging/testing. Chip design is further divided into front-end and back-end design. Front-end design, also known as logic design, aims to achieve the desired circuit logic functionality. Back-end design, or physical design, focuses on optimizing layout and routing to reduce chip area, lower power consumption, and increase frequency. Chip verification is a critical step in the chip design process. Its goal is to ensure that the designed chip meets the specified requirements in terms of functionality, performance, and power consumption. The verification process typically includes functional verification, timing verification, and power verification, using methods and tools such as simulation, formal verification, hardware acceleration, and prototyping. <strong>For this tutorial, chip verification refers only to the verification of the front-end design to ensure that the circuit logic meets the specified requirements (&ldquo;Does this proposed design do what is intended?&rdquo;), commonly known as functional verification. This does not include back-end design aspects like power and frequency.</strong></p>
<blockquote><p>
For chip products, design errors that make it to production can be extremely costly to fix, as it might require recalling products and remanufacturing chips, incurring significant financial and time costs. Here are some classic examples of failures due to inadequate chip verification:
<p><strong>Intel Pentium FDIV Bug</strong>：In 1994, Intel&rsquo;s Pentium processor was found to have a severe division error known as the FDIV bug. This error was due to incorrect entries in a lookup table within the chip&rsquo;s floating-point unit. Although it rarely affected most applications, it caused incorrect results in specific calculations. Intel had to recall a large number of processors, leading to significant financial losses.</p>
<p><strong>Ariane 5 Rocket Failure</strong>：Though not a chip example, this highlights the importance of hardware verification. In 1996, the European Space Agency&rsquo;s Ariane 5 rocket exploded shortly after launch due to an overflow when converting a 64-bit floating-point number to a 16-bit integer in the navigation system, causing the system to crash. This error went undetected during design and led to the rocket&rsquo;s failure.</p>
<p><strong>AMD Barcelona Bug</strong>：In 2007, AMD&rsquo;s Barcelona processor had a severe Translation Lookaside Buffer (TLB) error that could cause system crashes or reboots. AMD had to mitigate this by lowering the processor&rsquo;s frequency and releasing BIOS updates, which negatively impacted their reputation and financial status.</p>
<p>These cases emphasize the importance of chip verification. Errors detected and fixed during the design phase can prevent these costly failures. Insufficient verification continues to cause issues today, such as a new entrant in the ASIC chip market rushing a 55nm chip without proper verification, leading to three failed tape-outs and approximately $500,000 in losses per failure.</p>
</p></blockquote>
<h2 id="chip-verification-process">Chip Verification Process</h2>
<hr>
<p><img alt="Position of Verification in Chip Design" src="ic-verify.drawio.svg"></p>
<p>The coupling relationship between chip design and verification is shown in the diagram above. Both design and verification have the same input: the specification document. Based on this document, both design and verification teams independently code according to their understanding and requirements. The design team needs to ensure that the RTL code is &ldquo;synthesizable,&rdquo; considering circuit characteristics, while the verification team mainly focuses on whether the functionality meets the requirements, with fewer coding constraints. After both teams complete module development, a sanity test is conducted to check if the functionality matches. If there are discrepancies, collaborative debugging is done to identify and fix issues before retesting. Due to the high coupling between chip design and verification, some companies directly couple their design and verification teams, assigning verification teams to each design submodule. The coupling process in the diagram is coarse-grained, with specific chips (e.g., SoC, DDR) and companies having their cooperation models.</p>
<p>In the above comparison test, the module produced by the design team is usually called DUT (Design Under Test), while the model developed by the verification team is called RM (Reference Model). The verification process includes: writing a verification plan, creating a verification platform, organizing functional points, constructing test cases, running and debugging, collecting bugs/coverage, regression testing, and writing test reports.</p>
<blockquote><p>
<p><strong>Verification Plan：</strong> The verification plan describes how verification will be carried out and how verification quality will be ensured to meet functional verification requirements. It typically includes verification goals, strategies, environment, items, process, risk mitigation, resources, schedule, results, and reports. Verification goals specify the functions or performance metrics to be verified, directly extracted from the chip specification. Verification strategy outlines the methods to be used, such as simulation, formal verification, FPGA acceleration, etc., and how to organize the verification tasks. The verification environment details the specific testing environment, including verification tools and versions. The verification item library lists specific items to be verified and expected results. Verification plans can be general or specific to sub-tasks.</p>
<p><strong>Platform Setup：</strong> The verification platform is the execution environment for specific verification tasks. Similar verification tasks can use the same platform. Setting up the platform is a key step, including choosing verification tools (e.g., software simulation, formal verification, hardware acceleration), configuring the environment (e.g., server, FPGA), creating the test environment, and basic test cases. Initial basic test cases are often called &ldquo;smoke tests.&rdquo; Subsequent test codes are based on this platform, so it must be reusable. The platform includes the test framework, the code being tested, and basic signal stimuli.</p>
<p><strong>Organizing Functional Points：</strong> This involves listing the DUT&rsquo;s basic functions based on the specification manual and detailing how to test each function. Functional points are prioritized based on importance, risk, and complexity. They also need to be tracked for status, with updates synchronized to the plan if changes occur.</p>
<p><strong>Test Cases</strong> These are conditions or variables used to determine if the DUT meets specific requirements and operates correctly. Each case includes test conditions, input data, expected results, actual results, and test outcomes. Running test cases and comparing expected vs. actual results help verify the system or application&rsquo;s correct implementation of functions or requirements. Test cases are crucial tools for verifying chip design against specifications.</p>
<p><strong>Coding Implementation：</strong> This is the execution of test cases, including generating test data, selecting the test framework, programming language, and writing the reference model. This phase requires a deep understanding of functional points and test cases. Misunderstandings can lead to the DUT being undrivable or undetected bugs.</p>
<p><strong>Collecting Bugs/Coverage：</strong> The goal of verification is to find design bugs early, so collected bugs need unique identifiers, severity ratings, and status tracking with design engineers. Discovering bugs is ideal, but since not every test finds bugs, coverage is another metric to evaluate verification thoroughness. Sufficient verification is indicated when coverage (e.g., code coverage &gt;90%) exceeds a threshold.</p>
<p><strong>Regression Testing：</strong> As verification and design are iterative, regression tests ensure the modified DUT still functions correctly after bug fixes. This catches new errors or reactivates old ones due to changes. Regression tests can be comprehensive or selective, covering all functions or specific parts.</p>
<p><strong>Test Report：</strong> This summarizes the entire verification process, providing a comprehensive view of the testing activities, including objectives, executed test cases, discovered issues, coverage, and efficiency.</p>
</blockquote></p>
<h2 id="levels-of-chip-verification">Levels of Chip Verification</h2>
<hr>
<p>Chip verification typically includes four levels based on the object size: UT, BT, IT, and ST.</p>
<p><strong>Unit Testing（UT）：</strong> The lowest verification level, focusing on single modules or components to ensure their functionality is correct.</p>
<p><strong>Block Testing (BT) ：</strong> Modules often have tight coupling, making isolated UT testing complex. BT merges several coupled modules into one DUT block for testing.</p>
<p><strong>Integration Testing (IT) ：</strong> Builds on UT by combining multiple modules or components to verify their collaborative functionality, usually testing subsystem functionality.</p>
<p><strong>System Testing (ST) ：</strong> Also called Top verification, ST combines all modules or components into a complete system to verify overall functionality and performance requirements.</p>
<p>In theory, these levels follow a bottom-up order, each building on the previous level. However, practical verification activities depend on the scale, expertise, and functional needs of the enterprise, so not all levels are always involved. At each level, relevant test cases are written, tests run, and results analyzed to ensure the chip design&rsquo;s correctness and quality.</p>
<h2 id="chip-verification-metrics">Chip Verification Metrics</h2>
<hr>
<p>Verification metrics typically include functional correctness, test coverage, defect density, verification efficiency, and verification cost. Functional correctness is the fundamental metric, ensuring the chip executes its designed functions correctly. This is validated through functional test cases, including normal and robustness tests. Test coverage indicates the extent to which test cases cover design functionality, with higher coverage implying higher verification quality. Coverage can be further divided into code coverage, functional coverage, condition coverage, etc. Defect density measures the number of defects found in a given design scale or code volume, with lower density indicating higher design quality. Verification efficiency measures the amount of verification work completed within a given time and resource frame, with higher efficiency indicating higher productivity. Verification cost encompasses all resources required for verification, including manpower, equipment, and time, with lower costs indicating higher cost-effectiveness.</p>
<blockquote><p>
<p>Functional correctness is the absolute benchmark for verification. However, in practice, it is often impossible to determine if the test plan is comprehensive and if all test spaces have been adequately covered. Therefore, a quantifiable metric is needed to guide whether verification is sufficient and when it can be concluded. This metric is commonly referred to as &ldquo;test coverage.&rdquo; Test coverage typically includes code coverage (lines, functions, branches) and functional coverage.</p>
<p><strong>Code Line Coverage：</strong> This indicates how many lines of the DUT design code were executed during testing.</p>
<p><strong>Function Coverage：</strong> This indicates how many functions of the DUT design code were executed during testing.</p>
<p><strong>Branch Coverage：</strong> This indicates how many branches (if-else) of the DUT design code were executed during testing.</p>
<p><strong>Functional Coverage：</strong> This indicates how many predefined functions were triggered during testing.</p>
<p>High code coverage can improve the quality and reliability of verification but does not guarantee complete correctness since it cannot cover all input and state combinations. Therefore, in addition to pursuing high code coverage, other testing methods and metrics, such as functional testing, performance testing, and defect density, should be combined.</p>
</blockquote></p>
<h2 id="chip-verification-management">Chip Verification Management</h2>
<hr>
<p>Chip verification management is a <strong>comprehensive process</strong> that encompasses all activities in the chip verification process, including the development of verification strategies, the setup of the verification environment, the writing and execution of test cases, the collection and analysis of results, and the tracking and resolution of issues and defects. The goal of chip verification management is to ensure that the chip design meets all functional and performance requirements, as well as specifications and standards.</p>
<p>In chip verification management, the first step is to formulate a detailed verification strategy, including objectives, scope, methods, and schedules. Then, a suitable verification environment must be set up, including hardware, software tools, and test data. Next, a series of test cases covering all functional and performance points must be written and executed, with results collected and analyzed to identify problems and defects. Finally, these issues and defects need to be tracked and fixed until all test cases pass.</p>
<p>Chip verification management is a complex process requiring a variety of skills and knowledge, including chip design, testing methods, and project management. It requires close collaboration with other activities, such as chip design, production, and sales, to ensure the quality and performance of the chip. The effectiveness of chip verification management directly impacts the success of the chip and the company&rsquo;s competitiveness. Therefore, chip verification management is a crucial part of the chip development process.</p>
<p>The chip verification management process can be based on a &ldquo;project management platform&rdquo; and a &ldquo;bug management platform,&rdquo; with platform-based management typically being significantly more efficient than manual management.</p>
<h2 id="current-state-of-chip-verification">Current State of Chip Verification</h2>
<hr>
<p>Currently, chip verification is typically completed within chip design companies. This process is not only technically complex but also entails significant costs. Given the close relationship between acceptance and design, chip verification inevitably involves the source code of the chip design. However, chip design companies usually consider the source code as a trade secret, necessitating internal personnel to perform the verification, making outsourcing difficult.</p>

<figure>
    <img src="time_of_verification.png"
         alt="Verification Workload Proportion" width="700px"/> 
</figure>

<p>The importance of chip verification lies in ensuring that the designed chip operates reliably under various conditions. Verification is not only for meeting technical specifications but also for addressing the growing complexity and emerging technology demands. As the semiconductor industry evolves, the workload of chip verification has been continuously increasing, especially for complex chips, where verification work has exceeded design work, accounting for more than 70%. This means that in terms of engineer personnel ratio, verification engineers are usually twice the number of design engineers (e.g., in a team of three thousand at Zeku, there are about one thousand design engineers and two thousand verification engineers. Similar or higher ratios apply to other large chip design companies).</p>
<p>Due to the specificity of verification work, which requires access to the chip design source code, it significantly limits the possibility of outsourcing chip verification. The source code is considered the company&rsquo;s core trade secret, involving technical details and innovations, thus making it legally and securely unfeasible to share with external parties. Consequently, internal personnel must shoulder the verification work, increasing the internal workload and costs.</p>
<p>Given the current situation, the demand for chip verification engineers continues to grow. They need a solid technical background, familiarity with various verification tools and methods, and keen insight into emerging technologies. Due to the complexity of verification work, verification teams typically need a large scale, contrasting sharply with the design team size.</p>
<p>To meet this challenge, the industry may need to continuously explore innovative verification methods and tools to improve efficiency and reduce costs.</p>
<blockquote><p>
Summary: Complex Chip Verification Costs
<p><strong>High Verification Workload：</strong> For complex chips, verification work accounts for over 70% of the entire chip design work.</p>
<p><strong>High Labor Costs：</strong> The number of verification engineers is twice that of design engineers, with complex tasks requiring thousands of engineers.</p>
<p><strong>Internal Verification：</strong> To ensure trade secrets (chip design code) are not leaked, chip design companies can only hire a large number of verification engineers to perform verification work internally.</p>
</blockquote></p>
<h2 id="crowdsourcing-chip-verification">Crowdsourcing Chip Verification</h2>
<hr>
<p>In contrast to hardware, the software field has already made testing outsourcing (subcontracting) a norm to reduce testing costs. This business is highly mature, with a market size in the billions of yuan, advancing towards the trillion-yuan scale. From the content perspective, software testing and hardware verification share significant similarities (different targets with the same system objective). Is it feasible to subcontract hardware verification in the same way as software?</p>
<p><img alt="Software Outsourcing Market" src="maket_of_soft_test.png"></p>
<blockquote><p>
Crowdsourcing chip verification faces many challenges, such as:
<p><strong>Small Number of Practitioners：</strong> Compared to the software field, the number of hardware developers is several orders of magnitude smaller. For instance, according to GitHub statistics (<a href="https://madnight.github.io/githut/#/pull_requests/2023/2)">https://madnight.github.io/githut/#/pull_requests/2023/2)</a>, traditional software programming languages (Python, Java, C++, Go) account for nearly 50%, whereas hardware description languages like Verilog account for only 0.076%, reflecting the disparity in developer numbers.</p>
<p><strong>Commercial Verification Tools：</strong> The verification tools used in enterprises (simulators, formal verification, data analysis) are almost all commercial tools, which are nearly invisible to ordinary people and difficult to self-learn.</p>
<p><strong>Lack of Open Learning Materials：</strong> Chip verification involves accessing the chip design source code, which is typically regarded as the company&rsquo;s trade secrets and proprietary technology. Chip design companies may be unwilling to disclose detailed verification processes and techniques, limiting the availability of learning materials.</p>
</blockquote></p>
<h4 id="feasibility-analysis">Feasibility Analysis</h4>
<p>Although the chip verification field has been relatively closed, from a technical perspective, adopting a subcontracting approach for verification is a feasible option due to several factors:</p>
<p>Firstly, with the gradual increase of open-source chip projects, the source code involved in verification has become more open and transparent. These open-source projects do not have concerns about trade secrets in their design and verification process, providing more possibilities for learning and research. Even if some projects involve trade secrets, encryption and other methods can be used to hide design codes, addressing trade secret issues to a certain extent and making verification easier to achieve.</p>
<p>Secondly, many fundamental verification tools have emerged in the chip verification field, such as Verilator and SystemC. These tools provide robust support for verification engineers, helping them perform verification work more efficiently. These tools alleviate some of the complexity and difficulty of the verification process, providing a more feasible technical foundation for adopting subcontracted verification methods.</p>
<p>In the open-source software field, some successful cases can be referenced. For example, the Linux kernel verification process adopts a subcontracting approach, with different developers and teams responsible for verifying different modules, ultimately forming a complete system. Similarly, in the machine learning field, the ImageNet project adopted a crowdsourced annotation strategy, completing large-scale image annotation tasks through crowdsourcing. These cases provide successful experiences for the chip verification field, proving the potential of subcontracted verification to improve efficiency and reduce costs.</p>
<p>Therefore, despite the chip verification field being relatively closed compared to other technical fields, technological advances and the increase of open-source projects offer new possibilities for adopting subcontracted verification. By drawing on successful experiences from other fields and utilizing existing verification tools, we can promote the application of more open and efficient verification methods in chip verification, further advancing the industry. This openness and flexibility in technology will provide more choices for verification engineers, promoting innovative and diverse development in the chip verification field.</p>
<h4 id="technical-route">Technical Route</h4>
<blockquote><p>
<p>To overcome challenges and engage more people in chip verification, this project continuously attempts the following technical directions:</p>
<p><strong>Provide Multi-language Verification Tools：</strong> Traditional chip verification is based on the System Verilog programming language, which has a small user base. To allow other software development/testing professionals to participate in chip verification, this project provides multi-language verification conversion tools <a href="https://github.com/XS-MLVP/picker">Picker</a>, enabling verifiers to use familiar programming languages (e.g., C++, Python, Java, Go) with open-source verification tools.</p>
<p><strong>Provide Verification Learning Materials：</strong> The scarcity of chip verification learning materials is mainly due to the improbability of commercial companies disclosing internal data. Therefore, this project will continuously update learning materials, allowing verifiers to learn the necessary skills online for free.</p>
<p><strong>Provide Real Chip Verification Cases：</strong> To make the learning materials more practical, this project uses the &ldquo;Xiangshan Kunming Lake (an industrial-grade high-performance RISC-V processor) IP core&rdquo; as a basis, continuously updating verification cases by extracting modules from it.</p>
<p><strong>Organize Chip Design Subcontracted Verification：</strong> Applying what is learned is the goal of every learner. Therefore, this project periodically organizes subcontracted chip design verification, allowing everyone (whether you are a university student, verification expert, software developer, tester, or high school student) to participate in real chip design work.</p>
</blockquote></p>
<p>The goal of this project is to achieve the following vision: &ldquo;Open the black box of traditional verification modes, allowing anyone interested to participate in chip verification anytime, anywhere, using their preferred programming language.&rdquo;</p>

<figure>
    <img src="landscape.png"
         alt="Vision" width="700px"/> 
</figure>


</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d3cde34a1f60a51b0990066a7b5fc0c9">3.2 - Digital Circuits</h1>
    <div class="lead">Basic concepts of digital circuits</div>
	

<div class="pageinfo pageinfo-primary">
<p>This page introduces the basics of digital circuits. Digital circuits use digital signals and are the foundation of most modern computers.</p>

</div>

<h2 id="what-are-digital-circuits">What Are Digital Circuits</h2>
<hr>
<p>Digital circuits are electronic circuits that use two discrete voltage levels to represent information. Typically, digital circuits use two power supply voltages to indicate high (H) and low (L) levels, representing the digits 1 and 0 respectively. This representation uses binary signals to transmit and process information.</p>
<p>Most digital circuits are built using field-effect transistors, with MOSFETs (Metal-Oxide-Semiconductor Field-Effect Transistors) being the most common. MOSFETs are semiconductor devices that control current flow using an electric field, enabling digital signal processing.</p>
<p>In digital circuits, MOSFETs are combined to form various logic gates like AND, OR, and NOT gates. These logic gates are combined in different ways to create the various functions and operations in digital circuits. Here are some key features of digital circuits:</p>
<p><strong>(1) Voltage Representation：</strong> Digital circuits use two voltage levels, high and low, to represent digital information. Typically, a high level represents the digit 1, and a low level represents the digit 0.</p>
<p><strong>(2) MOSFET Implementation：</strong> MOSFETs are one of the most commonly used components in digital circuits. By controlling the on and off states of MOSFETs, digital signal processing and logic operations can be achieved.</p>
<p><strong>(3) Logic Gate Combinations：</strong> Logic gates, composed of MOSFETs, are the basic building blocks of digital circuits. By combining different logic gates, complex digital circuits can be built to perform various logical functions.</p>
<p><strong>(4) Binary Representation：</strong> Information in digital circuits is typically represented using the binary system. Each digit can be made up of a series of binary bits, which can be processed and operated on within digital circuits.</p>
<p><strong>(5) Signal Processing：</strong> Digital circuits convert and process signals through changes in voltage and logic operations. This discrete processing method makes digital circuits well-suited for computing and information processing tasks.</p>
<h2 id="why-learn-digital-circuits">Why Learn Digital Circuits</h2>
<hr>
<p>Learning digital circuits is fundamental and necessary for the chip verification process, primarily for the following reasons:</p>
<p><strong>(1) Understanding Design Principles：</strong> Digital circuits are the foundation of chip design. Knowing the basic principles and design methods of digital circuits is crucial for understanding the structure and function of chips. The goal of chip verification is to ensure that the designed digital circuits work according to specifications in actual hardware, and understanding digital circuits is key to comprehending the design.</p>
<p><strong>(2) Design Standards：</strong> Chip verification typically involves checking whether the design meets specific standards and functional requirements. Learning digital circuits helps in understanding these standards, thus building better test cases and verification processes to ensure thorough and accurate verification.</p>
<p><strong>(3) Timing and Clocks：</strong> Timing issues are common challenges in digital circuit design and verification. Learning digital circuits helps in understanding concepts of timing and clocks, ensuring that timing issues are correctly handled during verification, avoiding timing delays and conflicts in the circuit.</p>
<p><strong>(4) Logical Analysis：</strong> Chip verification often involves logical analysis to ensure circuit correctness. Learning digital circuits fosters a deep understanding of logic, aiding in logical analysis and troubleshooting.</p>
<p><strong>(5) Writing Test Cases：</strong> In chip verification, various test cases need to be written to ensure design correctness. Understanding digital circuits helps in designing comprehensive and targeted test cases, covering all aspects of the circuit.</p>
<p><strong>(6) Signal Integrity：</strong> Learning digital circuits helps in understanding signal propagation and integrity issues within circuits. Ensuring proper signal transmission under different conditions is crucial, especially in high-speed designs.</p>
<p>Overall, learning digital circuits provides foundational knowledge and tools for chip verification, enabling verification engineers to better understand designs, write effective test cases, analyze verification results, and troubleshoot issues. Theoretical and practical experience with digital circuits is indispensable for chip verification engineers.</p>
<h2 id="digital-circuits-basics">Digital Circuits Basics</h2>
<p>You can learn digital circuits through the following online resources：</p>
<ul>
<li><a href="https://www.xuetangx.com/course/THU08081000386/19317632">Tsinghua University&rsquo;s Digital Circuits Basics</a></li>
<li><a href="https://soc.ustc.edu.cn/Digital/">USTC Digital Circuit Lab</a></li>
<li><a href="https://github.com/apachecn/huazhang-cs-books/blob/master/%E6%95%B0%E5%AD%97%E8%AE%BE%E8%AE%A1%E5%92%8C%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%8E%9F%E4%B9%A6%E7%AC%AC2%E7%89%88.pdf">Digital Design and Computer Architecture</a></li>
<li><a href="https://ocw.mit.edu/courses/6-374-analysis-and-design-of-digital-integrated-circuits-fall-2003/download/">MIT Analysis and Design of Digital Integrated Circuits</a></li>
</ul>
<h2 id="hardware-description-language-chisel">Hardware Description Language Chisel</h2>
<hr>
<h3 id="traditional-description-languages">Traditional Description Languages</h3>
<p>Hardware Description Languages (HDL) are languages used to describe digital circuits, systems, and hardware. They allow engineers to describe hardware structure, function, and behavior through text files, enabling abstraction and modeling of hardware designs.</p>
<p>HDL is commonly used for designing and simulating digital circuits such as processors, memory, controllers, etc. It provides a formal method to describe the behavior and structure of hardware circuits, making it easier for design engineers to perform hardware design, verification, and simulation.</p>
<p>Common hardware description languages include:</p>
<ul>
<li>Verilog：One of the most used HDLs, Verilog is an event-driven language widely used for digital circuit design, verification, and simulation.</li>
<li>VHDL：Another common HDL, VHDL is an object-oriented language offering richer abstraction and modular design methods.</li>
<li>SystemVerilog：An extension of Verilog, SystemVerilog introduces advanced features like object-oriented programming and randomized testing, making Verilog more suitable for complex system design and verification.</li>
</ul>
<h3 id="chisel">Chisel</h3>
<p>Chisel is a modern, advanced hardware description language that differs from traditional Verilog and VHDL. It&rsquo;s a hardware construction language based on Scala. Chisel offers a more modern and flexible way to describe hardware, leveraging Scala’s features to easily implement parameterization, abstraction, and reuse while maintaining hardware-level efficiency and performance.</p>
<p>Chisel’s features include:</p>
<ul>
<li>Modern Syntax: Chisel&rsquo;s syntax is more similar to software programming languages like Scala, making hardware description more intuitive and concise.</li>
<li>Parameterization and Abstraction: Chisel supports parameterization and abstraction, allowing for the creation of configurable and reusable hardware modules.</li>
<li>Type Safety: Based on Scala, Chisel has type safety features, enabling many errors to be detected at compile-time.</li>
<li>Generating Performance-Optimized Hardware: Chisel code can be converted to Verilog and then synthesized, placed, routed, and simulated by standard EDA toolchains to generate performance-optimized hardware.</li>
<li>Strong Simulation Support: Chisel provides simulation support integrated with ScalaTest and Firrtl, making hardware simulation and verification more convenient and flexible.</li>
</ul>
<h4 id="chisel-example-of-a-full-adder">Chisel Example of a Full Adder</h4>
<p>The circuit design is shown below:</p>

<figure>
    <img src="fulladder.png"
         alt="Full Adder Circuit" width="500px"/> 
</figure>

<p>Complete Chisel code:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">examples</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">chisel3</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">class</span> <span style="color:#000">FullAdder</span> <span style="color:#000">extends</span> <span style="color:#000">Module</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic">// Define IO ports
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#000">val</span> <span style="color:#000">io</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">IO</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">new</span> <span style="color:#000">Bundle</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">val</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Input</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">UInt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1.</span><span style="color:#000">W</span><span style="color:#000;font-weight:bold">))</span>    <span style="color:#8f5902;font-style:italic">// Input port &#39;a&#39; of width 1 bit
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">val</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Input</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">UInt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1.</span><span style="color:#000">W</span><span style="color:#000;font-weight:bold">))</span>    <span style="color:#8f5902;font-style:italic">// Input port &#39;b&#39; of width 1 bit
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">val</span> <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Input</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">UInt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1.</span><span style="color:#000">W</span><span style="color:#000;font-weight:bold">))</span>  <span style="color:#8f5902;font-style:italic">// Input port &#39;cin&#39; (carry-in) of width 1 bit
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">val</span> <span style="color:#000">sum</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Output</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">UInt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1.</span><span style="color:#000">W</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#8f5902;font-style:italic">// Output port &#39;sum&#39; of width 1 bit
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">val</span> <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Output</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">UInt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1.</span><span style="color:#000">W</span><span style="color:#000;font-weight:bold">))</span><span style="color:#8f5902;font-style:italic">// Output port &#39;cout&#39; (carry-out) of width 1 bit
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic">// Calculate sum bit (sum of a, b, and cin)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#000">val</span> <span style="color:#000">s1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">io</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">^</span> <span style="color:#000">io</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">b</span>               <span style="color:#8f5902;font-style:italic">// XOR operation between &#39;a&#39; and &#39;b&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#000">io</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">s1</span> <span style="color:#ce5c00;font-weight:bold">^</span> <span style="color:#000">io</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cin</span>              <span style="color:#8f5902;font-style:italic">// XOR operation between &#39;s1&#39; and &#39;cin&#39;, result assigned to &#39;sum&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic">// Calculate carry-out bit
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#000">val</span> <span style="color:#000">s3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">io</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">io</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">b</span>               <span style="color:#8f5902;font-style:italic">// AND operation between &#39;a&#39; and &#39;b&#39;, result assigned to &#39;s3&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#000">val</span> <span style="color:#000">s2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">s1</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">io</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cin</span>               <span style="color:#8f5902;font-style:italic">// AND operation between &#39;s1&#39; and &#39;cin&#39;, result assigned to &#39;s2&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#000">io</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">s2</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">s3</span>                 <span style="color:#8f5902;font-style:italic">// OR operation between &#39;s2&#39; and &#39;s3&#39;, result assigned to &#39;cout&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>You can refer to Chisel learning materials from the official documentation: <a href="https://www.chisel-lang.org/docs">https://www.chisel-lang.org/docs</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f9d4c1f404f62253b519fd8af17d8389">3.3 - Creating DUT</h1>
    <div class="lead">Using Guoke Cache as an example, this document introduces how to create a DUT based on Chisel.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Using Guoke Cache as an example, this document introduces how to create a DUT based on Chisel.</p>

</div>

<p>In this document, a DUT (Design Under Test) refers to the circuit or system being verified during the chip verification process. The DUT is the primary subject of verification. When creating a DUT based on the picker tool, it is essential to consider the functionality, performance requirements, and verification goals of the subject under test. These goals may include the need for faster execution speed or more detailed test information. Generally, the DUT, written in RTL, is combined with its surrounding environment to form the verification environment (test_env), where test cases are written. In this project, the DUT is the Python module that needs to be tested and converted through RTL. Traditional RTL languages include Verilog, System Verilog, VHDL, etc. However, as an emerging RTL design language, （<a href="https://www.chisel-lang.org/">https://www.chisel-lang.org/</a>） is playing an increasingly important role in RTL design due to its object-oriented features and ease of use. This chapter introduces how to create a DUT using the conversion of the cache source code from the <a href="https://github.com/OSCPU/NutShell">Guoke Processor-NutShell</a> to a Python module as an example.</p>
<h2 id="chisel-and-guoke">Chisel and Guoke</h2>
<p>Chisel is a high-level hardware construction language (HCL) based on the Scala language. Traditional HDLs describe circuits, while HCLs generate circuits, making them more abstract and advanced. The Stage package provided in Chisel can convert HCL designs into traditional HDL languages such as Verilog and System Verilog. With tools like Mill and Sbt, automation in development can be achieved.</p>
<p>Guoke is a sequential single-issue processor implementation based on the RISC-V RV64 open instruction set, modularly designed using the Chisel language. For a more detailed introduction to Guoke, please refer to the link: <a href="https://oscpu.github.io/NutShell-doc/">https://oscpu.github.io/NutShell-doc/</a>.</p>
<h2 id="guoke-cache">Guoke cache</h2>
<p>The Guoke Cache (Nutshell Cache) is the cache module used in the Guoke processor. It features a three-stage pipeline design. When the third stage pipeline detects that the current request is MMIO or a refill occurs, it will block the pipeline. The Guoke Cache also uses a customizable modular design that can generate different-sized L1 Caches or L2 Caches by changing parameters. Additionally, the Guoke Cache has a coherence interface to handle coherence-related requests.</p>
<p><img alt="nt_cache" src="nt_cache.png"></p>
<h2 id="chisel-to-verilog">Chisel to Verilog</h2>
<p>The stage library in Chisel helps generate traditional HDL code such as Verilog and System Verilog from Chisel code. Below is a brief introduction on how to convert a cache implementation based on Chisel into the corresponding Verilog circuit description.</p>
<h3 id="initializing-the-guoke-environment">Initializing the Guoke Environment</h3>
<p>First, download the entire Guoke source code from the source repository and initialize it:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir cache-ut
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> cache-ut
</span></span><span style="display:flex;"><span>git clone https://github.com/OSCPU/NutShell.git
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> NutShell <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> git checkout 97a025d
</span></span><span style="display:flex;"><span>make init
</span></span></code></pre></div><h3 id="creating-scala-compilation-configuration">Creating Scala Compilation Configuration</h3>
<p>Then, create build.sc in the cache-ut directory with the following content:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">$file.NutShell.build</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">mill._</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">scalalib</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#204a87;font-weight:bold">_</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">coursier.maven.MavenRepository</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">mill.scalalib.TestModule._</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Specify Nutshell dependencies
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">object</span> <span style="color:#000">difftest</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">NutShell</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">build</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CommonNS</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">override</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">millSourcePath</span> <span style="color:#204a87;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pwd</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#4e9a06">&#34;NutShell&#34;</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#4e9a06">&#34;difftest&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Nutshell configuration
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">object</span> <span style="color:#000">NtShell</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">NutShell</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">build</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CommonNS</span> <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">NutShell</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">build</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">HasChiselTests</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">override</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">millSourcePath</span> <span style="color:#204a87;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pwd</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#4e9a06">&#34;NutShell&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">override</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">moduleDeps</span> <span style="color:#204a87;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">moduleDeps</span> <span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000">Seq</span><span style="color:#ce5c00;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">difftest</span><span style="color:#ce5c00;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// UT environment configuration
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">object</span> <span style="color:#000">ut</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">NutShell</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">build</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CommonNS</span> <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">ScalaTest</span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">override</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">millSourcePath</span> <span style="color:#204a87;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pwd</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">override</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">moduleDeps</span> <span style="color:#204a87;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">moduleDeps</span> <span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000">Seq</span><span style="color:#ce5c00;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">NtShell</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="instantiating-cache">Instantiating cache</h3>
<p>After creating the configuration information, create the src/main/scala source code directory according to the Scala specification. Then, in the source code directory, create nut_cache.scala and use the following code to instantiate the Cache and convert it into Verilog code:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">ut_nutshell</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">chisel3._</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">chisel3.util._</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">nutcore._</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">top._</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">chisel3.stage._</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">object</span> <span style="color:#000">CacheMain</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">App</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ChiselStage</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#000">execute</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Seq</span><span style="color:#ce5c00;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">ChiselGeneratorAnnotation</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#204a87;font-weight:bold">=&gt;</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Cache</span><span style="color:#ce5c00;font-weight:bold">()(</span><span style="color:#000">CacheConfig</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ro</span> <span style="color:#204a87;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">name</span> <span style="color:#204a87;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;tcache&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">userBits</span> <span style="color:#204a87;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">16</span><span style="color:#ce5c00;font-weight:bold">)))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="generating-rtl">Generating RTL</h3>
<p>After creating all the files (build.sc, src/main/scala/nut_cache.scala), execute the following command in the cache-ut directory:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir build
</span></span><span style="display:flex;"><span>mill --no-server -d ut.runMain ut_nutshell.CacheMain --target-dir build --output-file Cache
</span></span></code></pre></div><p>Note: For the Mill environment configuration, please refer to <a href="https://mill-build.com/mill/Intro_to_Mill.html">https://mill-build.com/mill/Intro_to_Mill.html</a>.</p>
<p>After successfully executing the above command, a Verilog file Cache.v will be generated in the build directory. Then, the picker tool can be used to convert Cache.v into a Python module. Besides Chisel, almost all other HCL languages can generate corresponding RTL codes, so the basic process above also applies to other HCLs.</p>
<h3 id="dut-compilation">DUT Compilation</h3>
<p>Generally, if you need the DUT to generate waveforms, coverage, etc., it will slow down the DUT&rsquo;s execution speed. Therefore, when generating a Python module through the picker tool, it will be generated according to various configurations: (1) Turn off all debug information; (2) Enable waveforms; (3) Enable code line coverage. The first configuration aims to quickly build the environment for regression testing, etc.; the second is used to analyze specific errors, timing, etc.; the third is used to improve coverage.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-82b31af9e0ee05c3d251234b764020ed">3.4 - DUT Verification</h1>
    <div class="lead">Overview of the general verification process</div>
	

<div class="pageinfo pageinfo-primary">
<p>This section introduces the general process of verifying a DUT based on Picker.</p>

</div>

<p>The goal of the open verification platform is functional verification, which generally involves the following steps:</p>
<h3 id="1-determine-the-verification-object-and-goals">1. Determine the verification object and goals</h3>
<p>Typically, the design documentation of the DUT is also delivered to the verification engineer. At this point, you need to read the documentation or source code to understand the basic functions, main structure, and expected functionalities of the verification object.</p>
<h3 id="2-build-the-basic-verification-environment">2. Build the basic verification environment</h3>
<p>After fully understanding the design, you need to build the basic verification environment. For example, in addition to the DUT generated by Picker, you may also need to set up a reference model for comparison and a signal monitoring platform for evaluating subsequent functional points.</p>
<h3 id="3-decompose-functional-points-and-test-points">3. Decompose functional points and test points</h3>
<p>Before officially starting the verification, you need to extract the functional points and further decompose them into test points. You can refer to: <a href="https://blog.csdn.net/W1Z1Q/article/details/124547192">CSDN: Chip Verification Series - Decomposition of Testpoints</a></p>
<h3 id="4-construct-test-cases">4. Construct test cases</h3>
<p>With the test points, you need to construct test cases to cover the corresponding test points. A test case may cover multiple test points.</p>
<h3 id="5-collect-test-results">5. Collect test results</h3>
<p>After running all the test cases, you need to summarize all the test results. Generally, this includes line coverage and functional coverage. The former can be obtained through the coverage function provided by the Picker tool, while the latter requires you to judge whether a function is covered by the test cases through monitoring the behavior of the DUT.</p>
<h3 id="6-evaluate-the-test-results">6. Evaluate the test results</h3>
<p>Finally, you need to evaluate the obtained results, such as whether there are design errors, whether a function cannot be triggered, whether the design documentation description is consistent with the DUT behavior, and whether the design documentation is clearly described.</p>
<hr>
<p>Next, we will introduce the general verification process using<strong>MMIO read and write of Nutshell Cache</strong> as an example:</p>
<p><strong>1 Determine the verification object and goals:</strong>：<br>
The MMIO read and write function of the Nutshell Cache. MMIO is a special type of IO mapping that supports accessing IO device registers by accessing memory addresses. Since the register state of IO devices can change at any time, it is not suitable to cache it. When receiving an MMIO request, the Nutshell cache will directly access the MMIO memory area to read or write data instead of querying hit/miss in the ordinary cache line.</p>
<p><strong>2 Build the basic verification environment:</strong>：<br>
We can roughly divide the verification environment into five parts:
<img src="env.png" alt="env" width="800" height="600"></p>
<blockquote>
<p><strong>1. Testcase Driver</strong>：Responsible for generating corresponding signals driven by test cases
<strong>2. Monitor</strong>：Monitors signals to determine whether functions are covered and correct
<strong>3. Ref Cache</strong>：A simple reference model
<strong>4. Memory/MMIO Ram</strong>：Simulates peripheral devices to simulate corresponding cache requests
<strong>5. Nutshell Cache Dut</strong>：DUT generated by Picker</p>
</blockquote>
<p>In addition, you may need to further encapsulate the DUT interface to achieve more convenient read and write request operations. For details, refer to <a href="https://github.com/yzcccccccccc/XS-MLVP-NutShellCache/blob/master/UT_Cache/util/cachewrapper.py">Nutshll cachewrapper</a>.</p>
<p><strong>3 Decompose functional points and test points</strong>：<br>
Nutshell cache can respond to MMIO requests, further decomposing into the following test points:</p>
<blockquote>
<p><strong>Test Point 1</strong>：MMIO requests will be forwarded to the MMIO port
<strong>Test Point 2</strong>：The cache will not issue burst transfer requests when responding to MMIO requests
<strong>Test Point 3</strong>：The cache will block the pipeline when responding to MMIO requests</p>
</blockquote>
<p><strong>4 Construct test cases</strong>：
The construction of test cases is simple. Knowing that the MMIO address range of the Nutshell cache obtained through <a href="/zh-cn/docs/basic/create_dut">Creating DUT</a>is 0x30000000~0x7fffffff, we only need to access this memory range to obtain the expected MMIO results. Note that to trigger the test point of blocking the pipeline, you may need to initiate requests continuously.<br>
Here is a simple test case:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># import CacheWrapper here</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">mmio_test</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cache</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">CacheWrapper</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">mmio_lb</span>	<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0x30000000</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">mmio_rb</span>	<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0x30001000</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">[MMIO Test]: Start MMIO Serial Test&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">addr</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mmio_lb</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">mmio_rb</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">16</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">addr</span> <span style="color:#ce5c00;font-weight:bold">&amp;=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0xf</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">addr1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">addr</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">addr2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">addr</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">addr3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">addr</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">trigger_read_req</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">addr1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">trigger_read_req</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">addr2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">trigger_read_req</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">addr3</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">recv</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">recv</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">recv</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;[MMIO Test]: Finish MMIO Serial Test&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p><strong>5 Collect test results</strong>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#4e9a06">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    In tb_cache.py
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># import packages here</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">TestCache</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">setup_class</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">color</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">print_blue</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">Cache Test Start&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTCache</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;libDPICache.so&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">init_clock</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;clock&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Init here</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">testlist</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;mmio_serial&#34;</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">teardown_class</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">finalize</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">color</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">print_blue</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">Cache Test End&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__reset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Reset cache and devices</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># MMIO Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_mmio</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;mmio_serial&#34;</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">testlist</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Run test</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">..test.test_mmio</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">mmio_test</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">mmio_test</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cache</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ref_cache</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">mmio test is not included&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">setup_class</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># test</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">test_mmio</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">teardown_class</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;__main__&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">tb</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">TestCache</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">tb</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>Run：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    python3 tb_cache.py
</span></span></code></pre></div><p>The above is only a rough execution process, for details refer to：<a href="https://github.com/yzcccccccccc/XS-MLVP-NutShellCache">Nutshell Cache Verify</a>。</p>
<p><strong>6 Evaluate the running results</strong><br>
After the run is complete, the following data can be obtained:
Line coverage:
<img src="line_cov.png" alt="line_cov" width="800" height="600"></p>
<p>Functional coverage:
<img src="func_cov.png" alt="func_cov" width="400" height="300"></p>
<p>It can be seen that the preset MMIO functions are all covered and correctly triggered.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9677ff4fee20856211cd5ff4272fe758">3.5 - Verification Report</h1>
    <div class="lead">An overview of the structure and content of the verification report.</div>
	

<div class="pageinfo pageinfo-primary">
<p>After we complete the DUT verification, writing a verification report is a crucial step. This section will provide an overview of the structure of the verification report and the content that needs to be covered.</p>

</div>

<p>The verification report is a review of the entire verification process and an important supporting document for determining the reasonableness of the verification. Generally, the verification report should include the following content:</p>
<blockquote>
<ol>
<li>Basic document information (author, log, version, etc.)</li>
<li>Verification object (verification target)</li>
<li>Introduction to functional points</li>
<li>Verification plan</li>
<li>Breakdown of test points</li>
<li>Test cases</li>
<li>Test environment</li>
<li>Result analysis</li>
<li>Defect analysis</li>
<li>Verification conclusion</li>
</ol>
</blockquote>
<p>The following content provides further explanation of the list, with specific examples available in<a href="nutshell_cache_report_demo.pdf">nutshell_cache_report_demo.pdf</a></p>
<hr>
<h3 id="1-basic-information">1. Basic Information</h3>
<p>Including author, log, version, date, etc.</p>
<h3 id="2-verification-object-verification-target">2. Verification object (verification target)</h3>
<p>A necessary introduction to your verification object, which may include its structure, basic functions, interface information, etc.</p>
<h3 id="3-introduction-to-functional-points">3. Introduction to functional points</h3>
<p>By reading the design documents or source code, you need to summarize the target functions of the DUT and break them down into various functional points.</p>
<h3 id="4-verification-plan">4. Verification plan</h3>
<p>Including your planned verification process and verification framework. Additionally, you should explain how each part of your framework works together.</p>
<h3 id="5-breakdown-of-test-points">5. Breakdown of test points</h3>
<p>Proposed testing methods for the functional points. Specifically, it can include what signal output should be observed under certain signal inputs.</p>
<h3 id="6-test-cases">6. Test cases</h3>
<p>The specific implementation of the test points. A test case can include multiple test points.</p>
<h3 id="7-test-environment">7. Test environment</h3>
<p>Including hardware information, software version information, etc.</p>
<h3 id="8-result-analysis">8. Result analysis</h3>
<p>Result analysis generally refers to coverage analysis. Typically, two types of coverage should be considered:
<strong>1. Line Coverage</strong>： How many RTL lines of code are executed in the test cases. Generally, we require line coverage to be above 98%.<br>
<strong>2. Functional Coverage</strong>：Determine whether the extracted functional points are covered and correctly triggered based on the relevant signals. We generally require test cases to cover each functional point.</p>
<h3 id="9-defect-analysis">9. Defect analysis</h3>
<p>Analyze the defects present in the DUT. This can include the specification and detail of the design documents, the correctness of the DUT functions (whether there are bugs), and whether the DUT functions can be triggered.</p>
<h3 id="10-verification-conclusion">10. Verification conclusion</h3>
<p>The final conclusion drawn after completing the chip verification process, summarizing the above content.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3116bc87ca15222db8a1ea63529f340c">4 - Verification Framework</h1>
    <div class="lead">mlvp is a Python-based hardware verification framework that helps users establish hardware</div>
	<p><strong>mlvp</strong>  is a hardware verification framework written in Python. It relies on a multi-language conversion tool called <a href="https://github.com/XS-MLVP/picker">picker</a> , which converts Verilog hardware design code into a Python package, allowing users to drive and verify hardware designs using Python.
It incorporates some concepts from the UVM verification methodology to ensure the standardization and reusability of the verification environment. The entire setup of the verification environment has been redesigned to better align with software development practices, making it easier for software developers to get started with hardware verification.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6b230018a9532ed03844c346cb1ab6b1">4.1 - Quick Start</h1>
    
	<h2 id="installation">Installation</h2>
<h3 id="toffee">toffee</h3>
<p><a href="https://github.com/XS-MLVP/toffee">Toffee</a> is a Python-based hardware verification framework designed to help users build hardware verification environments more conveniently and systematically using Python. It leverages the multi-language conversion tool <a href="https://github.com/XS-MLVP/picker">picker</a>, which converts Verilog code of hardware designs into Python Packages, enabling users to drive and verify hardware designs in Python.</p>
<p>Toffee requires the following dependencies:</p>
<ul>
<li>
<p>Python 3.6.8+</p>
</li>
<li>
<p>Picker 0.9.0+</p>
</li>
</ul>
<p>Once these dependencies are installed, you can install Toffee via pip:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install pytoffee
</span></span></code></pre></div><p>Or install the latest version of Toffee with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install pytoffee@git+https://github.com/XS-MLVP/toffee@master
</span></span></code></pre></div><p>For a local installation:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/XS-MLVP/toffee.git
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> toffee
</span></span><span style="display:flex;"><span>pip install .
</span></span></code></pre></div><h3 id="toffee-test">toffee-test</h3>
<p><a href="https://github.com/XS-MLVP/toffee-test">toffee-test</a> is a pytest plugin that provides testing support for the toffee framework. It includes identifying test functions as toffee test case objects, making them recognizable and executable by the toffee framework, offering resource management for test cases and providing test report generationto assist users in writing test cases for toffee</p>
<p>To install toffee-test via pip:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install toffee-test
</span></span></code></pre></div><p>Or install the development version:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install toffee-test@git+https://github.com/XS-MLVP/toffee-test@master
</span></span></code></pre></div><p>Or install from source:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/XS-MLVP/toffee-test.git
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> toffee-test
</span></span><span style="display:flex;"><span>pip install .
</span></span></code></pre></div><h2 id="setting-up-a-simple-verification-environment">Setting Up a Simple Verification Environment</h2>
<p>We will demonstrate how to use mlvp with a simple adder example located in the <code>example/adder</code> directory.
The adder design is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">module</span> <span style="color:#000">Adder</span> <span style="color:#000;font-weight:bold">#(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">parameter</span> <span style="color:#000">WIDTH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span>  <span style="color:#000;font-weight:bold">[</span><span style="color:#000">WIDTH</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">io_a</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span>  <span style="color:#000;font-weight:bold">[</span><span style="color:#000">WIDTH</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">io_b</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">input</span>              <span style="color:#000">io_cin</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">WIDTH</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000">io_sum</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">output</span>             <span style="color:#000">io_cout</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">assign</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#000">io_cout</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">io_sum</span><span style="color:#000;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">io_a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">io_b</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">io_cin</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">endmodule</span>
</span></span></code></pre></div><p>First, use picker to convert it into a Python package, and then use mlvp to set up the verification environment. After installing the dependencies, run the following command in the <code>example/adder</code> directory to complete the conversion:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make dut
</span></span></code></pre></div><p>To verify the adder&rsquo;s functionality, we will use mlvp to set up a verification environment.
First, we create a driver method for the adder interface using <code>Bundle</code> to describe the interface and <code>Agent</code> to define the driving methods, as shown below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderBundle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Signals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderAgent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Agent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_method</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">b</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">step</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span></code></pre></div><p>We use the <code>driver_method</code> decorator to mark the <code>exec_add</code> method, which drives the adder. Each time the method is called, it assigns the input signals <code>a</code>, <code>b</code>, and <code>cin</code> to the adder&rsquo;s input ports, then reads the output signals <code>sum</code> and <code>cout</code> after the next clock cycle and returns them.The <code>Bundle</code> describes the interface the <code>Agent</code> needs to drive. It provides connection methods to the DUT&rsquo;s input and output ports, allowing the <code>Agent</code> to drive any DUT with the same interface.Next, we create a reference model to verify the correctness of the adder&rsquo;s output. In mlvp, we use the <code>Model</code> class for this, as shown below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderModel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_hook</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;add_agent&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">sum</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#0000cf;font-weight:bold">64</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#0000cf;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cout</span>
</span></span></code></pre></div><p>In the reference model, we define the <code>exec_add</code> method, which shares the same input parameters as the <code>exec_add</code> method in the <code>Agent</code>. The method calculates the expected output for the adder. We use the <code>driver_hook</code> decorator to associate this method with the <code>Agent</code>&rsquo;s <code>exec_add</code> method.
Next, we create a top-level test environment to link the driving methods and the reference model, as shown below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderEnv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Env</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">adder_bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_agent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderAgent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder_bundle</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">attach</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">AdderModel</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>At this point, the verification environment is set up. toffee will automatically drive the reference model, collect results, and compare them with the adder&rsquo;s output.</p>
<p>After that, we can now write several test cases to verify the adder&rsquo;s functionality by toffee-test, as shown below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@pytest.mark.mlvp_async</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_random</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mlvp_request</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mlvp_request</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">randint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">64</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">randint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">64</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">randint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@pytest.mark.mlvp_async</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_boundary</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mlvp_request</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mlvp_request</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">cin</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">a</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">64</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">b</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">64</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>You can run the example in the <code>example/adder</code> directory with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make run
</span></span></code></pre></div><p>After running, the report will be automatically generated in the <code>reports</code> directory.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b07ce7c9627fc1d6d7c8d73fb5b195f4">4.2 - Writing a Standardized Verification Environment</h1>
    
	<h2 id="overview">Overview</h2>
<p>The main task of writing verification code can be broadly divided into two parts: <strong>building the verification environment</strong>  and <strong>writing test cases</strong> .<strong>Building the verification environment</strong>  aims to encapsulate the Design Under Test (DUT) so that the verification engineer does not have to deal with complex interface signals when driving the DUT, but can instead directly use the high-level interfaces provided by the verification environment. If a reference model needs to be written, it should also be part of the verification environment.<strong>Writing test cases</strong>  involves using the interfaces provided by the verification environment to write individual test cases for functional verification of the DUT.
Building the verification environment can be quite challenging, especially when the DUT is highly complex with numerous interface signals. In such cases, without a unified standard, constructing the verification environment can become chaotic, making it difficult for one person’s verification environment to be maintained by others. Additionally, when new verification tasks overlap with existing ones, it can be difficult to reuse the previous verification environment due to the lack of standardization.</p>
<p>This section will introduce the characteristics that a standardized verification environment should have, which will help in understanding the process of building the verification environment in mlvp.</p>
<h2 id="non-reusable-verification-code">Non-Reusable Verification Code</h2>
<p>Take a simple adder as an example, which has two input ports, <code>io_a</code> and <code>io_b</code>, and one output port, <code>io_sum</code>. If we do not consider the possibility of reusing the verification code for other tasks, we might write the following driving code:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">io_a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">io_b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">b</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">io_sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span></code></pre></div><p>In the above code, we wrote an <code>exec_add</code> function, which essentially encapsulates the addition operation of the adder at a high level. With the <code>exec_add</code> function, we no longer need to worry about how to assign values to the interface signals of the adder or how to drive the adder and retrieve its output. We simply need to call the <code>exec_add</code> function to drive the adder and complete an addition operation.
However, this driving function has a major drawback—it directly uses the DUT’s interface signals to interact with the DUT, meaning that this driving function can only be used for this specific adder.
Unlike software testing, in hardware verification, we frequently encounter scenarios where the interface structures are identical. Suppose we have another adder with the same functionality, but its interface signals are named <code>io_a_0</code>, <code>io_b_0</code>, and <code>io_sum_0</code>. In this case, the original driving function would fail and could not be reused. To drive this new adder, we would have to rewrite a new driving function.
If writing a driving function for an adder is already this problematic, imagine the difficulty when dealing with a DUT with complex interfaces. After putting in a lot of effort to write the driving code for such a DUT, we might later realize that the code needs to be migrated to a similar structure with some changes in the interface, leading to a significant amount of rework. Issues such as interface name changes, missing or additional signals, or unused references in the driving code would emerge.</p>
<p>The root cause of these issues lies in directly operating the DUT’s interface signals in the verification code. As illustrated in the diagram below, this approach is problematic:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+-----------+</span>   <span style="color:#ce5c00;font-weight:bold">+-----------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|--&gt;|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Test</span> <span style="color:#000">Code</span> <span style="color:#ce5c00;font-weight:bold">|</span>   <span style="color:#ce5c00;font-weight:bold">|</span>    <span style="color:#000">DUT</span>    <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|&lt;--|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+-----------+</span>   <span style="color:#ce5c00;font-weight:bold">+-----------+</span>
</span></span></code></pre></div><h2 id="decoupling-verification-code-from-the-dut">Decoupling Verification Code from the DUT</h2>
<p>To solve the above problems, we need to decouple the verification code from the DUT, so that the verification code no longer directly manipulates the DUT’s interface signals. Instead, it interacts with the DUT through an intermediate layer. This intermediate layer is a user-defined interface structure, referred to as a <code>Bundle</code> in mlvp, and we will use <code>Bundle</code> to represent this intermediate layer throughout the document.Using the adder as an example, we can define a <code>Bundle</code> structure that includes the signals <code>a</code>, <code>b</code>, and <code>sum</code>, and let the test code interact directly with this Bundle:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">b</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span></code></pre></div><p>In this case, the <code>exec_add</code> function does not directly manipulate the DUT’s interface signals, and it does not even need to know the names of the DUT’s interface signals. It interacts directly with the signals defined in the <code>Bundle</code>.How do we connect the signals in the <code>Bundle</code> to the DUT’s pins? This can be done by simply specifying how each signal in the <code>Bundle</code> is connected to the DUT’s pins. For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">&lt;</span>-&gt; <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">io_a</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">&lt;</span>-&gt; <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">io_b</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">&lt;</span>-&gt; <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">io_sum</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>If the DUT’s interface signal names change, we only need to modify this connection process:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">&lt;</span>-&gt; <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">io_a_0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">&lt;</span>-&gt; <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">io_b_0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">&lt;</span>-&gt; <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">io_sum_0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In this way, regardless of how the DUT’s interface changes, as long as the structure remains the same, we can use the original driving code to operate the DUT, with only the connection process needing adjustment. The relationship between the verification code and the DUT now looks like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+-----------+</span>  <span style="color:#ce5c00;font-weight:bold">+--------+</span>             <span style="color:#ce5c00;font-weight:bold">+-----------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|-&gt;|</span>        <span style="color:#ce5c00;font-weight:bold">|</span>             <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Test</span> <span style="color:#000">Code</span> <span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Bundle</span> <span style="color:#ce5c00;font-weight:bold">|--</span> <span style="color:#000">connect</span> <span style="color:#8f5902;font-style:italic">--|    DUT    |</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|&lt;-|</span>        <span style="color:#ce5c00;font-weight:bold">|</span>             <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+-----------+</span>  <span style="color:#ce5c00;font-weight:bold">+--------+</span>             <span style="color:#ce5c00;font-weight:bold">+-----------+</span>
</span></span></code></pre></div><p>In mlvp, we provide a simple way to define <code>Bundles</code> and a variety of connection methods to make defining and connecting the intermediate layer easy. Additionally, <code>Bundles</code> offer many practical features to help verification engineers interact with interface signals more effectively.</p>
<h2 id="categorizing-dut-interfaces-for-driving">Categorizing DUT Interfaces for Driving</h2>
<p>We now know that a <code>Bundle</code> must be defined to decouple the test code from the DUT. However, if the DUT’s interface signals are too complex, we might face a new issue—only this particular DUT can be connected to the <code>Bundle</code>. This is because we would be defining a <code>Bundle</code> structure that includes all the DUT’s pins, meaning only a DUT with an identical interface could be connected to this <code>Bundle</code>, which is too restrictive.In such cases, the intermediate layer loses its purpose. However, we often observe that a DUT’s interface structure is logically organized and usually composed of several independent sub-interfaces. For example, the dual-port stack mentioned <a href="https://open-verify.cc/mlvp/docs/quick-start/eg-stack-callback/">here</a>  has two sub-interfaces with identical structures. Instead of covering the entire dual-port stack interface in a single <code>Bundle</code>, we can split it into two <code>Bundles</code>, each corresponding to one sub-interface.Moreover, for the dual-port stack, the two sub-interfaces have identical structures, so we can use the same <code>Bundle</code> to describe both sub-interfaces without redefining it. Since both share the same <code>Bundle</code>, the driving code written for this <code>Bundle</code> is fully reusable! This is the essence of reusability in verification environments.In summary, for every DUT, we should divide its interface signals into several independent sub-interfaces, each with its own function, and then define a <code>Bundle</code> for each sub-interface. The driving code for each <code>Bundle</code> should then be written.
At this point, the relationship between the verification code and the DUT looks like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+-----------+</span>  <span style="color:#ce5c00;font-weight:bold">+--------+</span>             <span style="color:#ce5c00;font-weight:bold">+-----------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|-&gt;|</span>        <span style="color:#ce5c00;font-weight:bold">|</span>             <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Test</span> <span style="color:#000">Code</span> <span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Bundle</span> <span style="color:#ce5c00;font-weight:bold">|--</span> <span style="color:#000">connect</span> <span style="color:#8f5902;font-style:italic">--|           |</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|&lt;-|</span>        <span style="color:#ce5c00;font-weight:bold">|</span>             <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+-----------+</span>  <span style="color:#ce5c00;font-weight:bold">+--------+</span>             <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>                                      <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>     <span style="color:#000;font-weight:bold">...</span>           <span style="color:#000;font-weight:bold">...</span>                <span style="color:#ce5c00;font-weight:bold">|</span>    <span style="color:#000">DUT</span>    <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>                                      <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+-----------+</span>  <span style="color:#ce5c00;font-weight:bold">+--------+</span>             <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|-&gt;|</span>        <span style="color:#ce5c00;font-weight:bold">|</span>             <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Test</span> <span style="color:#000">Code</span> <span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Bundle</span> <span style="color:#ce5c00;font-weight:bold">|--</span> <span style="color:#000">connect</span> <span style="color:#8f5902;font-style:italic">--|           |</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|&lt;-|</span>        <span style="color:#ce5c00;font-weight:bold">|</span>             <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+-----------+</span>  <span style="color:#ce5c00;font-weight:bold">+--------+</span>             <span style="color:#ce5c00;font-weight:bold">+-----------+</span>
</span></span></code></pre></div><p>Now, our approach to building the verification environment becomes clear: we write high-level abstractions for each independent sub-interface.</p>
<h2 id="structure-of-independent-interface-drivers">Structure of Independent Interface Drivers</h2>
<p>We write high-level abstractions for each <code>Bundle</code>, and these pieces of code are independent and highly reusable. If we separate the interaction logic between the high-level operations and place it in the test cases, then a combination of multiple <code>Test Code + Bundle</code> units will form the entire driving environment for the DUT.We can assign a name to each <code>Test Code + Bundle</code> combination. In mlvp, this structure is called an <code>Agent</code>. An <code>Agent</code> is independent of the DUT and handles all interactions with a specific interface.
The relationship between the verification code and the DUT now looks like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+---------+</span>    <span style="color:#ce5c00;font-weight:bold">+-----------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>         <span style="color:#ce5c00;font-weight:bold">|</span>    <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#000">Agent</span>  <span style="color:#ce5c00;font-weight:bold">|----|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>         <span style="color:#ce5c00;font-weight:bold">|</span>    <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+---------+</span>    <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>               <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">...</span>        <span style="color:#ce5c00;font-weight:bold">|</span>    <span style="color:#000">DUT</span>    <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>               <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+---------+</span>    <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>         <span style="color:#ce5c00;font-weight:bold">|</span>    <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#000">Agent</span>  <span style="color:#ce5c00;font-weight:bold">|----|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>         <span style="color:#ce5c00;font-weight:bold">|</span>    <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+---------+</span>    <span style="color:#ce5c00;font-weight:bold">+-----------+</span>
</span></span></code></pre></div><p>Thus, the process of building the driving environment is essentially the process of writing one <code>Agent</code> after another. However, we have not yet discussed how to write a standardized <code>Agent</code>. If everyone writes <code>Agents</code> differently, the verification environment will still become difficult to manage.</p>
<h2 id="writing-a-standardized-agent">Writing a Standardized “Agent”</h2>
<p>To understand how to write a standardized <code>Agent</code>, we first need to grasp the main functions an <code>Agent</code> is supposed to accomplish. As mentioned earlier, an <code>Agent</code> implements all the interactions with a specific class of interfaces and provides high-level abstraction.
Let’s explore the interactions between the verification code and the interface. Assuming that the verification code has the ability to read input ports, we can categorize the interactions based on whether the verification code actively initiates communication or passively receives data, as follows:</p>
<ol>
<li><strong>Verification Code Actively Initiates</strong></li>
</ol>
<ul>
<li>
<p>Actively reads the value of input/output ports</p>
</li>
<li>
<p>Actively assigns values to input ports</p>
</li>
</ul>
<ol start="2">
<li><strong>Verification Code Passively Receives</strong></li>
</ol>
<ul>
<li>Passively receives the values of output/input ports
These two types of operations cover all interactions between the verification code and the interface, so an <code>Agent</code> must support both.</li>
</ul>
<h3 id="interactions-actively-initiated-by-the-verification-code">Interactions Actively Initiated by the Verification Code</h3>
<p>Let’s first consider the two types of interactions actively initiated by the verification code. To encapsulate these interactions at a high level, the <code>Agent</code> must have two capabilities:</p>
<ol>
<li>
<p>The driver should be able to convert high-level semantic information into assignments to interface signals.</p>
</li>
<li>
<p>It should convert interface signals into high-level semantic information and return this to the initiator.
There are various ways to implement these interactions. However, since mlvp is a verification framework based on a software testing language, and we want to keep the verification code as simple as possible, mlvp standardizes the use of <strong>functions</strong>  to carry out these interactions.
Because functions are the most basic abstraction unit in programming, their input parameters can directly represent high-level semantic information and be passed to the function body. Within the function body, assignments and reading operations can handle the translation between semantic information and interface signals. Finally, the return value can be used to pass the converted interface signal back to the initiator as high-level semantic information.
In mlvp, such functions that facilitate interactions actively initiated by the verification code are called <strong>driver methods</strong> . In mlvp, we use the <code>driver_method</code> decorator to mark these functions.</p>
</li>
</ol>
<h3 id="interactions-passively-received-by-the-verification-code">Interactions Passively Received by the Verification Code</h3>
<p>Next, let’s look at interactions passively received by the verification code. These interactions occur when the interface sends output signals to the verification code upon meeting specific conditions, without the verification code actively initiating the process.</p>
<p>For example, the verification code might want to passively obtain output signals from the DUT after the DUT completes an operation and convert them into high-level semantic information. Alternatively, the verification code might want to passively retrieve output signals at every cycle and convert them.
Similar to the <code>driver_method</code>, mlvp also standardizes the use of <strong>functions</strong>  to carry out this type of interaction. However, these functions have no input parameters and are not actively controlled by the verification code. When specific conditions are met, the function is triggered to read interface signals and convert them into high-level semantic information. This information is then stored for later use by the verification code.These functions in mlvp, which facilitate passively received interactions, are referred to as <strong>monitor methods</strong> . We use the <code>monitor_method</code> decorator in mlvp to mark such functions.</p>
<h3 id="a-standardized-agent-structure">A Standardized “Agent” Structure</h3>
<p>In summary, we use <strong>functions</strong>  as carriers to facilitate all interactions between the verification code and the interface. These functions are categorized into two types: <strong>driver methods</strong>  and <strong>monitor methods</strong> . These methods handle the interactions actively initiated and passively received by the verification code, respectively.Thus, writing an <code>Agent</code> essentially involves creating a series of driver methods and monitor methods. Once an <code>Agent</code> is created, simply providing the list of its internal driver and monitor methods will describe the entire functionality of the <code>Agent</code>.An <code>Agent</code> structure can be described using the following diagram:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">--------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Agent</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000">driver_method</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000">driver_method</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000;font-weight:bold">...</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000">monitor_method</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000">monitor_method</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000;font-weight:bold">...</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">--------------------+
</span></span></span></code></pre></div><h2 id="verifying-the-duts-functional-correctness">Verifying the DUT’s Functional Correctness</h2>
<p>At this point, we have completed the encapsulation of high-level operations on the DUT and established interaction between the verification code and the DUT through functions. Now, to verify the functional correctness of the DUT, we would write test cases that use the <strong>driver methods</strong>  to drive the DUT through specific operations. Simultaneously, the <strong>monitor methods</strong>  are automatically triggered to collect relevant information from the DUT.<strong>But how do we verify that the DUT’s functionality is correct?</strong>
After driving the DUT in the test case, the output information we obtain from the DUT comes in two forms: one is actively retrieved through the driver methods, and the other is collected through the monitor methods. Therefore, verifying the DUT’s functionality essentially involves checking whether this information matches the expected results.
<strong>How do we determine whether this information is as expected?</strong>
In one case, we already know what the DUT’s output should be or what conditions it should meet. In this situation, after obtaining the information in the test case, we can directly check it against our expectations.
In another case, we do not know the expected output of the DUT. In this scenario, we can create a <strong>Reference Model (RM)</strong>  with the same functionality as the DUT. Whenever we send input to the DUT, we simultaneously send the same input to the reference model.
To verify the two types of output information, we can compare the DUT&rsquo;s output with the reference model’s output, obtained at the same time, to ensure consistency.
These are the two methods of verifying the DUT’s correctness: <strong>direct comparison</strong>  and <strong>reference model comparison</strong> .</p>
<h2 id="how-to-add-a-reference-model">How to Add a Reference Model</h2>
<p>For direct comparison, the comparison logic can be written directly into the test case. However, if we use the reference model method, the test case might involve additional steps: sending information to both the DUT and the model simultaneously, collecting both DUT and model outputs, and writing logic for comparing passive signals from the DUT with the reference model. This can clutter the test case code and mix the reference model interaction logic with the test logic, making maintenance difficult.</p>
<p>We can observe that every call to a driver function represents an operation on the DUT, which also needs to be forwarded to the reference model. The reference model doesn’t need to know how the DUT’s interface is driven; it only needs to process high-level semantic information and update its internal state. Therefore, the reference model only needs to receive the high-level semantic information (i.e., the input parameters of the driver function).</p>
<p>Thus, the reference model only needs to define how to react when driver functions are called. The task of passing call information to the reference model can be handled by the framework. Similarly, comparing return values or monitor signals can also be automatically managed by the framework.</p>
<p>With this, test cases only need to focus on driving the DUT, while synchronization and comparison with the reference model will be automatically managed by the framework.
To achieve reference model synchronization, mlvp defines a set of reference model matching specifications. By following these specifications, you can automatically forward and compare data to the reference model. Additionally, mlvp provides the <code>Env</code> concept to package the entire verification environment. Once the reference model is implemented, it can be linked to the <code>Env</code> for automatic synchronization.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Thus, our verification environment becomes the following structure:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+--------------------------------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Env</span>                            <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>                  <span style="color:#ce5c00;font-weight:bold">+-----------+</span> <span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#ce5c00;font-weight:bold">+-----------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>   <span style="color:#ce5c00;font-weight:bold">+---------+</span>    <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>   <span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#000">Agent</span>  <span style="color:#ce5c00;font-weight:bold">|----|</span>           <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">|-&gt;|</span> <span style="color:#000">Reference</span> <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>   <span style="color:#ce5c00;font-weight:bold">+---------+</span>    <span style="color:#ce5c00;font-weight:bold">|</span>    <span style="color:#000">DUT</span>    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#ce5c00;font-weight:bold">|</span>   <span style="color:#000">Model</span>   <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>   <span style="color:#ce5c00;font-weight:bold">+---------+</span>    <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">|&lt;-|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>   <span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#000">Agent</span>  <span style="color:#ce5c00;font-weight:bold">|----|</span>           <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>   <span style="color:#ce5c00;font-weight:bold">+---------+</span>    <span style="color:#ce5c00;font-weight:bold">|</span>           <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">|</span>  <span style="color:#ce5c00;font-weight:bold">+-----------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|</span>       <span style="color:#000;font-weight:bold">...</span>        <span style="color:#ce5c00;font-weight:bold">+-----------+</span> <span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">+--------------------------------+</span>
</span></span></code></pre></div><p>At this stage, building the verification environment becomes clear and standardized. For reuse, you simply select the appropriate <code>Agent</code>, connect it to the DUT, and package everything into an <code>Env</code>. To implement a reference model, you just follow the <code>Env</code> interface specification and implement the reference model logic.The test cases are separated from the verification environment. Once the environment is set up, the interfaces provided by each <code>Agent</code> can be used to write the driving logic for the test cases. The synchronization and comparison with the reference model will be automatically handled by the framework.
This is the idea behind constructing the verification environment in mlvp, which offers many features to help you build a standardized verification environment. It also provides test case management methods to make writing and managing test cases easier.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e77a7d893b67be7260a40bdc5eb52674">4.3 - Setting Up a Verification Environment</h1>
    
	<p><strong>mlvp</strong>  provides the methods and tools needed for the complete process of setting up a verification environment. This chapter will explain in detail how to use <strong>mlvp</strong>  to build a complete verification environment.Before proceeding, please ensure you have read <a href="https://chatgpt.com/docs/mlvp/canonical_env">How to Write a Canonical Verification Environment</a>  and are familiar with the basic structure of mlvp&rsquo;s canonical verification environment.
For a completely new verification task, following the environment setup steps, the process of building a verification environment can be divided into the following steps:</p>
<ol>
<li>
<p>Partition the DUT interface based on logical functions and define Bundles.</p>
</li>
<li>
<p>Write an Agent for each Bundle, completing the high-level encapsulation of the Bundle.</p>
</li>
<li>
<p>Encapsulate multiple Agents into an Env, completing the high-level encapsulation of the entire DUT.</p>
</li>
<li>
<p>Write the reference model according to the interface specifications of the Env and bind it to the Env.</p>
</li>
</ol>
<p>This chapter will introduce how to use mlvp tools to meet the requirements for setting up the environment in each step.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f0ad1b6fbd03350b4038655714fa526a">4.3.1 - How to Use an Asynchronous Environment</h1>
    
	<h2 id="starting-the-event-loop">Starting the Event Loop</h2>
<p>In the previously described verification environment, we designed a standardized setup. However, if we attempt to write it as a simple single-threaded program, we may encounter complex implementation issues.</p>
<p>For instance, consider having two driver methods that drive two different interfaces. Inside each driver method, we need to wait for several clock cycles of the DUT (Device Under Test), and both methods must run simultaneously. In a basic single-threaded program, running both driver methods concurrently can be quite challenging. Even if we force concurrency using multithreading, there is still no built-in mechanism to wait for the DUT to advance through multiple clock cycles. This limitation exists because the interfaces provided by Picker allow us to push the DUT forward by one cycle at a time but not to wait for it.
Moreover, in cases where multiple components of the environment need to run concurrently, we require an environment that supports asynchronous execution. <strong>mlvp</strong>  uses Python&rsquo;s coroutines to manage asynchronous programs. It builds an event loop on top of a single thread to manage multiple concurrently running coroutines. These coroutines can wait on each other and switch between tasks via the event loop.Before starting the event loop, we need to understand two keywords, <code>async</code> and <code>await</code>, to grasp how Python manages coroutines.By adding the <code>async</code> keyword before a function, we define it as a coroutine, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">my_coro</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span></code></pre></div><p>Inside the coroutine, we use the <code>await</code> keyword to run another coroutine and wait for it to complete, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">my_coro</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#4e9a06">&#34;my_coro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">my_coro2</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">my_coro</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>If you don&rsquo;t want to wait for a coroutine to finish but simply run it in the background, you can use <strong>mlvp</strong> &rsquo;s <code>create_task</code> method, like so:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">mlvp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">my_coro</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#4e9a06">&#34;my_coro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">my_coro2</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">mlvp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_task</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">my_coro</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>How do we start the event loop and run <code>my_coro2</code>? In <strong>mlvp</strong> , we use <code>mlvp.run</code> to start the event loop and run the asynchronous program:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">mlvp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">mlvp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">my_coro2</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>Since all environment components in <strong>mlvp</strong>  need to run within the event loop, when starting the <strong>mlvp</strong>  verification environment, you must first initiate the event loop via <code>mlvp.run</code> and then create the <strong>mlvp</strong>  verification environment inside the loop.
Thus, the test environment should be set up as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">mlvp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">start_test</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Create verification environment</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MyEnv</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">mlvp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">start_test</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><h2 id="how-to-manage-dut-clock">How to Manage DUT Clock</h2>
<p>As mentioned earlier, if we need two driver methods to run simultaneously and each one to wait for several DUT clock cycles, asynchronous environments allow us to wait for specific events. However, Picker only provides the ability to push the DUT forward by one cycle and does not provide an event to wait on.
<strong>mlvp</strong>  addresses this by creating a background clock to automatically push the DUT forward one cycle at a time. After each cycle, the background clock sends a clock signal to other coroutines, allowing them to resume execution. The actual clock cycles of the DUT are driven by the background clock, while other coroutines only need to wait for the clock signal.In <strong>mlvp</strong> , the background clock is created using <code>start_clock</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">mlvp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">start_test</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MyDUT</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">mlvp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start_clock</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">mlvp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">start_test</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>Simply call <code>start_clock</code> within the event loop to create the background clock. It requires a DUT object to drive the DUT&rsquo;s execution and bind the clock signal to the DUT and its pins.In other coroutines, you can use <code>ClockCycles</code> to wait for the clock signal. The <code>ClockCycles</code> parameter can be the DUT itself or any of its pins. For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">mlvp</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp.triggers</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">my_coro</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">ClockCycles</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;10 cycles passed&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">start_test</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MyDUT</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">mlvp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start_clock</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">my_coro</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">mlvp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">start_test</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>In <code>my_coro</code>, <code>ClockCycles</code> is used to wait for 10 clock cycles of the DUT. After 10 cycles, <code>my_coro</code> continues executing and prints &ldquo;10 cycles passed.&rdquo;<strong>mlvp</strong>  provides several methods for waiting on clock signals, such as:</p>
<ul>
<li>
<p><code>ClockCycles</code>: Wait for a specified number of DUT clock cycles.</p>
</li>
<li>
<p><code>Value</code>: Wait for a DUT pin to equal a specific value.</p>
</li>
<li>
<p><code>AllValid</code>: Wait for all DUT pins to be valid simultaneously.</p>
</li>
<li>
<p><code>Condition</code>: Wait for a condition to be met.</p>
</li>
<li>
<p><code>Change</code>: Wait for a change in the value of a DUT pin.</p>
</li>
<li>
<p><code>RisingEdge</code>: Wait for the rising edge of a DUT pin.</p>
</li>
<li>
<p><code>FallingEdge</code>: Wait for the falling edge of a DUT pin.</p>
</li>
</ul>
<p>For more methods of waiting on clock signals, refer to the API documentation.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-24fbc3c0d43eefa92eb8f640766a6876">4.3.2 - How to Use Bundle</h1>
    
	<p><code>Bundle</code> serves as an intermediary layer in the mlvp verification environment, facilitating interaction between the <code>Agent</code> and the DUT while ensuring their decoupling. Additionally, <code>Bundle</code> helps define the hierarchy of DUT interface layers, making access to the DUT interface clearer and more convenient.</p>
<h2 id="a-simple-definition-of-a-bundle">A Simple Definition of a Bundle</h2>
<p>To define a <code>Bundle</code>, you need to create a new class that inherits from the <code>Bundle</code> class in mlvp. Here’s a simple example of defining a <code>Bundle</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Bundle</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Signals</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderBundle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Signals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>This Bundle defines a simple adder interface. In the <code>AdderBundle</code> class, we define five signals: <code>a</code>, <code>b</code>, <code>sum</code>, <code>cin</code>, and <code>cout</code>, which represent the input ports <code>a</code> and <code>b</code>, the output port <code>sum</code>, and the carry input and output ports <code>cin</code> and <code>cout</code>, respectively.After the definition, we can access these signals through an instance of the <code>AdderBundle</code> class, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderBundle</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h2 id="binding-the-dut-to-the-bundle">Binding the DUT to the Bundle</h2>
<p>In the code above, we created an instance of a bundle and drove it, but we did not bind this bundle to any DUT, which means operations on this bundle cannot actually affect the DUT.
Using the <code>bind</code> method, we can bind a DUT to a bundle. For example, if we have a simple adder DUT whose interface names match those defined in the Bundle:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderBundle</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bind</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>The <code>bind</code> function will automatically retrieve all interfaces from the DUT and bind those with the same names. Once bound, operations on the bundle will directly affect the DUT.However, if the interface names of the DUT differ from those defined in the Bundle, using <code>bind</code> directly will not bind them correctly. In the Bundle, we provide various binding methods to accommodate different binding needs.</p>
<h3 id="binding-via-a-dictionary">Binding via a Dictionary</h3>
<p>In the <code>bind</code> function, you can specify a mapping between the DUT&rsquo;s interface names and the Bundle&rsquo;s interface names by passing in a dictionary.
Suppose the interface names in the Bundle correspond to those in the DUT as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#f8f8f8;text-decoration:underline">    </span>-&gt; <span style="color:#000">a_in</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">b</span><span style="color:#f8f8f8;text-decoration:underline">    </span>-&gt; <span style="color:#000">b_in</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">sum</span><span style="color:#f8f8f8;text-decoration:underline">  </span>-&gt; <span style="color:#000">sum_out</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">cin</span><span style="color:#f8f8f8;text-decoration:underline">  </span>-&gt; <span style="color:#000">cin_in</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">cout</span><span style="color:#f8f8f8;text-decoration:underline"> </span>-&gt; <span style="color:#000">cout_out</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>When instantiating the <code>bundle</code>, we can create it using the <code>from_dict</code> method and provide a dictionary to inform the <code>Bundle</code> to bind in this way.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderBundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_dict</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;a_in&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;b&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;b_in&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;sum&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;sum_out&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;cin&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;cin_in&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;cout&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;cout_out&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bind</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Now, <code>adder_bundle</code> is correctly bound to <code>adder</code>.</p>
<h3 id="binding-via-a-prefix">Binding via a Prefix</h3>
<p>If the DUT&rsquo;s interface names correspond to those in the Bundle as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#f8f8f8;text-decoration:underline">    </span>-&gt; <span style="color:#000">io_a</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">b</span><span style="color:#f8f8f8;text-decoration:underline">    </span>-&gt; <span style="color:#000">io_b</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">sum</span><span style="color:#f8f8f8;text-decoration:underline">  </span>-&gt; <span style="color:#000">io_sum</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">cin</span><span style="color:#f8f8f8;text-decoration:underline">  </span>-&gt; <span style="color:#000">io_cin</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">cout</span><span style="color:#f8f8f8;text-decoration:underline"> </span>-&gt; <span style="color:#000">io_cout</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>You can see that the DUT&rsquo;s interface names have an <code>io_</code> prefix compared to those in the Bundle. In this case, you can create the <code>Bundle</code> using the <code>from_prefix</code> method, providing the prefix name to instruct the <code>Bundle</code> to bind using the prefix.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderBundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_prefix</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;io_&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bind</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="binding-via-regular-expressions">Binding via Regular Expressions</h3>
<p>In some cases, the correspondence between the DUT&rsquo;s interface names and the Bundle&rsquo;s interface names may not be a simple prefix or dictionary relationship but instead follow more complex rules. For example, the mapping may be:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#000">a</span><span style="color:#f8f8f8;text-decoration:underline">    </span>-&gt; <span style="color:#000">io_a_in</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">b</span><span style="color:#f8f8f8;text-decoration:underline">    </span>-&gt; <span style="color:#000">io_b_in</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">sum</span><span style="color:#f8f8f8;text-decoration:underline">  </span>-&gt; <span style="color:#000">io_sum_out</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">cin</span><span style="color:#f8f8f8;text-decoration:underline">  </span>-&gt; <span style="color:#000">io_cin_in</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">cout</span><span style="color:#f8f8f8;text-decoration:underline"> </span>-&gt; <span style="color:#000">io_cout_out</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In such cases, you can pass a regular expression to inform the <code>Bundle</code> to bind using that regular expression.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderBundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_regex</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">r</span><span style="color:#4e9a06">&#39;io_(.*)_.*&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bind</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>When using a regular expression, the Bundle attempts to match the DUT&rsquo;s interface names with the regular expression. For successful matches, the Bundle reads all capture groups from the regular expression, concatenating them into a string. This string is then used to match against the Bundle&rsquo;s interface names.
For example, in the code above, <code>io_a_in</code> matches the regular expression successfully, capturing <code>a</code> as the unique capture group. The name <code>a</code> matches the Bundle&rsquo;s interface name <code>a</code>, so <code>io_a_in</code> is correctly bound to <code>a</code>.</p>
<h2 id="creating-sub-bundles">Creating Sub-Bundles</h2>
<p>Often, we may need a Bundle to contain one or more other Bundles. In this case, we can include already defined Bundles as sub-Bundles of the current Bundle.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Bundle</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Signal</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Signals</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderBundle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Signals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MultiplierBundle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">product</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Signals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">ArithmeticBundle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">selector</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Signal</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">adder</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderBundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_prefix</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;add_&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">multiplier</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MultiplierBundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_prefix</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;mul_&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>In the code above, we define an <code>ArithmeticBundle</code> that contains its own signal <code>selector</code>. In addition, it includes an <code>AdderBundle</code> and a <code>MultiplierBundle</code>, which are named <code>adder</code> and <code>multiplier</code>, respectively.When accessing the sub-Bundles within the <code>ArithmeticBundle</code>, you can use the <code>.</code> operator:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">arithmetic_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ArithmeticBundle</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">arithmetic_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">selector</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#000">arithmetic_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#000">arithmetic_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span><span style="color:#000">arithmetic_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">multiplier</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span><span style="color:#000">arithmetic_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">multiplier</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">4</span>
</span></span></code></pre></div><p>Furthermore, when defining in this manner, binding the top-level Bundle will also bind the sub-Bundles to the DUT. The previously mentioned various binding methods can still be used when defining sub-Bundles.
It is important to note that the method for creating sub-Bundles matches signal names that have been processed by the previous Bundle&rsquo;s creation method. For example, in the code above, if the top-level Bundle&rsquo;s matching method is set to <code>from_prefix('io_')</code>, then the signal names matched within the <code>AdderBundle</code> will be those stripped of the <code>io_</code> prefix.
Similarly, the dictionary matching method will pass the names transformed into the mapped names for matching with the sub-Bundle, while the regular expression matching method will pass the names captured by the regular expression for matching with the sub-Bundle.</p>
<h2 id="practical-operations-in-a-bundle">Practical Operations in a Bundle</h2>
<h3 id="signal-access-and-assignment">Signal Access and Assignment</h3>
<p><strong>Accessing Signal Values</strong> In a Bundle, signals can be accessed not only through the <code>.</code> operator but also through the <code>[]</code> operator.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderBundle</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><p><strong>Accessing Unconnected Signals</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">bind</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">unconnected_signal_access</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>When binding, you can pass the <code>unconnected_signal_access</code> parameter to control whether accessing unconnected signals is allowed. By default, it is <code>True</code>, meaning unconnected signals can be accessed. In this case, writing to the signal will not change it, and reading the signal will return <code>None</code>. When <code>unconnected_signal_access</code> is set to <code>False</code>, accessing unconnected signals will raise an exception.<strong>Assigning All Signals Simultaneously</strong> You can use the <code>set_all</code> method to change all input signals at once.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_all</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p><strong>Changing Signal Assignment Mode</strong> The signal assignment mode is a concept in <code>picker</code> that controls how signals are assigned. Please refer to the <code>picker</code> documentation for more details.In a Bundle, you can change the assignment mode for the entire Bundle using the <code>set_write_mode</code> method.Additionally, there are shortcut methods: <code>set_write_mode_as_imme</code>, <code>set_write_mode_as_rise</code>, and <code>set_write_mode_as_fall</code>, which set the Bundle&rsquo;s assignment mode to immediate, rising edge, and falling edge assignments, respectively.</p>
<h3 id="message-support">Message Support</h3>
<p><strong>Default Message Type Assignment</strong> <code>mlvp</code> supports assigning a default message type to a Bundle&rsquo;s signals using the <code>assign</code> method with a dictionary.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">assign</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;b&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;cin&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">})</span>
</span></span></code></pre></div><p>The Bundle will automatically assign the values from the dictionary to the corresponding signals. If you want to assign unspecified signals to a default value, use <code>*</code> to specify a default value:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">assign</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;*&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">})</span>
</span></span></code></pre></div><p><strong>Default Message Assignment for Sub-Bundles</strong> If you want to assign signals in sub-Bundles using default message types, this can be achieved in two ways. When the <code>multilevel</code> parameter in <code>assign</code> is set to <code>True</code>, the Bundle supports multi-level dictionary assignments.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">arithmetic_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">assign</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;selector&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;adder&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;*&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;cin&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;multiplier&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;b&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">},</span> <span style="color:#000">multilevel</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>When <code>multilevel</code> is <code>False</code>, the Bundle supports specifying sub-Bundle signals using the <code>.</code> operator.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">arithmetic_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">assign</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;*&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;selector&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;adder.cin&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;multiplier.a&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;multiplier.b&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">},</span> <span style="color:#000">multilevel</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p><strong>Reading Default Message Types</strong> You can convert the current signal values in a Bundle into a dictionary using the <code>as_dict</code> method. It supports two formats: when <code>multilevel</code> is <code>True</code>, a multi-level dictionary is returned; when <code>multilevel</code> is <code>False</code>, a flattened dictionary is returned.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">arithmetic_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">as_dict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">multilevel</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;selector&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;adder&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;b&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;sum&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;cin&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;cout&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;multiplier&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;b&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;product&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">arithmetic_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">as_dict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">multilevel</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;selector&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;adder.a&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;adder.b&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;adder.sum&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;adder.cin&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;adder.cout&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;multiplier.a&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;multiplier.b&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;multiplier.product&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p><strong>Custom Message Types</strong>
In custom message structures, rules can be defined to assign signals to a Bundle.
One approach is to implement the <code>as_dict</code> function in the custom message structure to convert it into a dictionary, which can then be assigned to the Bundle using the <code>assign</code> method.Another approach is to implement the <code>__bundle_assign__</code> function in the custom message structure, which accepts a Bundle instance and assigns values to its signals. Once this is implemented, the <code>assign</code> method can be used to assign the message to the Bundle, and the Bundle will automatically call the <code>__bundle_assign__</code> function for assignment.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyMessage</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__bundle_assign__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">my_message</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MyMessage</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">assign</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">my_message</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>When you need to convert the signal values in a Bundle into a custom message structure, implement a <code>from_bundle</code> class method in the custom message structure. This method accepts a Bundle instance and returns the custom message structure.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyMessage</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@classmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">from_bundle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">cls</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">message</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">cls</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">message</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">my_message</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MyMessage</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_bundle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder_bundle</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="timing-encapsulation">Timing Encapsulation</h3>
<p>In addition to encapsulating DUT pins, the <code>Bundle</code> class also provides timing encapsulation based on arrays, which can be applied to simple timing scenarios. The <code>Bundle</code> class offers a <code>process_requests(data_list)</code> function that accepts an array as input. On the <code>i-th</code> clock cycle, <code>data_list[i]</code> will assign the corresponding data to the pins. The <code>data_list</code> can contain data in the form of a <code>dict</code> or a callable object (<code>callable(cycle, bundle_ins)</code>). For the <code>dict</code> type, special keys include:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>__funcs__: func<span style="color:#ce5c00;font-weight:bold">(</span>cycle, self<span style="color:#ce5c00;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># Callable object, can be an array of functions [f1, f2, ..]</span>
</span></span><span style="display:flex;"><span>__condition_func__: func<span style="color:#ce5c00;font-weight:bold">(</span>cycle, self, cargs<span style="color:#ce5c00;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># Conditional function, assignment occurs when this returns true, otherwise, the clock advances</span>
</span></span><span style="display:flex;"><span>__condition_args__: cargs  <span style="color:#8f5902;font-style:italic"># Arguments for the conditional function</span>
</span></span><span style="display:flex;"><span>__return_bundles__: bundle  <span style="color:#8f5902;font-style:italic"># Specifies which bundle data should be returned when this dict is processed. Can be list[bundle]</span>
</span></span></code></pre></div><p>If the input <code>dict</code> contains <code>__return_bundles__</code>, the function will return the corresponding bundle values, such as <code>{&quot;data&quot;: x, &quot;cycle&quot;: y}</code>. For example, consider the Adder bundle where the result is expected after the third addition:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The Adder is combinational logic but used here as sequential logic</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderBundle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Signals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># Define the pins</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># init clock</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># dut.InitClock(&#34;clock&#34;)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bind</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># Bind to the DUT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">add_list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data_list</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">)]):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Create the input dict</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data_list</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;a&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;b&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;*&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">}</span>  <span style="color:#8f5902;font-style:italic"># Build the dict for bundle assignment</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">x</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;__return_bundles__&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span>  <span style="color:#8f5902;font-style:italic"># Set the bundle to be returned</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">process_requests</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># Drive the clock, assign values, return results</span>
</span></span></code></pre></div><p>After calling <code>add_list()</code>, the returned result is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;a&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;b&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;cin&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;sum&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">11</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;cout&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">},</span> <span style="color:#4e9a06">&#34;cycle&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;a&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;b&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;cin&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;sum&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;cout&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">},</span> <span style="color:#4e9a06">&#34;cycle&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">]</span>
</span></span></code></pre></div><h3 id="asynchronous-support">Asynchronous Support</h3>
<p>In the <code>Bundle</code>, a <code>step</code> function is provided to conveniently synchronize with the clock signal of the DUT. When the <code>Bundle</code> is connected to any signal of the DUT, the <code>step</code> function automatically synchronizes with the DUT&rsquo;s clock signal.The <code>step</code> function can be used to wait for clock cycles.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">adder_process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder_bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">step</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="signal-connectivity">Signal Connectivity</h3>
<p><strong>Signal Connectivity Rules</strong> Once the <code>Bundle</code> instance is defined, you can call the <code>all_signals_rule</code> method to get the connection rules for all signals, helping the user check if the connection rules are as expected.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">all_signals_rule</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p><strong>Signal Connectivity Check</strong> The <code>detect_connectivity</code> method checks if a specific signal name can connect to any signal in the <code>Bundle</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">detect_connectivity</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;io_a&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>The <code>detect_specific_connectivity</code> method checks if a specific signal name can connect to a particular signal in the <code>Bundle</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">detect_specific_connectivity</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;io_a&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>To check connectivity for signals in sub-Bundles, use the <code>.</code> operator to specify the sub-Bundle.</p>
<h3 id="dut-signal-connectivity-check">DUT Signal Connectivity Check</h3>
<p><strong>Unconnected Signal Check</strong> The <code>detect_unconnected_signals</code> method checks for any signals in the DUT that are not connected to any <code>Bundle</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">Bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">detect_unconnected_signals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p><strong>Duplicate Connection Check</strong> The <code>detect_multiple_connections</code> method checks for signals in the DUT that are connected to multiple <code>Bundles</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">Bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">detect_multiple_connections</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="other-practical-operations">Other Practical Operations</h3>
<p><strong>Set Bundle Name</strong> You can set the name of a <code>Bundle</code> using the <code>set_name</code> method.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_name</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;adder&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Once the name is set, more intuitive prompt information is provided.
<strong>Get All Signals in the Bundle</strong> The <code>all_signals</code> method returns a generator containing all signals, including those in sub-Bundles.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">signal</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">adder_bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">all_signals</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">signal</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h2 id="automatic-bundle-generation-script">Automatic Bundle Generation Script</h2>
<p>In many cases, the interface of a DUT can be complex, making it tedious to manually write the <code>Bundle</code> definitions. However, since <code>Bundle</code> serves as an intermediate layer, providing an exact definition of signal names is essential. To address this, <code>mlvp</code> provides an automatic generation script that generates <code>Bundle</code> definitions from the DUT&rsquo;s interface.The script <code>bundle_code_gen.py</code> can be found in the <code>scripts</code> folder of the <code>mlvp</code> repository. This script can automatically generate <code>Bundle</code> definitions by parsing a DUT instance and the specified binding rules.
It provides three functions:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">gen_bundle_code_from_dict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bundle_name</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">dict</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">dict</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">max_width</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">120</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">gen_bundle_code_from_prefix</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bundle_name</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">max_width</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">120</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">gen_bundle_code_from_regex</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bundle_name</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">regex</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">max_width</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">120</span><span style="color:#000;font-weight:bold">):</span>
</span></span></code></pre></div><p>These functions generate <code>Bundle</code> definitions based on a dictionary, prefix, or regular expression, respectively.To use, specify the <code>Bundle</code> name, DUT instance, and the corresponding generation rules to generate the <code>Bundle</code> definition. You can also use the <code>max_width</code> parameter to set the maximum width of the generated code.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">bundle_code_gen</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">gen_bundle_code_from_dict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;AdderBundle&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;io_a&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;b&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;io_b&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;sum&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;io_sum&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;cin&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;io_cin&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;cout&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;io_cout&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gen_bundle_code_from_prefix</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;AdderBundle&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;io_&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gen_bundle_code_from_regex</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;AdderBundle&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">r</span><span style="color:#4e9a06">&#39;io_(.*)&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>The generated code can be copied directly into your project or used with minor modifications. It can also serve as a sub-Bundle definition for use in other <code>Bundles</code>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d8294406c872c50fb824daf8117b16c4">4.3.3 - How to Write an Agent</h1>
    
	<p>An <code>Agent</code> in the mlvp verification environment provides a high-level encapsulation of signals within a class of <code>Bundles</code>, allowing the upper-level driver code to drive and monitor the signals in the Bundle without worrying about specific signal assignments.An <code>Agent</code> consists of <strong>driver methods</strong>  and <strong>monitor methods</strong> , where the driver methods actively drive the signals in the Bundle, and the monitor methods passively observe the signals in the Bundle.</p>
<h2 id="initializing-the-agent">Initializing the Agent</h2>
<p>To define an <code>Agent</code>, you need to create a new class that inherits from the <code>Agent</code> class in mlvp. Here’s a simple example of defining an <code>Agent</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp.agent</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderAgent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Agent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">step</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">bundle</span>
</span></span></code></pre></div><p>In the initialization of the <code>AdderAgent</code> class, you need to pass the Bundle that this Agent will drive and provide a clock synchronization function to the parent <code>Agent</code> class. This function will be used by the Agent to determine when to call the monitor methods. Generally, it can be set to <code>bundle.step</code>, which is the clock synchronization function in the Bundle, synchronized with the DUT&rsquo;s clock.</p>
<h2 id="creating-driver-methods">Creating Driver Methods</h2>
<p>In the <code>Agent</code>, the driver method is an asynchronous function used to actively drive the signals in the Bundle. The driver function needs to parse its input parameters and assign values to the signals in the Bundle based on the parsed results, which can span multiple clock cycles. If you need to obtain signal values from the Bundle, you should write the corresponding logic in the function and return the needed data through the function&rsquo;s return value.Each driver method should be an asynchronous function and decorated with the <code>@driver_method</code> decorator so that the Agent can recognize it as a driver method.
Here’s a simple example of defining a driver method:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp.agent</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderAgent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Agent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">step</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">bundle</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_method</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">a</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">b</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">step</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span>
</span></span></code></pre></div><p>In the <code>exec_add</code> function, we assign the incoming parameters <code>a</code>, <code>b</code>, and <code>cin</code> to the corresponding signals in the Bundle. We then wait for one clock cycle. After the clock cycle ends, we return the values of <code>sum</code> and <code>cout</code> signals from the Bundle.During the development of the driver function, you can use all the synchronization methods for waiting for clock signals introduced in <a href="https://chatgpt.com/docs/mlvp/env/start_test">How to Use the Asynchronous Environment</a> , such as <code>ClockCycles</code>, <code>Value</code>, etc.
Once created, you can call this driver method in your driving code like a regular function:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderBundle</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_agent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderAgent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder_bundle</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">adder_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cout</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Functions marked with <code>@driver_method</code> have various features when called; this will be elaborated on when writing test cases. Additionally, these functions will handle matching against the reference model and automatically call back to return values for comparison; this will be discussed in the reference model section.</p>
<h2 id="creating-monitor-methods">Creating Monitor Methods</h2>
<p>The monitor method also needs to be an asynchronous function and should be decorated with the <code>@monitor_method</code> decorator so that the Agent can recognize it as a monitor method.
Here’s a simple example of defining a monitor method:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp.agent</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderAgent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Agent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">step</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">bundle</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@monitor_method</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">monitor_sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">as_dict</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>In the <code>monitor_sum</code> function, we use the <code>sum</code> signal in the Bundle as the object to monitor. When the value of the <code>sum</code> signal is greater than 0, we collect the default message type generated by the Bundle. The collected return value will be stored in the internal message queue.Once the <code>monitor_method</code> decorator is added, the <code>monitor_sum</code> function will be automatically called by the Agent, which will use the clock synchronization function provided during the Agent&rsquo;s initialization to decide when to call the monitor method. By default, the Agent will call the monitor method once in each clock cycle. If the monitor method has a return value, it will be stored in the internal message queue. If the execution of a single call to the monitor method spans multiple clock cycles, the Agent will wait until the previous call to the monitor method has finished before calling it again.
If you write a monitor method like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@monitor_method</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">monitor_sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bundle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">as_dict</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>This monitor method will add a message to the message queue in every cycle.
<strong>Retrieving Monitor Messages</strong> Since this monitor method is marked with <code>@monitor_method</code>, it will be automatically called by the Agent. If you try to directly call this function in your test case as follows, it will not execute as expected:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">adder_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderBundle</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">adder_agent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderAgent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder_bundle</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">adder_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">monitor_sum</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>Instead, when called in the above manner, the monitor method will pop the earliest collected message from the message queue and return it. If the message queue is empty, this call will wait until there are messages in the queue before returning.</p>
<p>If you want to get the number of messages in the message queue, you can do so as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">message_count</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">adder_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">monitor_size</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;monitor_sum&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>By creating monitor methods, you can easily add a background monitoring task that observes the signal values in the Bundle and collects messages when certain conditions are met. Once a function is marked as a monitor method, the framework will also provide it with matching against the reference model and automatic collection for comparison; this will be detailed in the reference model section.
By writing multiple driver methods and monitor methods within the Agent, you complete the entire <code>Agent</code> implementation.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ef7ff8d9b1e4680f7bfedab19681abb5">4.3.4 - How to Build an Env</h1>
    
	<p><code>Env</code> is used in the mlvp verification environment to package the entire verification setup. It directly instantiates all the agents needed in the verification environment and is responsible for passing the required bundles to these agents.
Once the Env is created, the specification for writing reference models is also determined. Reference models written according to this specification can be directly attached to the Env, allowing it to handle automatic synchronization of the reference models.</p>
<h2 id="creating-an-env">Creating an Env</h2>
<p>To define an <code>Env</code>, you need to create a new class that inherits from the <code>Env</code> class in mlvp. Here’s a simple example of defining an <code>Env</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp.env</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">DualPortStackEnv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Env</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">port1_bundle</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">port2_bundle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port1_agent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StackAgent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">port1_bundle</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port2_agent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StackAgent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">port2_bundle</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>In this example, we define a <code>DualPortStackEnv</code> class that instantiates two identical <code>StackAgent</code> objects, each responsible for driving different Bundles.
You can choose to connect the Bundles outside the Env or within the Env itself, as long as you ensure that the correct Bundles are passed to the Agents.</p>
<p>At this point, if you do not need to write additional reference models, the entire verification environment setup is complete, and you can directly write test cases using the interfaces provided by the Env. For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">port1_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StackPortBundle</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">port2_bundle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StackPortBundle</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DualPortStackEnv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">port1_bundle</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">port2_bundle</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port1_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port2_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port1_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port2_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><h2 id="attaching-reference-models">Attaching Reference Models</h2>
<p>Once the Env is defined, the interfaces for the entire verification environment are also established, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span><span style="color:#000">DualPortStackEnv</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">port1_agent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">push</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">pop</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@monitor_method</span> <span style="color:#000">some_monitor</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">port2_agent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">push</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">pop</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@monitor_method</span> <span style="color:#000">some_monitor</span>
</span></span></code></pre></div><p>Reference models written according to this specification can be directly attached to the Env, allowing it to automatically synchronize the reference models. This can be done as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DualPortStackEnv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">port1_bundle</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">port2_bundle</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">attach</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">StackRefModel</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>An Env can attach multiple reference models, all of which will be automatically synchronized by the Env.</p>
<p>The specific method for writing reference models will be detailed in the section on writing reference models.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-561e9af58bbb529ed50067d0df763d91">4.3.5 - How to Write a Reference Model</h1>
    
	<p>A <code>reference model</code> is used to simulate the behavior of the design under verification, aiding in the validation process. In the mlvp verification environment, the reference model needs to follow the <code>Env</code> interface specifications so it can be attached to <code>Env</code>, allowing automatic synchronization by <code>Env</code>.</p>
<h2 id="two-ways-to-implement-a-reference-model">Two Ways to Implement a Reference Model</h2>
<p>mlvp provides two methods for implementing a reference model, both of which can be attached to <code>Env</code> for automatic synchronization. Depending on the scenario, you can choose the most suitable method for your reference model implementation.These two methods are <strong>function call mode</strong>  and <strong>independent execution flow mode</strong> . Below, we will introduce both concepts in detail.</p>
<h3 id="function-call-mode">Function Call Mode</h3>
<p><strong>Function call mode</strong>  defines the reference model&rsquo;s external interface as a series of functions, driving the reference model&rsquo;s behavior by calling these functions. In this mode, data is passed to the reference model through input parameters, and the model&rsquo;s output data is retrieved through return values. The internal state of the reference model is updated through the logic within the function body.
Here is a simple example of a reference model implemented in function call mode:</p>
<p>For instance, this is a simple reference model of an adder:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderRefModel</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">b</span>
</span></span></code></pre></div><p>In this reference model, there is no need for any internal state. All functionalities are handled through a single external function interface.</p>
<p>Note that reference models written in function call mode can only be executed through external function calls and cannot output internal data passively. As a result, they cannot be matched with the monitoring methods in an Agent. Writing monitoring methods in the Agent is meaningless when using a reference model written in function call mode.</p>
<h3 id="independent-execution-flow-mode">Independent Execution Flow Mode</h3>
<p><strong>Independent execution flow mode</strong>  defines the reference model&rsquo;s behavior as an independent execution flow. Instead of being controlled by external function calls, the reference model can actively fetch input data and output data. When external data is sent to the reference model, it does not respond immediately. Instead, it stores the data and waits for its logic to actively retrieve and process the data.
Here is a code snippet that demonstrates this mode using concepts provided by mlvp, though understanding these concepts in detail is not required at the moment.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AdderRefModel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_port</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DriverPort</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum_port</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MonitorPort</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">while</span> <span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">operands</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_port</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">sum</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">operands</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;a&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">operands</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;b&#34;</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sum_port</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>In this example, two types of interfaces are defined in the constructor of the reference model: a <strong>driver interface (DriverPort)</strong> , represented by <code>add_port</code>, which receives external input data, and a <strong>monitoring interface (MonitorPort)</strong> , represented by <code>sum_port</code>, which outputs data to the external environment.Once these interfaces are defined, the reference model does not trigger a specific function when data is sent to it. Instead, the data is sent to the <code>add_port</code> driver interface. At the same time, external code cannot proactively retrieve output data from the reference model. The model will actively output the result data via the <code>sum_port</code> monitoring interface.How does the reference model utilize these interfaces? The reference model has a main function, which is its execution entry point. When the reference model is created, the main function is automatically called and runs continuously in the background. In the code above, the main function continuously waits for data from the <code>add_port</code>, computes the result, and outputs the result to the <code>sum_port</code>.The reference model actively requests data from the <code>add_port</code>, and if there is no data, it waits for new data. Once data arrives, it processes the data and proactively outputs the result to the <code>sum_port</code>. This execution flow operates independently and is not controlled by external function calls. When the reference model becomes more complex, with multiple driver and monitoring interfaces, the independent execution flow is particularly useful for handling interactions, especially when the interfaces have a specific call order.</p>
<h2 id="how-to-write-a-function-call-mode-reference-model">How to Write a Function Call Mode Reference Model</h2>
<h3 id="driver-function-matching">Driver Function Matching</h3>
<p>Suppose the following interface is defined in the Env:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span><span style="color:#000">StackEnv</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">port_agent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">push</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">pop</span>
</span></span></code></pre></div><p>If you want to write a reference model that corresponds to this interface, you need to define the behavior of the reference model for each driver function. For each driver function, write a corresponding function in the reference model that will be automatically called when the driver function is invoked.
To match a function in the reference model with a specific driver function, you should use the <code>@driver_hook</code> decorator to indicate that the function is a match for a driver function. Then, specify the corresponding Agent and driver function name in the decorator. Finally, ensure that the function parameters match those of the driver function, and the two will be linked.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">StackRefModel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_hook</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">driver_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_hook</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">driver_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;pop&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">pop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">pass</span>
</span></span></code></pre></div><p>At this point, the driver function is linked with the reference model function. When a driver function in the Env is called, the corresponding reference model function will be automatically invoked, and their return values will be compared.</p>
<p>mlvp also provides several matching methods to improve flexibility:
<strong>Specify the Driver Function Path</strong>
You can specify the driver function path using a &ldquo;.&rdquo;. For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">StackRefModel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_hook</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;port_agent.push&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_hook</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;port_agent.pop&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">pop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">pass</span>
</span></span></code></pre></div><p><strong>Match Driver Function Name with Function Name</strong> If the reference model function name is the same as the driver function name, you can omit the <code>driver_name</code> parameter:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">StackRefModel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_hook</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_hook</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">pop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">pass</span>
</span></span></code></pre></div><p><strong>Match Both Agent and Driver Function Names</strong> By using a double underscore <code>__</code>, you can match both the Agent and the driver function names:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">StackRefModel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_hook</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">port_agent__push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@driver_hook</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">port_agent__pop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">pass</span>
</span></span></code></pre></div><h3 id="agent-matching">Agent Matching</h3>
<p>Instead of writing a separate <code>driver_hook</code> for each driver function in the Agent, you can use the <code>@agent_hook</code> decorator to match all the driver functions in an Agent at once.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">StackRefModel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@agent_hook</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">port_agent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">driver_name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">pass</span>
</span></span></code></pre></div><p>In this example, the <code>port_agent</code> function will match all the driver functions in the <code>port_agent</code> Agent. When any driver function in the Agent is called, the <code>port_agent</code> function will be invoked automatically. Besides <code>self</code>, the <code>port_agent</code> function should take exactly two parameters: the first is the name of the driver function, and the second is the arguments passed to the driver function.When a driver function is called, the <code>driver_name</code> parameter will receive the name of the driver function, and the <code>args</code> parameter will receive the arguments passed during the call, represented as a dictionary. The <code>port_agent</code> function can then decide how to handle the driver function call based on <code>driver_name</code> and <code>args</code> and return the result. The framework will automatically compare the return value of this function with that of the driver function.Similar to driver functions, the <code>@agent_hook</code> decorator allows you to omit the <code>agent_name</code> parameter when the function name matches the Agent name.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">StackRefModel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@agent_hook</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">port_agent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">driver_name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">pass</span>
</span></span></code></pre></div><p><strong>Using Both agent_hook and driver_hook</strong> Once an <code>agent_hook</code> is defined, in theory, there is no need to define any <code>driver_hook</code> to match driver functions in the Agent. However, if special handling is needed for a specific driver function, a <code>driver_hook</code> can still be defined to match that driver function.When both <code>agent_hook</code> and <code>driver_hook</code> are present, the framework will first call the <code>agent_hook</code> function, followed by the <code>driver_hook</code> function. The result of the <code>driver_hook</code> function will be used for comparison.Once all the driver functions in the Env have corresponding <code>driver_hook</code> or <code>agent_hook</code> matches, the reference model can be attached to the Env using the <code>attach</code> method.</p>
<h2 id="how-to-write-an-independent-execution-flow-reference-model">How to Write an Independent Execution Flow Reference Model</h2>
<p>An independent execution flow reference model handles input and output through <code>port</code> interfaces, where it can actively request or send data. In mlvp, two types of interfaces are provided for this purpose: <code>DriverPort</code> and <code>MonitorPort</code>.Similarly, a series of <code>DriverPort</code> objects can be defined to match the driver functions in the Env, and a series of <code>MonitorPort</code> objects can be defined to match the monitor functions.When a driver function in the Env is called, the data from the call is sent to the <code>DriverPort</code>. The reference model will actively fetch this data, perform calculations, and output the result to the <code>MonitorPort</code>. When a monitor function in the Env is called, the comparator will automatically retrieve the data from the <code>MonitorPort</code> and compare it with the return value of the monitor function.</p>
<h3 id="driver-method-interface-matching">Driver Method Interface Matching</h3>
<p>To receive all driver function calls from the Env, the reference model can define a corresponding <code>DriverPort</code> for each driver function. The <code>DriverPort</code> parameters <code>agent_name</code> and <code>driver_name</code> are used to match the driver functions in the Env.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">StackRefModel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push_port</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DriverPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">driver_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pop_port</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DriverPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">driver_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;pop&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Similar to <code>driver_hook</code>, you can also match the driver functions in the Env in the following ways:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Specify the driver function path using &#34;.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push_port</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DriverPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;port_agent.push&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># If the variable name in the reference model matches the driver function name, you can omit the driver_name parameter</span>
</span></span><span style="display:flex;"><span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DriverPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Match both the Agent name and driver function name using `__` to separate them</span>
</span></span><span style="display:flex;"><span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_agent__push</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DriverPort</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><h3 id="agent-interface-matching">Agent Interface Matching</h3>
<p>You can also define an <code>AgentPort</code> to match all driver functions in an Agent. Unlike <code>agent_hook</code>, once an <code>AgentPort</code> is defined, no <code>DriverPort</code> can be defined for any driver function in that Agent. All driver function calls will be sent to the <code>AgentPort</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">StackRefModel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_agent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AgentPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Similarly, when the variable name matches the Agent name, you can omit the <code>agent_name</code> parameter:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_agent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AgentPort</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><h2 id="monitor-method-interface-matching">Monitor Method Interface Matching</h2>
<p>To match the monitor functions in the Env, the reference model needs to define a corresponding <code>MonitorPort</code> for each monitor function. The definition method is the same as for <code>DriverPort</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">monitor_port</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MonitorPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">monitor_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;monitor&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Specify the monitor function path using &#34;.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">monitor_port</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MonitorPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;port_agent.monitor&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># If the variable name in the reference model matches the monitor function name, you can omit the monitor_name parameter</span>
</span></span><span style="display:flex;"><span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">monitor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MonitorPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;port_agent&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Match both the Agent name and monitor function name using `__` to separate them</span>
</span></span><span style="display:flex;"><span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port_agent__monitor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MonitorPort</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>The data sent to the <code>MonitorPort</code> will automatically be compared with the return value of the corresponding monitor function in the Env.Once all <code>DriverPort</code>, <code>AgentPort</code>, and <code>MonitorPort</code> definitions in the reference model successfully match the interfaces in the Env, the reference model can be attached to the Env using the <code>attach</code> method.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3c86338d72241e31623b577659ea691b">4.4 - Writing Test Cases</h1>
    
	<p>Writing test cases requires utilizing the interfaces defined in the verification environment. However, it is often necessary to drive multiple interfaces simultaneously in the test case, and there are often different synchronization needs with reference simulations. This section will provide a detailed explanation of how to better use the interfaces in the verification environment for writing test cases.
Once the verification environment is set up, test cases are written to verify whether the design functions as expected. Two important aspects of hardware verification are <strong>functional coverage</strong>  and <strong>line coverage</strong> . Functional coverage means whether the test cases cover all the functions of the design, while line coverage means whether the test cases trigger all lines of the design’s code. In mlvp, not only is support provided for both types of coverage, but after each run, the tool automatically calculates the results for both and generates a verification report. mlvp uses pytest to manage test cases, which provides powerful test case management capabilities.
In this section, we will cover how to write test cases to take advantage of the powerful features provided by mlvp in the following areas:</p>
<ol>
<li>
<p>How to use test environment interfaces for driving</p>
</li>
<li>
<p>How to manage test cases with pytest</p>
</li>
<li>
<p>How to add functional test points</p>
</li>
</ol>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-59f61aa8e02aaee75f4d59274ed9c583">4.4.1 - How to Drive Using Test Environment Interfaces</h1>
    
	<h2 id="how-to-simultaneously-call-multiple-driver-functions">How to Simultaneously Call Multiple Driver Functions</h2>
<p>Once the verification environment is set up, you can write test cases using the interfaces provided by the verification environment. However, it is often difficult to call two driver functions simultaneously using conventional serial code. This becomes especially important when multiple interfaces need to be driven at the same time, and mlvp provides a simple way to handle such scenarios.</p>
<h3 id="simultaneously-calling-multiple-driver-functions-of-different-categories">Simultaneously Calling Multiple Driver Functions of Different Categories</h3>
<p>For example, suppose the current Env structure is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span><span style="color:#000">DualPortStackEnv</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">port1_agent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">push</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">pop</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">port2_agent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">push</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">pop</span>
</span></span></code></pre></div><p>We want to call the <code>push</code> functions of both <code>port1_agent</code> and <code>port2_agent</code> simultaneously in a test case, to drive both interfaces at the same time.In mlvp, this can be achieved using the <code>Executor</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Executor</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">Executor</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port1_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port2_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;result&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">exec</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_results</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>We use <code>async with</code> to create an <code>Executor</code> object and establish an execution block. By directly calling <code>exec</code>, you can add the driver functions that need to be executed. When the <code>Executor</code> object exits the scope, all added driver functions will be executed simultaneously. The <code>Executor</code> will automatically wait for all the driver functions to complete.If you need to retrieve the return values of the driver functions, you can use the <code>get_results</code> method. <code>get_results</code> returns a dictionary where the keys are the names of the driver functions, and the values are lists containing the return values of the respective driver functions.</p>
<h3 id="multiple-calls-to-the-same-driver-function">Multiple Calls to the Same Driver Function</h3>
<p>If the same driver function is called multiple times in the execution block, <code>Executor</code> will automatically serialize these calls.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Executor</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">Executor</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port1_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port2_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;result&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">exec</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_results</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>In the code above, <code>port1_agent.push</code> will be called 5 times, and <code>port2_agent.push</code> will be called once. Since <code>port1_agent.push</code> is the same driver function, <code>Executor</code> will automatically serialize these 5 calls, and the return values will be stored sequentially in the result list. Meanwhile, <code>port2_agent.push</code> will execute in parallel with the serialized <code>port1_agent.push</code> calls.
In this process, we created a scheduling process like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">------------------  current time --------------------
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">---------------------+   +---------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">group</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agent1.push&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">group</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agent2.push&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">-----------------+ |   | +-----------------+ |
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">agent1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">agent2</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">-----------------+ |   | +-----------------+ |
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">-----------------+ |   +---------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">agent1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">-----------------+ |
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">-----------------+ |
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">agent1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">-----------------+ |
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">-----------------+ |
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">agent1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">-----------------+ |
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">-----------------+ |
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">agent1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">-----------------+ |
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#8f5902;font-style:italic">---------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">------------------- Executor exit -------------------
</span></span></span></code></pre></div><p><code>Executor</code> automatically created two scheduling groups based on the function names of the driver functions, and the driver functions were added to their respective groups in the order they were called. Inside the scheduling group, the driver functions are executed sequentially. Across groups, driver functions are executed in parallel.The default name for the scheduling group is the driver function’s path name, separated by periods (<code>.</code>).Using the <code>sche_group</code> parameter, you can manually specify which scheduling group a driver function call belongs to. For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Executor</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">Executor</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port1_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">sche_group</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;group1&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port2_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">sche_group</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;group1&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;result&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">exec</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_results</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>In this case, <code>port1_agent.push</code> and <code>port2_agent.push</code> will be added sequentially to the same scheduling group, <code>group1</code>, and they will execute in series. In the dictionary returned by <code>get_results</code>, <code>group1</code> will be the key, and its value will be a list of the return values for all the driver functions in <code>group1</code>.</p>
<h3 id="adding-custom-functions-to-the-executor">Adding Custom Functions to the Executor</h3>
<p>If we call driver functions or other functions from a custom function and wish to schedule the custom function through the <code>Executor</code>, we can add the custom function in the same way as we add driver functions.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Executor</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">multi_push_port1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">times</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">times</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port1_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">Executor</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">multi_push_port1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">port2_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;result&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">exec</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_results</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>Here, <code>multi_push_port1</code> will be added to the <code>Executor</code>, creating a scheduling group named <code>multi_push_port1</code> and adding two calls to it. This will execute in parallel with the <code>port2_agent.push</code> group.We can also use <code>Executor</code> within custom functions, or call other custom functions, allowing us to create arbitrarily complex scheduling scenarios with <code>Executor</code>.</p>
<h3 id="example-scenarios">Example Scenarios:</h3>
<p><strong>Scenario 1</strong> :
The environment interface is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span><span style="color:#000">Env</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">agent1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">send</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">agent2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">@driver_method</span> <span style="color:#204a87">send</span>
</span></span></code></pre></div><p>The <code>send</code> function in both agents needs to be called 5 times in parallel, sending the result of the previous call each time, with the first call sending <code>0</code>. The two function calls are independent of each other.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Executor</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">send</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">send</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_send</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">Executor</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">send</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">agent1</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">sche_group</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;agent1&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">send</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">agent2</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">sche_group</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;agent2&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;result&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">exec</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_results</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p><strong>Scenario 2</strong> :
The environment interface is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>env
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">-</span> agent1
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">-</span> <span style="color:#ce5c00">@driver_method</span> long_task
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">-</span> agent2
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">-</span> <span style="color:#ce5c00">@driver_method</span> task1
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">-</span> <span style="color:#ce5c00">@driver_method</span> task2
</span></span></code></pre></div><p><code>task1</code> and <code>task2</code> need to be executed in parallel, with synchronization after each call. Both need to be called 5 times, and <code>long_task</code> needs to execute in parallel with <code>task1</code> and <code>task2</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Executor</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">exec_once</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">Executor</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">agent2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">task1</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">agent2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">task2</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_case</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">Executor</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">exec_once</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">agent1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">long_task</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;result&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">exec</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_results</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><h3 id="setting-executor-exit-conditions">Setting Executor Exit Conditions</h3>
<p>The <code>Executor</code> will wait for all driver functions to complete before exiting, but sometimes it’s unnecessary to wait for all functions. You can set the exit condition using the <code>exit</code> parameter when creating the <code>Executor</code>.The <code>exit</code> parameter can be set to <code>all</code>, <code>any</code>, or <code>none</code>, which correspond to exiting after all groups finish, after any group finishes, or immediately without waiting.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Executor</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">send_forever</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">while</span> <span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">send</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_send</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">Executor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">exit</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;any&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">send_forever</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">agent1</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">agent2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">send</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;result&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">exec</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_results</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p>In this code, the <code>send_forever</code> function runs in an infinite loop. By setting <code>exit=&quot;any&quot;</code>, the <code>Executor</code> will exit after <code>env.agent2.send</code> completes, without waiting for <code>send_forever</code>.If needed later, you can wait for all tasks to complete by calling <code>exec.wait_all</code>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-20d016e97daff972eb4b248aee8c24c1">4.4.2 - How to Use Pytest to Manage Test Cases</h1>
    
	<h2 id="writing-test-cases">Writing Test Cases</h2>
<p>In <code>mlvp</code>, test cases are managed using <code>pytest</code>. <code>pytest</code> is a powerful Python testing framework. If you are not familiar with <code>pytest</code>, you can refer to the <a href="https://docs.pytest.org/en/latest/">official pytest documentation</a> .</p>
<h3 id="writing-your-first-test-case">Writing Your First Test Case</h3>
<p>First, we need to create a test case file, for example, <code>test_adder.py</code>. The file should start with <code>test_</code> or end with <code>_test.py</code> so that <code>pytest</code> can recognize it. Then we can write our first test case in it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># test_adder.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">my_test</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderEnv</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_adder</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">mlvp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">my_test</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><p><code>pytest</code> cannot directly run coroutine test cases, so we need to call <code>mlvp.run</code> in the test case to execute the asynchronous test case.Once the test case is written, we can run <code>pytest</code> in the terminal.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pytest
</span></span></code></pre></div><p><code>pytest</code> will look for all files in the current directory that start with <code>test_</code> or end with <code>_test.py</code> and will run the functions that start with <code>test_</code>, treating each function as a test case.</p>
<h3 id="running-coroutine-test-cases">Running Coroutine Test Cases</h3>
<p>To enable <code>pytest</code> to run coroutine test cases directly, <code>mlvp</code> provides the <code>mlvp_async</code> marker to mark asynchronous test cases.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># test_adder.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@pytest.mark.mlvp_async</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_adder</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderEnv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>As shown, we simply need to add the <code>@pytest.mark.mlvp_async</code> marker to the test case function, and <code>pytest</code> will be able to run coroutine test cases directly.</p>
<h2 id="generating-test-reports">Generating Test Reports</h2>
<p>When running <code>pytest</code>, <code>mlvp</code> will automatically collect the execution results of test cases, tally coverage information, and generate a validation report. To generate this report, you need to add the <code>--mlvp-report</code> parameter when calling <code>pytest</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pytest --mlvp-report
</span></span></code></pre></div><p>By default, <code>mlvp</code> will generate a default report name for each run and place the report in the <code>reports</code> directory. You can specify the report storage directory using the <code>--report-dir</code> parameter and the report name using the <code>--report-name</code> parameter.However, at this point, since <code>mlvp</code> cannot determine the coverage file name, the report cannot display coverage information. If you want coverage information to be shown in the report, you need to pass the functional coverage group and line coverage file name in each test case.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@pytest.mark.mlvp_async</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_adder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">request</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">adder</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">waveform_filename</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;adder.fst&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">coverage_filename</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;adder.dat&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">g</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">CovGroup</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Adder&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderEnv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adder</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">adder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Finish</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">set_func_coverage</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">request</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cov_groups</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">set_line_coverage</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">request</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;adder.dat&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>In the code above, when creating the DUT, we pass the names of the waveform file and coverage file, allowing the DUT to generate a coverage file with the specified name during execution. Then we define a coverage group to collect the functional coverage information of the DUT, which will be explained in detail in the next document.
Next, we call the DUT&rsquo;s <code>Finish</code> method to stop recording the waveform file. Finally, we use the <code>set_func_coverage</code> and <code>set_line_coverage</code> functions to set the functional coverage group and line coverage file information.When we run <code>pytest</code> again, <code>mlvp</code> will automatically collect the coverage information and display it in the report.Managing Resources with <code>mlvp</code>
However, the above process is quite cumbersome, and to ensure that file names do not conflict between each test case, we need to pass different file names in each test case. Additionally, if a test case encounters an exception, it will not complete, resulting in the coverage file not being generated.
Therefore, <code>mlvp</code> provides the <code>mlvp_pre_request</code> Fixture to manage resources and simplify the writing of test cases.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># test_adder.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@pytest.mark.mlvp_async</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_adder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">my_request</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">my_request</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AdderEnv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dut</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_agent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exec_add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@pytest.fixture</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">my_request</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mlvp_pre_request</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">PreRequest</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">mlvp_pre_request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_cov_groups</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">CovGroup</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Adder&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">mlvp_pre_request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_dut</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">DUTAdder</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Fixtures are a concept in <code>pytest</code>. In the code above, we define a fixture named <code>my_request</code>. If any other test case has an output parameter containing the <code>my_request</code> parameter, <code>pytest</code> will automatically call the <code>my_request</code> fixture and pass its return value to the test case.In the code above, we defined a custom fixture <code>my_request</code> and used it in the test case, which means that the resource management will be handled within the fixture, allowing the test case to focus solely on the test logic. The <code>my_request</code> fixture must use <code>mlvp</code>&rsquo;s provided <code>mlvp_pre_request</code> fixture as a parameter for resource management. The <code>mlvp_pre_request</code> fixture provides a series of methods for managing resources.By using <code>add_cov_groups</code>, the coverage group will be automatically included in the report.
Using <code>create_dut</code>, a DUT instance is created, and <code>mlvp</code> will automatically manage the generation of the DUT&rsquo;s waveform and coverage files, ensuring that file names do not conflict.In <code>my_request</code>, you can customize the return values passed to the test case. If you want any test case to access the fixture, you can define the fixture in the <code>conftest.py</code> file.
Thus, we have achieved the separation of test case resource management and logic writing, eliminating the need to manually manage resource creation and release in each test case.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a072beec952896e88e69f09e9e661bc0">4.4.3 - How to Write Test Points</h1>
    
	<h2 id="test-points-in-verification">Test Points in Verification</h2>
<p>In mlvp, a <strong>test point (Cover Point)</strong>  refers to the smallest unit of verification for a specific function of the design, while a <strong>test group (Cover Group)</strong>  is a collection of related test points.
To define a test point, you need to specify the name of the test point and its trigger condition. For example, you can define a test point such as, &ldquo;When the result of the adder operation is non-zero, the result is correct.&rdquo; In this case, the trigger condition for the test point could be &ldquo;the sum signal of the adder is non-zero.&rdquo;</p>
<p>When the trigger condition of the test point is met, the test point is triggered. At this moment, the verification report will record the triggering of the test point and increase the functional coverage of the verification. When all test points are triggered, the functional coverage of the verification reaches 100%.</p>
<h2 id="how-to-write-test-points">How to Write Test Points</h2>
<p>Before writing test points, you first need to create a test group and specify the name of the test group:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mlvp.reporter</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">CovGroup</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">g</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">CovGroup</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Adder addition function&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Next, you need to add test points to this test group:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># import mlvp.funcov as fc</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># g.add_watch_point(adder.io_cout, {&#34;io_cout is 0&#34;: fc.Eq(0)}, name=&#34;Cout is 0&#34;)</span>
</span></span></code></pre></div><p>TBD (To Be Determined)</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-218ae6a2d4629a583763e808ab9baf63">4.5 - Starting a New Verification Task</h1>
    
	<p>With mlvp, you can now set up a complete verification environment and conveniently write test cases. However, in real-world scenarios, it can be challenging to understand how to get started and ultimately complete a verification task. After writing code, common issues may include difficulties in correctly partitioning the Bundle, misunderstanding the high-level semantic encapsulation of the Agent, and not knowing what to do after setting up the environment.</p>
<p>In this section, we will introduce how to complete a new verification task from scratch and how to use mlvp effectively to accomplish it.</p>
<h2 id="1-understanding-the-design-under-test-dut">1. Understanding the Design Under Test (DUT)</h2>
<p>When you first encounter a new design, you may face dozens or even hundreds of input and output signals, which can be overwhelming. At this point, you must trust that these signals are defined by the design engineers, and by understanding the functionality of the design, you can infer the meaning of these signals.</p>
<p>If the design team provides documentation, you can read it to understand the functionality of the design and map the functions to the input and output signals. You should also gain a clear understanding of the signal timing and how to use these signals to drive the design. Generally, you will also need to review the design&rsquo;s source code to uncover more detailed timing issues.</p>
<p>Once you have a basic understanding of the DUT&rsquo;s functionality and how to drive its interface, you can start building the verification environment.</p>
<h2 id="2-partitioning-the-bundle">2. Partitioning the Bundle</h2>
<p>The first step in setting up the environment is to logically partition the interface into several sets, with each set of interfaces considered as a Bundle. Each Bundle should be driven by an independent Agent.</p>
<p>However, in practice, interfaces may appear like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|----------------------</span> <span style="color:#000">DUT</span> <span style="color:#000">Bundle</span> <span style="color:#8f5902;font-style:italic">-------------------------------|</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|-------</span> <span style="color:#000">Bundle</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#8f5902;font-style:italic">------| |------ Bundle 2 ------| |-- Bundle 3 --|</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">|--</span> <span style="color:#000">B1</span><span style="color:#0000cf;font-weight:bold">.1</span> <span style="color:#8f5902;font-style:italic">--| |-- B1.2 --| |-- B2.1 --|</span>
</span></span></code></pre></div><p>This raises the question: should B1.1 and B1.2 each have their own Agent, or should a single Agent be created for Bundle 1?</p>
<p>The answer depends on the logic of the interface. If a request requires simultaneous operations on both B1.1 and B1.2, then you should create one Agent for Bundle 1 rather than creating separate Agents for B1.1 and B1.2.</p>
<p>That said, creating individual Agents for B1.1 and B1.2 is also feasible. This increases the granularity of the Agent but sacrifices operational continuity, making the upper-level code and reference model more complex. Therefore, the appropriate granularity depends on the specific use case. In the end, all Agents combined should cover the entire DUT Bundle interface.
In practice, for convenience in connecting the DUT, you can define a <code>DUT</code> Bundle that connects all interfaces to this Bundle at once, and then the <code>Env</code> can distribute the sub-Bundles to their respective Agents.</p>
<h2 id="3-writing-the-agent">3. Writing the Agent</h2>
<p>After partitioning the Bundle, you can start writing the Agents to drive them. You need to write an Agent for each Bundle.</p>
<p>First, you can begin by writing the driver methods, which are high-level semantic encapsulations of the Bundle. These high-level semantic details should carry all the information necessary to drive the Bundle. If a signal in the Bundle requires a value but the method parameters don’t provide the corresponding information, then the encapsulation is incomplete. Avoid assuming any signal values within the driver methods; otherwise, the DUT&rsquo;s output will be affected by these assumptions, potentially causing discrepancies between the reference model and the DUT.</p>
<p>This high-level encapsulation also defines the functionality of the reference model, which interacts directly with the high-level semantic information, not with the low-level signals.</p>
<p>If the reference model is written using function-call mode, the DUT’s outputs should be returned through function return values. If the reference model uses a separate execution flow, you should write monitoring methods that convert the DUT’s outputs into high-level semantic information and output them via the monitoring methods.</p>
<h2 id="4-encapsulating-into-env">4. Encapsulating into Env</h2>
<p>Once all the Agents are written or selected from existing Agents, you can encapsulate them into the <code>Env</code>.<code>Env</code> encapsulates the entire verification environment and defines the writing conventions for the reference model.</p>
<h2 id="5-writing-the-reference-model">5. Writing the Reference Model</h2>
<p>Writing the reference model doesn’t need to wait until the <code>Env</code> is complete—it can be done alongside the Agent development, with some driving code written in real-time to verify correctness. Of course, if the Agent is well-structured, writing the reference model after the complete <code>Env</code> is created is also feasible.
The most important part of the reference model is choosing the appropriate mode—both function-call mode and separate execution flow mode are viable, but the selection depends on the specific use case.</p>
<h2 id="6-identifying-functional-and-test-points">6. Identifying Functional and Test Points</h2>
<p>After writing the <code>Env</code> and reference model, you cannot immediately start writing test cases because there is no direction yet for writing them. Blindly writing test cases won’t ensure complete verification of the design.
First, you need to list the functional and test points. Functional points refer to all the functionalities supported by the design. For example, for an arithmetic logic unit (ALU), functional points could be &ldquo;supports addition&rdquo; or &ldquo;supports multiplication.&rdquo; Each functional point should correspond to one or more test points, which break the function into different test scenarios to verify whether the functional point is correct. For example, for the &ldquo;supports addition&rdquo; functional point, test points could include &ldquo;addition is correct when both inputs are positive.&rdquo;</p>
<h2 id="7-writing-test-cases">7. Writing Test Cases</h2>
<p>Once the list of functional and test points is determined, you can start writing test cases. Each test case should cover one or more test points to verify whether the functional point is correct. All test cases combined should cover all test points (100% functional coverage) and all lines of code (100% line coverage), ensuring verification completeness.
How can you ensure verification correctness? If the reference model comparison method is used, mlvp will automatically throw an exception when a mismatch occurs, causing the test case to fail. If a direct comparison method is used, you should use <code>assert</code> in the test case to write comparison code. When the comparison fails, the test case will also fail. When all test cases pass, the functionality is confirmed as correct.When writing, use the interfaces provided by <code>Env</code> to drive the DUT. If interaction between multiple driver methods is needed, you can use the <code>Executor</code> to encapsulate higher-level functions. In other words, interactions at the driver method level should be handled during test case development.</p>
<h2 id="8-writing-the-verification-report">8. Writing the Verification Report</h2>
<p>Once 100% line and functional coverage is achieved, the verification is complete. A verification report should be written to summarize the results. If issues are found in the DUT, the report should provide detailed descriptions of the causes. If 100% coverage is not achieved, the report should explain why. The format of the report should follow the company&rsquo;s internal standards.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c7e9635323f5bcd8850571649a8a42b8">4.6 - API Documentation</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-bd013f36b484950df4c10662b7c51cde">4.6.1 - Bundle API</h1>
    
	
</div>



    
	
  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9bbc770803b9bc1e63b3586d9d27b4a2">5 - Advanced Case Studies</h1>
    <div class="lead">Complex case studies completed using the open verification platform.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-def016dedd85ad313b8a6618f0995331">5.1 - Complete Verification of Nutshell Cache</h1>
    <div class="lead">Verification of Nutshell Cache using Python.</div>
	<h2 id="verification-report">Verification Report</h2>
<p>Chinese version:<br>
<a href="https://github.com/XS-MLVP/Example-NutShellCache/blob/master/nutshell_cache_report_demo.pdf">https://github.com/XS-MLVP/Example-NutShellCache/blob/master/nutshell_cache_report_demo.pdf</a></p>
<p>English verision:<br>
TBD</p>
<h2 id="verification-environment--test-case-code">Verification Environment &amp; Test Case Code</h2>
<p><a href="https://github.com/XS-MLVP/Example-NutShellCache">https://github.com/XS-MLVP/Example-NutShellCache</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ddd72ebc8a861fa48194266f6ffaaf60">5.2 - TileLink Protocol</h1>
    <div class="lead">Using TileLink Protocol for L2 Cache Driven by C++</div>
	
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-636f24d07e5c63a708ce945a0d50c36c">6 - Multi-language Support</h1>
    <div class="lead">The Open Verification Platform supports multiple languages.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-cd5f02d8062ce0e1861c417988fc8c9e">6.1 - Using C&#43;&#43;</h1>
    <div class="lead">Encapsulate the DUT hardware runtime environment with C++ and compile it into a dynamic library.</div>
	<h2 id="principle-introduction">Principle Introduction</h2>
<h3 id="basic-library">Basic Library</h3>
<p>In this chapter, we will introduce how to use Picker to compile RTL code into a C++ class and compile it into a dynamic library.</p>
<ol>
<li>
<p>First, the Picker tool parses the RTL code, creates a new module based on the specified Top Module, encapsulates the module&rsquo;s <strong>input and output ports</strong>, and exports <code>DPI/API</code> to operate the input ports and read the output ports.</p>
<blockquote>
<p><em>The tool determines the module to be encapsulated by specifying the file and Module Name of the Top Module. At this point, you can understand Top as the main function in software programming.</em></p>
</blockquote>
</li>
<li>
<p>Next, the Picker tool uses the specified <strong>simulator</strong> to compile the RTL code and generate a <strong>DPI library file</strong>. This library file contains the logic required to simulate running the RTL code (i.e., the <strong>hardware simulator</strong>).</p>
<blockquote>
<p><em>For VCS, this library file is a .so (dynamic library) file, and for Verilator, it is a .a (static library) file.</em>
<em>DPI stands for <a href="https://www.chipverify.com/systemverilog/systemverilog-dpi">Direct Programming Interface</a>，which can be understood as an API specification.</em></p>
</blockquote>
</li>
<li>
<p>Then, the Picker tool renders the base class defined in the source code according to the configuration parameters, generates a base class (wrapper) for interfacing with the simulator and <strong>hides simulator details</strong>, and links the base class with the DPI library file to generate a <strong>UT dynamic library file</strong>.</p>
<blockquote>
<ul>
<li><em>At this point, the <strong>UT library file</strong> uses the unified API provided by the Picker tool template. Compared with the simulator-specific API in the <strong>DPI library file</strong>, the UT library file provides a <strong>unified API interface</strong> for the hardware simulator generated by the simulator.</em></li>
<li><em>The generated <strong>UT library file</strong> is <strong>common</strong> across different languages! Unless otherwise specified, other high-level languages will operate the hardware simulator by <strong>calling the UT dynamic library</strong>.</em></li>
</ul>
</blockquote>
</li>
<li>
<p>Finally, based on the configuration parameters and parsed RTL code, the Picker tool generates a <strong>C++ class</strong> source code. This source code is the <strong>definition (.hpp)</strong> and <strong>implementation (.cpp)</strong> of the RTL hardware module in the software. Instantiating this class is equivalent to creating a hardware module.</p>
<blockquote>
<p><em>This class inherits from the <strong>base class</strong> and implements the pure virtual functions in the base class to instantiate the hardware in software.</em>
<em>There are two reasons for not encapsulating this <strong>class implementation</strong> into the dynamic library:</em></p>
<ol>
<li><em>Since the <strong>UT library file</strong> needs to be <strong>common</strong> across different languages, and different languages have different ways to implement classes, for universality, the <code>class implementation</code> is not encapsulated into the dynamic library.</em></li>
<li><em>To <strong>facilitate debugging</strong>, enhance code readability, and make it easier for users to repackage and modify.</em></li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="generating-executable-files">Generating Executable Files</h3>
<p>In this chapter, we will introduce how to write test cases and generate executable files based on the basic library generated in the previous chapter (including dynamic libraries, class declarations, and definitions).</p>
<ol>
<li>
<p>First, users need to write test cases, which means instantiating the class generated in the previous chapter and calling the methods in the class to operate the hardware module.
Details can be found in [Random Number Generator Verification - Configure Test Code](docs/quick-start/examples/rmg/#Configure Test Code) for instantiation and initialization process.</p>
</li>
<li>
<p>Second, users need to apply different linking parameters to generate executable files based on the <strong>different simulators</strong> applied in the basic library. The corresponding parameters are defined in <code>template/cpp/cmake/*.cmake</code>.</p>
</li>
<li>
<p>Finally, according to the configured linking parameters, the compiler will link the basic library and generate an executable file.</p>
<blockquote>
<p>Taking <a href="docs/quick-start/examples/adder/#%E5%B0%86rtl%E6%9E%84%E5%BB%BA%E4%B8%BAc-class">Adder Verification</a> as an example, <code>picker_out_adder/cpp/cmake/*.cmake</code> is a copy of the template described in item 2 above.
<code>vcs.cmake</code> defines the linking parameters of the basic library generated using the VCS simulator, and <code>verilator.cmake</code> defines the linking parameters of the basic library generated using the Verilator simulator.</p>
</blockquote>
</li>
</ol>
<h2 id="usage">Usage</h2>
<ul>
<li>The parameter <code>--language cpp</code> or <code>-l cpp</code> is used to specify the generation of the C++ basic library.</li>
<li>The parameter <code>-e</code> is used to generate an executable file containing an example project.</li>
<li>The parameter <code>-v</code> is used to retain intermediate files when generating the project.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&#34;UT_Adder.hpp&#34;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">int64_t</span> <span style="color:#000">random_int64</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">random_device</span> <span style="color:#000">rd</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">mt19937_64</span> <span style="color:#000">generator</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">rd</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">uniform_int_distribution</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">int64_t</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">distribution</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">INT64_MIN</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>                                                            <span style="color:#000">INT64_MAX</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">distribution</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">generator</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#if defined(USE_VCS)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">UTAdder</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">UTAdder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;libDPIAdder.so&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#elif defined(USE_VERILATOR)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">UTAdder</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">UTAdder</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#8f5902;font-style:italic">// dut-&gt;initClock(dut-&gt;clock);
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">xclk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Initialized UTAdder</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000">input_t</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">uint64_t</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">uint64_t</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">uint64_t</span> <span style="color:#000">cin</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000">output_t</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">uint64_t</span> <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">uint64_t</span> <span style="color:#000">cout</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">114514</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">c</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">input_t</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">output_t</span> <span style="color:#000">o_dut</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">o_ref</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">a</span>   <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random_int64</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">b</span>   <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random_int64</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random_int64</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">auto</span> <span style="color:#000">dut_cal</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">]()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">a</span>   <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">b</span>   <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">xclk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">o_dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">uint64_t</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">o_dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">uint64_t</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">cout</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">auto</span> <span style="color:#000">ref_cal</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">]()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">uint64_t</span> <span style="color:#000">sum</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">carry</span>   <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sum</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">sum</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">carry</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">carry</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">sum</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">o_ref</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">o_ref</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">carry</span> <span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">dut_cal</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ref_cal</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;[cycle %llu] a=0x%lx, b=0x%lx, cin=0x%lx</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">xclk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">clk</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;DUT: sum=0x%lx, cout=0x%lx</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">o_dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">o_dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;REF: sum=0x%lx, cout=0x%lx</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">o_ref</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">o_ref</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Assert</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">o_dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">o_ref</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;sum mismatch&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">delete</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Test Passed, destory UTAdder</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="generating-waveforms">Generating Waveforms</h3>
<p>In C++, the destructor of the DUT automatically calls <code>dut.finalize()</code>, so you only need to <code>delete dut</code> after the test ends to perform post-processing (write waveform, coverage files, etc.).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&#34;UT_Adder.hpp&#34;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">UTAdder</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">dut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">UTAdder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;libDPIAdder.so&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Initialized UTAdder</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">114514</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">c</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">auto</span> <span style="color:#000">dut_cal</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">]()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">a</span>   <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">b</span>   <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">cin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">xclk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Step</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">o_dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">uint64_t</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">o_dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">uint64_t</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">cout</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">dut_cal</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;[cycle %llu] a=0x%lx, b=0x%lx, cin=0x%lx</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dut</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">xclk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">clk</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cin</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;DUT: sum=0x%lx, cout=0x%lx</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">o_dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">o_dut</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cout</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">delete</span> <span style="color:#000">dut</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// automatically call dut.finalize() in ~UTAdder()
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Simulation finished</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-28fd3cc543c8fa74cf9e1aa32666d139">6.2 - Using Java ...</h1>
    <div class="lead">Encapsulate the DUT hardware runtime environment with Java and package it as a jar file.</div>
	<p>Currently, Picker supports C++/Python. Other languages such as Java, Golang, Javascript, Scala, etc., will be supported after the Python interface is stabilized.</p>

</div>



    
	
  

    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025
    <span class="td-footer__authors">BOSC</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/mlvp/js/main.min.37d14e870feb76f0f7a2a2422bae231efb0186c477999a4ab9ca7e9924ced592.js" integrity="sha256-N9FOhw/rdvD3oqJCK64jHvsBhsR3mZpKucp&#43;mSTO1ZI=" crossorigin="anonymous"></script>
<script src='/mlvp/js/prism.js'></script>
<script src='/mlvp/js/tabpane-persist.js'></script>

  </body>
</html>
